!function(){"use strict";var He={d:function(t,e){for(var r in e)He.o(e,r)&&!He.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},p:""};!function(){if(void 0!==He){var t=He.u,e=He.e,r=new Map,n=new Map;He.u=function(i){return t(i)+(r.has(i)?"?"+r.get(i):"")},He.e=function(i){return e(i).catch(function(o){var s=n.has(i)?n.get(i):5;if(s<1){var l=t(i);throw o.message="Loading chunk "+i+" failed after 5 retries.\n("+l+")",o.request=l,o}return new Promise(function(c){setTimeout(function(){var p=Date.now();r.set(i,p),n.set(i,s-1),c(He.e(i))},3e3)})})}}}();var Ss={};He.r(Ss),He.d(Ss,{SandboxHost:function(){return $S},SandboxPromise:function(){return QS},SandboxPromise2:function(){return WS},SandboxPromiseHandler:function(){return jS},createSandboxHost:function(){return JS},exportCreateSandboxToGlobal:function(){return XS},exportOnSecurityPolicyViolationToGlobal:function(){return eb},formatModeRelayUIEvents:function(){return gf},injectCustomVisual:function(){return YS},onSecurityPolicyViolation:function(){return KS},relayKeyboardEvents:function(){return hf},relayMouseEvents:function(){return HS},relayTouchEvents:function(){return GS},relayUIEventProps:function(){return yf},relayUIEvents:function(){return vf}});var bs=function(t,e){return(bs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])})(t,e)};function T(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}bs(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ye=function(){return ye=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++)for(var a in r=arguments[n])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},ye.apply(this,arguments)};function W(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}function x(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function nt(t,e,r,n){return new(r||(r=Promise))(function(a,o){function s(f){try{c(n.next(f))}catch(d){o(d)}}function l(f){try{c(n.throw(f))}catch(d){o(d)}}function c(f){f.done?a(f.value):function(a){return a instanceof r?a:new r(function(o){o(a)})}(f.value).then(s,l)}c((n=n.apply(t,e||[])).next())})}function it(t,e){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(f){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=2&c[0]?i.return:c[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,c[1])).done)return a;switch(i=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(a=(a=r.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){r=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){r.label=c[1];break}if(6===c[0]&&r.label<a[1]){r.label=a[1],a=c;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(c);break}a[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(f){c=[6,f],i=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,f])}}}function Ee(t,e,r){if(r||2===arguments.length)for(var a,n=0,i=e.length;n<i;n++)(a||!(n in e))&&(a||(a=Array.prototype.slice.call(e,0,n)),a[n]=e[n]);return t.concat(a||e)}var Cn=window;Cn.powerbi||(Cn.powerbi={});var Ef="True"===Cn.useCDN&&Cn.hashMappings?Cn.cdnUrl:Cn.powerbi.build;He.p=Ef?Ef+"/scripts/":"",_.constant(He.p);var at=function(t){return t[t.Grouping=0]="Grouping",t[t.Measure=1]="Measure",t[t.GroupingOrMeasure=2]="GroupingOrMeasure",t}({}),dr=function(t){return t[t.Create=0]="Create",t[t.Append=1]="Append",t[t.Segment=2]="Segment",t[t.None=3]="None",t}({}),_t=function(t){return t[t.Data=2]="Data",t[t.Resize=4]="Resize",t[t.ViewMode=8]="ViewMode",t[t.Style=16]="Style",t[t.ResizeEnd=32]="ResizeEnd",t[t.FormattingSubSelectionChange=64]="FormattingSubSelectionChange",t[t.FormatModeChange=128]="FormatModeChange",t[t.FilterOptionsChange=256]="FilterOptionsChange",t[t.All=510]="All",t}({}),ab=function(t){return{}}();function Wt(t){var e=t.type||_t.Data;return e&_t.Resize&&2===t.resizeMode&&(e|=_t.ResizeEnd),e}var ub={version:"1.0.0",overloads:function(e,r){return{update:function(i){e.update&&e.update({viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,type:Wt(i)})},destroy:function(){e.destroy&&e.destroy()},enumerateObjectInstances:function(i){return e.enumerateObjectInstances&&e.enumerateObjectInstances(i)||[]}}},hostAdapter:function(e){return{}}},u=function(){function t(){}return t.setAssertFailFunction=function(e){t.assertFailFunction=e},t.assert=function(e,r){},t.setAssert=function(e){t.assert=e},t.assertValue=function(e,r){},t.assertNonEmpty=function(e,r){},t.assertAnyValue=function(e,r){},t.assertFail=function(e){},t.log=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n]},t.logDebug=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n]},t.warn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n]},t.assertNever=function(e){},t.breakDebugger=function(){},t.execute=function(e){},t.isDisabled=function(){return this.disbaled},t.disable=function(){window.DEBUG=!1,this.disbaled=!0},t.disbaled=!1,t}(),Cf=!1;function wf(t,e,r){u.assert(function(){return e>=0&&e<t.length},"startIndex is out of range."),u.assert(function(){return r>=0&&r<t.length},"endIndex is out of range.");for(var n=[],i=e;i<=r;++i)n.push(t[i]);return n}function pr(t,e){u.assert(function(){return e>=0},"Count is negative."),u.assert(function(){return e<=t.length},"Count is too large.");for(var r=[],n=0;n<e;++n)r.push(t[n]);return r}function Vf(t){return u.assertValue(t,"source"),pr(t,t.length)}function Ae(t,e,r){var n;if(t||(t=null),e||(e=null),t===e)return!0;if(!!t!=!!e)return!1;var i=null!==(n=null==t?void 0:t.length)&&void 0!==n?n:0;if(i!==(null==e?void 0:e.length))return!1;for(var a=0;a<i&&r(null==t?void 0:t[a],null==e?void 0:e[a]);)++a;return a===i}function Lr(t){return t&&0===t.length?null:t}function Es(t){u.assertValue(t,"array");var e=t;return e.withName=yb,e}function yb(t){return function(t,e){var r=function(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r].name===e)return r;return-1}(t,e);if(r>=0)return t[r]}(this,t)}function Mf(t,e){u.assertValue(t,"values"),u.assertValue(e,"compareFunction");var r=t.length;if(r>=2)for(var n=1;n<r;n++)if(e(t[n-1],t[n])>0)return!1;return!0}function Cs(t,e){return u.assertValue(t,"values"),u.assertAnyValue(e,"descendingOrder"),Mf(t,e?function(n,i){return i-n}:function(n,i){return n-i})}function hr(t){return _.isArray(t)?t:[t]}function ws(t,e,r){return _.isEmpty(t)||_.isEmpty(e)?_.isEmpty(t)&&_.isEmpty(e):t.length===e.length&&function(t,e,r){for(var n=new Array(e.length),i=0,a=t;i<a.length;i++){for(var o=a[i],s=!1,l=0;l<e.length;l++)if(!n[l]&&r(o,e[l])){s=!0,n[l]=!0;break}if(!s)return!1}return!0}(t,e,r)}Cf||(window.debug=u,window.DEBUG=!1,Cf=!0);var Br=1e-4,Cb=Math.log(10),Df=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13,1e14,1e15,1e16,1e17,1e18,1e19,1e20,1e21,1e22,1e23,1e24,1e25,1e26,1e27,1e28,1e29,1e30,1e31,1e32,1e33,1e34,1e35,1e36,1e37,1e38,1e39,1e40,1e41,1e42,1e43,1e44,1e45,1e46,1e47,1e48,1e49,1e50,1e51,1e52,1e53,1e54,1e55,1e56,1e57,1e58,1e59,1e60,1e61,1e62,1e63,1e64,1e65,1e66,1e67,1e68,1e69,1e70,1e71,1e72,1e73,1e74,1e75,1e76,1e77,1e78,1e79,1e80,1e81,1e82,1e83,1e84,1e85,1e86,1e87,1e88,1e89,1e90,1e91,1e92,1e93,1e94,1e95,1e96,1e97,1e98,1e99,1e100,1e101,1e102,1e103,1e104,1e105,1e106,1e107,1e108,1e109,1e110,1e111,1e112,1e113,1e114,1e115,1e116,1e117,1e118,1e119,1e120,1e121,1e122,1e123,1e124,1e125,1e126,1e127,1e128,1e129,1e130,1e131,1e132,1e133,1e134,1e135,1e136,1e137,1e138,1e139,1e140,1e141,1e142,1e143,1e144,1e145,1e146,1e147,1e148,1e149,1e150,1e151,1e152,1e153,1e154,1e155,1e156,1e157,1e158,1e159,1e160,1e161,1e162,1e163,1e164,1e165,1e166,1e167,1e168,1e169,1e170,1e171,1e172,1e173,1e174,1e175,1e176,1e177,1e178,1e179,1e180,1e181,1e182,1e183,1e184,1e185,1e186,1e187,1e188,1e189,1e190,1e191,1e192,1e193,1e194,1e195,1e196,1e197,1e198,1e199,1e200,1e201,1e202,1e203,1e204,1e205,1e206,1e207,1e208,1e209,1e210,1e211,1e212,1e213,1e214,1e215,1e216,1e217,1e218,1e219,1e220,1e221,1e222,1e223,1e224,1e225,1e226,1e227,1e228,1e229,1e230,1e231,1e232,1e233,1e234,1e235,1e236,1e237,1e238,1e239,1e240,1e241,1e242,1e243,1e244,1e245,1e246,1e247,1e248,1e249,1e250,1e251,1e252,1e253,1e254,1e255,1e256,1e257,1e258,1e259,1e260,1e261,1e262,1e263,1e264,1e265,1e266,1e267,1e268,1e269,1e270,1e271,1e272,1e273,1e274,1e275,1e276,1e277,1e278,1e279,1e280,1e281,1e282,1e283,1e284,1e285,1e286,1e287,1e288,1e289,1e290,1e291,1e292,1e293,1e294,1e295,1e296,1e297,1e298,1e299,1e300,1e301,1e302,1e303,1e304,1e305,1e306,1e307,1e308],Ms=[1,.1,.01,.001,1e-4,1e-5,1e-6,1e-7,1e-8,1e-9,1e-10,1e-11,1e-12,1e-13,1e-14,1e-15,1e-16,1e-17,1e-18,1e-19,1e-20,1e-21,1e-22,1e-23,1e-24,1e-25,1e-26,1e-27,1e-28,1e-29,1e-30,1e-31,1e-32,1e-33,1e-34,1e-35,1e-36,1e-37,1e-38,1e-39,1e-40,1e-41,1e-42,1e-43,1e-44,1e-45,1e-46,1e-47,1e-48,1e-49,1e-50,1e-51,1e-52,1e-53,1e-54,1e-55,1e-56,1e-57,1e-58,1e-59,1e-60,1e-61,1e-62,1e-63,1e-64,1e-65,1e-66,1e-67,1e-68,1e-69,1e-70,1e-71,1e-72,1e-73,1e-74,1e-75,1e-76,1e-77,1e-78,1e-79,1e-80,1e-81,1e-82,1e-83,1e-84,1e-85,1e-86,1e-87,1e-88,1e-89,1e-90,1e-91,1e-92,1e-93,1e-94,1e-95,1e-96,1e-97,1e-98,1e-99,1e-100,1e-101,1e-102,1e-103,1e-104,1e-105,1e-106,1e-107,1e-108,1e-109,1e-110,1e-111,1e-112,1e-113,1e-114,1e-115,1e-116,1e-117,1e-118,1e-119,1e-120,1e-121,1e-122,1e-123,1e-124,1e-125,1e-126,1e-127,1e-128,1e-129,1e-130,1e-131,1e-132,1e-133,1e-134,1e-135,1e-136,1e-137,1e-138,1e-139,1e-140,1e-141,1e-142,1e-143,1e-144,1e-145,1e-146,1e-147,1e-148,1e-149,1e-150,1e-151,1e-152,1e-153,1e-154,1e-155,1e-156,1e-157,1e-158,1e-159,1e-160,1e-161,1e-162,1e-163,1e-164,1e-165,1e-166,1e-167,1e-168,1e-169,1e-170,1e-171,1e-172,1e-173,1e-174,1e-175,1e-176,1e-177,1e-178,1e-179,1e-180,1e-181,1e-182,1e-183,1e-184,1e-185,1e-186,1e-187,1e-188,1e-189,1e-190,1e-191,1e-192,1e-193,1e-194,1e-195,1e-196,1e-197,1e-198,1e-199,1e-200,1e-201,1e-202,1e-203,1e-204,1e-205,1e-206,1e-207,1e-208,1e-209,1e-210,1e-211,1e-212,1e-213,1e-214,1e-215,1e-216,1e-217,1e-218,1e-219,1e-220,1e-221,1e-222,1e-223,1e-224,1e-225,1e-226,1e-227,1e-228,1e-229,1e-230,1e-231,1e-232,1e-233,1e-234,1e-235,1e-236,1e-237,1e-238,1e-239,1e-240,1e-241,1e-242,1e-243,1e-244,1e-245,1e-246,1e-247,1e-248,1e-249,1e-250,1e-251,1e-252,1e-253,1e-254,1e-255,1e-256,1e-257,1e-258,1e-259,1e-260,1e-261,1e-262,1e-263,1e-264,1e-265,1e-266,1e-267,1e-268,1e-269,1e-270,1e-271,1e-272,1e-273,1e-274,1e-275,1e-276,1e-277,1e-278,1e-279,1e-280,1e-281,1e-282,1e-283,1e-284,1e-285,1e-286,1e-287,1e-288,1e-289,1e-290,1e-291,1e-292,1e-293,1e-294,1e-295,1e-296,1e-297,1e-298,1e-299,1e-300,1e-301,1e-302,1e-303,1e-304,1e-305,1e-306,1e-307,1e-308,1e-309,1e-310,1e-311,1e-312,1e-313,1e-314,1e-315,1e-316,1e-317,1e-318,1e-319,1e-320,1e-321,1e-322,1e-323,0];function vr(t){return u.assertValue(t,"exp"),t>=0?t<Df.length?Df[t]:1/0:(t=-t)>0&&t<Ms.length?Ms[t]:0}function gr(t){return u.assert(function(){return t>=0},"val"),t>1&&t<1e16?t<1e8?t<1e4?t<100?t<10?0:1:t<1e3?2:3:t<1e6?t<1e5?4:5:t<1e7?6:7:t<1e12?t<1e10?t<1e9?8:9:t<1e11?10:11:t<1e14?t<1e13?12:13:t<1e15?14:15:t>1e-16&&t<1?t<1e-8?t<1e-12?t<1e-14?t<1e-15?-16:-15:t<1e-13?-14:-13:t<1e-10?t<1e-11?-12:-11:t<1e-9?-10:-9:t<1e-4?t<1e-6?t<1e-7?-8:-7:t<1e-5?-6:-5:t<.01?t<.001?-4:-3:t<.1?-2:-1:oi(Math.log(t)/Cb)}function Ur(t,e){if(void 0===e?e=12:u.assert(function(){return e>=0},"decimalDigits"),t&&isFinite(t)){var r=gr(Math.abs(t));return r<-308?0:vr(Math.max(r-e,1-Ms.length))}}function oi(t,e){e=null!=e?e:Br,u.assert(function(){return e>=0},"precision");var r=Math.round(t);return Math.abs(t-r)<e?r:Math.floor(t)}function Or(t,e){e=jt(e,Br),u.assert(function(){return e>=0},"precision");var r=Math.round(t);return Math.abs(t-r)<e?r:Math.ceil(t)}function Af(t,e){return e=jt(e,Br),u.assert(function(){return e>=0},"precision"),0===e||0===t?t:Math.floor(t/e)*e}function _f(t,e){return e=jt(e,Br),u.assert(function(){return e>=0},"precision"),0===e||0===t?t:Math.ceil(t/e)*e}function ga(t,e){if(e=jt(e,Br),u.assert(function(){return e>=0},"precision"),0===e||0===t)return t;var r=Math.round(t/e)*e,n=Math.round(gr(Math.abs(t))-gr(e))+1;return n>0&&n<16&&(r=parseFloat(r.toPrecision(n))),r}function si(t,e,r){return u.assert(function(){return e<=r},"min must be less or equal to max"),null==t?t:t<e?e:t>r?r:t}function If(t){return null!==t&&t%1==0}function jt(t,e,r){return void 0!==t?t:Ur(r?e?Math.min(Math.abs(e),Math.abs(r)):r:e)||Br}function xb(t,e){if(0===e)return t;var r=zr(t);if(r){var n=function(t){if(t){var e,r,n=t.R/255,i=t.G/255,a=t.B/255,o=Math.min(n,Math.min(i,a)),s=Math.max(n,Math.max(i,a)),c=s-o;return 0===s||0===c?(e=0,r=0):(e=c/s,r=n===s?(i-a)/c:i===s?2+(a-n)/c:4+(n-i)/c),(r/=6)<0&&(r+=1),{H:r,S:e,V:s}}}(r);if(n){var i=function(t,e){var r=t.H+e;return{H:r>1?r-1:r,S:t.S,V:t.V}}(n,e);if(i){var a=function(t){var e,r,n,s,l,c,f,d,p,a=t.S,o=t.V;if(0===a)e=o,r=o,n=o;else switch(s=o*(1-a),l=o*(1-a*(f=(p=6*t.H)-(d=Math.floor(p)))),c=o*(1-a*(1-f)),d){case 0:e=o,r=c,n=s;break;case 1:e=l,r=o,n=s;break;case 2:e=s,r=o,n=c;break;case 3:e=s,r=l,n=o;break;case 4:e=c,r=s,n=o;break;case 5:e=o,r=s,n=l;break;default:return void u.assertFail("unexpected")}return{R:Math.floor(255*e),G:Math.floor(255*r),B:Math.floor(255*n)}}(i);if(a)return qr(a)}}}}function zr(t){if(t.indexOf("#")>=0){if(7===t.length)return null==(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))||e.length<4?void 0:{R:parseInt(e[1],16),G:parseInt(e[2],16),B:parseInt(e[3],16)};if(4===t.length)return null==(e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i.exec(t))||e.length<4?void 0:{R:parseInt(e[1]+e[1],16),G:parseInt(e[2]+e[2],16),B:parseInt(e[3]+e[3],16)}}else{var e;if(t.indexOf("rgb(")>=0)return null==(e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(t))||e.length<4?void 0:{R:parseInt(e[1],10),G:parseInt(e[2],10),B:parseInt(e[3],10)};if(t.indexOf("rgba(")>=0)return null==(e=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*(?:\.\d+)?)\)$/.exec(t))||e.length<5?void 0:{R:parseInt(e[1],10),G:parseInt(e[2],10),B:parseInt(e[3],10),A:parseFloat(e[4])}}}function qr(t){return"#"+As(t.R)+As(t.G)+As(t.B)}function As(t){var r=si(t,0,255).toString(16).toUpperCase();return 1===r.length?"0"+r:r}function ui(t,e,r){u.assert(function(){return t.length===e.length},"createLinearColorScale - domain and range must be the same size"),u.assert(function(){return t.length>1},"createLinearColorScale - domain and range must contain at least 2 values");var n=e.map(function(i){return zr(i)});return function(i){if(null==i&&(i=0),!isNaN(i)){if(r){var a=_.last(t);if(null==a||i>=a)return _.last(e);if(i<=t[0])return e[0]}for(var o,s,l,c,f=1,d=t.length;f<d;f++){if(s=t[f],(o=t[f-1])===Number.NEGATIVE_INFINITY&&isNaN(s))return e[f];if(isNaN(o)||isNaN(s))return;if(i===s)return e[f];if(i>=o&&i<=s){l=n[f-1],c=n[f];break}}if(void 0!==o&&void 0!==s&&void 0!==l&&void 0!==c)return qr({R:_s(i,o,s,l.R,c.R),G:_s(i,o,s,l.G,c.G),B:_s(i,o,s,l.B,c.B)})}}}function _s(t,e,r,n,i){return e===Number.NEGATIVE_INFINITY&&r===Number.POSITIVE_INFINITY?Math.round((i+n)/2):e===Number.NEGATIVE_INFINITY?i:r===Number.POSITIVE_INFINITY?n:Math.round(n+(t-e)*(i-n)/(r-e))}var Fb={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Tf=function(){function t(e,r,n){var i;this.basePickerColors=[{value:"#FFFFFF"},{value:"#000000"}],this.colors=e||Ke.getDefaultColors(),this.sentimentColors=r||Ke.defaultSentimentColors,this.gradientColors=n||Ke.defaultGradientColors,this.scales={},(i=this.basePickerColors).push.apply(i,_.take(this.colors,8))}return t.prototype.getColorScaleByKey=function(e){var r=this.scales[e];return void 0===r&&(r=this.createScale(),this.scales[e]=r),r},t.prototype.getNewColorScale=function(){return this.createScale()},t.prototype.getColorByIndex=function(e){var r=this;return u.assert(function(){return e>=0&&e<r.colors.length},"index is out of bounds"),this.colors[e]},t.prototype.getSentimentColors=function(){return this.sentimentColors},t.prototype.getGradientColors=function(){return this.gradientColors},t.prototype.getBasePickerColors=function(){return this.basePickerColors},t.prototype.getBaseColors=function(){return _.take(this.colors,8)},t.prototype.getAllColors=function(){return this.colors},t.prototype.createScale=function(){return Nb.createFromColors(this.colors)},t}(),Nb=function(){function t(e){this.scale=e}return t.prototype.getColor=function(e){return this.scale(e)},t.prototype.clearAndRotateScale=function(){var e=this.scale.domain().length,r=function(t,e){if(0===e)return t.slice();var r=t.slice(e);return Array.prototype.push.apply(r,t.slice(0,e)),r}(this.scale.range(),e);this.scale=d3.scaleOrdinal().range(r)},t.prototype.clone=function(){return new t(this.scale.copy())},t.prototype.getDomain=function(){return this.scale.domain()},t.createFromColors=function(e){return new t(d3.scaleOrdinal().range(e))},t}(),Ke=function(){function t(){}return t.getDefaultColors=function(){if(!t.defaultColors){t.defaultColors=[];for(var e=t.defaultBaseColors,r=0;r<t.colorSectorCount;++r)for(var n=0,i=e.length;n<i;++n){var a=xb(e[n].value,r/t.colorSectorCount);t.defaultColors.push({value:null!=a?a:e[n].value})}}return t.defaultColors},t.colorSectorCount=12,t.defaultBaseColors=[{value:"#01B8AA"},{value:"#374649"},{value:"#FD625E"},{value:"#F2C80F"},{value:"#5F6B6D"},{value:"#8AD4EB"},{value:"#FE9666"},{value:"#A66999"},{value:"#3599B8"},{value:"#DFBFBF"},{value:"#4AC5BB"},{value:"#5F6B6D"},{value:"#FB8281"},{value:"#F4D25A"},{value:"#7F898A"},{value:"#A4DDEE"},{value:"#FDAB89"},{value:"#B687AC"},{value:"#28738A"},{value:"#A78F8F"},{value:"#168980"},{value:"#293537"},{value:"#BB4A4A"},{value:"#B59525"},{value:"#475052"},{value:"#6A9FB0"},{value:"#BD7150"},{value:"#7B4F71"},{value:"#1B4D5C"},{value:"#706060"},{value:"#0F5C55"},{value:"#1C2325"},{value:"#7D3231"},{value:"#796419"},{value:"#303637"},{value:"#476A75"},{value:"#7E4B36"},{value:"#52354C"},{value:"#0D262E"},{value:"#544848"}],t.defaultSentimentColors={bad:{value:"#E81123"},neutral:{value:"#F2C811"},good:{value:"#3bb44a"}},t.defaultGradientColors={minColor:{value:"#FD625E"},midColor:{value:"#F5D33F"},maxColor:{value:"#01B8AA"},nullColor:{value:"#FF7F48"}},t}(),Hr=function(){function t(e){u.assertValue(e,"factoryMethod"),this.factoryMethod=e}return t.prototype.getValue=function(){return null!==this.factoryMethod&&(this.value=this.factoryMethod(),this.factoryMethod=null),this.value},t}();function Kt(t){t&&Object.getOwnPropertyNames(t).forEach(function(e){"constructor"!==e&&Object.defineProperty(t,e,{enumerable:!0})})}function Pf(t){return new Ff(t)}var Ff=function(){function t(e){var r=this;this.kind=0,u.assertNonEmpty(e,"roles"),this._roles=e,this._key=new Hr(function(){return JSON.stringify(r.roles)})}return Object.defineProperty(t.prototype,"roles",{get:function(){return this._roles},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();function kt(t){return u.assertValue(t,"expr"),2===t.kind}function Le(t){return u.assertValue(t,"expr"),17===t.kind}function Rf(t){return u.assertValue(t,"expr"),Le(t)&&t.type.numeric}function Nf(t){return u.assertValue(t,"expr"),Le(t)&&t.type.bool}function wn(t){return u.assertValue(t,"expr"),Le(t)&&t.type.dateTime}function Is(t){return u.assertValue(t,"expr"),Le(t)&&t.type.text}function ma(t){return u.assertValue(t,"expr"),Le(t)&&0===t.type.primitiveType&&null===t.value}function Vn(t){return u.assertValue(t,"expr"),0===t.kind}function li(t){return u.assertValue(t,"expr"),6===t.kind}function Gr(t){return u.assertValue(t,"expr"),7===t.kind}function vt(t){return u.assertValue(t,"expr"),10===t.kind}function et(t){return u.assertValue(t,"expr"),4===t.kind}function Mn(t){return u.assertValue(t,"expr"),3===t.kind}function kf(t){return u.assertValue(t,"expr"),43===t.kind}function Ts(t){return u.assertValue(t,"expr"),44===t.kind}function Sa(t){return u.assertValue(t,"expr"),28===t.kind}function ci(t){return u.assertValue(t,"expr"),5===t.kind}function Jt(t){return u.assertValue(t,"expr"),30===t.kind}function Qr(t){return u.assertValue(t,"expr"),26===t.kind}function fi(t){return u.assertValue(t,"expr"),41===t.kind}function Ps(t){return u.assertValue(t,"expr"),1===t.kind}function Lf(t){return u.assertValue(t,"expr"),27===t.kind}function Bf(t){return u.assertValue(t,"expr"),32===t.kind}function Fs(t){return u.assertValue(t,"expr"),34===t.kind}function Uf(t){return u.assertValue(t,"expr"),36===t.kind}function Of(t){return u.assertValue(t,"expr"),37===t.kind}function Rs(t){return u.assertValue(t,"expr"),9===t.kind}function xn(t){return u.assertValue(t,"expr"),8===t.kind}function Yt(t){return u.assertValue(t,"expr"),11===t.kind}function Dn(t){return u.assertValue(t,"expr"),13===t.kind}function zf(t){return u.assertValue(t,"expr"),12===t.kind}function yr(t){return u.assertValue(t,"expr"),18===t.kind}function An(t){return u.assertValue(t,"expr"),19===t.kind}function mr(t){return u.assertValue(t,"expr"),16===t.kind}function Ns(t){return u.assertValue(t,"expr"),20===t.kind}function qf(t){return u.assertValue(t,"expr"),22===t.kind}function ks(t){return u.assertValue(t,"expr"),21===t.kind}function Hf(t){return u.assertValue(t,"expr"),14===t.kind}function Ls(t){return u.assertValue(t,"expr"),46===t.kind}function di(t){return u.assertValue(t,"expr"),47===t.kind}function ba(){return window.powerbi||(window.powerbi={}),window.powerbi}function Gf(){var t=ba();return t.common||(t.common={}),t.common}function Ea(){var t=ba();return t.visuals||(t.visuals={}),t.visuals}function Bs(){return window.jsCommon||(window.jsCommon={}),window.jsCommon}Kt(Ff.prototype);var Qf=function(t){function e(r,n){var i=t.call(this,n)||this;return i.name=r,i}return T(e,t),e}(Error),Us=function(t){function e(r,n,i){var a=t.call(this,r,n+": "+i)||this;return a.argument=i,a}return T(e,t),e}(Qf),It=void 0!==window.performance&&window.performance.now&&window.performance.timeOrigin?function(){return window.performance.now()+window.performance.timeOrigin}:Date.now;function _n(t){return _.isEmpty(t)||_.isEmpty(t.trim())}function Be(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0];if(_n(r))return r;for(var n=0;n<t.length-1;n++){var i=new RegExp("\\{"+n+"\\}","gm");r=r.replace(i,t[n+1])}return r}var Ca=function(){function t(e,r,n,i,a){this.text=e,this.type=r,this.sessionId=n,this.requestId=i,this.timeStamp=new Date,this.additionalInfo=a}return t.prototype.toString=function(){var e="";return e+="".concat(t.traceTypeStrings[this.type]," (").concat(this.timeStamp.toUTCString(),"): ").concat(this.text),this.requestId&&(e+="\n(Request id: "+this.requestId+")"),this.additionalInfo&&(e+="\nAdditional info: "+JSON.stringify(this.additionalInfo)),e},t.traceTypeStrings=["INFORMATION","VERBOSE","WARNING","ERROR","EXPECTEDERROR","UNEXPECTEDERROR","FATAL"],t}(),wa=function(t){return t[t.Information=0]="Information",t[t.Verbose=1]="Verbose",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.ExpectedError=4]="ExpectedError",t[t.UnexpectedError=5]="UnexpectedError",t[t.Fatal=6]="Fatal",t}({}),tE=function(){function t(){}return t.prototype.logTrace=function(e){},t}(),Va=new tE,ot=function(){function t(){}return t.assertFail=function(e){u.assertValue(e,"message"),u.assertFail(e),this.error(e,!0)},t.warning=function(e,r,n){u.assertValue(e,"text"),this.logTraceInternal(new Ca(e,wa.Warning,this.sessionId,r,n))},t.error=function(e,r,n,i){u.assertValue(e,"text"),r&&(e=Be("{0}.\nStack:\n{1}",e,function(t){var e,r,n;void 0===t&&(t=1);try{if(!(n=new Error).stack)throw n}catch(i){n=i}return null!=(e=n.stack)&&((r=e.split("\n")).splice(1,t),e=r.join("\n")),e}())),this.logTraceInternal(new Ca(e,wa.Error,this.sessionId,n,i))},t.information=function(e,r,n){u.assertValue(e,"text"),this.logTraceInternal(new Ca(e,wa.Information,this.sessionId,r,n))},t.verbose=function(e,r,n){u.assertValue(e,"text"),this.logTraceInternal(new Ca(e,wa.Verbose,this.sessionId,r,n))},t.addListener=function(e){u.assertValue(e,"listener"),_.find(this.listeners,function(r){return r===e})||this.listeners.push(e)},t.removeListener=function(e){u.assertValue(e,"listener");var r=this.listeners.indexOf(e);r>=0&&this.listeners.splice(r,1)},t.resetListeners=function(){this.listeners=new Array(Va)},t.reset=function(){this.lastTraceIndex=-1},t.getTraces=function(){if(this.lastTraceIndex<0)return[];for(var e=new Array(this.lastTraceIndex+1),r=0;r<=this.lastTraceIndex;r++)e[r]=this.traces[r];return e},t.disableDefaultListener=function(){this.removeListener(Va)},t.enableDefaultListener=function(){this.addListener(Va)},t.logTraceInternal=function(e){this.lastTraceIndex+1>=1e3&&this.reset(),this.traces[++this.lastTraceIndex]=e;for(var r=0,n=this.listeners.length;r<n;r++)this.listeners[r].logTrace(e)},t.traces=new Array(1e3),t.lastTraceIndex=-1,t.listeners=new Array(Va),t}();Bs().Trace=ot;var rE=window,nE=window.location.protocol+"//"+window.location.host;function Ma(t,e){return null!=t&&-1!==t.indexOf(e)}function Wr(t){return yt.throwIfNullOrUndefined(t,yt,"normalizeCase","value"),t.toUpperCase()}function jr(t,e,r){if(!e)return t;var n=function(t){return t.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}(e);return t.replace(new RegExp(n,"gi"),r)}function xa(t,e,r,n){u.assertValue(t,"usedNames"),u.assertValue(e,"baseName"),u.assert(function(){return null==r||r>=0},"startSuffix == null || startSuffix >= 0");var i=n?" ":"",a=r||0,o=e;for(r&&(o+=i+r);oE(t,o);)o=e+i+ ++a;return o}function oE(t,e){return _.isSet(t)?t.has(e):t[e]}function Os(t,e,r){if(!t||0===t.length)return"";null==r&&(r=Number.MAX_VALUE);for(var n=Math.min(r,t.length),i=[],a=0;a<2;a++)for(var o="{"+a+"}",s="_|_<"+a+">_|_",l=0;l<n;l++)t[l].indexOf(o)>-1&&(t[l]=t[l].replace(o,s),i.push({targetValue:o,replaceValue:s}));var c="";for(l=0;l<n;l++)c=0===l?t[l]:Be(e.get("PowerBI_TwoStrings_SeperateWithCommaAndVisualSpace"),c,t[l]);for(var f=0,d=i;f<d.length;f++){var p=d[f];c=c.replace(p.replaceValue,p.targetValue)}return c}var yt=function(){function t(){}return t.ensureError=function(e){return e instanceof Error||(e=new Error(e?e.message||e.toString():"<null-or-undefined> error was thrown")),e},t.throwIfNullOrUndefined=function(e,r,n,i){null===e?this.throwException(function(t){return new Us("argumentNull","Argument was null",t)}(this.getComponentName(r)+n+"."+i)):void 0===e&&this.throwException(function(t){return new Us("argumentUndefined","Argument was undefined",t)}(this.getComponentName(r)+n+"."+i))},t.throwIfNullOrEmptyString=function(e,r,n,i){this.throwIfNullOrUndefined(e,r,n,i),e.length<1&&this.throwException(function(t){return new Us("argumentOutOfRange","Argument was out of range",t)}(this.getComponentName(r)+n+"."+i))},t.valueOrDefault=function(e,r){return null!=e?e:r},t.urlCombine=function(e,r){if(this.throwIfNullOrUndefined(e,t,"urlCombine","baseUrl"),this.throwIfNullOrUndefined(r,t,"urlCombine","path"),_n(r))return e;if(_n(e))return r;var n=e;return"/"===n.charAt(n.length-1)?"/"===r.charAt(0)&&(r=r.slice(1)):"/"!==r.charAt(0)&&(r="/"+r),n+r},t.getAbsoluteUri=function(e){this.throwIfNullOrUndefined(e,t,"getAbsoluteUri","path");var r=e;return r&&-1===r.indexOf("http")&&(r=this.urlCombine(rE.clusterUri,r)),r},t.getStaticResourceUri=function(e){this.throwIfNullOrUndefined(e,t,"getStaticResourceUri","path");var r=e;return r&&-1===r.indexOf("http")&&(r=this.urlCombine(nE,r)),r},t.getComponentName=function(e){return e?(typeof e).toString()+".":""},t.throwException=function(e){throw ot.error("Throwing exception: ".concat(JSON.stringify(e)),null==e.stack),this.ensureError(e)},t.createClassSelector=function(e){return this.throwIfNullOrEmptyString(e,null,"CreateClassSelector","className"),"."+e},t.createIdSelector=function(e){return this.throwIfNullOrEmptyString(e,null,"CreateIdSelector","id"),"#"+e},t.clampValue=function(e,r,n){return u.assert(function(){return r<=n},"min value must be less than or equal the max value"),e=Math.min(e,n),Math.max(e,r)},t.generateGuid=function(){var e="",r=0;for(r=0;r<32;r+=1){var n=16*Math.random()|0;switch(r){case 8:case 12:case 16:case 20:e+="-"}e+=n.toString(16)}return e},t.getCookieValue=function(e){for(var n=0,i=document.cookie.split(";");n<i.length;n++){var a=i[n],o=a.split("=");if(o.length>0&&o[0].trim()===e)return a.substr(a.indexOf("=")+1)}return null},t.getDomainForUrl=function(e){var r=this.getHrefObjectFromUrl(e);return r.prop("protocol")+"//"+r.prop("hostname")},t.getHostNameForUrl=function(e){var r=this.getHrefObjectFromUrl(e);return this.urlCombine(r.prop("hostname"),r.prop("pathname"))},t.getUrlWithoutQueryString=function(e){var r=this.getHrefObjectFromUrl(e);return r.prop("protocol")+"//"+this.urlCombine(r.prop("host"),r.prop("pathname"))},t.getProtocolFromUrl=function(e){return this.getHrefObjectFromUrl(e).prop("protocol").replace(":","")},t.getHrefObjectFromUrl=function(e){var r=$("<a>");return r.prop("href",e)},t.getDateFromWcfJsonString=function(e,r){if(_.isEmpty(e))return null;var n=e.indexOf("("),i=e.indexOf(")");if(-1!==n&&-1!==i){var a=parseInt(e.substring(n+1,i),10);if(isNaN(a)&&(a=0),r)return new Date(a);var o=new Date(0);return o.setUTCMilliseconds(a),o}return null},t.isValidImageDataUrl=function(e){return this.ImageDataRegex.test(e)},t.encodeUriForImageDataSvg=function(e){if(this.ImageDataSvgRegex.test(e)){var r=e.indexOf(",");if(r>-1){var n=e.substring(0,r).split(";"),i=e.substring(r+1);try{i=decodeURIComponent(i)}catch(a){}return"".concat(n[0],",").concat(encodeURIComponent(i))}}return e},t.isLocalUrl=function(e){return _.startsWith(e,"data:")||_.startsWith(e,"blob:")},t.extractFileNameFromPath=function(e){return e.replace(/^.*[\\\/]/,"")},t.is64BitOperatingSystem=function(){return-1!==navigator.userAgent.indexOf("WOW64")||-1!==navigator.userAgent.indexOf("Win64")},t.isWindows10=function(){return-1!==navigator.userAgent.indexOf("Windows NT 10.0")},t.parseNumber=function(e,r){if(null===e)return null;if(void 0===e)return r;var n=Number(e);return isFinite(n)?n:isNaN(n)&&"number"!=typeof e&&"NaN"!==e?r:n},t.getURLParamValue=function(e){var r=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==r?null:r[1]||0},t.getLocalTimeZoneString=function(){var r=-1*new Date(Date.UTC(2005,6,30,0,0,0,0)).getTimezoneOffset(),i=-1*new Date(Date.UTC(2005,12,30,0,0,0,0)).getTimezoneOffset();return-720===r&&-720===i?"Dateline Standard Time":-660===r&&-660===i?"UTC-11":-660===r&&-660===i?"Samoa Standard Time":-600===r&&-600===i?"Hawaiian Standard Time":-480===r&&-540===i?"Alaskan Standard Time":-420===r&&-480===i?"Pacific Standard Time":-420===r&&-420===i?"US Mountain Standard Time":-360===r&&-420===i?"Mountain Standard Time":-360===r&&-360===i?"Central America Standard Time":-300===r&&-360===i?"Central Standard Time":-300===r&&-300===i?"SA Pacific Standard Time":-240===r&&-300===i?"Eastern Standard Time":-270===r&&-270===i?"Venezuela Standard Time":-240===r&&-240===i?"SA Western Standard Time":-240===r&&-180===i?"Central Brazilian Standard Time":-180===r&&-240===i?"Atlantic Standard Time":-180===r&&-180===i?"Montevideo Standard Time":-180===r&&-120===i?"E. South America Standard Time":-150===r&&-210===i?"Mid-Atlantic Standard Time":-120===r&&-120===i?"SA Eastern Standard Time":0===r&&0===i?"UTC":60===r&&0===i?"GMT Standard Time":60===r&&120===i?"Namibia Standard Time":120===r&&60===i?"Romance Standard Time":120===r&&120===i?"South Africa Standard Time":180===r&&120===i?"GTB Standard Time":180===r&&180===i?"E. Africa Standard Time":240===r&&180===i?"Russian Standard Time":240===r&&240===i?"Arabian Standard Time":270===r&&210===i?"Iran Standard Time":270===r&&270===i?"Afghanistan Standard Time":300===r&&240===i?"Pakistan Standard Time":300===r&&300===i?"West Asia Standard Time":330===r&&330===i?"India Standard Time":345===r&&345===i?"Nepal Standard Time":360===r&&300===i?"N. Central Asia Standard Time":360===r&&360===i?"Central Asia Standard Time":390===r&&390===i?"Myanmar Standard Time":420===r&&360===i?"North Asia Standard Time":420===r&&420===i?"SE Asia Standard Time":480===r&&420===i?"North Asia East Standard Time":480===r&&480===i?"China Standard Time":540===r&&480===i?"Yakutsk Standard Time":540===r&&540===i?"Tokyo Standard Time":570===r&&570===i?"Cen. Australia Standard Time":600===r&&600===i?"E. Australia Standard Time":600===r&&660===i?"AUS Eastern Standard Time":660===r&&600===i?"Tasmania Standard Time":660===r&&660===i?"West Pacific Standard Time":690===r&&690===i?"Central Pacific Standard Time":720===r&&660===i?"Magadan Standard Time":720===r&&720===i?"Fiji Standard Time":720===r&&780===i?"New Zealand Standard Time":780===r&&780===i?"Tonga Standard Time":"UTC"},t.ImageDataRegex=new RegExp("data:(image/(png|jpg|jpeg|gif|svg))"),t.ImageDataSvgRegex=new RegExp("data:(image/svg)"),t}(),Jf=0;function pi(t){var e=window.performance;if(!e||!e.mark)return function(){return 0};var r="Begin "+(t=++Jf+" "+t);e.mark(r);var n=It();return function(){var i="End "+t;return e.mark(i),e.measure&&e.measure(t,r,i),It()-n}}function Je(t){var e=It();return t(),It()-e}var Yf=!1;function j(t,e,r,n,i){return fE.run(t,e,r,n,i)}!function(){if(!Yf){var t=Be;(function(){var t=Bs();return t.StringExtensions||(t.StringExtensions={}),t.StringExtensions}()).format=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.apply(void 0,e)},Yf=!0}}();var qs,fE=function(){function t(e,r,n){this.ignoreCase=e,this.ignoreVariables=r,this.ignoreAnnotations=n}return t.getInstance=function(e,r,n){e||(e=!1),r||(r=!1),n||(n=!1);var i=[+e,+r,+n].reduce(function(o,s){return o<<1|s}),a=t.instances[i];return a||(a=new t(e,r,n)),a},t.run=function(e,r,n,i,a){return(e=e||null)===(r=r||null)||!e==!r&&(u.assertValue(e,"x"),u.assertValue(r,"y"),e.accept(t.getInstance(n,i,a),r))},t.prototype.visitColumnRef=function(e,r){return!(!kt(r)&&!Fs(r))&&e.ref===r.ref&&this.equals(e.source,r.source)&&this.equalAnnotations(e,r)},t.prototype.visitMeasureRef=function(e,r){return!(!Mn(r)||!this.equalAnnotations(e,r))&&e.ref===r.ref&&this.equals(e.source,r.source)},t.prototype.visitNativeMeasure=function(e,r){if(!kf(r)||e.language!==r.language||e.expression!==r.expression||e.dataType!==r.dataType||e.format!==r.format||e.proposedName!==r.proposedName||!this.equalAnnotations(e,r))return!1;var n=e.expressionContentCache,i=r.expressionContentCache;return!n&&!i||!(!n||!i)&&n.unrecognizedIdentifiers===i.unrecognizedIdentifiers&&this.equalsAll(n.dependencies,i.dependencies)},t.prototype.visitNativeColumn=function(e,r){if(!Ts(r)||e.language!==r.language||e.expression!==r.expression||e.dataType!==r.dataType||e.proposedName!==r.proposedName||e.format!==r.format||!this.equals(e.source,r.source)||!this.equalAnnotations(e,r))return!1;var n=e.expressionContentCache,i=r.expressionContentCache;return!n&&!i||!(!n||!i)&&n.unrecognizedIdentifiers===i.unrecognizedIdentifiers&&this.equalsAll(n.dependencies,i.dependencies)},t.prototype.visitAggr=function(e,r){return et(r)&&this.equalAnnotations(e,r)&&e.func===r.func&&this.equals(e.arg,r.arg)},t.prototype.visitPercentile=function(e,r){return!(!Sa(r)||!this.equalAnnotations(e,r))&&e.exclusive===r.exclusive&&e.k===r.k&&this.equals(e.arg,r.arg)},t.prototype.visitRangePercent=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),29===t.kind}(r)||!this.equalAnnotations(e,r))&&e.percent===r.percent&&this.equals(e.min,r.min)&&this.equals(e.max,r.max)},t.prototype.visitGroupRef=function(e,r){var n=!1;return(Fs(r)||kt(r))&&(n=e.ref===r.ref&&this.equals(e.source,r.source)&&this.equalAnnotations(e,r)),Fs(r)&&this.equalAnnotations(e,r)&&(n=n&&this.equalsAll(e.groupedExprs,r.groupedExprs)),n},t.prototype.visitHierarchy=function(e,r){return!(!li(r)||!this.equalAnnotations(e,r))&&e.hierarchy===r.hierarchy&&this.equals(e.arg,r.arg)},t.prototype.visitHierarchyLevel=function(e,r){return!(!Gr(r)||!this.equalAnnotations(e,r))&&e.level===r.level&&this.equals(e.arg,r.arg)},t.prototype.visitPropertyVariationSource=function(e,r){return!(!ci(r)||!this.equalAnnotations(e,r))&&e.name===r.name&&e.property===r.property&&this.equals(e.arg,r.arg)},t.prototype.visitSelectRef=function(e,r){return!(!Jt(r)||!this.equalAnnotations(e,r)||e.expressionName!==r.expressionName||e.attributeKind!==r.attributeKind&&this.isNullOrUndefined(e.attributeKind)!==this.isNullOrUndefined(r.attributeKind))},t.prototype.isNullOrUndefined=function(e){return null==e},t.prototype.visitBetween=function(e,r){return!(!Rs(r)||!this.equalAnnotations(e,r))&&this.equals(e.arg,r.arg)&&this.equals(e.lower,r.lower)&&this.equals(e.upper,r.upper)},t.prototype.visitIn=function(e,r){if(!vt(r)||!this.equalsAll(e.args,r.args)||!this.equalAnnotations(e,r))return!1;var n=r,i=e.values;if(i){var a=n.values;if(!a||i.length!==a.length)return!1;for(var o=0,s=i.length;o<s;o++)if(!this.equalsAll(i[o],a[o]))return!1}else if(u.assert(function(){return!!e.table},"either values or table must be non-null for an In operator"),!n.table||!this.equals(e.table,n.table))return!1;return!0},t.prototype.visitEntity=function(e,r){return!(!Vn(r)||!this.equalAnnotations(e,r))&&e.schema===r.schema&&e.entity===r.entity&&(this.ignoreVariables||this.optionalEqual(e.variable,r.variable))},t.prototype.visitSubqueryRef=function(e,r){return!(!Ps(r)||!this.equalAnnotations(e,r)||!e.query&&r.query||e.query&&!r.query)&&(e.query&&r.query?e.variable===r.variable&&zs(e.query,r.query):e.variable===r.variable)},t.prototype.visitNamedQueryRef=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),39===t.kind}(r)||!this.equalAnnotations(e,r))&&e.queryName===r.queryName&&(this.ignoreVariables||this.optionalEqual(e.variable,r.variable))},t.prototype.visitAnd=function(e,r){return!(!xn(r)||!this.equalAnnotations(e,r))&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitOr=function(e,r){return!(!Yt(r)||!this.equalAnnotations(e,r))&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitCompare=function(e,r){return!(!Dn(r)||!this.equalAnnotations(e,r))&&e.comparison===r.comparison&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitConditional=function(e,r){var n=this;return!(!function(t){return u.assertValue(t,"expr"),42===t.kind}(r)||!this.equalAnnotations(e,r))&&Ae(e.cases,r.cases,function(i,a){return n.visitCase(i,a)})&&this.equalsNullableObject(e.defaultValue,r.defaultValue,function(i,a){return n.equals(i,a)})},t.prototype.visitCase=function(e,r){return this.equals(e.condition,r.condition)&&this.equals(e.value,r.value)},t.prototype.visitContains=function(e,r){return!(!zf(r)||!this.equalAnnotations(e,r))&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitDateSpan=function(e,r){return!(!yr(r)||!this.equalAnnotations(e,r))&&e.unit===r.unit&&this.equals(e.arg,r.arg)},t.prototype.visitDateAdd=function(e,r){return!(!An(r)||!this.equalAnnotations(e,r))&&e.unit===r.unit&&e.amount===r.amount&&this.equals(e.arg,r.arg)},t.prototype.visitExists=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),15===t.kind}(r)||!this.equalAnnotations(e,r))&&this.equals(e.arg,r.arg)},t.prototype.visitNot=function(e,r){return!(!mr(r)||!this.equalAnnotations(e,r))&&this.equals(e.arg,r.arg)},t.prototype.visitNow=function(e,r){return!!this.equalAnnotations(e,r)&&Ns(r)},t.prototype.visitDefaultValue=function(e,r){return!!this.equalAnnotations(e,r)&&qf(r)},t.prototype.visitAnyValue=function(e,r){return!!this.equalAnnotations(e,r)&&ks(r)},t.prototype.visitResourcePackageItem=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),25===t.kind}(r)||!this.equalAnnotations(e,r))&&e.packageName===r.packageName&&e.packageType===r.packageType&&e.itemName===r.itemName},t.prototype.visitStartsWith=function(e,r){return!(!Hf(r)||!this.equalAnnotations(e,r))&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitConstant=function(e,r){return!!(Le(r)&&e.type.equals(r.type)&&this.equalAnnotations(e,r))&&(e.type.text&&this.ignoreCase?function(t,e){return Wr(t)===Wr(e)}(e.valueEncoded,r.valueEncoded):e.valueEncoded===r.valueEncoded)},t.prototype.visitFillRule=function(e,r){var n=this;if(!function(t){return u.assertValue(t,"expr"),24===t.kind}(r)||!this.equals(e.input,r.input)||!this.equalAnnotations(e,r))return!1;var i=e.rule,a=r.rule;return i===a||this.equalsNullableObject(i.linearGradient2,a.linearGradient2,function(o,s){return n.visitLinearGradient2(o,s)})&&this.equalsNullableObject(i.linearGradient3,a.linearGradient3,function(o,s){return n.visitLinearGradient3(o,s)})},t.prototype.visitLinearGradient2=function(e,r){var n=this;return u.assertValue(e,"left"),u.assertValue(r,"right"),this.equalsFillRuleStop(e.min,r.min)&&this.equalsFillRuleStop(e.max,r.max)&&this.equalsNullableObject(e.nullColoringStrategy,r.nullColoringStrategy,function(i,a){return n.equalsNullStrategy(i,a)})},t.prototype.visitLinearGradient3=function(e,r){var n=this;return u.assertValue(e,"left"),u.assertValue(r,"right"),this.equalsFillRuleStop(e.min,r.min)&&this.equalsFillRuleStop(e.mid,r.mid)&&this.equalsFillRuleStop(e.max,r.max)&&this.equalsNullableObject(e.nullColoringStrategy,r.nullColoringStrategy,function(i,a){return n.equalsNullStrategy(i,a)})},t.prototype.visitThemeDataColor=function(e,r){return u.assertValue(e,"expr"),u.assertValue(r,"comparand"),function(t){return u.assertValue(t,"expr"),33===t.kind}(r)&&e.colorId===r.colorId&&e.percent===r.percent},t.prototype.equalsFillRuleStop=function(e,r){return u.assertValue(e,"stop1"),u.assertValue(r,"stop2"),this.equals(e.color,r.color)&&this.equalsNullable(e.value,r.value)},t.prototype.equalsNullStrategy=function(e,r){return u.assertValue(e,"equalsNullStrategy - left"),u.assertValue(r,"equalsNullStrategy - right"),this.equals(e.strategy,r.strategy)&&this.equalsNullable(e.color,r.color)},t.prototype.visitArithmetic=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),23===t.kind}(r)||!this.equalAnnotations(e,r))&&e.operator===r.operator&&this.equals(e.left,r.left)&&this.equals(e.right,r.right)},t.prototype.visitFloor=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),35===t.kind}(r)||!this.equalAnnotations(e,r))&&e.timeUnit===r.timeUnit&&e.size===r.size&&this.equals(e.arg,r.arg)},t.prototype.visitScopedEval=function(e,r){return!(!Qr(r)||!this.equalAnnotations(e,r))&&this.equals(e.expression,r.expression)&&this.equalsAll(e.scope,r.scope)},t.prototype.visitFilteredEval=function(e,r){return!(!fi(r)||!this.equalAnnotations(e,r))&&this.equals(e.expression,r.expression)&&e.filters.length===r.filters.length&&_.every(e.filters,function(n,i){return hi(n,r.filters[i])})},t.prototype.visitWithRef=function(e,r){return!(!Lf(r)||!this.equalAnnotations(e,r))&&e.expressionName===r.expressionName},t.prototype.visitTransformTableRef=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),31===t.kind}(r)||!this.equalAnnotations(e,r))&&e.source===r.source},t.prototype.visitTransformOutputRoleRef=function(e,r){return!(!Bf(r)||!this.equalAnnotations(e,r))&&e.role===r.role&&e.transform===r.transform},t.prototype.visitRoleRef=function(e,r){return!(!Uf(r)||!this.equalAnnotations(e,r))&&e.role===r.role},t.prototype.visitSummaryValueRef=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),45===t.kind}(r)||!this.equalAnnotations(e,r))&&e.name===r.name},t.prototype.visitAllRolesRef=function(e,r){return Of(r)},t.prototype.visitDiscretize=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),38===t.kind}(r)||!this.equalAnnotations(e,r))&&e.count===r.count&&this.equals(e.source,r.source)},t.prototype.visitMember=function(e,r){return!(!function(t){return u.assertValue(t,"expr"),40===t.kind}(r)||!this.equalAnnotations(e,r))&&e.member===r.member&&this.equals(e.source,r.source)},t.prototype.visitSparklineData=function(e,r){return!!Ls(r)&&this.equals(e.measure,r.measure)&&this.equalsAll(e.grouping,r.grouping)&&!!(!e.scalarKey&&!r.scalarKey||e.scalarKey&&r.scalarKey&&this.equals(e.scalarKey,r.scalarKey))&&e.pointsPerSparkline===r.pointsPerSparkline&&e.includeMinGroupingInterval===r.includeMinGroupingInterval},t.prototype.optionalEqual=function(e,r){return!e||!r||e===r},t.prototype.equals=function(e,r){return e.accept(this,r)},t.prototype.equalsNullable=function(e,r){var n=this;return this.equalsNullableObject(e,r,function(i,a){return n.equals(i,a)})},t.prototype.equalsNullableObject=function(e,r,n){return null==e&&null==r||null!=e&&null!=r&&n(e,r)},t.prototype.equalsAll=function(e,r){var n=this;return Ae(e,r,function(i,a){return n.equals(i,a)})},t.prototype.equalAnnotations=function(e,r){return!(!this.ignoreAnnotations&&!_.isEqual(e.getAnnotations(),r.getAnnotations()))},t.prototype.visitNativeVisualCalc=function(e,r){return!(!this.ignoreAnnotations&&!_.isEqual(e.getAnnotations(),r.getAnnotations()))&&e.language===r.language&&e.expression===r.expression&&e.name===r.name},t.instances=[],t}();function hi(t,e){return u.assertAnyValue(t,"leftFilter"),u.assertAnyValue(e,"rightFilter"),t||(t=null),e||(e=null),t===e||!(!!t!=!!e||!$f(t,e))&&j(t.condition,e.condition)}function $f(t,e){return u.assertValue(t,"leftFilter"),u.assertValue(e,"rightFilter"),Ae(t.target,e.target,j)}function Xf(t,e){return u.assertAnyValue(t,"filters"),u.assertValue(e,"searchTarget"),!_.isEmpty(t)&&_.some(t,function(r){return hi(r,e)})}function dE(t,e){return!t&&!e||!(!t||!e)&&t.direction===e.direction&&j(t.expr,e.expr)}function Da(t,e){return!t&&!e||!(!t||!e)&&j(t.expr,e.expr)}function Zf(t,e){return!t&&!e||!(!t||!e)&&Ae(t.columns,e.columns,function(r,n){return function(t,e){return!t&&!e||!(!t||!e)&&t.role===e.role&&Da(t.expression,e.expression)}(r,n)})}function gE(t,e){return!t&&!e||!(!t||!e)&&t.algorithm===e.algorithm&&function(t,e){return!t&&!e||!(!t||!e)&&Ae(t.parameters,e.parameters,function(r,n){return Da(r,n)})&&Zf(t.table,e.table)}(t.input,e.input)&&function(t,e){return!t&&!e||!(!t||!e)&&Zf(t.table,e.table)}(t.output,e.output)}function zs(t,e){return u.assertValue(t,"x SemanticQuery"),u.assertValue(e,"y SemanticQuery"),t.from().equals(e.from())&&Ae(t.where(),e.where(),hi)&&Ae(t.orderBy(),e.orderBy(),dE)&&Ae(t.select(),e.select(),Da)&&Ae(t.groupBy(),e.groupBy(),Da)&&Ae(t.transforms(),e.transforms(),gE)&&t.top()===e.top()}var Aa=function(){function t(){}return t.getLanguage=function(){return this.navigator.userLanguage||this.navigator.language},t.isChrome=function(){if(null!=this.isChromeCache)return this.isChromeCache;var e=this.navigator.vendor||"",r=this.navigator.userAgent.toLowerCase();return this.isChromeCache=e.toLowerCase().indexOf("google")>-1&&r.indexOf("chrome")>-1&&-1===r.indexOf("edge")&&-1===r.indexOf("opr"),this.isChromeCache},t.isInternetExplorerOrEdge=function(){if(null!=this.isInternetExplorerOrEdgeCache)return this.isInternetExplorerOrEdgeCache;var e=this.navigator.userAgent.toLowerCase();return this.isInternetExplorerOrEdgeCache=e.indexOf("msie")>-1||e.indexOf("trident")>-1||e.indexOf("edge")>-1,this.isInternetExplorerOrEdgeCache},t.isInternetExplorer11=function(){var e=this.navigator.userAgent.toLowerCase(),r=e.match(/rv:(\d+)/i);return!!(r&&r[1]&&parseInt&&11===parseInt(r[1],10))&&e.indexOf("trident")>-1&&-1===e.indexOf("msie")},t.isEdgeLegacy=function(){return!t.isInternetExplorer11()&&"StyleMedia"in window},t.isWindows10=function(){return-1!==this.navigator.userAgent.indexOf("Windows NT 10.0")},t.isKeyboardClick=function(e){return 0===e.clientX&&0===e.clientX},t.isCtrlOrMeta=function(e){return!0===e[t.isMacOs()?"metaKey":"ctrlKey"]},t.noModifierPressed=function(e){var r=t.isMacOs()?"metaKey":"ctrlKey";return!e.shiftKey&&!e.altKey&&!e[r]},t.isPointerTypeTouch=function(e){return"touch"===e.pointerType},t.getInternetExplorerVersion=function(){var e=0;if("Microsoft Internet Explorer"===this.navigator.appName||this.navigator.userAgent.indexOf("MSIE")>=0){var n=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})").exec(this.navigator.userAgent);n&&(e=parseFloat(n[1]))}return e},t.isFirefox=function(){return this.navigator.userAgent.toLowerCase().indexOf("firefox")>-1},t.isMacOs=function(){return this.navigator.userAgent.indexOf("Macintosh")>=0},t.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(this.navigator.userAgent)},t.isSafari11OrHigher=function(){if(!this.isSafari())return!1;var e=this.navigator.userAgent.match(/version\/(\d+)/i),r=null==e?void 0:e[1];return!(null==r||!parseInt)&&parseInt(r,10)>=11},t.isIOSWebView=function(){var e=this.navigator.userAgent.toLowerCase();return e.indexOf("iphone")>-1||e.indexOf("ipad")>-1||e.indexOf("macintosh")>-1&&this.navigator.maxTouchPoints>1},t.isAndroidWebView=function(){return this.navigator.userAgent.toLowerCase().indexOf("android")>-1},t.focus=function(e,r){if(e)if(e.focus)r?e.focus(r):e.focus();else try{HTMLElement.prototype.focus.apply(e)}catch(n){u.assertFail("BrowserUtils.focus: failed to set focus on element: "+n)}},t.setBrowserSupportsHttp2=function(e){this.browserSupportsHttp2=e},t.calculateBrowserSupportsHttp2=function(){if(!window||!window.performance)return!1;var e=window.performance;return"h2"===(e.getEntriesByType&&e.getEntriesByType("navigation")&&e.getEntriesByType("navigation")[0]&&e.getEntriesByType("navigation")[0].nextHopProtocol)||!(!window.navigator||!window.navigator.userAgent)&&!!(this.isInternetExplorer11()&&this.isWindows10()||this.isMacOs()&&this.isSafari11OrHigher()||this.isIOSWebView())},t.navigator=window.navigator,t.browserSupportsHttp2=function(){return null!=t.browserSupportsHttp2Cache||(t.browserSupportsHttp2Cache=t.calculateBrowserSupportsHttp2()),t.browserSupportsHttp2Cache},t}();function Hs(t){return t instanceof Date&&"number"==typeof t.epochTimeStamp}function Gs(t){var e=t;return e.epochTimeStamp=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),e}function ed(t,e){return t===e||JSON.stringify(t)===JSON.stringify(e)}function Qs(t,e,r){return u.assertValue(t,"regex"),t.lastIndex=r||0,t.exec(e)}var B=function(t){return t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.Week=2]="Week",t[t.Day=3]="Day",t[t.Hour=4]="Hour",t[t.Minute=5]="Minute",t[t.Second=6]="Second",t[t.Millisecond=7]="Millisecond",t}({}),Ws=function(){function t(){}return t.canFormat=function(e){return e instanceof Date},t.format=function(e,r,n){r=r||"G",Hs(e)&&(e=Ue.fromTimeValue(e.epochTimeStamp));var o=1===r.length;try{return o?od(e,r,n):function(t,e,r){var n,i=[];if((e=vi(e,i)).indexOf("F")>-1){e=jr(e,"FFFF","FFF");var a=t.getMilliseconds();if(a%10>=1&&(e=jr(e,"FFF","fff")),e=jr(e,"FFF","FF"),a%100/10>=1&&(e=jr(e,"FF","ff")),e=jr(e,"FF","F"),a%1e3/100>=1&&(e=jr(e,"F","f")),""===(e=jr(e,"F",""))||"%"===e)return""}var o=function(t){return null!=t.match(/gg/)}(e);e=function(t){return t===id?ad:(id=t,t=function(t){if(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/%K/g,"zzz")).replace(/K/g,"zzz")).replace(/fffffff/g,"fff0000")).replace(/ffffff/g,"fff000")).replace(/fffff/g,"fff00")).replace(/ffff/g,"fff0")).replace(/yyyyy/g,"0yyyy")).replace(/(^y|^)yyy(^y|$)/g,"yyyy"),qs||(qs=["d","f","F","g","h","H","K","m","M","s","t","y","z",":","/"].map(function(i){return{r:new RegExp("%"+i+"(?!"+i+")","g"),s:i}})),-1!==t.indexOf("%")&&t.length>2)for(var e=0,r=qs;e<r.length;e++){var n=r[e];t=t.replace(n.r,n.s)}return t}(t),ad=t,t)}(e);var s=r.calendar;return o&&(r.calendar=r.calendars.Japanese),n=Globalize.format(t,e,r),o&&(r.calendar=s),_a(n=Ws.localize(n,r.calendar),i,!1)}(e,r,n)}catch(s){return od(e,"G",n)}},t.localize=function(e,r){var n=r[":"];if(":"===n)return e;for(var i="",a=e.length,o=0;o<a;o++){var s=e.charAt(o);i+=":"===s?n:s}return i},t}(),In=function(){function t(){}return t.canFormat=function(e){return"number"==typeof e},t.format=function(e,r,n){r=r||"G";try{return yi(r)?function(t,e,r){var n,i=e.length>1?parseInt(e.substr(1,e.length-1),10):void 0,a=r.numberFormat,o=e.charAt(0);switch(o){case"e":case"E":void 0===i&&(i=6);var s=_.repeat("0",i);n=Ys(t,e="0."+s+o+"+000",r);break;case"f":case"F":n=t.toFixed(void 0!==i?i:a.decimals),n=In.localize(n,a);break;case"g":case"G":var l=Math.abs(t);if(0===l||1e-4<=l&&l<1e15)n=void 0!==i?t.toPrecision(i):t.toString();else{if(u.assert(function(){return"number"==typeof t},"value must be a number"),"number"!=typeof t)return String(t);n=(n=void 0!==i?t.toExponential(i):t.toExponential()).replace("e","E")}n=In.localize(n,a);break;case"r":case"R":n=t.toString(),n=In.localize(n,a);break;case"x":case"X":if(n=t.toString(16),"X"===o&&(n=n.toUpperCase()),void 0!==i){var c=n.length,f=t<0;f&&c--;var d=i-c,p=void 0;d>0&&(p=_.repeat("0",d)),n=f?"-"+p+n.substr(1):p+n}n=In.localize(n,a);break;default:n=Globalize.format(t,e,r)}return n}(e,r,n):Ys(e,r,n)}catch(i){return Globalize.format(e,void 0,n)}},t.localize=function(e,r){var n=r["+"],i=r["-"],a=r["."],o=r[","];if("+"===n&&"-"===i&&"."===a&&","===o)return e;for(var s=e.length,l="",c=0;c<s;c++){var f=e.charAt(c);switch(f){case"+":l+=n;break;case"-":l+=i;break;case".":l+=a;break;case",":l+=o;break;default:l+=f}}return l},t}(),Ue=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.setInternalDate=function(r){this.date=r},e.fromTimeValue=function(r){var n=new e(r);return"function"!=typeof n.setInternalDate&&ot.information("epochTimeStamp is '".concat(r,"' of type '").concat(typeof r,"'")),n.setInternalDate(new Date(r)),n},e.fromDateParts=function(r,n,i,a,o,s,l){void 0===n&&(n=0),void 0===i&&(i=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===l&&(l=0);var c=Date.UTC(r,n,i,a,o,s,l),f=new e(c);return f.setInternalDate(new Date(c)),f},e.fromString=function(r){u.assert(function(){return/^[\+-]?\d{4}-\d{2}-\d{2}(T\d{2}\:\d{2}\:\d{2}(\.\d{3})?Z)?$/.test(r)},"Only ISO 8601 is guaranteed to be parsed as UTC");var n=new Date(r),i=new e(n.getTime());return i.setInternalDate(n),i},e.fromDateWithEpochValue=function(r){return e.fromTimeValue(r.epochTimeStamp)},e.isDate=function(r){return r instanceof Date},e.prototype.getDate=function(){return this.date.getUTCDate()},e.prototype.getDay=function(){return this.date.getUTCDay()},e.prototype.getFullYear=function(){return this.date.getUTCFullYear()},e.prototype.getHours=function(){return this.date.getUTCHours()},e.prototype.getMilliseconds=function(){return this.date.getUTCMilliseconds()},e.prototype.getMinutes=function(){return this.date.getUTCMinutes()},e.prototype.getMonth=function(){return this.date.getUTCMonth()},e.prototype.getSeconds=function(){return this.date.getUTCSeconds()},e.prototype.setDate=function(r){return this.date.setUTCDate.apply(this.date,arguments)},e.prototype.setFullYear=function(r,n,i){return this.date.setUTCFullYear.apply(this.date,arguments)},e.prototype.setHours=function(r,n,i,a){return this.date.setUTCHours.apply(this.date,arguments)},e.prototype.setMilliseconds=function(r){return this.date.setUTCMilliseconds.apply(this.date,arguments)},e.prototype.setMinutes=function(r,n,i){return this.date.setUTCMinutes.apply(this.date,arguments)},e.prototype.setMonth=function(r,n){return this.date.setUTCMonth.apply(this.date,arguments)},e.prototype.setSeconds=function(r,n){return this.date.setUTCSeconds.apply(this.date,arguments)},e.prototype.toString=function(){var r=this.date.toUTCString(),n=r.length-4;return r.indexOf(" GMT")===n&&(r=r.substr(0,n)),r},e.prototype.getTime=function(){return this.date.getTime()},e.prototype.getTimezoneOffset=function(){return this.date.getTimezoneOffset()},e.prototype.getUTCDate=function(){return this.date.getUTCDate()},e.prototype.getUTCDay=function(){return this.date.getUTCDay()},e.prototype.getUTCFullYear=function(){return this.date.getUTCFullYear()},e.prototype.getUTCHours=function(){return this.date.getUTCHours()},e.prototype.getUTCMilliseconds=function(){return this.date.getUTCMilliseconds()},e.prototype.getUTCMinutes=function(){return this.date.getUTCMinutes()},e.prototype.getUTCMonth=function(){return this.date.getUTCMonth()},e.prototype.getUTCSeconds=function(){return this.date.getUTCSeconds()},e.prototype.setUTCDate=function(r){return this.date.setUTCDate.apply(this.date,arguments)},e.prototype.setUTCFullYear=function(r,n,i){return this.date.setUTCFullYear.apply(this.date,arguments)},e.prototype.setUTCHours=function(r,n,i,a){return this.date.setUTCHours.apply(this.date,arguments)},e.prototype.setUTCMilliseconds=function(r){return this.date.setUTCMilliseconds.apply(this.date,arguments)},e.prototype.setUTCMinutes=function(r,n,i){return this.date.setUTCMinutes.apply(this.date,arguments)},e.prototype.setUTCMonth=function(r,n){return this.date.setUTCMonth.apply(this.date,arguments)},e.prototype.setUTCSeconds=function(r,n){return this.date.setUTCSeconds.apply(this.date,arguments)},e.prototype.toDateString=function(){return this.date.toDateString()},e.prototype.toISOString=function(){return this.date.toISOString()},e.prototype.toJSON=function(){return this.date.toJSON()},e.prototype.toLocaleDateString=function(){return this.date.toLocaleDateString()},e.prototype.toLocaleString=function(){return this.date.toLocaleString()},e.prototype.toLocaleTimeString=function(){return this.date.toLocaleTimeString()},e.prototype.toTimeString=function(){return this.date.toTimeString()},e.prototype.toUTCString=function(){return this.date.toUTCString()},e.prototype.valueOf=function(){return this.date.valueOf()},e}(Date),Kr=new RegExp(["'[^']*'",'"[^"]*"',"\\\\.","'[^']*$",'"[^"]*$',"\\\\$"].join("|"),"g");function rd(t){return Kr.lastIndex=0,t.replace(Kr,"\ue100")}function vi(t,e){for(Kr.lastIndex=0;;){var r=Kr.exec(t);if(!r)break;var n=r[0],i=Kr.lastIndex-n.length,a=String.fromCharCode(57600+e.length);e.push(n),t=t.substr(0,i)+a+t.substr(Kr.lastIndex),Kr.lastIndex=i+1}return t}function _a(t,e,r){void 0===r&&(r=!0);for(var n=e.length,i=0;i<n;i++){var a=String.fromCharCode(57600+i),o=e[i];if(!r){var s=o[0];o="\\"===s||1===o.length||o[o.length-1]!==s?o.substring(1):o.substring(1,o.length-1)}t=t.replace(a,o)}return t}var id,ad,wE=/({{)|(}})|{(\d+[^}]*)}/g,Sr="#",nd=new RegExp(["0",Sr].join("|"),"g"),xE=function(){function t(){}return t.prototype.formatValue=function(e,r,n){if(null==e)return"";var i=this.getCulture(n);return Ws.canFormat(e)?Ws.format(e,r,i):In.canFormat(e)?In.format(e,r,i):e.toString()},t.prototype.format=function(e,r,n){var i=this;return e?e.replace(wE,function(o,s,l,c){if(s)return"{";if(l)return"}";var f=c.split(":"),d=parseInt(f[0],10);return i.formatValue(r[d],f[1],n)}):""},t.prototype.isStandardNumberFormat=function(e){return yi(e)},t.prototype.formatNumberWithCustomOverride=function(e,r,n,i){return function(t,e,r,n){return u.assertValue(t,"value"),u.assert(function(){return"number"==typeof t},"value must be a number"),u.assertValue(e,"format"),u.assertValue(r,"nonScientificOverrideFormat"),u.assertValue(n,"culture"),u.assert(function(){return!yi(e)},"Standard format"),Ys(t,e,n,r)}(e,r,n,this.getCulture(i))},t.prototype.dateFormatString=function(e){return this._dateTimeScaleFormatInfo||this.initialize(),this._dateTimeScaleFormatInfo.getFormatString(e)},t.prototype.setCurrentCulture=function(e){this._currentCultureSelector!==e&&(this._currentCulture=this.getCulture(e),this._currentCultureSelector=e,this._dateTimeScaleFormatInfo=new jE(this._currentCulture))},t.prototype.normalizeCultureSelector=function(e){var r=e.split("-");return 2===r.length&&2===r[1].length&&(e=r[0]+"-"+r[1].toUpperCase()),e},t.prototype.getCulture=function(e){if(null==e)return null==this._currentCulture&&this.initialize(),this._currentCulture;e=this.normalizeCultureSelector(e);var r=Globalize.findClosestCulture(e);return r||(r=Globalize.culture("en-US")),r},t.prototype.parseFloat=function(e){return Globalize.parseFloat(e,this.getCulture())},t.prototype.parseDate=function(e){var r=Globalize.parseDate(e,null,this.getCulture());return r&&Gs(r)},t.prototype.getCurrentCulture=function(){return this.getCulture()},t.prototype.initialize=function(){var e=this.getCurrentLocale();this.setCurrentCulture(e);var r=this.getUrlParam("calendar");if(r){var n=this._currentCulture,i=n.calendars[r];i&&(n.calendar=i)}},t.prototype.getCurrentLocale=function(){var e=Aa.getLanguage()||Globalize.culture().name,r=Gf().cultureInfo;return e=Gf().formattingLocale||r||e,this.getUrlParam("formatLocale")||this.getUrlParam("language")||e},t.prototype.getUrlParam=function(e){var r=window.location.search.match(RegExp("[?&]"+e+"=([^&]*)"));return r?r[1]:void 0},t}();function od(t,e,r){var n=r.calendar.patterns;!function(t){var e=t.patterns;void 0===e.g&&(e.g=e.f.replace(e.D,e.d),e.G=e.F.replace(e.D,e.d))}(r.calendar);var i=function(t,e,r){switch(e){case"m":e="M";break;case"O":case"o":e="yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'fff'0000'";break;case"R":case"r":t=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),e="ddd, dd MMM yyyy HH':'mm':'ss 'GMT'";break;case"s":e="S";break;case"u":t=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),e="yyyy'-'MM'-'dd HH':'mm':'ss'Z'";break;case"U":t=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),e="F";break;case"y":case"Y":switch(r){case"default":case"en":case"en-US":e="MMMM, yyyy";break;default:e="Y"}}return{value:t,format:e}}(t,e,r.name);return e=1===i.format.length?n[i.format]:i.format,Globalize.format(i.value,e,r)}var Ta,TE=/^\{.+\}.*/,PE=/\{.+\}/,FE=/e[+-]*[0#]+/i,RE=/^[a-z]\d{0,2}$/i,NE=/0+$/,kE=/([,]*)\.([0#]*)/g,LE=/[0#,\.]+[0,#]*/g,BE=/([0#])(?=[^0#]*$)/;function sd(t,e){if(null==e)return e;if(ld(e)){var r=gi(e);return Ia(t>0?r.positive:0===t?r.zero:r.negative)}return Ia(e)}function Ia(t){var e=Qs(LE,t);return e?e[0]:t}function Js(t,e,r){if(null==e)return t;if(null==t&&(t="0"),ld(t)){for(var n=gi(t),s=[n.positive,n.negative,n.zero],l=0;l<s.length;l++)s[l]=ud(s[l],e,r);return s.join(";")}return ud(t,e,r)}function ud(t,e,r){if((e=Math.abs(e))>=0){var n=[];t=vi(t,n);var a=_.repeat(r?"0":Sr,Math.abs(e)),o=Qs(kE,t);if(o){var s=t.substr(0,o.index+o[1].length),l=t.substr(o.index+o[1].length+1,o[2].length),c=o[1],f=t.substr(o.index+o[0].length);if(r)l=a;else{var d=a.length-l.length;d>0?l+=a.slice(-d):d<0&&(l=l.slice(0,d))}l.length>0?l="."+l:c.length>0&&(l="."),t=s+l+f}else a.length>0&&(t=t.replace(BE,"$1."+a));0!==n.length&&(t=_a(t,n))}return t}function ld(t){return-1!==rd(t).indexOf(";")}function gi(t){var e={hasNegative:!1,positive:t,negative:t,zero:t},r=[],n=(t=vi(t,r)).split(";"),i=n.length;return i>1&&(0!==r.length&&(n=_.map(n,function(a){return _a(a,r)})),e.hasNegative=!0,e.positive=e.zero=n[0],e.negative=n[1],i>2&&(e.zero=n[2])),e}function yi(t){return u.assertValue(t,"format"),RE.test(t)}function Ys(t,e,r,n){var i,a=r.numberFormat;if(!isFinite(t))return Globalize.format(t,void 0);var o=gi(e);e=t>0?o.positive:0===t?o.zero:o.negative,o.hasNegative&&(t=Math.abs(t));var s=mi(e,!0),l=[];if(s.hasLiterals&&(e=vi(e,l)),s.hasE&&!n){var c=Qs(FE,e);if(c){var f=e.substr(0,c.index),d=e.substr(c.index+2),p=Xs(f,s);if(1!==(h=Zs(f,s))&&(t*=h),u.assert(function(){return"number"==typeof t},"value must be a number"),"number"!=typeof t)return String(t);var v=t.toExponential(p),g=v.indexOf("e"),y=v.substr(0,g),m=v.substr(g+1),S=eu(y,f,a),b=eu(m,d,a);"+"===b.charAt(0)&&"+"!==c[0].charAt(1)&&(b=b.substr(1)),i=S+c[0].charAt(0)+b}}if(void 0===i){var h,C=void 0,w=!1;if(p=Xs(e,s),1!==(h=Zs(e,s))&&(t*=h),t=parseFloat($s(t,p)),!isFinite(t))return Globalize.format(t,void 0);n?(n=function(t,e){return e&&void 0!==t?t.replace("{0}","{0:"+e+"}"):t}(n,sd(t,e)),C=Ge.format(n,[t],r.name),w=!0):(C=$s(t,p),C=function(t,e,r,n){if(0===n)return e;var i=e.indexOf(".");if(-1===i)return e;for(var a=i+1,s=a+(r-n);s<e.length;++s){var l=e[s];if("0"===l||"9"===l){var c=$s(t,s-a);if(parseFloat(c)===t)return c}}return e}(t,C,p,function(t,e){return cd(t,e),e.optionalPrecision}(e,s))),i=eu(C,e,a,n,w)}return s.hasLiterals&&(i=_a(i,l,!1)),Ta=s,i}function $s(t,e){var r="",n=0;e>16&&(n=e-16,e=16);var i=gr(Math.abs(t))+1;if(i<16){if(i>0){var a=16-i;e>a&&(n+=e-a,e=a)}r=function(t,e){if(!t||isFinite(t)){var r=t<0;r&&(t=-t);var n=Math.pow(2,Math.floor(Math.log(t)/Math.LN2)-52),i=Math.pow(10,e);1/i>10*n&&(t=Math.round((t+n)*i)/i),r&&(t=-t)}return t.toFixed(e)}(t,e)}else if(16===i)r=t.toFixed(0),(n+=e)>0&&(r+=".");else{if(u.assert(function(){return"number"==typeof t},"value must be a number"),"number"!=typeof t)return String(t);var o=(r=t.toExponential(15)).indexOf("e");if(o>0){var s=r.indexOf("."),l=r.substr(0,o),c=r.substr(o+1),f=parseInt(c,10)-(l.length-s-1);r=l.replace(".","")+_.repeat("0",f),e>0&&(r=r+"."+_.repeat("0",e))}}return n>0&&(r+=_.repeat("0",n)),r}function mi(t,e,r,n){if(void 0!==Ta&&t===Ta.format)return Ta;for(var i=[],a=vi(t,i),o={format:t,hasLiterals:0!==i.length,hasE:!1,hasCommas:!1,hasDots:!1,hasPercent:!1,hasPermile:!1,precision:void 0,optionalPrecision:void 0,scale:void 0,partsPerScale:void 0},s=0,l=a.length;s<l;s++)switch(a.charAt(s)){case"e":case"E":o.hasE=!0;break;case",":o.hasCommas=!0;break;case".":o.hasDots=!0;break;case"%":o.hasPercent=!0;break;case"\u2030":o.hasPermile=!0}var f=gi(t);return e&&(o.precision=Xs(f.positive,o)),n&&(o.partsPerScale=fd(f.positive,o)),r&&(o.scale=Zs(f.positive,o)),o}function Xs(t,e){return cd(t,e),e.precision}function cd(t,e){if(!(e.precision>-1)){var r=0,n=0;if(e.hasDots){e.hasLiterals&&(t=rd(t));var i=t.indexOf(".");if(i>-1){for(var a=t.length,o=i;o<a;o++){var s=t.charAt(o);if(s.match(nd)&&++r,s===Sr?++n:n=0,"E"===s)break}r>19&&(n=Math.max(0,n-(r-19)),r=19)}}e.precision=r,e.optionalPrecision=n}}function fd(t,e){if(null!=e.partsPerScale)return e.partsPerScale;var r=1;return e.hasPercent&&t.indexOf("%")>-1&&(r*=100),e.hasPermile&&t.indexOf("\u2030")>-1&&(r*=1e3),e.partsPerScale=r,r}function Zs(t,e){if(e.scale>-1)return e.scale;var r=fd(t,e);if(e.hasCommas){var n=t.indexOf(".");if(-1===n)for(n=t.length;n>0&&")"===t.charAt(n-1);)n--;for(var i=n-1;i>-1&&","===t.charAt(i);i--)r/=1e3}return e.scale=r,r}function eu(t,e,r,n,i){var a=!!n,o=e.split(".",2);if(2===o.length){var s=o[0],l=o[1],c="";n&&(u.assert(function(){return TE.test(n)},"Number should always precede the display unit"),c=n.replace(PE,""),t=t.replace(c,""));var f=r["."],p=t.split(i?f:".",2),h=1===p.length?p[0]+c:p[0],v=2===p.length?p[1]+c:"";v=v.replace(NE,"");var g=dd(h,s,r,a),y=function(t,e,r){var n=0,i=e.length,a=t.length;if(r){u.assert(function(){return i>0},"Empty formatting string");var o=e.charAt(i-1);return o.match(nd)?{value:t,fmtOnly:""===t}:{value:t+o,fmtOnly:""===t}}for(var s="",l=!0,c=0;c<i;c++){var f=e.charAt(c);if(n<a)switch(f){case"0":case Sr:s+=t[n++],l=!1;break;default:s+=f}else f!==Sr&&(s+=f,l=l&&"0"!==f)}return{value:s,fmtOnly:l}}(v,l,a);return y.fmtOnly||""===y.value?g+y.value:g+f+y.value}return dd(t,e,r,a)}function dd(t,e,r,n){var i=e.indexOf(","),a=i>-1&&i<Math.max(e.lastIndexOf("0"),e.lastIndexOf("#"))&&r[","],o=0,s=0,l=r.groupSizes||[3],c=l[0],f=r[","],d="",p=t.charAt(0);("+"===p||"-"===p)&&(d=r[p],t=t.substr(1));for(var h="0"===t,v="",g="",y=t.length-1,m=!0,S=e.length-1;S>-1;S--){var b=e.charAt(S);switch(b){case"0":case Sr:m=!1,""!==g&&(v=g+v,g=""),n||((y>-1||"0"===b)&&a&&(o===c?(v=f+v,++s<l.length&&(c=l[s]),o=1):o++),y>-1?(h&&b===Sr||(v=t.charAt(y)+v),y--):b!==Sr&&(v=b+v));break;case",":break;default:g=b+g}}if(!n){if(y>-1&&""!==v)if(a)for(;y>-1;)o===c?(v=f+v,++s<l.length&&(c=l[s]),o=1):o++,v=t.charAt(y)+v,y--;else v=t.substr(0,y+1)+v;return d+g+v}return m?d+g+v:d+g+t+v}var jE=function(){function t(e){var r,n,i=e.calendar,a=i.patterns,o=null!=(null===(n=null===(r=i.months)||void 0===r?void 0:r.namesAbbr)||void 0===n?void 0:n[0]),s=a.Y,l=a.M,c=a.f,f=a.T,d=a.t,p=c.indexOf(",")>-1?", ":" ",h=0===s.indexOf("yyyy'")&&s.length>6&&"'"===s[6];this.YearPattern=h?s.substr(0,7):"yyyy";var v=c.indexOf("yy"),g=c.indexOf("MMMM");this.MonthPattern=o&&g>-1?v>g?"MMM yyyy":"yyyy MMM":s,this.DayPattern=o?l.replace("MMMM","MMM"):l;var y=c.indexOf("mm"),S=c.indexOf("tt")>-1?d.replace(":mm ",""):d;this.HourPattern=v<y?this.DayPattern+p+S:S+p+this.DayPattern,this.MinutePattern=d,this.SecondPattern=f,this.MillisecondPattern=f.replace("ss","ss.fff")}return t.prototype.getFormatString=function(e){switch(e){case B.Year:return this.YearPattern;case B.Month:return this.MonthPattern;case B.Week:case B.Day:return this.DayPattern;case B.Hour:return this.HourPattern;case B.Minute:return this.MinutePattern;case B.Second:return this.SecondPattern;case B.Millisecond:return this.MillisecondPattern}u.assertFail("Unexpected unit: "+e)},t}(),Ge=new xE;function ie(t,e){return u.assert(function(){return!!e},"flag must be specified and nonzero."),(t&e)===e}function pd(t){if(null===t||t%1!=0)return 0;for(var e=0,r=t;0!==r;)1==(1&r)&&e++,r>>>=1;return e}var Oe,R,L=function(){function t(e,r,n,i,a,o){u.assert(function(){return!!e&&null!=Pa[e]||0===e},"type"),u.assert(function(){return!!r||null===r},"category"),u.assert(function(){return 26214401!==e||!!n},"enumType"),u.assert(function(){return 26280196!==e||!!i},"flagsEnumType"),this.underlyingType=e,this.category=r,ie(e,512)&&(this.temporalType=new JE(e)),ie(e,1024)&&(this.geographyType=new YE(e)),ie(e,2048)&&(this.miscType=new tu(e,o)),ie(e,4096)&&(this.formattingType=new ru(e)),ie(e,26214401)&&(this.enumType=n),ie(e,26280196)&&(this.flagsEnumType=i),ie(e,8192)&&(this.scriptingType=new KE(e)),ie(e,16384)&&(this.referenceType=new $E(e)),ie(e,13)&&(this.variationTypes=a)}return t.isValueTypeDescriptor=function(e){return 0!==t.fromDescriptor(e).primitiveType},t.fromDescriptor=function(e){if((e=e||{}).scripting&&e.scripting.source)return t.fromExtendedType(32776193);if(e.enumeration)return t.fromEnum(e.enumeration);if(e.flagsEnumeration)return t.fromFlagsEnum(e.flagsEnumeration);if(e.temporal){if(e.temporal.year)return t.fromExtendedType(66308);if(e.temporal.quarter)return t.fromExtendedType(262916);if(e.temporal.month)return t.fromExtendedType(131844);if(e.temporal.day)return t.fromExtendedType(328452);if(e.temporal.paddedDateTableDate)return t.fromExtendedType(197127)}if(e.geography){if(e.geography.address)return t.fromExtendedType(6554625);if(e.geography.city)return t.fromExtendedType(6620161);if(e.geography.continent)return t.fromExtendedType(6685697);if(e.geography.country)return t.fromExtendedType(6751233);if(e.geography.county)return t.fromExtendedType(6816769);if(e.geography.region)return t.fromExtendedType(6882305);if(e.geography.postalCode)return t.fromExtendedType(6947841);if(e.geography.stateOrProvince)return t.fromExtendedType(7013377);if(e.geography.place)return t.fromExtendedType(7078913);if(e.geography.latitude)return t.fromExtendedType(7144707);if(e.geography.longitude)return t.fromExtendedType(7210243)}if(e.misc){if(e.misc.image)return t.fromExtendedType(13109259);if(e.misc.imageUrl)return t.fromExtendedType(13174785);if(e.misc.webUrl)return t.fromExtendedType(13240321);if(e.misc.barcode)return t.fromExtendedType(13305857);if(e.misc.sparkline)return t.fromSparklineType(e.misc.sparkline)}if(e.formatting){if(e.formatting.color)return t.fromExtendedType(19664897);if(e.formatting.formatString)return t.fromExtendedType(19730433);if(e.formatting.alignment)return t.fromExtendedType(20058113);if(e.formatting.labelDisplayUnits)return t.fromExtendedType(20123649);if(e.formatting.displayUnitsWithoutAuto)return t.fromExtendedType(20516865);if(e.formatting.fontFamily)return t.fromExtendedType(20385793);if(e.formatting.fontSize)return t.fromExtendedType(20189443);if(e.formatting.altText)return t.fromExtendedType(20451329);if(e.formatting.stylePreset)return t.fromExtendedType(20582401);if(e.formatting.dashArray)return t.fromExtendedType(20647937)}if(e.text)return t.fromExtendedType(1);if(e.integer)return t.fromExtendedType(260);if(e.numeric)return t.fromExtendedType(259);if(e.bool)return t.fromExtendedType(5);if(e.dateTime)return t.fromExtendedType(519);if(e.duration)return t.fromExtendedType(10);if(e.binary)return t.fromExtendedType(11);if(e.json)return t.fromExtendedType(14);if(e.none)return t.fromExtendedType(12);if(e.extendedType)return t.fromExtendedType(e.extendedType);if(e.operations&&e.operations.searchEnabled)return t.fromExtendedType(65541);if(e.reference){if(e.reference.bookmark)return t.fromExtendedType(39337985);if(e.reference.bookmarkGroup)return t.fromExtendedType(39534593);if(e.reference.section)return t.fromExtendedType(39403521);if(e.reference.perspective)return t.fromExtendedType(39469057);if(e.reference.rowRefText)return t.fromExtendedType(39600129)}if(e.variant){var r=_.map(e.variant,function(n){return t.fromDescriptor(n)});return t.fromVariant(r)}return t.fromExtendedType(0)},t.fromExtendedType=function(e){var r=iu(e=e||0),n=function(t){if(function(t){return(65535&t)===t}(t))return null;var e=Pa[t];if(!e)return null;var r=e.lastIndexOf("_");if(r>0){var n=e.slice(0,r);n in nu&&(u.assert(function(){return(t&Fa)==(t&Fa)},"Unexpected value for ExtendedType base member of "+t),e=n)}return e}(e);return u.assert(function(){return 0!==r||0===e},"Cannot create ValueType for abstract extended type. Consider using fromDescriptor instead."),t.fromPrimitiveTypeAndCategory(r,n)},t.fromPrimitiveTypeAndCategory=function(e,r){r=r||null;var n=(e=e||0).toString();return r&&(n+="|"+r),t.typeCache[n]||(t.typeCache[n]=new t(function(t,e){var r=XE[t],n=nu[r];if(null==n&&(u.assertFail("Unexpected primitiveType "+t),n=0),t&&e){var i=nu[e];if(i){var a=iu(i);0===a?Pa[i|=n]&&(u.assert(function(){return Pa[i]===e+"_"+r},"Unexpected name for ExtendedType member "+i),n=i):a===t&&(n=i)}}return n}(e,r),r))},t.fromEnum=function(e){return u.assertValue(e,"enumType"),new t(26214401,null,e)},t.fromFlagsEnum=function(e){return u.assertValue(e,"enumType"),new t(26280196,null,null,e)},t.fromVariant=function(e){return u.assertValue(e,"variantTypes"),new t(13,null,null,null,e)},t.fromSparklineType=function(e){return new t(13371406,"Sparkline",null,null,null,e)},t.isCompatibleFromAny=function(e,r,n){u.assertValue(e,"type"),u.assertValue(r,"otherType");var i=t.fromDescriptor(e);return!!t.isCompatibleTo(i,[r],n)||i&&i.isCompatibleFrom(t.fromDescriptor(r),n)},t.isCompatibleTo=function(e,r,n){u.assertValue(e,"type"),u.assertValue(r,"otherTypes");for(var i=t.fromDescriptor(e),a=0,o=r;a<o.length;a++)if(t.fromDescriptor(o[a]).isCompatibleFrom(i,n))return!0;return!1},t.prototype.isCompatibleFrom=function(e,r){if(u.assertValue(e,"other"),this===e)return!0;if(e.variant)for(var n=0,i=e.variant;n<i.length;n++)if(!this.isCompatibleFrom(i[n],r))return!1;if(this.variant)for(var o=0,s=this.variant;o<s.length;o++)if(s[o].isCompatibleFrom(e,r))return!0;var c=e.primitiveType;return this.primitiveType===c||0===c||this.numeric&&e.numeric&&(!r||!this.integer||e.integer)},t.prototype.equals=function(e){return _.isEqual(this,e)},Object.defineProperty(t.prototype,"primitiveType",{get:function(){return iu(this.underlyingType)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extendedType",{get:function(){return this.underlyingType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"categoryString",{get:function(){return this.category},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return 1===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numeric",{get:function(){return ie(this.underlyingType,256)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"integer",{get:function(){return 4===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bool",{get:function(){return 5===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dateTime",{get:function(){return 7===this.primitiveType||6===this.primitiveType||9===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return 10===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"binary",{get:function(){return 11===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"json",{get:function(){return 14===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return 12===this.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"temporal",{get:function(){return this.temporalType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"geography",{get:function(){return this.geographyType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"misc",{get:function(){return this.miscType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formatting",{get:function(){return this.formattingType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enum",{get:function(){return this.enumType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flagsEnum",{get:function(){return this.flagsEnumType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scripting",{get:function(){return this.scriptingType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reference",{get:function(){return this.referenceType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"variant",{get:function(){return this.variationTypes},enumerable:!1,configurable:!0}),t.typeCache={},t}();Kt(L.prototype);var KE=function(){function t(e){u.assert(function(){return!!e&&ie(e,8192)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"source",{get:function(){return ae(this.underlyingType,32776193)},enumerable:!1,configurable:!0}),t}(),JE=function(){function t(e){u.assert(function(){return!!e&&ie(e,512)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"year",{get:function(){return ae(this.underlyingType,66048)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"quarter",{get:function(){return ae(this.underlyingType,262656)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"month",{get:function(){return ae(this.underlyingType,131584)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"day",{get:function(){return ae(this.underlyingType,328192)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paddedDateTableDate",{get:function(){return ae(this.underlyingType,197127)},enumerable:!1,configurable:!0}),t}(),YE=function(){function t(e){u.assert(function(){return!!e&&ie(e,1024)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"address",{get:function(){return ae(this.underlyingType,6554625)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"city",{get:function(){return ae(this.underlyingType,6620161)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"continent",{get:function(){return ae(this.underlyingType,6685697)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"country",{get:function(){return ae(this.underlyingType,6751233)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"county",{get:function(){return ae(this.underlyingType,6816769)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"region",{get:function(){return ae(this.underlyingType,6882305)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"postalCode",{get:function(){return ae(this.underlyingType,6947840)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateOrProvince",{get:function(){return ae(this.underlyingType,7013377)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"place",{get:function(){return ae(this.underlyingType,7078913)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"latitude",{get:function(){return ae(this.underlyingType,7144448)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return ae(this.underlyingType,7209984)},enumerable:!1,configurable:!0}),t}(),tu=function(){function t(e,r){u.assert(function(){return!!e&&ie(e,2048)},"type"),this.underlyingType=e,this.sparklineType=r}return Object.defineProperty(t.prototype,"image",{get:function(){return ae(this.underlyingType,13109259)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return ae(this.underlyingType,13174785)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"webUrl",{get:function(){return ae(this.underlyingType,13240321)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barcode",{get:function(){return ae(this.underlyingType,13305856)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sparkline",{get:function(){if(ae(this.underlyingType,13371406))return this.sparklineType},enumerable:!1,configurable:!0}),t}();Object.getOwnPropertyNames(tu.prototype).forEach(function(t){"constructor"!==t&&Object.defineProperty(tu.prototype,t,{enumerable:!0})});var $E=function(){function t(e){u.assert(function(){return!!e&&ie(e,16384)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"bookmark",{get:function(){return ae(this.underlyingType,39337985)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bookmarkGroup",{get:function(){return ae(this.underlyingType,39534593)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"section",{get:function(){return ae(this.underlyingType,39403521)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perspective",{get:function(){return ae(this.underlyingType,39469057)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowRefText",{get:function(){return ae(this.underlyingType,39600129)},enumerable:!1,configurable:!0}),t}(),ru=function(){function t(e){u.assert(function(){return!!e&&ie(e,4096)},"type"),this.underlyingType=e}return Object.defineProperty(t.prototype,"color",{get:function(){return ae(this.underlyingType,19664897)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formatString",{get:function(){return ae(this.underlyingType,19730433)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alignment",{get:function(){return ae(this.underlyingType,20058113)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"labelDisplayUnits",{get:function(){return ae(this.underlyingType,20123649)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayUnitsWithoutAuto",{get:function(){return ae(this.underlyingType,20516865)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return ae(this.underlyingType,20385793)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return ae(this.underlyingType,20189443)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"altText",{get:function(){return ae(this.underlyingType,20451329)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stylePreset",{get:function(){return ae(this.underlyingType,20582401)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dashArray",{get:function(){return ae(this.underlyingType,20647937)},enumerable:!1,configurable:!0}),t}();Object.getOwnPropertyNames(ru.prototype).forEach(function(t){"constructor"!==t&&Object.defineProperty(ru.prototype,t,{enumerable:!0})});var XE=((Oe={})[0]="Null",Oe[1]="Text",Oe[2]="Decimal",Oe[3]="Double",Oe[4]="Integer",Oe[5]="Boolean",Oe[6]="Date",Oe[7]="DateTime",Oe[8]="DateTimeZone",Oe[9]="Time",Oe[10]="Duration",Oe[11]="Binary",Oe[12]="None",Oe[13]="Variant",Oe[14]="Json",Oe),Pa=((R={})[256]="Numeric",R[512]="Temporal",R[1024]="Geography",R[2048]="Miscellaneous",R[4096]="Formatting",R[8192]="Scripting",R[0]="Null",R[1]="Text",R[258]="Decimal",R[259]="Double",R[260]="Integer",R[5]="Boolean",R[518]="Date",R[519]="DateTime",R[520]="DateTimeZone",R[521]="Time",R[10]="Duration",R[11]="Binary",R[12]="None",R[13]="Variant",R[66048]="Years",R[66049]="Years_Text",R[66308]="Years_Integer",R[66054]="Years_Date",R[66055]="Years_DateTime",R[131584]="Months",R[131585]="Months_Text",R[131844]="Months_Integer",R[131590]="Months_Date",R[131591]="Months_DateTime",R[197127]="PaddedDateTableDates",R[262656]="Quarters",R[262657]="Quarters_Text",R[262916]="Quarters_Integer",R[262662]="Quarters_Date",R[262663]="Quarters_DateTime",R[328192]="DayOfMonth",R[328193]="DayOfMonth_Text",R[328452]="DayOfMonth_Integer",R[328198]="DayOfMonth_Date",R[328199]="DayOfMonth_DateTime",R[6554625]="Address",R[6620161]="City",R[6685697]="Continent",R[6751233]="Country",R[6816769]="County",R[6882305]="Region",R[6947840]="PostalCode",R[6947841]="PostalCode_Text",R[6948100]="PostalCode_Integer",R[7013377]="StateOrProvince",R[7078913]="Place",R[7144448]="Latitude",R[7144706]="Latitude_Decimal",R[7144707]="Latitude_Double",R[7209984]="Longitude",R[7210242]="Longitude_Decimal",R[7210243]="Longitude_Double",R[13109259]="Image",R[13174785]="ImageUrl",R[13240321]="WebUrl",R[13305856]="Barcode",R[13305857]="Barcode_Text",R[13306116]="Barcode_Integer",R[19664897]="Color",R[19730433]="FormatString",R[20058113]="Alignment",R[20123649]="LabelDisplayUnits",R[20516865]="DisplayUnitsWithoutAuto",R[20385793]="FontFamily",R[20451329]="AltText",R[20189443]="FontSize",R[26214401]="Enumeration",R[26280196]="FlagsEnumeration",R[32776193]="ScriptSource",R[65541]="SearchEnabled",R[39337985]="BookmarkRef",R[39534593]="BookmarkGroupRef",R[39403521]="SectionRef",R[20582401]="StylePreset",R[20647937]="DashArray",R[39469057]="PerspectiveRef",R[16384]="Reference",R[14]="Json",R[13371406]="Sparkline",R[39600129]="RowRefText",R),nu={Numeric:256,Temporal:512,Geography:1024,Miscellaneous:2048,Formatting:4096,Scripting:8192,Null:0,Text:1,Decimal:258,Double:259,Integer:260,Boolean:5,Date:518,DateTime:519,DateTimeZone:520,Time:521,Duration:10,Binary:11,None:12,Variant:13,Years:66048,Years_Text:66049,Years_Integer:66308,Years_Date:66054,Years_DateTime:66055,Months:131584,Months_Text:131585,Months_Integer:131844,Months_Date:131590,Months_DateTime:131591,PaddedDateTableDates:197127,Quarters:262656,Quarters_Text:262657,Quarters_Integer:262916,Quarters_Date:262662,Quarters_DateTime:262663,DayOfMonth:328192,DayOfMonth_Text:328193,DayOfMonth_Integer:328452,DayOfMonth_Date:328198,DayOfMonth_DateTime:328199,Address:6554625,City:6620161,Continent:6685697,Country:6751233,County:6816769,Region:6882305,PostalCode:6947840,PostalCode_Text:6947841,PostalCode_Integer:6948100,StateOrProvince:7013377,Place:7078913,Latitude:7144448,Latitude_Decimal:7144706,Latitude_Double:7144707,Longitude:7209984,Longitude_Decimal:7210242,Longitude_Double:7210243,Image:13109259,ImageUrl:13174785,WebUrl:13240321,Barcode:13305856,Barcode_Text:13305857,Barcode_Integer:13306116,Color:19664897,FormatString:19730433,Alignment:20058113,LabelDisplayUnits:20123649,DisplayUnitsWithoutAuto:20516865,FontFamily:20385793,AltText:20451329,FontSize:20189443,Enumeration:26214401,FlagsEnumeration:26280196,ScriptSource:32776193,SearchEnabled:65541,BookmarkRef:39337985,BookmarkGroupRef:39534593,SectionRef:39403521,StylePreset:20582401,DashArray:20647937,PerspectiveRef:39469057,Reference:16384,Json:14,Sparkline:13371406,RowRefText:39600129},Fa=4294901760;function iu(t){return 255&t}function ae(t,e){return(t&Fa)==(e&Fa)}function we(t,e){return u.assertValue(t,"expr"),u.assertValue(e,"visitor"),u.assertValue(t,"expected sqExpr to conform to a fieldExprPattern"),t.column?function(t,e){return u.assertValue(t,"column"),u.assertValue(e,"visitor"),e.visitColumn(t)}(t.column,e):t.columnAggr?function(t,e){return u.assertValue(t,"columnAggr"),u.assertValue(e,"visitor"),e.visitColumnAggr(t)}(t.columnAggr,e):t.groupingColumn?function(t,e){return u.assertValue(t,"column"),u.assertValue(e,"visitor"),e.visitGroupingColumn(t)}(t.groupingColumn,e):t.groupingColumnAggr?function(t,e){return u.assertValue(t,"columnAggr"),u.assertValue(e,"visitor"),e.visitGroupingColumnAggr(t)}(t.groupingColumnAggr,e):t.columnHierarchyVariation?function(t,e){return u.assertValue(t,"columnHierarchyVariation"),u.assertValue(e,"visitor"),e.visitColumnHierarchyVariation(t)}(t.columnHierarchyVariation,e):t.columnHierarchyLevelVariation?function(t,e){return u.assertValue(t,"columnHierarchyLevelVariation"),u.assertValue(e,"visitor"),e.visitColumnHierarchyLevelVariation(t)}(t.columnHierarchyLevelVariation,e):t.columnSubquery?function(t,e){return u.assertValue(t,"columnSubquery"),u.assertValue(e,"visitor"),e.visitColumnSubquery(t)}(t.columnSubquery,e):t.columnAggrSubquery?function(t,e){return u.assertValue(t,"columnAggrSubquery"),u.assertValue(e,"visitor"),e.visitColumnAggrSubquery(t)}(t.columnAggrSubquery,e):t.columnTransformRef?function(t,e){return u.assertValue(t,"columnTransformRef"),u.assertValue(e,"visitor"),e.visitColumnTransformRef(t)}(t.columnTransformRef,e):t.entity?function(t,e){return u.assertValue(t,"entity"),u.assertValue(e,"visitor"),e.visitEntity(t)}(t.entity,e):t.entityAggr?function(t,e){return u.assertValue(t,"entityAggr"),u.assertValue(e,"visitor"),e.visitEntityAggr(t)}(t.entityAggr,e):t.hierarchy?function(t,e){return u.assertValue(t,"hierarchy"),u.assertValue(e,"visitor"),e.visitHierarchy(t)}(t.hierarchy,e):t.hierarchyLevel?function(t,e){return u.assertValue(t,"hierarchyLevel"),u.assertValue(e,"visitor"),e.visitHierarchyLevel(t)}(t.hierarchyLevel,e):t.hierarchyLevelAggr?function(t,e){return u.assertValue(t,"hierarchyLevelAggr"),u.assertValue(e,"visitor"),e.visitHierarchyLevelAggr(t)}(t.hierarchyLevelAggr,e):t.measure?function(t,e){return u.assertValue(t,"measure"),u.assertValue(e,"visitor"),e.visitMeasure(t)}(t.measure,e):t.percentile?function(t,e){return u.assertValue(t,"percentile"),u.assertValue(e,"visitor"),e.visitPercentile(t)}(t.percentile,e):t.percentOfGrandTotal?function(t,e){return u.assertValue(t,"percentOfGrandTotal"),u.assertValue(e,"visitor"),e.visitPercentOfGrandTotal(t)}(t.percentOfGrandTotal,e):t.percentOfRoleTotal?function(t,e){return u.assertValue(t,"percentOfRoleTotal"),u.assertValue(e,"visitor"),e.visitPercentOfRoleTotal(t)}(t.percentOfRoleTotal,e):t.selectRef?function(t,e){return u.assertValue(t,"selectRef"),u.assertValue(e,"visitor"),e.visitSelectRef(t)}(t.selectRef,e):t.transformOutputRoleRef?function(t,e){return u.assertValue(t,"transformOutputRoleRef"),u.assertValue(e,"visitor"),e.visitTransformOutputRoleRef(t)}(t.transformOutputRoleRef,e):t.filteredEval?function(t,e){return u.assertValue(t,"filteredEval"),u.assertValue(e,"visitor"),e.visitFilteredEval(t)}(t.filteredEval,e):t.arithmetic?function(t,e){return u.assertValue(t,"arithmetic"),u.assertValue(e,"visitor"),e.visitArithmetic(t)}(t.arithmetic,e):t.constant?function(t,e){return u.assertValue(t,"constant"),u.assertValue(e,"visitor"),e.visitConstant(t)}(t.constant,e):t.sparklineData?function(t,e){return u.assertValue(t,"sparkline"),u.assertValue(e,"visitor"),e.visitSparklineData(t)}(t.sparklineData,e):t.nativeVisualCalc?function(t,e){return u.assertValue(t,"nativeVisualCalc"),u.assertValue(e,"visitor"),e.visitNativeVisualCalc(t)}(t.nativeVisualCalc,e):void u.assertFail("failed to visit a fieldExprPattern.")}function au(t){var e=we(t,hd.instance);return u.assert(function(){return!e||1===_.size(e)},"If there are more than 1 property names, then use getPropertyNames instead"),null==e?void 0:e[0]}function br(t){var e=we(t,Ra.instance);return u.assert(function(){return!e||1===_.size(e)},"If there are more than 1 entity, then use toFieldExprEntityItemPatterns instead"),null==e?void 0:e[0]}function ou(t){return we(t,Ra.instance)}var Ra=function(){function t(){}return t.prototype.visitColumn=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitColumnAggr=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitGroupingColumn=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitGroupingColumnAggr=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitColumnHierarchyVariation=function(e){return[t.toEntityItemExprPattern(e.source)]},t.prototype.visitColumnHierarchyLevelVariation=function(e){return[t.toEntityItemExprPattern(e.source)]},t.prototype.visitColumnSubquery=function(e){},t.prototype.visitColumnAggrSubquery=function(e){},t.prototype.visitColumnTransformRef=function(e){},t.prototype.visitEntity=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitEntityAggr=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitHierarchy=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitHierarchyLevel=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitHierarchyLevelAggr=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitMeasure=function(e){return[t.toEntityItemExprPattern(e)]},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){return we(e.arg,this)},t.prototype.visitPercentOfGrandTotal=function(e){return we(e.baseExpr,this)},t.prototype.visitPercentOfRoleTotal=function(e){return we(e.baseExpr,this)},t.prototype.visitTransformOutputRoleRef=function(e){},t.prototype.visitFilteredEval=function(e){return we(e.baseExpr,this)},t.prototype.visitArithmetic=function(e){var r=we(e.left,this),n=we(e.right,this),i=r&&n?Ee(Ee([],r,!0),n,!0):null!=r?r:n;return _.isEmpty(i)?void 0:i},t.prototype.visitConstant=function(e){},t.prototype.visitSparklineData=function(e){var r=this;return Ee(Ee([],we(e.measure,this),!0),_.chain(e.grouping).map(function(n){return we(n,r)}).flatten().value(),!0)},t.prototype.visitNativeVisualCalc=function(e){},t.toEntityItemExprPattern=function(e){u.assertValue(e,"exprPattern");var r={schema:e.schema,entity:e.entity};return e.entityVar&&(r.entityVar=e.entityVar),r},t.instance=new t,t}(),hd=function(){function t(){}return t.prototype.visitColumn=function(e){return[e.name]},t.prototype.visitColumnAggr=function(e){return[e.name]},t.prototype.visitGroupingColumn=function(e){return[e.name]},t.prototype.visitGroupingColumnAggr=function(e){return[e.name]},t.prototype.visitColumnHierarchyVariation=function(e){},t.prototype.visitColumnHierarchyLevelVariation=function(e){},t.prototype.visitColumnSubquery=function(e){return[e.name]},t.prototype.visitColumnAggrSubquery=function(e){return[e.name]},t.prototype.visitColumnTransformRef=function(e){return[e.name]},t.prototype.visitEntity=function(e){},t.prototype.visitEntityAggr=function(e){},t.prototype.visitHierarchy=function(e){},t.prototype.visitHierarchyLevel=function(e){},t.prototype.visitHierarchyLevelAggr=function(e){},t.prototype.visitMeasure=function(e){return[e.name]},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){return we(e.arg,this)},t.prototype.visitPercentOfGrandTotal=function(e){return we(e.baseExpr,this)},t.prototype.visitPercentOfRoleTotal=function(e){return we(e.baseExpr,this)},t.prototype.visitTransformOutputRoleRef=function(e){},t.prototype.visitFilteredEval=function(e){return we(e.baseExpr,this)},t.prototype.visitArithmetic=function(e){var r=we(e.left,this),n=we(e.right,this),i=r&&n?Ee(Ee([],r,!0),n,!0):null!=r?r:n;return _.isEmpty(i)?void 0:i},t.prototype.visitConstant=function(e){},t.prototype.visitSparklineData=function(e){var r=this;return Ee(Ee([],we(e.measure,this),!0),_.chain(e.grouping).map(function(n){return we(n,r)}).flatten().value(),!0)},t.prototype.visitNativeVisualCalc=function(e){return[e.name]},t.instance=new t,t}();function su(t){return new TC(t)}var TC=function(){function t(e){u.assertValue(e,"allMembers"),this.allMembers=e}return t.prototype.members=function(e){var r=this.allMembers;if(!e)return r;for(var n=[],i=0,a=r;i<a.length;i++){var o=a[i];_.includes(e,o.value)&&n.push(o)}return n},t}(),uu="asZero",vd="noColor",gd="specificColor",PC=su([{value:uu,displayName:function(e){return e.get("ConditionalFormattingDialog_FormatNull_AsZero")}},{value:vd,displayName:function(e){return e.get("ConditionalFormattingDialog_FormatNull_NoFormat")}},{value:gd,displayName:function(e){return e.get("ConditionalFormattingDialog_FormatNull_SpecificColor")}}]);function yd(t,e){u.assertValue(t,"fillRule"),t.linearGradient2?function(t,e){u.assertValue(t,"gradient2"),Si(t.min,e),Si(t.max,e),md(t.nullColoringStrategy,e)}(t.linearGradient2,e):t.linearGradient3?function(t,e){u.assertValue(t,"gradient3"),Si(t.min,e),Si(t.mid,e),Si(t.max,e),md(t.nullColoringStrategy,e)}(t.linearGradient3,e):u.assertFail("Unsupported FillRuleDefinition")}function Si(t,e){u.assertValue(t,"stop"),e.visitExpr(t.color);var r=t.value;r&&e.visitExpr(r)}function md(t,e){t&&(e.visitExpr(t.strategy),t.color&&e.visitExpr(t.color))}var Na=function(){function t(e,r){this.exprVisitor=e,this.valueRefVisitor=r}return t.prototype.visitExpr=function(e){return u.assertValue(e,"expr"),u.assertValue(this.exprVisitor,"exprVisitor"),e.accept(this.exprVisitor)},t.prototype.visitValueRef=function(e){return u.assertValue(this.valueRefVisitor,"valueRefVisitor"),this.valueRefVisitor.accept(e)},t}(),bi=function(){function t(){}return t.prototype.visitEntity=function(e,r){return this.visitDefault(e,r)},t.prototype.visitSubqueryRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNamedQueryRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitColumnRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitMeasureRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitAggr=function(e,r){return this.visitDefault(e,r)},t.prototype.visitPercentile=function(e,r){return this.visitDefault(e,r)},t.prototype.visitRangePercent=function(e,r){return this.visitDefault(e,r)},t.prototype.visitGroupRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitHierarchy=function(e,r){return this.visitDefault(e,r)},t.prototype.visitHierarchyLevel=function(e,r){return this.visitDefault(e,r)},t.prototype.visitPropertyVariationSource=function(e,r){return this.visitDefault(e,r)},t.prototype.visitSelectRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitBetween=function(e,r){return this.visitDefault(e,r)},t.prototype.visitIn=function(e,r){return this.visitDefault(e,r)},t.prototype.visitAnd=function(e,r){return this.visitDefault(e,r)},t.prototype.visitOr=function(e,r){return this.visitDefault(e,r)},t.prototype.visitCompare=function(e,r){return this.visitDefault(e,r)},t.prototype.visitConditional=function(e,r){return this.visitDefault(e,r)},t.prototype.visitContains=function(e,r){return this.visitDefault(e,r)},t.prototype.visitExists=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNot=function(e,r){return this.visitDefault(e,r)},t.prototype.visitStartsWith=function(e,r){return this.visitDefault(e,r)},t.prototype.visitConstant=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDateSpan=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDateAdd=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNow=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDefaultValue=function(e,r){return this.visitDefault(e,r)},t.prototype.visitAnyValue=function(e,r){return this.visitDefault(e,r)},t.prototype.visitArithmetic=function(e,r){return this.visitDefault(e,r)},t.prototype.visitFloor=function(e,r){return this.visitDefault(e,r)},t.prototype.visitFillRule=function(e,r){return this.visitDefault(e,r)},t.prototype.visitThemeDataColor=function(e,r){return this.visitDefault(e,r)},t.prototype.visitResourcePackageItem=function(e,r){return this.visitDefault(e,r)},t.prototype.visitScopedEval=function(e,r){return this.visitDefault(e,r)},t.prototype.visitFilteredEval=function(e,r){return this.visitDefault(e,r)},t.prototype.visitWithRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitTransformTableRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitTransformOutputRoleRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitRoleRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitSummaryValueRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitAllRolesRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDiscretize=function(e,r){return this.visitDefault(e,r)},t.prototype.visitMember=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNativeMeasure=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNativeColumn=function(e,r){return this.visitDefault(e,r)},t.prototype.visitSparklineData=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNativeVisualCalc=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDefault=function(e,r){},t}(),Ye=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e}(bi),$t=function(){function t(){}return t.prototype.visitEntity=function(e){this.visitDefault(e)},t.prototype.visitSubqueryRef=function(e){this.visitDefault(e)},t.prototype.visitNamedQueryRef=function(e){this.visitDefault(e)},t.prototype.visitColumnRef=function(e){e.source.accept(this)},t.prototype.visitMeasureRef=function(e){e.source.accept(this)},t.prototype.visitAggr=function(e){e.arg.accept(this)},t.prototype.visitPercentile=function(e){e.arg.accept(this)},t.prototype.visitRangePercent=function(e){e.min.accept(this),e.max.accept(this)},t.prototype.visitGroupRef=function(e){e.source.accept(this);for(var r=0,n=e.groupedExprs;r<n.length;r++)n[r].accept(this)},t.prototype.visitHierarchy=function(e){e.arg.accept(this)},t.prototype.visitHierarchyLevel=function(e){e.arg.accept(this)},t.prototype.visitPropertyVariationSource=function(e){e.arg.accept(this)},t.prototype.visitSelectRef=function(e){this.visitDefault(e)},t.prototype.visitBetween=function(e){e.arg.accept(this),e.lower.accept(this),e.upper.accept(this)},t.prototype.visitIn=function(e){for(var r=e.args,n=0,i=r.length;n<i;n++)r[n].accept(this);var a=e.values;if(a)for(n=0,i=a.length;n<i;n++)for(var o=a[n],s=0,l=o.length;s<l;s++)o[s].accept(this);else e.table.accept(this)},t.prototype.visitAnd=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitCompare=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitConditional=function(e){u.assertValue(e,"expr"),u.assertNonEmpty(e.cases,"expr.cases");for(var r=0,n=e.cases;r<n.length;r++){var i=n[r];i.condition.accept(this),i.value.accept(this)}e.defaultValue&&e.defaultValue.accept(this)},t.prototype.visitContains=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitExists=function(e){e.arg.accept(this)},t.prototype.visitNot=function(e){e.arg.accept(this)},t.prototype.visitStartsWith=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitConstant=function(e){this.visitDefault(e)},t.prototype.visitDateSpan=function(e){e.arg.accept(this)},t.prototype.visitDateAdd=function(e){e.arg.accept(this)},t.prototype.visitNow=function(e){this.visitDefault(e)},t.prototype.visitDefaultValue=function(e){this.visitDefault(e)},t.prototype.visitAnyValue=function(e){this.visitDefault(e)},t.prototype.visitArithmetic=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitFloor=function(e){e.arg.accept(this)},t.prototype.visitFillRule=function(e){e.input.accept(this),yd(e.rule,new Na(this,null))},t.prototype.visistExists=function(e){e.arg.accept(this)},t.prototype.visitThemeDataColor=function(e){this.visitDefault(e)},t.prototype.visitResourcePackageItem=function(e){this.visitDefault(e)},t.prototype.visitScopedEval=function(e){e.expression.accept(this);for(var r=0,n=e.scope;r<n.length;r++)n[r].accept(this)},t.prototype.visitFilteredEval=function(e){e.expression.accept(this);for(var r=0,n=e.filters;r<n.length;r++){var i=n[r];if(!_.isEmpty(i.target))for(var a=0,o=i.target;a<o.length;a++)o[a].accept(this);i.condition.accept(this)}},t.prototype.visitWithRef=function(e){this.visitDefault(e)},t.prototype.visitTransformTableRef=function(e){this.visitDefault(e)},t.prototype.visitTransformOutputRoleRef=function(e){this.visitDefault(e)},t.prototype.visitRoleRef=function(e){this.visitDefault(e)},t.prototype.visitSummaryValueRef=function(e){this.visitDefault(e)},t.prototype.visitAllRolesRef=function(e){this.visitDefault(e)},t.prototype.visitDiscretize=function(e){this.visitDefault(e)},t.prototype.visitMember=function(e){this.visitDefault(e)},t.prototype.visitNativeMeasure=function(e){this.visitDefault(e)},t.prototype.visitNativeColumn=function(e){this.visitDefault(e)},t.prototype.visitSparklineData=function(e){var r;e.measure.accept(this);for(var n=0,i=e.grouping;n<i.length;n++)i[n].accept(this);null===(r=e.scalarKey)||void 0===r||r.accept(this)},t.prototype.visitNativeVisualCalc=function(e,r){this.visitDefault(e)},t.prototype.visitDefault=function(e){},t}();function lu(t){u.assertValue(t,"expr");var e=new Sd;return t.accept(e),e.analyze().filterKind}var Sd=function(t){function e(){var r=t.call(this)||this;return r.entityExprs={},r.filterKind=0,r.isSubquery=!1,r}return T(e,t),e.prototype.analyze=function(){return{entitiesByName:this.entityExprs,filterKind:this.isSubquery?3:this.filterKind}},e.prototype.visitMeasureRef=function(r){this.filterKind=1,r.source.accept(this)},e.prototype.visitExists=function(r){this.filterKind=2,r.arg.accept(this)},e.prototype.visitAggr=function(r){this.filterKind=1,r.arg.accept(this)},e.prototype.visitSubqueryRef=function(r){this.isSubquery=!0},e.prototype.visitEntity=function(r){this.entityExprs[r.entity]=!0},e}($t),cu=function(){function t(){}return t.prototype.visitColumnRef=function(e){var r=e.source,n=r.accept(this);return r===n?e:new Cr(n,e.ref,void 0,e.getAnnotations())},t.prototype.visitMeasureRef=function(e){var r=e.source,n=r.accept(this);return r===n?e:new Hd(n,e.ref,e.getAnnotations())},t.prototype.visitNativeMeasure=function(e){var r=e.expressionContentCache&&e.expressionContentCache.dependencies,n=r&&this.rewriteAll(r);return r===n?e:new Gd(e.language,e.expression,e.dataType,e.proposedName,ye(ye({},e.expressionContentCache),{dependencies:n}),e.format,e.getAnnotations())},t.prototype.visitNativeColumn=function(e){var r=e.expressionContentCache&&e.expressionContentCache.dependencies,n=r&&this.rewriteAll(r),i=e.source.accept(this);if(r===n&&e.source===i)return e;var a=e.expressionContentCache?ye(ye({},e.expressionContentCache),{dependencies:n}):void 0;return new Qd(e.language,e.expression,e.dataType,i,e.proposedName,a,e.format,e.getAnnotations())},t.prototype.visitAggr=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new en(n,e.func,e.includeAllTypes,e.getAnnotations())},t.prototype.visitSelectRef=function(e){return e},t.prototype.visitPercentile=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new Wd(n,e.k,e.exclusive,e.getAnnotations())},t.prototype.visitRangePercent=function(e){var r=e.min,n=r.accept(this),i=e.max,a=i.accept(this);return r===n&&i===a?e:new jd(n,a,e.percent,e.getAnnotations())},t.prototype.visitGroupRef=function(e){for(var r=e.source,n=e.source.accept(this),i=e.groupedExprs,a=new Array(i.length),o=0;o<i.length;o++)a[o]=i[o].accept(this);return r===n&&function(t,e){u.assertValue(t,"x"),u.assertValue(e,"y");var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(!j(t[n],e[n]))return!1;return!0}(i,a)?e:new Jd(e.ref,n,a,e.getAnnotations())},t.prototype.visitHierarchy=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new Yd(n,e.hierarchy,e.getAnnotations())},t.prototype.visitHierarchyLevel=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new $d(n,e.level,e.getAnnotations())},t.prototype.visitPropertyVariationSource=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new Kd(n,e.name,e.property,e.getAnnotations())},t.prototype.visitEntity=function(e){return e},t.prototype.visitSubqueryRef=function(e){return e},t.prototype.visitNamedQueryRef=function(e){return e},t.prototype.visitAnd=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new Fn(n,a,e.getAnnotations())},t.prototype.visitBetween=function(e){var r=e.arg,n=r.accept(this),i=e.lower,a=i.accept(this),o=e.upper,s=o.accept(this);return r===n&&i===a&&o===s?e:new Xd(n,a,s,e.getAnnotations())},t.prototype.visitIn=function(e){var a,r=e.args,n=this.rewriteAll(r),i=e.values,o=e.table,s=o;if(i){u.assert(function(){return!o},"values and table cannot be both specified for the In operator");for(var l=0,c=i.length;l<c;l++){var f=i[l],d=this.rewriteAll(f);f!==d&&!a&&(a=pr(i,l)),a&&a.push(d)}}return o&&(u.assert(function(){return!i},"values and table cannot be both specified for the In operator"),s=o.accept(this)),r!==n||a||o!==s?new tn(n,a||i,s,e.getAnnotations()):e},t.prototype.rewriteAll=function(e){var r=this;return u.assertValue(e,"origExprs"),function(t,e){u.assertValue(t,"array");for(var r,n=0,i=t.length;n<i;n++){var a=t[n],o=e(a);a!==o&&!r&&(r=pr(t,n)),r&&r.push(o)}return r||t}(e,function(n){return n.accept(r)})},t.prototype.visitOr=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new Wa(n,a,e.getAnnotations())},t.prototype.visitCompare=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new gu(e.comparison,n,a,e.getAnnotations())},t.prototype.visitConditional=function(e){u.assertNonEmpty(e.cases,"orig.cases");for(var a,r=e.defaultValue,n=r&&r.accept(this),i=e.cases,o=0,s=i.length;o<s;o++){var l=i[o],c=this.visitCase(l);l!==c&&!a&&(a=pr(i,o)),a&&a.push(c)}return a||(a=i),n===r&&a===i?e:new Zd(a,n,e.getAnnotations())},t.prototype.visitCase=function(e){var r=e.condition,n=r.accept(this),i=e.value,a=i.accept(this);return r===n&&i===a?e:{condition:n,value:a}},t.prototype.visitContains=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new ja(n,a,e.getAnnotations())},t.prototype.visitExists=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new tp(n,e.getAnnotations())},t.prototype.visitNot=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new yu(n,e.getAnnotations())},t.prototype.visitStartsWith=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new ep(n,a,e.getAnnotations())},t.prototype.visitConstant=function(e){return e},t.prototype.visitFloor=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new Od(n,e.size,e.timeUnit,e.getAnnotations())},t.prototype.visitDateSpan=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new rp(e.unit,n,e.getAnnotations())},t.prototype.visitDateAdd=function(e){var r=e.arg,n=r.accept(this);return r===n?e:new np(e.unit,e.amount,n,e.getAnnotations())},t.prototype.visitNow=function(e){return e},t.prototype.visitDefaultValue=function(e){return e},t.prototype.visitAnyValue=function(e){return e},t.prototype.visitArithmetic=function(e){var r=e.left,n=r.accept(this),i=e.right,a=i.accept(this);return r===n&&i===a?e:new Ud(n,a,e.operator,e.getAnnotations())},t.prototype.visitScopedEval=function(e){var r=e.expression,n=r.accept(this),i=e.scope,a=this.rewriteAll(i);return r===n&&i===a?e:new Qa(n,a,e.getAnnotations())},t.prototype.visitFilteredEval=function(e){for(var r=e.expression,n=r.accept(this),i=!1,a=[],o=0,s=e.filters;o<s.length;o++){var l=s[o],c=l.target,f=void 0;_.isEmpty(c)||(f=this.rewriteAll(c));var d=l.condition,p=l.condition.accept(this);(c!==f||d!==p)&&(i=!0),a.push({target:f,condition:p})}return r!==n||i?new zd(n,a,e.getAnnotations()):e},t.prototype.visitWithRef=function(e){return e},t.prototype.visitTransformTableRef=function(e){return e},t.prototype.visitTransformOutputRoleRef=function(e){return e},t.prototype.visitRoleRef=function(e){return e},t.prototype.visitSummaryValueRef=function(e){return e},t.prototype.visitAllRolesRef=function(e){return e},t.prototype.visitFillRule=function(e){var r=e.input,n=r.accept(this),i=e.rule,a=i.linearGradient2,o=a;a&&(o=this.visitLinearGradient2(a));var s=i.linearGradient3,l=s;if(s&&(l=this.visitLinearGradient3(s)),r!==n||a!==o||s!==l){var c={};return o&&(c.linearGradient2=o),l&&(c.linearGradient3=l),new ip(n,c,e.getAnnotations())}return e},t.prototype.visitLinearGradient2=function(e){u.assertValue(e,"origGradient");var r=e.min,n=this.visitFillRuleStop(r),i=e.max,a=this.visitFillRuleStop(i),o=e.nullColoringStrategy,s=this.visitFillNullStrategy(o);if(r!==n||i!==a||o!==s){var l={min:n,max:a};return s&&(l.nullColoringStrategy=s),l}return e},t.prototype.visitLinearGradient3=function(e){u.assertValue(e,"origGradient");var r=e.min,n=this.visitFillRuleStop(r),i=e.mid,a=this.visitFillRuleStop(i),o=e.max,s=this.visitFillRuleStop(o),l=e.nullColoringStrategy,c=this.visitFillNullStrategy(l);if(r!==n||i!==a||o!==s||l!==c){var f={min:n,mid:a,max:s};return c&&(f.nullColoringStrategy=c),f}return e},t.prototype.visitFillRuleStop=function(e){u.assertValue(e,"stop");var r=e.color,n=e.color.accept(this),i=e.value,a=i;if(i&&(a=i.accept(this)),r!==n||i!==a){var o={color:n};return a&&(o.value=a),o}return e},t.prototype.visitFillNullStrategy=function(e){if(e){var r=e.strategy,n=r.accept(this),i=e.color,a=i;if(i&&(a=i.accept(this)),r!==n||i!==a){var o={strategy:n};return a&&(o.color=a),o}return e}},t.prototype.visitThemeDataColor=function(e){return e},t.prototype.visitResourcePackageItem=function(e){return e},t.prototype.visitDiscretize=function(e){var r=e.source.accept(this);return r===e.source?e:new op(r,e.count,e.getAnnotations())},t.prototype.visitMember=function(e){var r=e.source.accept(this);return r===e.source?e:new sp(r,e.member,e.getAnnotations())},t.prototype.visitSparklineData=function(e){var r,n=e.measure.accept(this),i=this.rewriteAll(e.grouping),a=null===(r=e.scalarKey)||void 0===r?void 0:r.accept(this),o=e.pointsPerSparkline,s=e.includeMinGroupingInterval;return n===e.measure&&i===e.grouping&&e.scalarKey===a&&e.pointsPerSparkline===o&&e.includeMinGroupingInterval===s?e:new up(n,i,a,o,s)},t.prototype.visitNativeVisualCalc=function(e){return e},t}();function Yr(t){return u.assertValue(t,"source"),null!=t.subquery}var Ei=function(){function t(e,r){this.schema=e,this.entity=r}return t.prototype.accept=function(e,r){return e.visitEntity(this,r)},t.prototype.equals=function(e){return e&&this.entity===e.entity&&this.schema===e.schema},t}(),bd=function(){function t(e,r){this.schema=e,this.pod=r}return t.prototype.accept=function(e,r){return e.visitPod(this,r)},t.prototype.equals=function(e){return e&&this.pod===e.pod&&this.schema===e.schema},t}(),Er=function(){function t(e){this.subquery=e}return t.prototype.accept=function(e,r){return e.visitSubquery(this,r)},t.prototype.equals=function(e){return e&&zs(this.subquery,e.subquery)},t}(),fu=function(){function t(e){this.expr=e}return t.prototype.accept=function(e,r){return e.visitExpr(this,r)},t.prototype.equals=function(e){return e&&j(this.expr,e.expr)},t}(),$r=function(){function t(e,r){if(this.items=e||{},this.usedNames=r||{},!_.isEmpty(this.items))for(var n=0,i=this.keys();n<i.length;n++)this.usedNames[i[n]]=!0}return t.prototype.keys=function(){return Object.keys(this.items)},t.prototype.source=function(e){return this.items[e]},t.prototype.sources=function(){return this.items},t.prototype.usedSourceNames=function(){return this.usedNames},t.prototype.ensureSource=function(e,r){u.assertValue(e,"source");var n=this.getSourceKeyFromItems(e);return n?{name:n}:{name:this.addSource(e,r),new:!0}},t.prototype.remove=function(e){this.items[e]&&delete this.usedNames[e],delete this.items[e]},t.prototype.getSourceKeyFromItems=function(e){var r=this.keys();for(var n in r){var i=r[n];if(Ed(this.items[i],e))return i}},t.prototype.addSource=function(e,r){var i=r||e.accept(new kC,null);return i=xa(this.usedNames,i),this.items[i]=e,this.usedNames[i]=!0,i},t.prototype.clone=function(){var e=new t(null,_.clone(this.usedNames));return $.extend(e.items,this.items),e},t.prototype.equals=function(e){var r=this;if(!e)return!1;var n=this.keys(),i=e.keys();return n.length===i.length&&Ae(n,i,function(a,o){return Ed(r.source(a),e.source(o))})},t.prototype.renameSources=function(e){for(var n,r=this.items,i=Object.keys(r),a=0,o=i.length;a<o;a++){var s=i[a],l=s;if(e[s]&&(l=xa(e,s),!n)){n={};for(var c=0;c<a;c++){var f=i[c];n[f]=r[f]}}e[l]=!0,n&&(n[l]=r[s])}return n?new t(n):this},t}();function Ed(t,e){if(t===e)return!0;if(t&&e){if(ka(t)&&ka(e)||du(t)&&du(e))return t.equals(e);if(Yr(t)&&Yr(e))return t.equals(e);if(La(t)&&La(e))return t.equals(e)}return!1}function ka(t){return u.assertValue(t,"source"),null!=t.entity}function du(t){return u.assertValue(t,"source"),null!=t.pod}function La(t){return u.assertValue(t,"source"),null!=t.expr}var kC=function(){function t(){}return t.prototype.visitEntity=function(e){return this.getShortName(e.entity)},t.prototype.visitPod=function(e){return this.getShortName(e.pod)},t.prototype.visitSubquery=function(e){return"q"},t.prototype.visitExpr=function(e){return"x"},t.prototype.getShortName=function(e){var r=e,n=r.lastIndexOf(".");return n>=0&&n!==r.length-1&&(r=r.substr(n+1)),function(t){return t>=0&&t<=55295||t>=57344&&t<=65535}(r.charCodeAt(0))?r.charAt(0).toLowerCase():"a"},t}(),LC=function(){function t(){this.entities=[]}return t.prototype.visitEntity=function(e,r){this.entities.push(new Ga(e.schema,e.entity,r))},t.prototype.visitPod=function(e,r){},t.prototype.visitSubquery=function(e,r){},t.prototype.visitExpr=function(e,r){},t}(),BC=function(){function t(e){this.exprRewriter=e}return t.prototype.visitEntity=function(e,r){var i=je(e.schema,e.entity,r).accept(this.exprRewriter);return new Ei(i.schema,i.entity)},t.prototype.visitPod=function(e,r){var i=je(e.schema,e.pod,r).accept(this.exprRewriter);return new bd(i.schema,i.entity)},t.prototype.visitSubquery=function(e,r){var i=e.subquery.rewrite(this.exprRewriter);return new Er(i)},t.prototype.visitExpr=function(e,r){var i=e.expr.accept(this.exprRewriter);return new fu(i)},t}();function Cd(t,e){u.assertValue(t,"items"),u.assertValue(e,"searchElement");for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i&&j(i.expr,e))return r}return-1}function Ba(t,e){!0!==t&&Ua(e||"condition: "+t)}function Ua(t){throw new Error("Contract check failed: "+t)}function wd(t,e){return void 0===e&&(e="select"),t?t.accept(qC.instance,e):e}var qC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitEntity=function(r){return r.entity},e.prototype.visitNamedQueryRef=function(r){return"QueryRef(".concat(r.queryName,")")},e.prototype.visitColumnRef=function(r){return r.source.accept(this)+"."+r.ref},e.prototype.visitGroupRef=function(r){return r.source.accept(this)+"."+r.ref},e.prototype.visitMeasureRef=function(r){return r.source.accept(this)+"."+r.ref},e.prototype.visitNativeMeasure=function(r){return"NativeMeasure(".concat(r.proposedName,")")},e.prototype.visitNativeColumn=function(r){return"NativeColumn(".concat(r.proposedName,")")},e.prototype.visitHierarchy=function(r){return r.arg.accept(this)+"."+r.hierarchy},e.prototype.visitHierarchyLevel=function(r){return r.arg.accept(this)+"."+r.level},e.prototype.visitPropertyVariationSource=function(r){return r.arg.accept(this)+"."+r.property+"."+r.name},e.prototype.visitAggr=function(r){return function(t){switch(t){case 0:return"Sum";case 1:return"Avg";case 2:return"Count";case 3:return"Min";case 4:return"Max";case 5:return"CountNonNull";case 6:return"Median";case 7:return"StandardDeviation";case 8:return"Variance";default:u.assert(function(){return null==t},"Unrecognized aggregate function.")}}(r.func)+"("+r.arg.accept(this)+")"},e.prototype.visitPercentile=function(r){return(r.exclusive?"Percentile.Exc(":"Percentile.Inc(")+r.arg.accept(this)+", "+r.k+")"},e.prototype.visitRangePercent=function(r){return"RangePercent("+r.min.accept(this)+", "+r.max.accept(this)+", "+r.percent.toString()+")"},e.prototype.visitArithmetic=function(r){return function(t){switch(t){case 0:return"Add";case 1:return"Subtract";case 2:return"Multiply";case 3:return"Divide"}return Ua("Unexpected ArithmeticOperatorKind: "+t)}(r.operator)+"("+r.left.accept(this)+", "+r.right.accept(this)+")"},e.prototype.visitConstant=function(r){return"const"},e.prototype.visitTransformOutputRoleRef=function(r){var n=r.role;return r.transform&&(n+="."+r.transform),n},e.prototype.visitScopedEval=function(r){var n=this;return"ScopedEval("+r.expression.accept(this)+", ["+_.map(r.scope,function(i){return i.accept(n)}).join(", ")+"])"},e.prototype.visitFilteredEval=function(r){var n=this;return"FilteredEval(".concat(r.expression.accept(this),", [").concat(_.map(r.filters,function(a){return o=a,s="{",_.isEmpty(o.target)||(s+="Target(".concat(_.map(o.target,function(l){return l.accept(n)}).join(", "),"), ")),s+"Condition(".concat(o.condition.accept(n),")}");var o,s}).join(", "),"])")},e.prototype.visitRoleRef=function(r){return"Role."+r.role},e.prototype.visitSummaryRef=function(r){return"SummaryValueRef."+r.name},e.prototype.visitAllRolesRef=function(r){return"AllRoles"},e.prototype.visitDiscretize=function(r){return"Discretize(".concat(r.source.accept(this),", ").concat(r.count,")")},e.prototype.visitMember=function(r){return"Member(".concat(r.source.accept(this),", ").concat(r.member,")")},e.prototype.visitCompare=function(r){var n=r.left.accept(this),i=r.right.accept(this),a="";switch(r.comparison){case 0:a="=";break;case 1:a=">";break;case 2:a=">=";break;case 3:a="<";break;case 4:a="<="}return"".concat(n).concat(a).concat(i)},e.prototype.visitSparklineData=function(r){var n=this;return"SparklineData(".concat(r.measure.accept(this),"_[").concat(_.map(r.grouping,function(i){return i.accept(n)}).join(","),"])")},e.prototype.visitDefault=function(r,n){return n||"expr"},e.instance=new e,e}(bi);function HC(t,e,r){u.assertValue(t,"namedItems");for(var n={},i=0,a=t.length;i<a;i++)n[t[i].name]=!0;return xa(n,r||wd(e))}function Oa(t){return u.assertValue(t,"expr"),t.accept(GC.instance)}var GC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitMeasureRef=function(r){return!0},e.prototype.visitNativeMeasure=function(r){return!0},e.prototype.visitNativeVisualCalc=function(r){return!0},e.prototype.visitAggr=function(r){return!0},e.prototype.visitArithmetic=function(r){return!0},e.prototype.visitFilteredEval=function(r){return r.expression.accept(this)},e.prototype.visitSparklineData=function(r){return!0},e.prototype.visitDefault=function(r){return!1},e.instance=new e,e}(Ye),WC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitCompare=function(r){return 0===r.comparison&&r.right.accept(this)},e.prototype.visitAnd=function(r){return r.left.accept(this)&&r.right.accept(this)},e.prototype.visitAnyValue=function(r){return!0},e.prototype.visitDefault=function(r){return!1},e.instance=new e,e}(Ye),KC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitCompare=function(r){return 0===r.comparison&&r.right.accept(this)},e.prototype.visitAnd=function(r){return r.left.accept(this)&&r.right.accept(this)},e.prototype.visitDefaultValue=function(r){return!0},e.prototype.visitDefault=function(r){return!1},e.instance=new e,e}(Ye);function Ci(t,e){u.assert(function(){return t.length===e.length},"fileds and values need to be the same size");for(var r=[],n=0;n<t.length;n++)r.push(Rn(0,t[n],e[n]));if(!_.isEmpty(r)){for(var i,a=0,o=r;a<o.length;a++)i=st(i,o[a]);return i}}var za=function(){function t(e){this.exprRewriter=e}return t.rewriteFrom=function(e,r){for(var n,i=e,a=i.keys(),o=0,s=a.length;o<s;o++){var l=a[o],c=i.source(l),f=c.accept(r,l);(c!==f||n)&&(n||(n=_.pick(i.sources(),a.slice(0,o))),n[l]=f)}return n?new $r(n):i},t.prototype.rewriteFrom=function(e){return t.rewriteFrom(e,new BC(this.exprRewriter))},t.prototype.rewriteSelect=function(e,r){return u.assertValue(e,"selectItems"),u.assertValue(r,"from"),this.rewriteNamedSQExpressions(e,r)},t.prototype.rewriteGroupBy=function(e,r){if(u.assertAnyValue(e,"groupByitems"),u.assertValue(r,"from"),!_.isEmpty(e))return this.rewriteNamedSQExpressions(e,r)},t.prototype.rewriteNamedSQExpressions=function(e,r){var n=this;return u.assertValue(e,"expressions"),_.map(e,function(i){return{name:i.name,expr:We.rewrite(i.expr.accept(n.exprRewriter),r,r),nativeReferenceName:i.nativeReferenceName}})},t.prototype.rewriteOrderBy=function(e,r){if(u.assertAnyValue(e,"orderByItems"),u.assertValue(r,"from"),!_.isEmpty(e)){for(var n=[],i=0,a=e.length;i<a;i++){var o=e[i],s=We.rewrite(o.expr.accept(this.exprRewriter),r,r);n.push({direction:o.direction,expr:s})}return n}},t.prototype.rewriteWhere=function(e,r){var n=this;if(u.assertAnyValue(e,"whereItems"),u.assertValue(r,"from"),!_.isEmpty(e)){for(var i=[],a=0,o=e.length;a<o;a++){var s=e[a],l={condition:We.rewrite(s.condition.accept(this.exprRewriter),r,r)};s.target&&(l.target=_.map(s.target,function(c){return We.rewrite(c.accept(n.exprRewriter),r,r)})),s.annotations&&(l.annotations=s.annotations),i.push(l)}return i}},t.prototype.rewriteTransform=function(e,r){var n=this;if(u.assertAnyValue(e,"transformItems"),u.assertAnyValue(r,"from"),!_.isEmpty(e)){for(var i=[],a=0,o=e;a<o.length;a++){var s=o[a],l=void 0;s.input.table&&!_.isEmpty(s.input.table.columns)&&(l=_.map(s.input.table.columns,function(f){return{role:f.role,expression:{name:f.expression.name,expr:We.rewrite(f.expression.expr.accept(n.exprRewriter),r,r)}}}));var c={name:s.name,algorithm:s.algorithm,input:{parameters:s.input.parameters},output:s.output};s.input.table&&(c.input.table={name:s.input.table.name,columns:l}),i.push(c)}return i}},t}(),Vd=function(){function t(e,r,n,i,a,o,s){u.assertValue(e,"from"),u.assertValue(i,"select"),this.fromValue=e,this.whereItems=r,this.orderByItems=n,this.selectItems=i,this.groupByItems=a,this.transformItems=o,null!=s&&(this.topValue=s)}return t.create=function(){return t.empty||(t.empty=new t(new $r,null,null,[],null,null,null)),t.empty},t.createWith=function(e,r){return u.assertValue(e,"clauses"),r||(e=t.normalize(e)),new t(e.from,e.where,e.orderBy,e.select,e.groupBy,e.transforms,e.top)},t.prototype.createModified=function(e){return t.createWith({from:void 0!==e.from?e.from:this.fromValue,where:void 0!==e.where?e.where:this.whereItems,transforms:void 0!==e.transforms?e.transforms:this.transformItems,orderBy:void 0!==e.orderBy?e.orderBy:this.orderByItems,select:void 0!==e.select?e.select:this.selectItems,groupBy:void 0!==e.groupBy?e.groupBy:this.groupByItems,top:void 0!==e.top?e.top:this.topValue})},t.normalize=function(e){var r={clauses:{from:e.from,where:e.where,orderBy:e.orderBy,select:e.select,groupBy:e.groupBy,transforms:e.transforms,top:e.top},usedSourceNames:{}};return t.removeUnreferencedKeys(r),t.renameSources(r),t.renameSourcesInSubqueries(r),r.clauses},t.removeUnreferencedKeys=function(e){var r=e.clauses,n=r.from,i=r.where,a=r.orderBy,o=r.select,s=r.groupBy,l=r.transforms,c=new Md(n.keys());if(i)for(var f=0,d=i.length;f<d;f++){var p=i[f];p.condition.accept(c);var h=p.target;if(h)for(var v=0,g=h.length;v<g;v++)h[v]&&h[v].accept(c)}if(l)for(f=0,d=l.length;f<d;f++){var y=l[f].input.table;if(y&&!_.isEmpty(y.columns))for(var m=0,S=y.columns;m<S.length;m++)S[m].expression.expr.accept(c)}if(a)for(f=0,d=a.length;f<d;f++)a[f].expr.accept(c);for(f=0,d=o.length;f<d;f++)o[f].expr.accept(c);if(s)for(f=0,d=s.length;f<d;f++)s[f].expr.accept(c);var E=c.result();if(E){for(var C=n.clone(),w=0,M=E;w<M.length;w++)C.remove(M[w]);e.clauses.from=C}},t.renameSources=function(e){var r=e.clauses.from,n=r.renameSources(e.usedSourceNames);n!==r&&(e.clauses.from=n,t.rewriteClauses(e.clauses,new We(r,n)))},t.renameSourcesInSubqueries=function(e){e.clauses.from=YC.renameSources(t.renameSourcesInQuery,e.clauses.from,e.usedSourceNames)},t.renameSourcesInQuery=function(e,r){var n={clauses:e.getClauses(),usedSourceNames:r},i=n.clauses.from;return t.renameSources(n),t.renameSourcesInSubqueries(n),n.clauses.from===i?e:t.createWith(n.clauses)},t.prototype.from=function(e){return e?this.createModified({from:e}):this.fromValue.clone()},t.prototype.select=function(e){return _.isEmpty(arguments)?this.getSelect():this.setSelect(e)},t.prototype.getSelect=function(){return t.createNamedExpressionArray(this.selectItems)},t.createNamedExpressionArray=function(e){return Es(_.map(e,function(r){return{name:r.name,expr:r.expr,nativeReferenceName:r.nativeReferenceName}}))},t.prototype.setSelect=function(e){var r=this.fromValue.clone(),n=t.rewriteExpressionsWithSourceRenames(e,r);return this.createModified({from:r,select:n})},t.rewriteExpressionsWithSourceRenames=function(e,r){for(var n=[],i=0,a=e.length;i<a;i++){var o=e[i];n.push({name:o.name,expr:We.rewrite(o.expr,null,r)})}return n},t.prototype.removeSelect=function(e){u.assertValue(e,"expr");for(var r=this.selectItems,n=[],i=0,a=r.length;i<a;i++){var o=r[i];j(o.expr,e)||n.push(o)}return this.createModified({select:n})},t.prototype.removeOrderBy=function(e){for(var r=this.orderBy(),n=r.length-1;n>=0;n--)j(r[n].expr,e)&&r.splice(n,1);return this.createModified({orderBy:r})},t.prototype.removeTransform=function(e){for(var r=this.transforms(),n=0,i=r.length;n<i;n++)if(r[n].name===e.name){r.splice(n,1);break}return this.createModified({transforms:r})},t.prototype.selectNameOf=function(e){var r;return null===(r=this.getSelectFor(e))||void 0===r?void 0:r.name},t.prototype.selectNativeReferenceNameOf=function(e){var r;return null===(r=this.getSelectFor(e))||void 0===r?void 0:r.nativeReferenceName},t.prototype.getSelectFor=function(e){var r=Cd(this.selectItems,e);if(r>=0)return this.selectItems[r]},t.prototype.setSelectAt=function(e,r,n){if(u.assertValue(r,"expr"),!(e>=this.selectItems.length)){var i=this.select(),a=this.fromValue.clone(),s=null!=n?n:i[e].nativeReferenceName;return i[e]={name:i[e].name,expr:We.rewrite(r,null,a),nativeReferenceName:s},this.createModified({from:a,select:i})}},t.prototype.addSelect=function(e,r,n){u.assertValue(e,"expr");var i=this.select(),a=this.fromValue.clone();return i.push(this.createNamedExpr(i,a,e,r,n)),this.createModified({from:a,select:i})},t.prototype.setNativeReferenceNameAt=function(e,r){var n=this;u.assert(function(){return 0<=e&&e<n.selectItems.length},"index should be within the length of the selectedItems"),this.selectItems[e].nativeReferenceName=r},t.prototype.getNativeReferenceNameAt=function(e){var r=this;return u.assert(function(){return 0<=e&&e<r.selectItems.length},"index should be within the length of the selectedItems"),this.selectItems[e].nativeReferenceName},t.prototype.getNativeReferenceNames=function(e){var r=this.selectItems.map(function(n){return n.nativeReferenceName});return e?_.filter(r,function(n){return!_n(n)}):r},t.prototype.createNamedExpr=function(e,r,n,i,a){return{name:HC(e,n,i),expr:We.rewrite(n,r,r),nativeReferenceName:a}},t.prototype.groupBy=function(e){return _.isEmpty(arguments)?this.getGroupBy():this.setGroupBy(e)},t.prototype.getGroupBy=function(){return t.createNamedExpressionArray(this.groupByItems)},t.prototype.setGroupBy=function(e){var r=this.fromValue.clone(),n=t.rewriteExpressionsWithSourceRenames(e,r);return this.createModified({from:r,groupBy:n})},t.prototype.addGroupBy=function(e){u.assertValue(e,"expr");var r=this.groupBy(),n=this.fromValue.clone();return r.push(this.createNamedExpr(r,n,e)),this.createModified({from:n,groupBy:r})},t.prototype.orderBy=function(e){return _.isEmpty(arguments)?this.getOrderBy():this.setOrderBy(e)},t.prototype.getOrderBy=function(){var e=[],r=this.orderByItems;if(r)for(var n=0,i=r.length;n<i;n++){var a=r[n];e.push({expr:a.expr,direction:a.direction})}return e},t.prototype.setOrderBy=function(e){u.assertValue(e,"values");for(var r=[],n=this.fromValue.clone(),i=0,a=e.length;i<a;i++){var o=e[i];r.push({expr:We.rewrite(o.expr,n,n),direction:o.direction})}return this.createModified({from:n,orderBy:r})},t.prototype.where=function(e,r){return _.isEmpty(arguments)?this.getWhere():this.setWhere([],e,r)},t.prototype.getWhere=function(){var e=[],r=this.whereItems;if(r)for(var n=0,i=r.length;n<i;n++)e.push(r[n]);return e},t.prototype.setWhere=function(e,r,n){u.assertValue(e,"existingFilters"),u.assertValue(r,"newFilters");for(var i=_.clone(e),a=this.fromValue.clone(),o=0,s=r;o<s.length;o++){var l=s[o],c={condition:We.rewrite(l.condition,n,a)};l.target&&(c.target=_.map(l.target,function(f){return We.rewrite(f,n,a)})),l.annotations&&(c.annotations=l.annotations),i.push(c)}return this.createModified({from:a,where:i})},t.prototype.addWhere=function(e,r){return this.setWhere(this.where(),e,r)},t.prototype.addSemanticFilter=function(e){return u.assertValue(e,"filter"),this.setWhere(this.where(),e.where(),e.from())},t.prototype.transforms=function(e){return _.isEmpty(arguments)?this.getTransforms():this.setTransforms(e)},t.prototype.getTransforms=function(){var e=[];if(!_.isEmpty(this.transformItems))for(var r=0,n=this.transformItems;r<n.length;r++)e.push(n[r]);return e},t.prototype.setTransforms=function(e){for(var r=this,n=this.fromValue.clone(),i=[],a=0,o=e;a<o.length;a++){var s=o[a],l=void 0;s.input.table&&!_.isEmpty(s.input.table.columns)&&(l=_.map(s.input.table.columns,function(f){return{role:f.role,expression:r.createNamedExpr(Es([]),n,f.expression.expr,f.expression.name)}}));var c={name:s.name,algorithm:s.algorithm,input:{parameters:s.input.parameters},output:s.output};s.input.table&&(c.input.table={name:s.input.table.name,columns:l}),i.push(c)}return this.createModified({from:n,transforms:e})},t.prototype.top=function(e){return _.isEmpty(arguments)?this.topValue:this.setTop(e)},t.prototype.setTop=function(e){return u.assert(function(){return null==e||e>0},"if top is specified, it must be positive"),this.createModified({top:e})},t.prototype.rewrite=function(e){var r=this.getClauses();return t.rewriteClauses(r,e),this.createModified(r)},t.prototype.hasVisualCalculations=function(){for(var e=0,r=this.selectItems;e<r.length;e++)if(di(r[e].expr))return!0;return!1},t.prototype.getClauses=function(){return{from:this.fromValue,where:this.whereItems,orderBy:this.orderByItems,select:this.selectItems,groupBy:this.groupByItems,transforms:this.transformItems,top:this.topValue}},t.rewriteClauses=function(e,r){var n=new za(r);e.from=n.rewriteFrom(e.from),e.where=n.rewriteWhere(e.where,e.from),e.orderBy=n.rewriteOrderBy(e.orderBy,e.from),e.select=n.rewriteSelect(e.select,e.from),e.groupBy=n.rewriteGroupBy(e.groupBy,e.from),e.transforms=n.rewriteTransform(e.transforms,e.from)},t.willFiltersAffectQuery=function(e){return u.assertValue(e,"query"),new JC(e).willFilterAffectQuery()},t}(),Qe=function(){function t(e,r){u.assertValue(e,"from"),u.assertValue(r,"where"),this.fromValue=e,this.whereItems=r}return t.fromSQExpr=function(e){return t.fromSQFromAndSQExpr(new $r,e)},t.fromSQFromAndSQExpr=function(e,r){return u.assertValue(e,"from"),u.assertValue(r,"condition"),new t(e,[{condition:We.rewrite(r,e,e)}])},t.fromSQFromAndSQFilters=function(e,r){return new t(e,r)},t.clone=function(e){return t.fromSQFromAndSQFilters(e.from(),e.where())},t.fromMeasureFilters=function(e,r,n){u.assertValue(e,"query"),u.assert(function(){return!_.isEmpty(r)},"measureFilters not empty"),u.assert(function(){return _.every(r,function(y){return 1===lu(y.condition)})},"Require measure filter");for(var i,a=[],o=e.where(),s=function(m){var S=_.find(o,function(b){return j(b.condition,m.condition)});if(!S||!S.target)return{value:void 0};i=i||S.target,u.assert(function(){return function(){for(var b=0;b<i.length;b++)if(!j(i[b],S.target[b]))return!1;return!0}()},"Expected targets to be the same."),a.push(S)},l=0,c=r;l<c.length;l++){var d=s(c[l]);if("object"==typeof d)return d.value}var p=_.filter(o,function(y){return 1!==lu(y.condition)}),h=_.map(i,function(y){return _.find(e.select(),function(m){return j(y,m.expr)})});n&&h.push.apply(h,this.getMeasuresForJoinPredicates(e,n)||[]);var v=Vd.createWith({from:e.from(),select:h,where:Ee(Ee([],p||[],!0),a||[],!0)});return function(t,e){var r=_.filter(_.map(e.select(),function(o){return o.expr}),function(o){return!Oa(o)});if(_.isEmpty(r))return t;var n=_.map(r,function(o){return{condition:Nn(o,Di(!0))}}),i=t.from(),a=pu.ensureFiltersInSubqueries(i,n,i);return i===a?t:Qe.fromSQFromAndSQFilters(a,t.where())}(t.fromMeasuresQuery(v,i),e)},t.fromMeasuresQuery=function(e,r){var n=new Er(e),i=new $r,o=Vu(r,rn(i.ensureSource(n,"subquery").name)),s=We.rewrite(o,i,i),l=[];return l.push({condition:s}),t.fromSQFromAndSQFilters(i,l)},t.getDefaultValueFilter=function(e){return t.getDataViewScopeIdentityComparisonFilters(e,Za())},t.getAnyValueFilter=function(e){return t.getDataViewScopeIdentityComparisonFilters(e,Di())},t.getDefaultAnyValueFilter=function(e,r){if(_.isEmpty(e))return t.getAnyValueFilter(r);if(_.isEmpty(r))return t.getDefaultValueFilter(e);var n=Array.apply(null,Array(e.length)).map(function(){return Za()}),i=Array.apply(null,Array(e.length)).map(function(){return Di()}),s=st(Ci(e,n),Ci(r,i));return t.fromSQExpr(s)},t.getDataViewScopeIdentityComparisonFilters=function(e,r){if(u.assertValue(e,"fieldSQExprs"),u.assertValue(r,"value"),e instanceof Array){var n=Array.apply(null,Array(e.length)).map(function(){return r});return t.fromSQExpr(Ci(e,n))}return t.fromSQExpr(Nn(e,r))},t.prototype.from=function(){return this.fromValue.clone()},t.prototype.conditions=function(){for(var e=[],r=this.whereItems,n=0,i=r.length;n<i;n++)e.push(r[n].condition);return e},t.prototype.where=function(){for(var e=[],r=this.whereItems,n=0,i=r.length;n<i;n++)e.push(r[n]);return e},t.prototype.rewrite=function(e){var r=new za(e),n=r.rewriteFrom(this.fromValue);return new t(n,r.rewriteWhere(this.whereItems,n))},t.prototype.validate=function(e,r,n){var i=new Vp(e,r,n);return this.rewrite(i),i.errors},t.merge=function(e){if(_.isEmpty(e))return null;if(1===e.length)return e[0];for(var r=e[0],n=r.from(),i=pr(r.whereItems,r.whereItems.length),a=1,o=e.length;a<o;a++)t.applyFilter(e[a],n,i);return new t(n,i)},t.unmerge=function(e){for(var r=[],n=0,i=e.whereItems;n<i.length;n++){var o=new t(e.fromValue,[i[n]]);Object.keys(o.from().sources()).length>1&&(o=t.removeUnreferencedKeys(o)),r.push(o)}return r},t.removeUnreferencedKeys=function(e){var r=e.from(),n=e.where(),i=new Md(r.keys());if(n)for(var a=0,o=n.length;a<o;a++){var s=n[a];s.condition.accept(i);var l=s.target;if(l)for(var c=0,f=l.length;c<f;c++)l[c]&&l[c].accept(i)}var d=i.result();if(d){for(var p=0,h=d;p<h.length;p++)r.remove(h[p]);return new t(r,n)}},t.getMeasuresForJoinPredicates=function(e,r){for(var n=e.select(),i=[],a=function(c){var f=n[c];if(Oa(f.expr)){if(_.some(r.SuppressedJoinPredicates,function(d){return d===c}))return"continue";(o.isSelectProjected(r.Primary,c)||o.isSelectProjected(r.Secondary,c))&&i.push(f)}},o=this,s=0;s<n.length;s++)a(s);return i},t.isSelectProjected=function(e,r){if(e&&e.Groupings)for(var n=0,i=e.Groupings;n<i.length;n++){var a=i[n];if(_.some(a.Projections,function(o){return o===r})&&!_.some(a.SuppressedProjections,function(o){return o===r}))return!0}return!1},t.isDefaultFilter=function(e){return!(!e||1!==e.where().length)&&function(t){return u.assertValue(t,"expr"),t.accept(KC.instance)}(e.where()[0].condition)},t.isAnyFilter=function(e){return!(!e||1!==e.where().length)&&function(t){return u.assertValue(t,"expr"),t.accept(WC.instance)}(e.where()[0].condition)},t.isSameFilter=function(e,r){return e===r||!!(e&&r&&e.from().equals(r.from())&&Ae(e.where(),r.where(),function(n,i){return hi(n,i)}))&&!(t.isDefaultFilter(e)&&t.isAnyFilter(r)||t.isAnyFilter(e)&&t.isDefaultFilter(r))},t.isInFilter=function(e){return!(!e||1!==e.where().length)&&vt(e.where()[0].condition)},t.applyFilter=function(e,r,n){u.assertValue(e,"filter"),u.assertValue(r,"from"),u.assertValue(n,"where");for(var a=0,o=e.whereItems;a<o.length;a++){var s=o[a],l={condition:We.rewrite(s.condition,e.fromValue,r)};s.target&&(l.target=_.map(s.target,function(c){return We.rewrite(c,e.fromValue,r)})),n.push(l)}},t.prototype.setIgnoreMParameter=function(){for(var r=0,n=this.whereItems;r<n.length;r++){var i=n[r];i.annotations||(i.annotations={}),i.annotations["PowerBI.MParameterBehavior"]=1}},t}(),We=function(t){function e(r,n){var i=this;return u.assertValue(n,"destinationFrom"),(i=t.call(this)||this).sourceFrom=r,i.destinationFrom=n,i}return T(e,t),e.prototype.visitEntity=function(r){var n=this.destinationFrom.source(r.variable);if(n&&ka(n)&&n.schema===r.schema&&n.entity===r.entity)return r;var i=this.destinationFrom.ensureSource(new Ei(r.schema,r.entity),r.variable);return i.name!==r.variable?new Ga(r.schema,r.entity,i.name):r},e.prototype.visitSubqueryRef=function(r){if(!this.sourceFrom)return u.assertFail("A source From clause must be provided to rewrite an expression containing a subquery reference."),r;var n=this.sourceFrom.source(r.variable);if(!n)return r;var i=this.destinationFrom.source(r.variable);if(i&&Yr(i)&&zs(n.subquery,i.subquery))return r;var a=this.destinationFrom.ensureSource(new Er(n.subquery),r.variable);return a.name!==r.variable?new vu(a.name):r},e.prototype.visitNamedQueryRef=function(r){var n=this.destinationFrom.source(r.variable);if(n&&La(n)&&j(n.expr,r))return r;var a=this.destinationFrom.ensureSource(new fu(r),r.variable);return a.name!==r.variable?new Bd(r.queryName,a.name):void 0},e.rewrite=function(r,n,i){u.assertValue(r,"expr"),u.assertValue(i,"destinationFrom");var a=new e(n,i);return r.accept(a)},e}(cu),Md=function(t){function e(r){var n=this;return u.assertValue(r,"keys"),(n=t.call(this)||this).keys=r,n}return T(e,t),e.prototype.visitEntity=function(r){this.removeKey(r.variable)},e.prototype.visitSubqueryRef=function(r){this.removeKey(r.variable)},e.prototype.visitNamedQueryRef=function(r){this.removeKey(r.variable)},e.prototype.removeKey=function(r){var n=this.keys.indexOf(r);n>=0&&this.keys.splice(n,1)},e.prototype.result=function(){return this.keys},e}($t),JC=function(t){function e(r){var n=t.call(this)||this;return n.query=r,n.containsEntityRefs=!1,n.containsSubqueries=!1,n}return T(e,t),e.prototype.visitEntity=function(r){this.containsEntityRefs=!0},e.prototype.visitPropertyVariationSource=function(r){this.containsEntityRefs=!0},e.prototype.visitSubqueryRef=function(r){this.containsSubqueries=!0},e.prototype.willFilterAffectQuery=function(){for(var n=0,i=this.query.select();n<i.length;n++)i[n].expr.accept(this);return!(!this.containsEntityRefs&&this.containsSubqueries)},e}($t),YC=function(){function t(e,r,n){this.renameSources=e,this.from=r,this.usedSourceNames=n,u.assertValue(e,"renameSources"),u.assertValue(r,"from"),u.assertValue(n,"usedSourceNames")}return t.renameSources=function(e,r,n){var i=new t(e,r,n);return za.rewriteFrom(r,i)},t.prototype.visitEntity=function(e,r){return e},t.prototype.visitPod=function(e,r){return e},t.prototype.visitSubquery=function(e,r){var n=e.subquery,i=this.renameSources(n,this.usedSourceNames);return i===n?e:new Er(i)},t.prototype.visitExpr=function(e,r){return e},t}(),pu=function(){function t(e,r){this.filtersToEnsure=e,this.filtersToEnsureFrom=r,this.modifiedSubquery=!1,u.assertNonEmpty(e,"expected filters to ensure exist in each subquery")}return t.ensureFiltersInSubqueries=function(e,r,n){var i=new t(r,n),a=za.rewriteFrom(e,i);return u.assert(function(){return a!==e===i.modifiedSubquery},"expected to rewrite the from clause if and only if we modified a subquery"),a},t.prototype.visitEntity=function(e,r){return e},t.prototype.visitPod=function(e,r){return e},t.prototype.visitSubquery=function(e,r){for(var n=e.subquery.where(),i=[],a=function(f){_.find(n,function(d){return hi(f,d)})||i.push(f)},o=0,s=this.filtersToEnsure;o<s.length;o++)a(s[o]);return 0===i.length?e:(this.modifiedSubquery=!0,new Er(e.subquery.addWhere(i,this.filtersToEnsureFrom)))},t.prototype.visitExpr=function(e,r){return e},t}(),Z=function(t){return t[t.Last=0]="Last",t[t.Current=1]="Current",t[t.Next=2]="Next",t}({}),O=function(t){return t[t.Second=0]="Second",t[t.Minute=1]="Minute",t[t.Hour=2]="Hour",t[t.Day=3]="Day",t[t.Week=4]="Week",t[t.CalendarWeek=5]="CalendarWeek",t[t.Month=6]="Month",t[t.CalendarMonth=7]="CalendarMonth",t[t.Year=8]="Year",t[t.CalendarYear=9]="CalendarYear",t}({}),Xr=function(t){return t[t.Unsupported=0]="Unsupported",t[t.Time=1]="Time",t[t.Date=2]="Date",t}({});function Tn(t){switch(t){case O.Minute:case O.Hour:return!0;default:return!1}}var xd=function(){function t(){}return t.convertRelativeDateUnitToRelativeFilterType=function(e){switch(e){case O.Second:case O.Minute:case O.Hour:return Xr.Time;case O.Day:case O.Week:case O.CalendarWeek:case O.Month:case O.CalendarMonth:case O.Year:case O.CalendarYear:return Xr.Date;default:return void u.assertNever(e)}},t.convertTimeUnitToRelativeFilterType=function(e){switch(e){case 5:return Xr.Unsupported;case 6:case 7:return Xr.Time;case 0:case 1:case 2:case 3:case 4:return Xr.Date;default:return void u.assertNever(e)}},t.getDateRange=function(e,r){switch(r.relativeUnit){case O.Minute:return this.getMinutesRange(e,r);case O.Hour:return this.getHoursRange(e,r);case O.Day:return this.getDaysRange(e,r);case O.Week:return this.getWeeksRange(e,r);case O.CalendarWeek:return this.getCalendarWeekRange(e,r);case O.Month:return this.getMonthRange(e,r);case O.CalendarMonth:return this.getCalendarMonthRange(e,r);case O.Year:return this.getYearRange(e,r);case O.CalendarYear:return this.getCalendarYearRange(e,r);default:return void u.assertFail("Unexpected RelativeDateUnit: "+r.relativeUnit)}},t.getMinutesRange=function(e,r){var n={min:null,max:null};switch(r.relativeQualifier){case Z.Last:n.min=new Date(e.valueOf()-6e4*r.duration),n.max=e;break;case Z.Current:n.min=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),0)),n.max=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),59));break;case Z.Next:n.min=e,n.max=new Date(e.valueOf()+6e4*r.duration)}return n},t.getHoursRange=function(e,r){var n={min:null,max:null},i=36e5;switch(r.relativeQualifier){case Z.Last:n.min=new Date(e.valueOf()-r.duration*i),n.max=e;break;case Z.Current:n.min=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),0,0)),n.max=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),59,59));break;case Z.Next:n.min=e,n.max=new Date(e.valueOf()+r.duration*i)}return n},t.getDaysRange=function(e,r){var n={min:null,max:null};switch(r.relativeQualifier){case Z.Last:n.max=r.includeToday?e:this.addDays(e,-1),n.min=this.addDays(n.max,1-r.duration);break;case Z.Current:n.min=e,n.max=e;break;case Z.Next:n.min=r.includeToday?e:this.addDays(e,1),n.max=this.addDays(n.min,r.duration-1)}return n},t.getWeeksRange=function(e,r){var n={min:null,max:null};switch(r.relativeQualifier){case Z.Last:n.max=r.includeToday?e:this.addDays(e,-1),n.min=this.addDays(n.max,-7*r.duration+1);break;case Z.Current:n=this.getCalendarWeek(e);break;case Z.Next:n.min=r.includeToday?e:this.addDays(e,1),n.max=this.addDays(n.min,7*r.duration-1)}return n},t.getCalendarWeekRange=function(e,r){var n={min:null,max:null},i=e.getUTCDay();switch(r.relativeQualifier){case Z.Last:var a=this.addDays(e,-i-1);n.min=this.addDays(a,-7*r.duration+1),n.max=a;break;case Z.Current:n=this.getCalendarWeek(e);break;case Z.Next:var o=this.addDays(e,7-i);n.min=o,n.max=this.addDays(o,7*r.duration-1)}return n},t.getMonthRange=function(e,r){var n={min:null,max:null};switch(r.relativeQualifier){case Z.Last:n.max=r.includeToday?e:this.addDays(e,-1),n.min=this.addMonths(n.max,-r.duration);break;case Z.Current:n=this.getCalendarMonth(e);break;case Z.Next:n.min=r.includeToday?e:this.addDays(e,1),n.max=this.addMonths(n.min,r.duration)}return n},t.getCalendarMonthRange=function(e,r){var n={min:null,max:null};switch(r.relativeQualifier){case Z.Last:n.min=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()-r.duration,1)),n.max=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),0));break;case Z.Current:n=this.getCalendarMonth(e);break;case Z.Next:n.min=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+1,1)),n.max=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+1+r.duration,0))}return n},t.getYearRange=function(e,r){var n={min:null,max:null};switch(r.relativeQualifier){case Z.Last:n.max=r.includeToday?e:this.addDays(e,-1),n.min=this.addYears(n.max,-r.duration);break;case Z.Current:n=this.getCalendarYear(e);break;case Z.Next:n.min=r.includeToday?e:this.addDays(e,1),n.max=this.addYears(n.min,r.duration)}return n},t.getCalendarYearRange=function(e,r){var n={min:null,max:null};switch(r.relativeQualifier){case Z.Last:n.min=new Date(Date.UTC(e.getUTCFullYear()-r.duration,0,1)),n.max=new Date(Date.UTC(e.getUTCFullYear()-1,11,31));break;case Z.Current:n=this.getCalendarYear(e);break;case Z.Next:n.min=new Date(Date.UTC(e.getUTCFullYear()+1,0,1)),n.max=new Date(Date.UTC(e.getUTCFullYear()+r.duration,11,31))}return n},t.getTimeRangeRestatement=function(e,r,n,i){return r?this.getDetailedTimeRestatement(n):this.getSimplifiedTimeRestatement(e,i)},t.getDetailedTimeRestatement=function(e){return Math.abs(e.max.valueOf()-e.min.valueOf())/864e5>1||e.max.getUTCDate()!==e.min.getUTCDate()?Ge.format("{0} - {1}",[e.min,e.max]):Ge.format("{0:T} - {1:T}",[e.min,e.max])},t.getSimplifiedTimeRestatement=function(e,r){switch(e.relativeQualifier){case Z.Current:switch(e.relativeUnit){case O.Minute:return r("RelativeTimeRestatement_this_Minute");case O.Hour:return r("RelativeTimeRestatement_this_Hour");default:u.assertFail("The following relative unit is not a relative time unit: ".concat(e.relativeUnit))}break;case Z.Last:switch(e.relativeUnit){case O.Minute:return 1===e.duration?r("RelativeTimeRestatement_last_Minute"):r("RelativeTimeRestatement_last_Minutes",e.duration);case O.Hour:return 1===e.duration?r("RelativeTimeRestatement_last_Hour"):r("RelativeTimeRestatement_last_Hours",e.duration);default:u.assertFail("The following relative unit is not a relative time unit: ".concat(e.relativeUnit))}break;case Z.Next:switch(e.relativeUnit){case O.Minute:return 1===e.duration?r("RelativeTimeRestatement_next_Minute"):r("RelativeTimeRestatement_next_Minutes",e.duration);case O.Hour:return 1===e.duration?r("RelativeTimeRestatement_next_Hour"):r("RelativeTimeRestatement_next_Hours",e.duration);default:u.assertFail("The following relative unit is not a relative time unit: ".concat(e.relativeUnit))}break;default:u.assertFail("The following is an Unsupported relativeQualifer: ".concat(e.relativeQualifier))}return""},t.getDateRangeRestatement=function(e){return Ge.format("{0:d} - {1:d}",[e.min,e.max])},t.getRestatement=function(e,r,n,i){var a;if(Tn(e.relativeUnit)?(u.assert(function(){return!!i},"For Relative time restatement, anchor time should be defined"),a=i||new Date):a=new Date,e.anchorDate&&function(t){return!Tn(t)}(e.relativeUnit)){var o=e.anchorDate;a=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()))}var s=this.getDateRange(a,e);return s.min.epochTimeStamp=s.min.getTime(),s.max.epochTimeStamp=s.max.getTime(),Tn(e.relativeUnit)?this.getTimeRangeRestatement(e,r,s,n):t.getDateRangeRestatement(s)},t.addMinutes=function(e,r){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()+r,e.getSeconds())},t.addHours=function(e,r){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()+r,e.getMinutes(),e.getSeconds())},t.addDays=function(e,r){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+r))},t.addMonths=function(e,r){if(0===r)return e;var a=e.getUTCDate()-(r>0?1:-1),o=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+r,a)),s=o.getUTCDate();if(a>0)if(s!==a&&r>0)o=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+r+1,0));else if(r<0){var l=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),a));(s!==a||l.getUTCMonth()!==e.getUTCMonth())&&(o=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+r+1,1)))}return o},t.addYears=function(e,r){return this.addMonths(e,12*r)},t.getDurationMax=function(e,r){if(e===Z.Current)return 1;switch(r){case O.Year:case O.CalendarYear:return 100;case O.Month:case O.CalendarMonth:case O.CalendarWeek:case O.Week:return 1e3;default:return 1e4}},t.getCalendarWeek=function(e){var r=e.getUTCDay(),n=this.addDays(e,-r);return{min:n,max:this.addDays(n,6)}},t.getCalendarMonth=function(e){return{min:new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),1)),max:new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+1,0))}},t.getCalendarYear=function(e){return{min:new Date(Date.UTC(e.getUTCFullYear(),0,1)),max:new Date(Date.UTC(e.getUTCFullYear(),11,31))}},t}(),mt=function(){function t(){}return t.supportsArithmetic=function(e,r,n){var i=r.getMetadata(n),a=i&&i.type;return!(!i||!a)&&(2===e||3===e?a.numeric:a.numeric||a.dateTime||a.duration)},t.indexOfExpr=function(e,r){u.assertValue(e,"items"),u.assertValue(r,"searchElement");for(var n=0,i=e.length;n<i;n++)if(j(e[n],r))return n;return-1},t.sequenceEqual=function(e,r){u.assertValue(e,"x"),u.assertValue(r,"y");var n=e.length;if(n!==r.length)return!1;for(var i=0;i<n;i++)if(!j(e[i],r[i]))return!1;return!0},t.isSubset=function(e,r){u.assertValue(e,"x"),u.assertValue(r,"y");for(var n=function(c){if(-1===_.findIndex(r,function(d){return j(d,c)}))return{value:!1}},i=0,a=e;i<a.length;i++){var s=n(a[i]);if("object"==typeof s)return s.value}return!0},t.isFromVariation=function(e){return u.assertValue(e,"expr"),li(e)&&ci(e.arg)||Gr(e)&&this.isFromVariation(e.arg)},t.discourageAggregation=function(e,r){var n=this.getSchemaCapabilities(e,r);return _.some(n,function(i){return i.discourageQueryAggregateUsage})},t.getAggregateBehavior=function(e,r){u.assertValue(e,"expr"),u.assertValue(r,"schema");var n=this.getConceptualColumn(e,r);if(n)return n.aggregateBehavior},t.getSchemaCapabilities=function(e,r){u.assertValue(e,"expr"),u.assertValue(r,"schema");var n=me(e,r);if(n){var i=ou(n);return _.chain(i).map(function(a){var o;return null===(o=r.schema(a.schema))||void 0===o?void 0:o.capabilities}).filter(function(a){return!!a}).value()}},t.getKpiMetadata=function(e,r){var n=this.getKpiStatusProperty(e,r);if(n)return n.kpiValue.measure.kpi.statusMetadata;var i=this.getKpiTrendProperty(e,r);return i?i.kpiValue.measure.kpi.trendMetadata:void 0},t.getParameterMetadata=function(e,r){var n=e.getConceptualProperty(r,!0),i=n&&n.column&&n.column.parameterMetadata;return i&&this.getDataViewParameterColumnMetadata(i)},t.getWhatIfParameterMetadata=function(e){if(e&&e.parameterMetadata&&0===e.parameterMetadata.kind)return e.parameterMetadata},t.getFieldParameterQuerySelects=function(e,r){var n;if(!_.isEmpty(e)){var i=e.getConceptualProperty(r);if(i){var a=i.column;if(a&&2===e.kind&&2===(null===(n=a.parameterMetadata)||void 0===n?void 0:n.kind)){var o=e.getTargetEntity(),s=r.schema(o.schema).entities.withName(o.entity),l=_.some(s.properties,function(h){return h.column&&h.column.keys});u.assert(function(){return l},"A key should always exist within the fieldParameter entity");for(var c=0,f=s.properties;c<f.length;c++){var d=f[c];if(d.column&&d.column.keys&&1===d.column.keys.length){var p=d.column.keys[0];if(p===i)return{parameterColumn:e,labelColumn:Re(o,d.name)};if(i===d)return{labelColumn:e,parameterColumn:Re(o,p.name)}}}return{parameterColumn:e}}}}},t.getFieldParameters=function(e){var r=[];for(var n in e){var a=e[n].getFieldParameters();r.push({role:n,parameters:a})}return r},t.getParameterValuesOrder=function(e,r){if(!_.isEmpty(e))for(var n=0,i=e;n<i.length;n++){var a=i[n],o=null==a?void 0:a.conditions();if(!_.isEmpty(o)){var s=uw(r,o[0]);if(!_.isEmpty(s))return s}}return[]},t.isFilterForFieldParameter=function(e,r,n){if(e)for(var a=0,o=t.getFieldParameters(e);a<o.length;a++)for(var l=0,c=o[a].parameters;l<c.length;l++){var d=t.getFieldParameterQuerySelects(c[l].expr,n);if(d&&!_.isEmpty(t.getParameterValuesOrder([r],d.parameterColumn)))return!0}return!1},t.shouldUseAsFieldParameter=function(e,r,n,i,a){return!(!e||a||!i||Gr(n)||!t.getFieldParameterQuerySelects(n,r))},t.getDataViewParameterColumnMetadata=function(e){return{kind:this.getDataViewParameterKind(e),mappedMParameterNames:e.mappedMParameterNames,supportsMultipleValues:e.supportsMultipleValues,supportsSelectAll:e.supportsSelectAll}},t.getDataViewParameterKind=function(e){if(null!=e){var r=e.kind;if(null==r)return 0;switch(r){case 0:return 0;case 1:return 1;case 2:return 2;default:return void u.assertNever(r)}}},t.hasMappedMParameter=function(e,r){var n=this.getConceptualParameterMetadata(e,r);return 1===(null==n?void 0:n.kind)},t.isSupportMulitpleValuesEnabled=function(e,r){var n=this.getConceptualParameterMetadata(e,r);return null==n?void 0:n.supportsMultipleValues},t.getConceptualParameterMetadata=function(e,r){var n=this.getConceptualColumn(e,r);return null==n?void 0:n.parameterMetadata},t.getConceptualEntity=function(e,r){return u.assertValue(e,"entityExpr"),r.schema(e.schema).entities.withName(e.entity)},t.hasMappedColumn=function(e,r){return ZC.hasMappedColumn(e,r)},t.getColumnnsWithKey=function(e,r){u.assertValue(e,"keyExpr"),u.assertValue(r,"schema");var n=e.getTargetColumnRef(r);if(n){var i=n.getConceptualProperty(r);if(i&&i.column){var a=n.getTargetEntity();if(a){var o=this.getConceptualEntity(a,r);if(o){for(var s=[],l=0,c=o.properties;l<c.length;l++){var f=c[l];f.column&&f.column.keys&&_.includes(f.column.keys,i)&&s.push(Re(a,f.name))}return s}}}}},t.tryGetExprFromFilter=function(e){if(vt(e.condition)&&1===_.size(e.condition.args))return e.condition.args[0];if(Dn(e.condition)){if(Le(e.condition.left))return e.condition.right;if(Le(e.condition.right))return e.condition.left}},t.checkExprForValidMParameters=function(e,r){return this.checkExprForMapped(e,r).isValidSQExpr},t.checkExprForMapped=function(e,r){return Dn(e)?this.checkComparsionForMapped(e,r):vt(e)?this.checkInForMapped(e,r):Yt(e)?this.checkOrForMapped(e,r):{isValidSQExpr:!t.hasMappedColumn(e,r)}},t.checkComparsionForMapped=function(e,r){if(!kt(e.left))return{isValidSQExpr:!0};var a,n=t.getConceptualParameterMetadata(e.left,r);if(1===(null==n?void 0:n.kind)){if(0!==e.comparison||ma(e.right))return{isValidSQExpr:!1};if(!n.supportsSelectAll&&ks(e.right))return{isValidSQExpr:!1};a=e.left}return{isValidSQExpr:!0,columnExpr:a}},t.checkInForMapped=function(e,r){for(var i,n=e.args,a=!1,o=!1,s=0,l=n;s<l.length;s++){var c=l[s];if(kt(c)){var f=t.getConceptualParameterMetadata(c,r);if(a=1===(null==f?void 0:f.kind)){i=c,o=null==f?void 0:f.supportsMultipleValues;break}}}if(a){if(n.length>1||e.table&&Ps(e.table)||e.values.length>1&&!o)return{isValidSQExpr:!1};if(_.some(e.values,function(p){return _.some(p,function(h){return ma(h)})}))return{isValidSQExpr:!1}}return{isValidSQExpr:!0,columnExpr:i}},t.checkOrForMapped=function(e,r){var n=this.checkExprForMapped(e.left,r),i=this.checkExprForMapped(e.right,r),a=n.columnExpr,o=i.columnExpr;return j(a,o)?a&&!t.isSupportMulitpleValuesEnabled(a,r)||o&&!t.isSupportMulitpleValuesEnabled(o,r)?{isValidSQExpr:!1}:{isValidSQExpr:n.isValidSQExpr&&i.isValidSQExpr,columnExpr:a}:{isValidSQExpr:!1}},t.getKpiStatusProperty=function(e,r){var n=e.getConceptualProperty(r);if(n){var i=n.kpiValue;if(i&&i.measure.kpi.status===n)return n}},t.getKpiTrendProperty=function(e,r){var n=e.getConceptualProperty(r);if(n){var i=n.kpiValue;if(i&&i.measure.kpi.trend===n)return n}},t.getDefaultValue=function(e,r){var n=this.getConceptualColumn(e,r);if(n)return n.defaultValue},t.getConceptualColumn=function(e,r){if(e&&r){var n=me(e);if(n){var i=n.column||n.groupingColumn;if(i){if(r.schema(i.schema)&&i.name){var a=r.schema(i.schema).findProperty(i.entity,i.name);if(a)return a.column}}else{var o=n.hierarchyLevel;if(o){var s=br(n),l=s.schema;if(r.schema(l)){var c=r.schema(l).findHierarchy(s.entity,o.name);if(c){var f=c.levels.withName(o.level);if(f&&f.column)return f.column.column}}}}}}},t.getDefaultValues=function(e,r){if(!_.isEmpty(e)&&r){for(var n=[],i=0,a=e;i<a.length;i++){var s=this.getDefaultValue(a[i],r);s&&n.push(s)}return n}},t.getPrimitiveValuesFromSQConstantExpr=function(e){if(Le(e)){if(Is(e))return Fe.getTextValue(e);if(wn(e))return Fe.getDateValue(e);if(Rf(e))return Fe.getNumericValue(e);if(Nf(e))return Fe.getBooleanValue(e)}},t.convertSemanticFilterToDataViewScopeIdentity=function(e){var r=[],n=e.conditions();if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i],s=new Ln;if(o.accept(s),s.keys&&s.values&&s.values.length>0&&s.keys.length>0&&s.values.length%s.keys.length==0)for(var l=0;l<s.values.length;l+=s.keys.length){for(var c=[],f=[],d=0;d<s.keys.length;d++)c.push(s.keys[d]),f.push(s.values[l+d]);var h=Et(Ci(c,f));r.push(h)}}return r},t.getActiveTablesNames=function(e){var n=new LC;if(e){var i=e.from();if(void 0!==i)for(var a=0,o=i.keys();a<o.length;a++)i.source(o[a]).accept(n,null)}return _.map(n.entities,function(l){return l.entity})},t.isRelatedToMany=function(e,r,n,i){return this.isRelated(e,r,n,0,2,i)||this.isRelated(e,n,r,2,0,i)},t.isRelatedToOne=function(e,r,n,i){return this.isRelated(e,r,n,2,0,i)||this.isRelated(e,n,r,0,2,i)},t.isRelated=function(e,r,n,i,a,o){var s=t.getConceptualEntity(r,e);if(u.assertValue(s,"could not resolve conceptual entity form sourceExpr."),_.isEmpty(s.navigationProperties))return!1;var l=t.getConceptualEntity(n,e);u.assertValue(l,"could not resolve conceptual entity form targetExpr.");var c=[];for(c.push(s);!_.isEmpty(c);){var d=c.shift().navigationProperties;if(!_.isEmpty(d))for(var p=0,h=d;p<h.length;p++){var v=h[p];if(v.isActive&&(null==o||v.behavior===o)&&v.targetMultiplicity===a&&v.sourceMultiplicity===i){if(v.targetEntity===l)return!0;c.push(v.targetEntity)}}}return!1},t.isRelatedOneToOne=function(e,r,n,i){var a=t.getConceptualEntity(r,e);u.assertValue(a,"could not resolve conceptual entity form sourceExpr.");var o=t.getConceptualEntity(n,e);u.assertValue(o,"could not resolve conceptual entity form targetExpr.");var s=a.navigationProperties,l=o.navigationProperties;return(!_.isEmpty(s)||!_.isEmpty(l))&&(this.hasOneToOneNavigation(s,o,i)||this.hasOneToOneNavigation(l,a,i))},t.haveTheSameSchema=function(e){u.assertNonEmpty(e,"exprs should not be null, undefined, or empty");var r=e[0].schema;return _.chain(e).drop(1).every(function(n){return n.schema===r}).value()},t.areHierarchicallyRelated=function(e,r){if(_.isEmpty(r)||!this.haveTheSameSchema(r))return!1;if(1===(r=_.values(_.keyBy(r,function(l){return l.entity}))).length)return!0;var n=r[0].schema,i=_.find(e.schemas,function(l){return l.name===n});if(!i)return!1;var a=r.map(function(l){return t.getConceptualEntity(l,e)});if(_.some(a,function(l){return!l}))return!1;var s=t.buildEntityGraph(a,this.allowedHierarchicalMultiplicityPairForTraversal,0);return!!this.searchEntityGraph(a,s)||(s=t.buildEntityGraph(i.entities,this.allowedHierarchicalMultiplicityPairForTraversal,0),this.searchEntityGraph(a,s))},t.searchEntityGraph=function(e,r){var n=[].concat(e),i=n.shift(),a=this.findEntityPath([i],n,r,!0);if(1===a.length&&0===a[0].unableToVisit.length)return!0;var o=_.values(_.keyBy(_.flatten(a.map(function(h){return h.unableToVisit})),function(h){return h.name})),s=this.findEntityPath([i],o,r,!1);if(1===s.length&&0===s[0].unableToVisit.length)return!0;for(var l=function(v){if(_.find(s,function(y){for(var m=!0,S=0,b=v.unableToVisit;S<b.length;S++)if(y.unableToVisit.indexOf(b[S])>=0){m=!1;break}return m}))return{value:!0}},c=0,f=a;c<f.length;c++){var p=l(f[c]);if("object"==typeof p)return p.value}return!1},t.buildEntityGraph=function(e,r,n){for(var i={},a=0,o=e;a<o.length;a++)i[(s=o[a]).name]={entity:s};for(var l=0,c=e;l<c.length;l++){var s,f=(s=c[l]).navigationProperties;if(!_.isEmpty(f))for(var d=i[s.name],p=0,h=f;p<h.length;p++){var v=h[p];if(v.isActive&&(void 0===v.behavior||void 0===n||v.behavior===n)){var g=i[v.targetEntity.name];g&&(this.multiplicityPairMatches([v.targetMultiplicity,v.sourceMultiplicity],r)&&this.addTraversalNodes(g,d),1===v.crossFilterDirection&&this.multiplicityPairMatches([v.sourceMultiplicity,v.targetMultiplicity],r)&&this.addTraversalNodes(d,g))}}}return i},t.addTraversalNodes=function(e,r){e.forwardNodes=e.forwardNodes||[],_.find(e.forwardNodes,function(n){return n.entity.name===r.entity.name})||e.forwardNodes.push(r),r.backwardNodes=r.backwardNodes||[],_.find(r.backwardNodes,function(n){return n.entity.name===e.entity.name})||r.backwardNodes.push(e)},t.multiplicityPairMatches=function(e,r){if(e&&2===e.length&&!_.isEmpty(r))for(var n=0,i=r;n<i.length;n++){var a=i[n];if(2===a.length&&e[0]===a[0]&&e[1]===a[1])return!0}return!1},t.findEntityPath=function(e,r,n,i){if(r=r||[],0===(e=e||[]).length||0===r.length||!n)return[{path:e,unableToVisit:r}];for(var a=0,o=e;a<o.length;a++)if(!n[o[a].name])return[{path:e,unableToVisit:r}];var c=n[e[e.length-1].name],f=i?c.forwardNodes:c.backwardNodes;if(!f||0===f.length)return[{path:e,unableToVisit:r}];for(var d=this.getEntityLoopPatterns(e),p=[],h=0,v=f;h<v.length;h++){var y=v[h].entity,m=[].concat(e);m.push(y);for(var S=!1,b=0,E=d;b<E.length;b++)if(this.endsWith(m,E[b])){S=!0;break}if(!S){var w=r,M=r.indexOf(y);M>=0&&(w=[].concat(r)).splice(M,1);var V=this.findEntityPath(m,w,n,i);if(1===V.length&&0===V[0].unableToVisit.length){p=V;break}for(var D=0,A=V;D<A.length;D++)p.push(A[D])}}return 0===p.length&&(p=[{path:e,unableToVisit:r}]),p},t.getEntityLoopPatterns=function(e){for(var r=[],i=function(c){if(e.filter(function(g){return g===c}).length>=2)for(var f=c,d=void 0,p=0,h=e;p<h.length;p++){var v=h[p];v===f?(d&&(d.push(v),r.push(d)),d=[v]):d&&d.push(v)}},a=0,o=_.values(_.keyBy(e,function(l){return l.name}));a<o.length;a++)i(o[a]);return r},t.endsWith=function(e,r){if(r.length>e.length)return!1;for(var n=!0,i=e.length-1,a=r.length-1;a>=0;--a){if(r[a]!==e[i]){n=!1;break}i--}return n},t.hasOneToOneNavigation=function(e,r,n){if(_.isEmpty(e))return!1;for(var i=0,a=e;i<a.length;i++){var o=a[i];if(o.isActive&&(null==n||o.behavior===n)&&o.targetEntity===r&&0===o.sourceMultiplicity&&0===o.targetMultiplicity)return!0}return!1},t.concatUnique=function(e,r){u.assertValue(e,"leftExprs"),u.assertValue(r,"rightExprs");for(var n=Vf(e),i=0,a=r;i<a.length;i++){var o=a[i];-1===this.indexOfExpr(n,o)&&n.push(o)}return n},t.detectTransformExpr=function(e){u.assertValue(e,"expr");var r=new e0;return e.accept(r),r.sawTransformOutputRoleRef},t.isExprValidForAggregation=function(e){return u.assertValue(e,"expr"),!this.isFromVariation(e)&&!li(e)},t.isExprValidForSorting=function(e){return u.assertValue(e,"expr"),!fi(e)},t.isExprValidForFiltering=function(e){return u.assertValue(e,"expr"),!(fi(e)||Bf(e)||Ls(e)||di(e))},t.isExprValidForClustering=function(e){return u.assertValue(e,"expr"),!(fi(e)||li(e)||Gr(e)||Ls(e)||di(e))},t.isExprValidForAnalysisTransform=function(e){return u.assertValue(e,"expr"),!fi(e)},t.getSubqueryExpression=function(e,r){var i,a,n=me(e);if(n.columnSubquery)n.columnSubquery.subqueryRef?i=n.columnSubquery.subqueryRef:n.columnSubquery.subquery?a=new Er(n.columnSubquery.subquery):u.assertFail("fieldExpr needs to contain either a subquery reference or an inlined query");else{if(!n.columnAggrSubquery)return void u.assertFail("invalid fieldExpr in subquery");n.columnAggrSubquery.subqueryRef?i=n.columnAggrSubquery.subqueryRef:n.columnAggrSubquery.subquery?a=new Er(n.columnAggrSubquery.subquery):u.assertFail("fieldExpr needs to contain either a subquery reference or an inlined query")}a||(u.assert(function(){return!(!r||!r.sources)},"context sources should be available for evaluating subquery source"),r.sources[i]?(a=r.sources[i],u.assert(function(){return a&&Yr(a)},"column referencing source should be available and be a subquery source")):u.assertFail("No context for the subquery ref.  Cannot construct SQFromSubquerySource without underlying reference."));var o=a;if(o){var s=function(t){return au(t)||br(t).entity}(n),l=void 0;if(o.subquery&&(l=o.subquery.select().withName(s)),l)return l.expr}},t.buildExprEvaluationContext=function(e){u.assertValue(e,"from");var r=e.sources();if(r)return{sources:r}},t.transformToVisualQueryField=function(e,r,n,i,a){return{expr:e,queryName:r,isFieldParameter:!!n,nativeReferenceName:i,isHidden:a}},t.isSQExprArray=function(e){return e[0]instanceof U},t.syncSQExprWithFilterIdenities=function(e,r){var n=new r0(e,mr(r)),i=r.accept(n);if(i)return i.accept(new t0)},t.validate=function(e,r,n){u.assertValue(r,"schema");var i=[];if(e&&(i=e.validate(r,n,i)),!_.isEmpty(i))return i},t.allowedHierarchicalMultiplicityPairForTraversal=[[0,2],[0,0]],t}(),ZC=function(t){function e(r){var n=t.call(this)||this;return n.schema=r,n.detectedMappedColumn=!1,n}return T(e,t),e.prototype.visitIn=function(r){for(var n=0,i=r.args;n<i.length;n++)if(i[n].accept(this),this.detectedMappedColumn)return},e.prototype.visitColumnRef=function(r){mt.hasMappedMParameter(r,this.schema)&&(this.detectedMappedColumn=!0)},e.hasMappedColumn=function(r,n){var i=new e(n);return r.accept(i),i.detectedMappedColumn},e}($t),e0=function(t){function e(){var r=t.call(this)||this;return r.sawTransformOutputRoleRef=!1,r}return T(e,t),e.prototype.visitTransformOutputRoleRef=function(r){this.sawTransformOutputRoleRef=!0},e}($t),t0=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitIn=function(r){return nn(r.args,this.removeDuplicates(r.values),r.getAnnotations())},e.prototype.visitAnd=function(r){var n=r.right.accept(this);return st(r.left.accept(this),n,r.getAnnotations())},e.prototype.visitOr=function(r){var n=r.right.accept(this);return xi(r.left.accept(this),n,r.getAnnotations())},e.prototype.visitDefault=function(r){return r},e.prototype.removeDuplicates=function(r){return _.uniqWith(r,function(n,i){for(var a=n.length,o=0;o<a;o++)if(!j(n[o],i[o]))return!1;return!0})},e}(Ye),r0=function(t){function e(r,n){var i=t.call(this)||this;return i.isRootNotExpr=!1,i.hasBeenModified=!1,i.isSupportedSQExpr=!1,i.filterIdentities=r,i.isRootNotExpr=n,i}return T(e,t),e.prototype.visitIn=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){if(this.noChangeRequired(r.args))return r;var n=this.tryToRemoveColumnsToMatchVisual(r),i=n.newArgs,a=n.newValues;if(!this.shouldDropWholeSQExpr()&&0!==i.length)return nn(i,a,r.getAnnotations())}},e.prototype.visitDefault=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){var n=r.left,i=r.right;if(n&&_.some(this.filterIdentities,function(a){return j(a,n)})||i&&_.some(this.filterIdentities,function(a){return j(a,i)}))return r;this.hasBeenModified=!0}},e.prototype.visitAnd=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){var n=r.right.accept(this),i=r.left.accept(this);if(!this.shouldDropWholeSQExpr()){if(i&&n)return st(i,n,r.getAnnotations());if(i)return i;if(n)return n}}},e.prototype.visitOr=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){var n=r.right.accept(this),i=r.left.accept(this);if(!this.shouldDropWholeSQExpr()){if(i&&n)return xi(i,n,r.getAnnotations());if(i)return i;if(n)return n}}},e.prototype.visitNot=function(r){if(this.verifyIsSupportedSQExpr(r),!this.shouldDropWholeSQExpr()){var n=r.arg.accept(this);if(n&&(this.isRootNotExpr||!this.hasBeenModified))return Xa(n,r.getAnnotations())}},e.prototype.verifyIsSupportedSQExpr=function(r){this.isSupportedSQExpr=Yt(r)?vt(r.right)&&(Yt(r.left)||vt(r.left)):xn(r)?mr(r.right)&&(vt(r.left)||Yt(r.left)):mr(r)?Yt(r.arg)||mr(r.arg):!vt(r)||!!r.values&&r.values.length>0},e.prototype.shouldDropWholeSQExpr=function(){return this.hasBeenModified&&!this.isSupportedSQExpr},e.prototype.noChangeRequired=function(r){var n=this,i=r.map(function(a){return{expr:[a],index:_.findIndex(n.filterIdentities,function(s){return j(s,a)})}});return 0===i[0].index&&i.every(function(a,o){return a.index>-1&&(o===i.length-1||a.index+1===i[o+1].index)})},e.prototype.tryToRemoveColumnsToMatchVisual=function(r){var n=this,i=[],a=[],s=r.values,l=r.args.map(function(h){return{expr:[h],index:_.findIndex(n.filterIdentities,function(g){return j(g,h)})}});if(l[0].index>0)return this.hasBeenModified=!0,{newArgs:i,newValues:a};s=_.unzip(s);var c=l.map(function(h,v){return{expr:s[v],index:h.index}});i=l.filter(function(h){return h.index>-1}).map(function(h){return h.expr[0]}),a=c.filter(function(h){return h.index>-1}).map(function(h){return h.expr}),l=l.filter(function(h){return h.index>-1});for(var f=0;f<l.length-1;f++)if(l[f].index+1<l[f+1].index){i=i.splice(0,f+1),a=a.splice(0,f+1);break}return a=_.unzip(a),this.hasBeenModified=!0,{newArgs:i,newValues:a}},e}(Ye);function Dd(t){if(t&&Yr(t)){var e=t.subquery.orderBy();if(!e||1!==e.length)return;var r=e[0],n=new n0;return n.visitOrderBy(r.expr)?{orderByField:n.orderByField,isTop:2===r.direction,itemCount:t.subquery.top()}:void 0}}var n0=function(t){function e(){var r=t.call(this)||this;return r.orderByField=null,r}return T(e,t),e.prototype.visitOrderBy=function(r){return r.accept(this,0)},e.prototype.visitAggr=function(r,n){return 0===n&&(u.assertValue(me(r),"expected field pattern"),this.orderByField=r,!0)},e.prototype.visitMeasureRef=function(r,n){return 0===n&&(this.orderByField=r,!0)},e}(bi);function Ad(t,e){var r=new a0;e.accept(r);var n={fieldsBeingFiltered:_.uniqWith(r.fieldsBeingFiltered,j),isSubquery:!1};if(r.subqueryName){n.isSubquery=!0;var i=t.sources(),o=Dd(i&&i[r.subqueryName]);o&&(n.orderByField=o.orderByField,n.itemCount=o.itemCount,n.isTop=o.isTop)}return n}var a0=function(t){function e(){var r=t.call(this)||this;return r.fieldsBeingFiltered=[],r}return T(e,t),e.prototype.visitColumnRef=function(r){this.fieldsBeingFiltered.push(r)},e.prototype.visitHierarchyLevel=function(r){this.fieldsBeingFiltered.push(r)},e.prototype.visitGroupRef=function(r){this.fieldsBeingFiltered.push(r)},e.prototype.visitSubqueryRef=function(r){r.variable?this.subqueryName=r.variable:u.assertFail("SubqueryRef with a inlined subquery not expected here")},e.prototype.visitAggr=function(r){me(r)&&this.fieldsBeingFiltered.push(r)},e.prototype.visitPropertyVariationSource=function(r){this.fieldsBeingFiltered.push(r)},e.prototype.visitMeasureRef=function(r){this.fieldsBeingFiltered.push(r)},e}($t);function qa(t,e){void 0===e&&(e=!1);var r=t.field,n=t.options,i=null,a=xu();if(t.options.anchorDate&&!Tn(n.relativeUnit)){var o=t.options.anchorDate;o.epochTimeStamp=Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()),a=er(t.options.anchorDate)}var s=function(t){switch(t){case O.CalendarYear:case O.Year:return 3;case O.CalendarMonth:case O.Month:return 2;case O.CalendarWeek:case O.Week:return 1;case O.Day:return 0;case O.Hour:return 7;case O.Minute:return 6;case O.Second:return 5;default:return void u.assertFail("Unsupported RelativeDateUnit")}}(n.relativeUnit),l=function(t,e){switch(void 0===e&&(e=!1),t){case O.Second:case O.Minute:case O.Hour:case O.Year:case O.Month:case O.Week:return!1;case O.Day:return e;case O.CalendarYear:case O.CalendarMonth:case O.CalendarWeek:return!0;default:return void u.assertFail("Unsupported RelativeDateUnit")}}(n.relativeUnit,e);switch(n.relativeQualifier){case Z.Current:i=Rn(0,r,bt(s,a));break;case Z.Last:if(l)i=_d(-n.duration,-1,s,a,r);else if(Tn(n.relativeUnit)){var f=a;i=wr(r,St(s,-n.duration,a),f)}else{var p=n.includeToday?a:St(0,-1,a);f=bt(0,p),i=wr(r,bt(0,St(s,-n.duration,St(0,1,p))),f)}break;case Z.Next:if(l)i=_d(1,n.duration,s,a,r);else if(Tn(n.relativeUnit))i=wr(r,a,f=St(s,n.duration,a));else{var h=n.includeToday?a:St(0,1,a);i=wr(r,bt(0,h),f=bt(0,St(s,n.duration,St(0,-1,h))))}}return i}function _d(t,e,r,n,i){return wr(i,bt(r,St(r,t,n)),bt(r,St(r,e,n)))}function Ha(t,e){switch(t){case 0:return O.Day;case 1:return e?O.CalendarWeek:O.Week;case 2:return e?O.CalendarMonth:O.Month;case 3:return e?O.CalendarYear:O.Year;case 7:return O.Hour;case 6:return O.Minute;case 5:return O.Second;default:return}}var Td=function(){function t(e){this.relativeFilterType=e}return t.prototype.tryExtractParametersFrom=function(e){return this.tryExtractCurrent(e)||this.tryExtractLastOrNext(e)},t.prototype.tryExtractCurrent=function(e){if(Dn(e)){var r=e;if((kt(r.left)||Gr(r.left))&&(this.field=r.left,yr(r.right))){var n=r.right,i=xd.convertTimeUnitToRelativeFilterType(n.unit);if(this.relativeFilterType!==i)return!1;if(void 0!==Ha(n.unit,!1)&&(Ns(n.arg)||wn(n.arg))&&(this.options={duration:1,includeToday:!0,includeTodayFromDefault:!0,relativeQualifier:Z.Current,relativeUnit:Ha(n.unit,!1)},wn(n.arg)&&(this.options.anchorDate=n.arg.value),this.validateOptions(e)))return!0}}return!1},t.prototype.tryExtractLastOrNext=function(e){if(Rs(e)){var r=e;if(kt(r.arg)||Gr(r.arg))if(this.field=r.arg,yr(r.upper)&&yr(r.lower)){if(this.options=this.getOptionsFromDateSpan(r.lower,Z.Last),this.validateOptions(e)||(this.options=this.getOptionsFromDateSpan(r.upper,Z.Next),this.validateOptions(e)))return!0}else if(An(r.upper)||An(r.lower)){var n=r.lower,i=r.upper;if(this.options=this.getOptionsFromDateAdd(n,n.unit,Z.Last),this.validateOptions(e)||(this.options=this.getOptionsFromDateAdd(i,i.unit,Z.Next),this.validateOptions(e)))return!0}}return!1},t.prototype.getOptionsFromDateSpan=function(e,r){if(yr(e))return this.getOptionsFromDateAdd(e.arg,e.unit,r)},t.prototype.getOptionsFromDateAdd=function(e,r,n){if(An(e)){var i=e,a=xd.convertTimeUnitToRelativeFilterType(i.unit);if(this.relativeFilterType!==a)return;var o=r===i.unit&&0!==r,s=!!o||this.getIncludeToday(i.arg),l=this.getAnchorDate(i);switch(n){case Z.Last:if(i.amount<0)return{duration:-i.amount,includeToday:s,relativeQualifier:n,relativeUnit:Ha(i.unit,o),anchorDate:l};break;case Z.Next:if(i.amount>0)return{duration:i.amount,includeToday:s,relativeQualifier:n,relativeUnit:Ha(i.unit,o),anchorDate:l}}}},t.prototype.getAnchorDate=function(e){for(var r=e;An(r);)r=r.arg;if(wn(r))return r.value},t.prototype.getIncludeToday=function(e){if(An(e)){var r=e;return Ns(r.arg)||wn(r.arg)}return!1},t.prototype.validateOptions=function(e){if(!this.field||!this.options)return!1;var r={field:this.field,options:this.options};return j(e,qa(r))||this.options.relativeUnit===O.Day&&!this.options.includeToday&&j(e,qa(r,!0))},t}();function Pd(t,e){u.assertValue(t,"from"),u.assertValue(e,"condition");var r=new p0;if(r.visitCondition(e)){var n=t.sources(),i=n&&n[r.subqueryName],a=Dd(i);if(a&&Yr(i))return{fieldBeingFiltered:r.fieldBeingFiltered,isTop:a.isTop,itemCount:i.subquery.top(),orderByField:a.orderByField}}}var p0=function(t){function e(){var r=t.call(this)||this;return r.fieldBeingFiltered=null,r.subqueryName=null,r}return T(e,t),e.prototype.visitCondition=function(r){return r.accept(this,0)},e.prototype.visitIn=function(r,n){return!!(0===n&&r.args&&1===r.args.length&&r.args[0].accept(this,1)&&r.table&&r.table.accept(this,2))},e.prototype.visitColumnRef=function(r,n){return 1===n&&(this.fieldBeingFiltered=r,!0)},e.prototype.visitHierarchyLevel=function(r,n){return 1===n&&(this.fieldBeingFiltered=r,!0)},e.prototype.visitGroupRef=function(r,n){return 1===n&&(this.fieldBeingFiltered=r,!0)},e.prototype.visitSubqueryRef=function(r,n){return 2===n&&(r.variable?this.subqueryName=r.variable:u.assertFail("SubqueryRef with a direct subquery not expected here"),!0)},e}(bi),v0=function(){function t(e){this.schema=e}return t.prototype.tryMatchPattern=function(e,r){var n;if(u.assert(function(){return void 0!==e},"There is no SQFilter for this Semantic filter"),n=this.matchTopN(e,r))return n;var i=e&&e.condition;if(i){if((n=this.tryMatchExpr(i,2))||(n=this.tryMatchComplex(e,r)))return n;u.assert(function(){return null==n},"There is no pattern that currently matches `expr`")}},t.prototype.tryMatchExpr=function(e,r){var n;if((n=this.matchBasicFilter(e))||(n=this.matchRelativeRange(e,Xr.Date))||(n=this.matchRelativeRange(e,Xr.Time))||(n=this.matchDateRange(e))||(n=this.matchAdvanced(e))||(n=this.matchCompareOperator(e))||1!==r&&(n=this.tryMatchHierarchical(e))||(n=this.matchComposite(e,r)))return n;u.assert(function(){return null==n},"There is no pattern that currently matches `expr`")},t.prototype.tryMatchComplex=function(e,r){var n=function(t,e){if(t){if(t instanceof Qe){var r=t.conditions();return _.isEmpty(r)||r.length>1?void 0:Ad(t.from(),r[0])}return Ad(e,t.condition)}}(e,r);if(n)return{complex:{args:_.map(n.fieldsBeingFiltered,function(i){return me(i)})}}},t.prototype.matchBasicFilter=function(e){var r=!1;if(mr(e)&&(r=!0,e=e.arg),vt(e)&&!e.table&&e.values)return{in:{args:_.map(e.args,function(n){return me(n)}),values:_.map(e.values,function(n){return _.map(n,function(i,a){return{value:i.value,type:i.type}})}),not:r}}},t.prototype.matchDateRange=function(e){if(Rs(e)&&yr(e.lower)&&yr(e.upper))return{between:{arg:me(e.arg),lower:{value:e.lower.arg.value,unit:e.lower.unit},upper:{value:e.upper.arg.value,unit:e.upper.unit}}}},t.prototype.matchTopN=function(e,r){if(e&&r){var n=function(t,e){if(t){if(t instanceof Qe){var r=t.conditions();return u.assertValue(r,"conditions"),u.assert(function(){return 1===r.length},"should be exactly one filter condition for a TopN filter"),Pd(t.from(),r[0])}return Pd(e,t.condition)}}(e,r);if(n)return{topN:{fieldBeingFiltered:me(n.fieldBeingFiltered),isTop:n.isTop,itemCount:n.itemCount,orderByField:me(n.orderByField)}}}},t.prototype.matchRelativeRange=function(e,r){var n=function(t,e){var r=new Td(e);if(r.tryExtractParametersFrom(t))return{field:r.field,options:r.options}}(e,r);if(n)return{relativeDateRange:{arg:me(n.field),options:n.options}}},t.prototype.matchCompareOperator=function(e){var r=e,n=!1;if(mr(e)&&(r=e.arg,n=!0),Dn(r)||zf(r)||Hf(r)){var i=this.getValuePattern(r.left,r.right);if(i)return{compareOperator:{arg:me(r.left),filterOperator:this.mapFromSQExprKindToFilterOperator(r,n),condition:i}}}},t.prototype.getValuePattern=function(e,r){if(yr(r)){var n=r.arg;if(Le(n))return{dateSpan:{value:n.value,unit:r.unit}}}if(Le(r))return{constant:{value:r.value,type:r.type}};if(qf(r)){var i=mt.getDefaultValue(e,this.schema);return{defaultValue:{value:i.value,type:i.type}}}return ks(r)?{anyValue:{}}:void 0},t.prototype.matchAdvanced=function(e){if(xn(e)||Yt(e)){var r=xn(e)?0:1,n=this.matchAdvanced(e.left)||this.matchCompareOperator(e.left);if(n){var i=this.matchAdvanced(e.right)||this.matchCompareOperator(e.right);if(i)return{advancedOperator:{logicalOperator:r,left:n.advancedOperator||n.compareOperator,right:i.advancedOperator||i.compareOperator}}}}},t.prototype.mapFromSQExprKindToFilterOperator=function(e,r){var i=0;switch(e.kind){case 12:i=r?6:5;break;case 14:i=r?8:7;break;case 13:var a=e;0===a.comparison?i=Le(a.right)&&null==a.right.value?r?12:11:Le(a.right)&&""===a.right.value?r?14:13:r?10:9:1===a.comparison?i=3:2===a.comparison?i=4:3===a.comparison?i=1:4===a.comparison&&(i=2);break;default:i=0}return i},t.prototype.tryMatchHierarchical=function(e){var a,o,r=[],n=[],i={hierarchical:{included:r,excluded:n}};if(e instanceof Fn){if(a=this.tryGetHierarchicalNode(e.left,!1)||this.tryGetHierarchicalNode(e.right,!1),o=this.tryGetHierarchicalNode(e.left,!0)||this.tryGetHierarchicalNode(e.right,!0),!a||!o)return}else if(a=this.tryGetHierarchicalNode(e,!1),o=this.tryGetHierarchicalNode(e,!0),!a&&!o)return;return a&&!this.matchHierarchicalNode(a,!1,r)||o&&!this.matchHierarchicalNode(o,!0,n)?void 0:i},t.prototype.tryGetHierarchicalNode=function(e,r){if(r){if(e instanceof yu){if(e.arg instanceof tn||e.arg instanceof Fn)return e.arg}else if(e instanceof Fn)return e}else if(e instanceof Wa||e instanceof tn)return e},t.prototype.matchHierarchicalNode=function(e,r,n){if(e instanceof tn)return this.matchHierarchicalExpr(e,r,n);var i=this.tryGetHierarchicalNode(e,r);if(!i)return!1;u.assert(function(){return i instanceof Wa||i instanceof Fn},".matchHierarchicalNode does not expect any other expr type");var a=i;return this.matchHierarchicalExpr(a.left,r,n)&&this.matchHierarchicalExpr(a.right,r,n)},t.prototype.matchHierarchicalExpr=function(e,r,n){if(e instanceof tn){var i=this.matchBasicFilter(e);return!!i&&(n.push(i.in),i.in.not=r,!0)}return this.matchHierarchicalNode(e,r,n)},t.prototype.matchComposite=function(e,r){var n=!1;mr(e)&&(n=!0,e=e.arg);var i=Yt(e);if((!i||0!==r)&&(Yt(e)||xn(e))){var a=i?1:0,o=this.tryMatchExpr(e.left,a),s=this.tryMatchExpr(e.right,a);if(o&&s)return{composite:{not:n,operator:a,filters:[o,s]}}}},t}();function g0(t,e){u.assertValue(t,"filterPattern"),u.assertValue(e,"visitor");var r=t.condition;return r.in?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitIn(t)}(r.in,e):r.between?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitBetween(t)}(r.between,e):r.relativeDateRange?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitRelativeDateRange(t)}(r.relativeDateRange,e):r.compareOperator?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitCompare(t)}(r.compareOperator,e):r.advancedOperator?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitAdvanced(t)}(r.advancedOperator,e):r.composite?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitComposite(t)}(r.composite,e):r.topN?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitTopN(t)}(r.topN,e):r.complex?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitComplex(t)}(r.complex,e):r.hierarchical?function(t,e){return u.assertValue(t,"pattern"),u.assertValue(e,"visitor"),e.visitHierarchical(t)}(r.hierarchical,e):void u.assertFail("Failed to visit filterPattern")}function me(t,e){return t.accept(new x0(e))}var x0=function(t){function e(r){var n=t.call(this)||this;return n.schema=r,n}return T(e,t),e.prototype.visitColumnRef=function(r){var n=r.source.accept(Pn.instance);if(n){if(n.entity){var i=n.entity;return i.name=r.ref,{column:i}}if(n.subquery)return n.subquery.variable?{columnSubquery:{name:r.ref,subqueryRef:n.subquery.variable}}:{columnSubquery:{name:r.ref,subquery:n.subquery.query}};if(n.transform)return{columnTransformRef:{name:r.ref,transformTable:n.transform}}}},e.prototype.visitMeasureRef=function(r){var n=r.source.accept(Pn.instance);if(n&&n.entity){var i=n.entity;return i.name=r.ref,{measure:i}}},e.prototype.visitEntity=function(r){var n={schema:r.schema,entity:r.entity};return r.variable&&(n.entityVar=r.variable),{entity:n}},e.prototype.visitAggr=function(r){var n=r.arg.accept(this);if(n){if(n.column)return(i=n.column).aggregate=r.func,{columnAggr:i};if(n.columnAggr)return(i=n.columnAggr).aggregate=r.func,{columnAggr:i};if(n.groupingColumn)return(i=n.groupingColumn).aggregate=r.func,{groupingColumnAggr:i};if(n.groupingColumnAggr)return(i=n.groupingColumnAggr).aggregate=r.func,{groupingColumnAggr:i};if(n.hierarchyLevel)return(i=n.hierarchyLevel).aggregate=r.func,{hierarchyLevelAggr:i};if(n.columnHierarchyLevelVariation)return(i=n.columnHierarchyLevelVariation.level).aggregate=r.func,{hierarchyLevelAggr:i};if(n.columnSubquery)return(i=n.columnSubquery).aggregate=r.func,{columnAggrSubquery:i}}var i,a=r.arg.accept(Pn.instance);if(a&&a.entity)return(i=a.entity).aggregate=r.func,{entityAggr:i}},e.prototype.visitPercentile=function(r){return{percentile:{arg:r.arg.accept(this),k:r.k,exclusive:r.exclusive}}},e.prototype.visitGroupRef=function(r){var n=r.source.accept(Pn.instance);if(n&&n.entity){var i=n.entity;i.name=r.ref,i.groupedColumns=[];for(var a=0,o=r.groupedExprs;a<o.length;a++){var l=o[a].accept(this);(l.column||l.groupingColumn||l.hierarchyLevel)&&i.groupedColumns.push(l)}return{groupingColumn:i}}},e.prototype.visitHierarchy=function(r){var n=r.arg.accept(Pn.instance);if(n){if(n.entity)return{hierarchy:{entity:n.entity.entity,name:r.hierarchy,schema:n.entity.schema}};if(n.variation&&n.variation.column){var i=n.variation;if(ci(r.arg)){var a=r.arg;if(Vn(a.arg)){var o=a.arg,s=this.schema.schema(i.column.schema).findTargetEntityOfVariation(o.entity,i.column.name,i.variationName);if(s)return{columnHierarchyVariation:{source:ye({},i.column),hierarchy:{schema:i.column.schema,entity:s.name,name:r.hierarchy},variationName:n.variation.variationName}}}}}}},e.prototype.visitHierarchyLevel=function(r){var n=r.arg.accept(D0.instance);if(n){var i;if(n.hierarchy&&(i={entity:n.hierarchy.entity,schema:n.hierarchy.schema,name:n.hierarchy.name,level:r.level}),n.variation){if(this.schema){var a=n.variation,o=this.schema.schema(n.variation.column.schema).findTargetEntityOfVariation(i.entity,a.column.name,a.variationName);o&&(i.entity=o.name)}return{columnHierarchyLevelVariation:{source:{entity:n.variation.column.entity,schema:n.variation.column.schema,name:n.variation.column.name},level:i,variationName:n.variation.variationName}}}return{hierarchyLevel:i}}},e.prototype.visitArithmetic=function(r){if(!Qr(r.right)||3!==r.operator)return{arithmetic:{left:r.left.accept(this),right:r.right.accept(this),operator:r.operator}};var n=r.right.scope;return _.isEmpty(n)?{percentOfGrandTotal:{baseExpr:r.left.accept(this)}}:_.every(n,function(i){return Uf(i)})?{percentOfRoleTotal:{baseExpr:r.left.accept(this),roles:_.map(n,function(i){return i.role})}}:void 0},e.prototype.visitSelectRef=function(r){return{selectRef:{expressionName:r.expressionName}}},e.prototype.visitTransformOutputRoleRef=function(r){return{transformOutputRoleRef:{expressionName:r.role}}},e.prototype.visitFilteredEval=function(r){var n=this,i=_.map(r.filters,function(a){var o=function(t,e){if(t){var r=t.where();if(r){var n=new v0(e),i=t.from();return r.map(function(a){var o=n.tryMatchPattern(a,i);if(o){var s={condition:o};return _.isEmpty(a.target)||(s.target=_.map(a.target,function(l){return me(l)})),s}})}}}(Qe.fromSQFromAndSQFilters(new $r,[a]),n.schema);if(o)return u.assert(function(){return 1===o.length},"There are more than one filter pattern in this Semantic Filter"),o[0]});return{filteredEval:{baseExpr:r.expression.accept(this),filters:i}}},e.prototype.visitConstant=function(r){return{constant:{value:r.value,type:r.type}}},e.prototype.visitSparklineData=function(r){var n=this;return{sparklineData:{measure:r.measure.accept(this),grouping:_.map(r.grouping,function(i){return i.accept(n)})}}},e.prototype.visitNativeVisualCalc=function(r){return{nativeVisualCalc:{name:r.name,language:r.language,expression:r.expression}}},e}(Ye),Pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitEntity=function(r){var n={schema:r.schema,entity:r.entity};return r.variable&&(n.entityVar=r.variable),{entity:n}},e.prototype.visitPropertyVariationSource=function(r){var n=r.arg;if(Vn(n)){var i={schema:n.schema,entity:n.entity,name:r.property};return n.variable&&(i.entityVar=n.variable),{variation:{column:i,variationName:r.name}}}},e.prototype.visitSubqueryRef=function(r){return r.variable?{subquery:{variable:r.variable}}:{subquery:{query:r.query}}},e.prototype.visitTransformTableRef=function(r){return u.assertValue(r,"expr"),u.assertValue(r.source,"source"),{transform:{name:null==r?void 0:r.source}}},e.instance=new e,e}(Ye),D0=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitHierarchy=function(r){var i,a,n=r.arg.accept(Pn.instance);return n.variation?(i={name:r.hierarchy,schema:n.variation.column.schema,entity:n.variation.column.entity},a=n.variation):i={name:r.hierarchy,schema:n.entity.schema,entity:n.entity.entity},{hierarchy:i,variation:a}},e.instance=new e,e}(Ye),A0=/'/g,_0=/\.000$/;function Fd(t){return u.assertValue(t,"value"),"'"+t.replace(A0,"''")+"'"}function Nd(t){return t?"true":"false"}var hu=function(e){return null!=e&&1===e["PowerBI.SQExprEvaluationKind"]};function kd(t,e,r,n,i){var o=t.schema(e).findHierarchy(r,n);if(o)return o.levels.withName(i)}var Zr=function(){function t(){}return t.prototype.visitEntity=function(e,r){return this.visitDefault(e,r)},t.prototype.visitSubqueryRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitColumnRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitMeasureRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitAggr=function(e,r){return this.visitDefault(e,r)},t.prototype.visitPercentile=function(e,r){return this.visitDefault(e,r)},t.prototype.visitRangePercent=function(e,r){return this.visitDefault(e,r)},t.prototype.visitGroupRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitHierarchy=function(e,r){return this.visitDefault(e,r)},t.prototype.visitHierarchyLevel=function(e,r){return this.visitDefault(e,r)},t.prototype.visitPropertyVariationSource=function(e,r){return this.visitDefault(e,r)},t.prototype.visitSelectRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitAnd=function(e,r){return this.visitDefault(e,r)},t.prototype.visitBetween=function(e,r){return this.visitDefault(e,r)},t.prototype.visitIn=function(e,r){return this.visitDefault(e,r)},t.prototype.visitOr=function(e,r){return this.visitDefault(e,r)},t.prototype.visitCompare=function(e,r){return this.visitDefault(e,r)},t.prototype.visitConditional=function(e,r){return this.visitDefault(e,r)},t.prototype.visitContains=function(e,r){return this.visitDefault(e,r)},t.prototype.visitExists=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNot=function(e,r){return this.visitDefault(e,r)},t.prototype.visitStartsWith=function(e,r){return this.visitDefault(e,r)},t.prototype.visitConstant=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDateSpan=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDateAdd=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNow=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDefaultValue=function(e,r){return this.visitDefault(e,r)},t.prototype.visitAnyValue=function(e,r){return this.visitDefault(e,r)},t.prototype.visitArithmetic=function(e,r){return this.visitDefault(e,r)},t.prototype.visitFloor=function(e,r){return this.visitDefault(e,r)},t.prototype.visitFillRule=function(e,r){return this.visitDefault(e,r)},t.prototype.visitThemeDataColor=function(e,r){return this.visitDefault(e,r)},t.prototype.visitResourcePackageItem=function(e,r){return this.visitDefault(e,r)},t.prototype.visitScopedEval=function(e,r){return this.visitDefault(e,r)},t.prototype.visitFilteredEval=function(e,r){return this.visitDefault(e,r)},t.prototype.visitWithRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitTransformTableRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitTransformOutputRoleRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitRoleRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitAllRolesRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDiscretize=function(e,r){return this.visitDefault(e,r)},t.prototype.visitMember=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNamedQueryRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNativeMeasure=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNativeColumn=function(e,r){return this.visitDefault(e,r)},t.prototype.visitSummaryValueRef=function(e,r){return this.visitDefault(e,r)},t.prototype.visitSparklineData=function(e,r){return this.visitDefault(e,r)},t.prototype.visitNativeVisualCalc=function(e,r){return this.visitDefault(e,r)},t.prototype.visitDefault=function(e,r){return e},t}(),U=function(){function t(e,r){u.assertValue(e,"kind"),u.assertAnyValue(r,"annotations"),this._kind=e,this._annotations=r}return t.prototype.validate=function(e,r,n,i){var a=new Vp(e,r,n,i);return this.accept(a),a.errors},t.prototype.accept=function(e,r){u.assertFail("abstract method")},Object.defineProperty(t.prototype,"kind",{get:function(){return this._kind},enumerable:!1,configurable:!0}),t.prototype.getMetadata=function(e,r){u.assertValue(e,"federatedSchema");var n=me(this,e);if(n)return n.column||n.columnAggr||n.groupingColumn||n.groupingColumnAggr||n.measure?this.getMetadataForProperty(n,e):n.hierarchyLevel||n.hierarchyLevelAggr?this.getMetadataForHierarchyLevel(n,e):n.columnHierarchyLevelVariation?this.getMetadataForVariation(n,e):n.columnSubquery||n.columnAggrSubquery?this.getMetadataForSubqueryColumn(n,e,r):n.columnTransformRef?this.getMetadataForColumnTransformRef():t.getMetadataForEntity(n,e)},t.prototype.isOrdinalEvaluation=function(){return!1},t.prototype.getAnnotations=function(){return this._annotations},t.prototype.getKeyColumns=function(e){var r=Tu.getColumnRefSQExpr(e,this);if(r){var n=[],i=this.getPropertyKeys(e);if(i&&i.length>0)for(var a=0,o=i.length;a<o;a++)n.push(Re(r.source,i[a].name));else n.push(r);return n}},t.prototype.hasGroupOnKeys=function(e){var r=this.getTargetColumnRef(e);if(r){var n=this.getPropertyKeys(e);return!(!n||n.length<1)&&(n.length>1||!j(Re(r.source,n[0].name),this))}},t.prototype.getPropertyKeys=function(e){var r=this.getConceptualProperty(e,!0);if(r)return r.column?r.column.keys:void 0},t.prototype.getOrderByColumns=function(e){var r=this.getTargetColumnRef(e);if(r){var n=r.getConceptualProperty(e,!0),i=n&&n.column&&n.column.orderBy;if(_.isEmpty(i))return[];for(var a=new Array(i.length),o=0,s=i.length;o<s;o++)a[o]=Re(r.source,i[o].name);return a}},t.prototype.getConceptualProperty=function(e,r){var n=me(this,e);if(n){var i=ou(n);if(i&&1===_.size(i)){var a=au(n);if(a){var o=e.schema(i[0].schema);return o?o.findProperty(i[0].entity,a):void 0}if(r){var l,s=void 0;if(n.columnHierarchyLevelVariation)(s=n.columnHierarchyLevelVariation.level)&&(l=e.schema(s.schema).findHierarchy(s.entity,s.name));else if(s=n.hierarchyLevel||n.hierarchyLevelAggr){var c=br(n);l=e.schema(c.schema).findHierarchy(c.entity,s.name)}if(l){var f=l.levels.withName(s.level);if(f)return f.column}}}}},t.prototype.getTargetEntityForVariation=function(e,r){var n=this.getConceptualProperty(e);if(n&&n.column&&!_.isEmpty(n.column.variations))for(var a=0,o=n.column.variations;a<o.length;a++){var s=o[a];if(s.name===r)return s.navigationProperty.targetEntity.name}},t.prototype.getTargetEntity=function(){return rw.getEntityExpr(this)},t.prototype.getTargetSchemaName=function(){return nw.getSchemaName(this)},t.prototype.getTargetColumnRef=function(e){return u.assertValue(e,"schema"),Tu.getColumnRefSQExpr(e,this)},t.prototype.getMetadataForVariation=function(e,r){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema");var n=e.columnHierarchyLevelVariation,i=br(e),a=r.schema(i.schema).findProperty(i.entity,n.source.name);if(a&&a.column&&a.column.variations)for(var o=0,s=a.column.variations;o<s.length;o++){var l=s[o];if(l.defaultHierarchy&&l.defaultHierarchy.levels)for(var c=0,f=l.defaultHierarchy.levels;c<f.length;c++){var d=f[c];if(d.name===n.level.level){var p=d.column;return{kind:1===p.kind?1:0,type:p.type,format:p.format,idOnEntityKey:!!p.column&&p.column.idOnEntityKey,defaultAggregate:p.column?p.column.defaultAggregate:null}}}}},t.prototype.getMetadataForHierarchyLevel=function(e,r){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema");var n=this.getConceptualProperty(r,!0);if(n)return this.getPropertyMetadata(e,n)},t.prototype.getPropertyMetadata=function(e,r){var n=e.columnAggr||e.groupingColumnAggr||e.hierarchyLevelAggr,i=n?this.getFormatAndTypeForAggregate(n.aggregate,r.format,r.type):r;return{kind:1===r.kind||n&&void 0!==n.aggregate?1:0,type:i.type,format:i.format,idOnEntityKey:!!r.column&&r.column.idOnEntityKey,aggregate:n?n.aggregate:void 0,defaultAggregate:r.column?r.column.defaultAggregate:null}},t.prototype.getMetadataForProperty=function(e,r){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema");var n=this.getConceptualProperty(r);if(n)return this.getPropertyMetadata(e,n)},t.prototype.getFormatAndTypeForAggregate=function(e,r,n){var i=r,a=n;switch(e){case 2:case 5:a=L.fromExtendedType(260),i=void 0;break;case 1:case 7:case 8:a.integer&&(a=L.fromExtendedType(259),i=function(t){return!t||yi(t)||mi(t).hasDots?t:Js(t,2,!0)}(i))}return{format:i,type:a}},t.prototype.getMetadataForSubqueryColumn=function(e,r,n){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema"),u.assert(function(){return!(!n||!n.sources)},"context sources should be available for evaluating subquery source");var i=mt.getSubqueryExpression(this,n);u.assertValue(i,"could not find original select expr of subquery from context");var a=i.getMetadata(r,n);if(a){if(a.kind=0,e.columnAggrSubquery){var o=this.getFormatAndTypeForAggregate(e.columnAggrSubquery.aggregate,a.format,a.type);a.type=o.type,a.format=o.format,a.aggregate=e.columnAggrSubquery.aggregate}else e.columnSubquery?a.aggregate=void 0:u.assertFail("invalid field expression for subquery column");return a}},t.prototype.getMetadataForColumnTransformRef=function(){return{idOnEntityKey:!1,kind:0,type:L.fromVariant([L.fromPrimitiveTypeAndCategory(5),L.fromPrimitiveTypeAndCategory(7),L.fromPrimitiveTypeAndCategory(2),L.fromPrimitiveTypeAndCategory(3),L.fromPrimitiveTypeAndCategory(4),L.fromPrimitiveTypeAndCategory(1)])}},t.getMetadataForEntity=function(e,r){u.assertValue(e,"field"),u.assertValue(r,"federatedSchema");var n=br(e);if(r.schema(n.schema).entities.withName(n.entity)&&e.entityAggr)switch(e.entityAggr.aggregate){case 2:case 5:return{kind:1,type:L.fromExtendedType(260),format:void 0,idOnEntityKey:!1,aggregate:e.entityAggr.aggregate}}},t}();Kt(U.prototype);var Ga=function(t){function e(r,n,i,a){var o=this;return u.assertValue(n,"entity"),(o=t.call(this,0,a)||this).schema=r,o.entity=n,i&&(o.variable=i),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitEntity(this,n)},e.prototype.as=function(r,n){return new e(this.schema,this.entity,r,n)},e}(U),Ld=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"name"),(o=t.call(this,47,a)||this).name=r,o.language=n,o.expression=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitNativeVisualCalc(this,n)},e.prototype.getMetadata=function(r){return u.assertValue(r,"federatedSchema"),{kind:1,type:L.fromPrimitiveTypeAndCategory(3)}},e}(U),vu=function(t){function e(r,n){var i=this;return u.assertValue(r,"source"),u.assertAnyValue(n,"annotations"),i=t.call(this,1,n)||this,_.isString(r)?i.variable=r:i.query=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitSubqueryRef(this,n)},e.prototype.as=function(r,n){return new e(r,n)},e}(U),Bd=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"source"),(a=t.call(this,39,i)||this).queryName=r,n&&(a.variable=n),a}return T(e,t),e.prototype.accept=function(r,n){return r.visitNamedQueryRef(this,n)},e.prototype.as=function(r,n){return new e(this.queryName,r,n)},e}(U),Ud=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),u.assertValue(i,"operator"),(o=t.call(this,23,a)||this).left=r,o.right=n,o.operator=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitArithmetic(this,n)},e.prototype.getMetadata=function(r){var n=this,i=this.left.getMetadata(r);if(Qr(this.right))return i?(u.assert(function(){return 3===n.operator},"unexpected usage of scoped eval with arithmetic"),i.format="#,##0.00%",i.type=L.fromExtendedType(259),i):void 0;var l,a=this.right.getMetadata(r),o=null==i?void 0:i.type,s=null==a?void 0:a.type;l=o&&s?this.getArithmeticResultType(o,s):null!=o?o:s,u.assertValue(l,"SQExpr - cannot get proper type for arithmetic expression");var d,c=null==i?void 0:i.format;return(0===this.operator||1===this.operator)&&(d=c===(null==a?void 0:a.format)?c:void 0),{format:d,type:l,kind:1}},e.prototype.getArithmeticResultType=function(r,n){return 0!==this.operator&&1!==this.operator&&2!==this.operator&&3!==this.operator&&u.assertNever(this.operator),2===r.primitiveType?L.fromPrimitiveTypeAndCategory(3===this.operator&&2===n.primitiveType?3:2):3===r.primitiveType?L.fromPrimitiveTypeAndCategory(3!==this.operator&&2===n.primitiveType?2:3):4===r.primitiveType?3===this.operator&&4===n.primitiveType?L.fromPrimitiveTypeAndCategory(3):n:void u.assertFail("unsupported arithmetic expression type")},e}(U),Od=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"size"),(o=t.call(this,35,a)||this).arg=r,o.size=n,null!=i&&(o.timeUnit=i),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitFloor(this,n)},e}(U),Qa=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"expression"),u.assertValue(n,"scope"),(a=t.call(this,26,i)||this).expression=r,a.scope=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitScopedEval(this,n)},e.prototype.getMetadata=function(r){return this.expression.getMetadata(r)},e.prototype.hasGlobalScope=function(){return u.assertValue(this.scope,"scope"),0===this.scope.length},e.prototype.hasInnerMostScope=function(){return u.assertValue(this.scope,"scope"),1===this.scope.length&&Of(this.scope[0])},e.createGlobalAggregateOfScopedExpr=function(r,n){var i=new e(r,[new ap]);return new e(new en(i,n),[])},e.prototype.decomposeGlobalAggregateOfScopedExpr=function(){if(this.hasGlobalScope()){var r=this.expression;if(et(r)){var n=r.arg;if(Qr(n)&&n.hasInnerMostScope())return{source:n.expression,func:r.func}}}},e}(U),zd=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"expression"),u.assertValue(n,"filters"),(a=t.call(this,41,i)||this).expression=r,a.filters=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitFilteredEval(this,n)},e.prototype.getMetadata=function(r){return this.expression.getMetadata(r)},e}(U),L0=function(t){function e(r,n){var i=this;return u.assertValue(r,"expressionName"),(i=t.call(this,27,n)||this).expressionName=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitWithRef(this,n)},e}(U),qd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"kind"),u.assertValue(n,"source"),u.assertValue(i,"ref"),(o=t.call(this,r,a)||this).source=n,o.ref=i,o}return T(e,t),e}(U),Cr=function(t){function e(r,n,i,a){return t.call(this,i||2,r,n,a)||this}return T(e,t),e.prototype.accept=function(r,n){return r.visitColumnRef(this,n)},e}(qd),Hd=function(t){function e(r,n,i){return t.call(this,3,r,n,i)||this}return T(e,t),e.prototype.accept=function(r,n){return r.visitMeasureRef(this,n)},e}(qd),Gd=function(t){function e(r,n,i,a,o,s,l){var c=t.call(this,43,l)||this;return u.assertValue(r,"language"),u.assertValue(n,"expression"),u.assertValue(i,"dataType"),u.assertAnyValue(a,"proposedName"),u.assertAnyValue(o,"expressionContentCache"),u.assertAnyValue(s,"format"),c.language=r,c.expression=n,c.dataType=i,c.proposedName=a,c.expressionContentCache=o,c.format=s,c}return T(e,t),e.prototype.getMetadata=function(r){return u.assertValue(r,"federatedSchema"),{kind:1,type:L.fromPrimitiveTypeAndCategory(this.dataType),format:this.format}},e.prototype.accept=function(r,n){return r.visitNativeMeasure(this,n)},e}(U),Qd=function(t){function e(r,n,i,a,o,s,l,c){var f=t.call(this,44,c)||this;return u.assertValue(r,"language"),u.assertValue(n,"expression"),u.assertValue(i,"dataType"),u.assertValue(a,"source"),u.assertAnyValue(o,"proposedName"),u.assertAnyValue(s,"expressionContentCache"),u.assertAnyValue(l,"format"),f.language=r,f.expression=n,f.dataType=i,f.source=a,f.proposedName=o,f.expressionContentCache=s,f.format=l,f}return T(e,t),e.prototype.getMetadata=function(r){return u.assertValue(r,"federatedSchema"),{kind:0,type:L.fromPrimitiveTypeAndCategory(this.dataType),format:this.format}},e.prototype.accept=function(r,n){return r.visitNativeColumn(this,n)},e}(U),en=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"func"),(o=t.call(this,4,a)||this).arg=r,o.func=n,o.includeAllTypes=i,u.assert(function(){return _.isNil(o.includeAllTypes)||3===o.func||4===o.func},"includeAllTypes has a value and the aggregate is not min/max - not a valid combination."),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitAggr(this,n)},e.prototype.getMetadata=function(r,n){if(u.assertValue(r,"federatedSchema"),Ts(this.arg)){var i=this.getFormatAndTypeForAggregate(this.func,this.arg.format,L.fromPrimitiveTypeAndCategory(this.arg.dataType));return{kind:1,type:i.type,format:i.format}}return t.prototype.getMetadata.call(this,r,n)},e}(U),Wd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"k"),u.assert(function(){return 0<=n&&n<=1},"0 <= k && k <= 1"),u.assertValue(i,"exclusive"),(o=t.call(this,28,a)||this).arg=r,o.k=n,o.exclusive=i,o}return T(e,t),e.prototype.getMetadata=function(r){u.assertValue(r,"federatedSchema");var n=this.arg.getMetadata(r);if(n)return{kind:1,type:n.type}},e.prototype.accept=function(r,n){return r.visitPercentile(this,n)},e}(U),jd=function(t){function e(r,n,i,a){var o=t.call(this,29,a)||this;return o.min=r,o.max=n,o.percent=i,u.assert(function(){return i>=0&&i<=1},"Invalid percent value. Valid values are 0 to 1"),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitRangePercent(this,n)},e.overRangeOf=function(r,n){return new e(Qa.createGlobalAggregateOfScopedExpr(r,3),Qa.createGlobalAggregateOfScopedExpr(r,4),n)},e.prototype.decomposeOverRangePattern=function(){var r=this.min,n=this.max;if(Qr(r)&&Qr(n)){var i=r.decomposeGlobalAggregateOfScopedExpr(),a=n.decomposeGlobalAggregateOfScopedExpr();if(i&&a&&3===i.func&&4===a.func&&j(i.source,a.source))return{sourceExpr:i.source,percent:this.percent}}},e}(U),Kd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"name"),u.assertValue(i,"property"),(o=t.call(this,5,a)||this).arg=r,o.name=n,o.property=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitPropertyVariationSource(this,n)},e}(U),Jd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"name"),u.assertValue(i,"groupedExprs"),u.assert(function(){return i.length>0},"groupedExprs.length > 0"),(o=t.call(this,n,r,34,a)||this).groupedExprs=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitGroupRef(this,n)},e}(Cr),Yd=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"arg"),u.assertValue(n,"hierarchy"),(a=t.call(this,6,i)||this).arg=r,a.hierarchy=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitHierarchy(this,n)},e}(U),$d=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"arg"),u.assertValue(n,"level"),(a=t.call(this,7,i)||this).arg=r,a.level=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitHierarchyLevel(this,n)},e}(U),B0=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"expressionName"),(a=t.call(this,30,i)||this).expressionName=r,a.attributeKind=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitSelectRef(this,n)},e}(U),Fn=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),(a=t.call(this,8,i)||this).left=r,a.right=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitAnd(this,n)},e}(U),Xd=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"arg"),u.assertValue(n,"lower"),u.assertValue(i,"upper"),(o=t.call(this,9,a)||this).arg=r,o.lower=n,o.upper=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitBetween(this,n)},e}(U),tn=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"args"),u.assert(function(){return null==n!=(null==i)},"values or table"),(o=t.call(this,10,a)||this).args=r,n&&(o.values=n),i&&(o.table=i),o}return T(e,t),e.prototype.accept=function(r,n){return r.visitIn(this,n)},e}(U),Wa=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),(a=t.call(this,11,i)||this).left=r,a.right=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitOr(this,n)},e}(U),gu=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"kind"),u.assertValue(n,"left"),u.assertValue(i,"right"),(o=t.call(this,13,a)||this).comparison=r,o.left=n,o.right=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitCompare(this,n)},e.prototype.isOrdinalEvaluation=function(){return hu(this.getAnnotations())},e}(U),Zd=function(t){function e(r,n,i){var a=this;return u.assertNonEmpty(r,"cases"),u.assertAnyValue(n,"defaultValue"),(a=t.call(this,42,i)||this).cases=r,a.defaultValue=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitConditional(this,n)},e}(U),ja=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),(a=t.call(this,12,i)||this).left=r,a.right=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitContains(this,n)},e.prototype.isOrdinalEvaluation=function(){return hu(this.getAnnotations())},e}(U),ep=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"left"),u.assertValue(n,"right"),(a=t.call(this,14,i)||this).left=r,a.right=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitStartsWith(this,n)},e.prototype.isOrdinalEvaluation=function(){return hu(this.getAnnotations())},e}(U),tp=function(t){function e(r,n){var i=this;return u.assertValue(r,"arg"),u.assert(function(){return r instanceof Ga},"Exists only supports Entity argument"),(i=t.call(this,15,n)||this).arg=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitExists(this,n)},e}(U),yu=function(t){function e(r,n){var i=this;return u.assertValue(r,"arg"),(i=t.call(this,16,n)||this).arg=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitNot(this,n)},e}(U),Fe=function(t){function e(r,n,i,a,o){var s=this;return u.assertValue(r,"type"),(s=t.call(this,17,o)||this).type=r,s.value=n,s.typeEncodedValue=i,a&&(s.rawValue=a),s}return T(e,t),Object.defineProperty(e.prototype,"valueEncoded",{get:function(){return void 0===this.typeEncodedValue&&(this.typeEncodedValue=function(t,e){if(null===t)return"null";switch(e.primitiveType){case 4:return u.assert(function(){return _.isString(t)||_.isNumber(t)},"Expected either a string or number value to encode for type ".concat(e)),t+"L";case 2:return u.assert(function(){return _.isString(t)||_.isNumber(t)},"Expected either a string or number value to encode for type ".concat(e)),t+"M";case 3:return u.assert(function(){return _.isString(t)||_.isNumber(t)},"Expected either a string or number value to encode for type ".concat(e)),t+"D";case 7:case 6:var n=void 0;return t instanceof Date?(n=Hs(t)?new Date(t.epochTimeStamp).toISOString():new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString(),_.endsWith(n,"Z")&&(n=n.substr(0,n.length-1)),n=n.replace(_0,"")):(u.assert(function(){return _.isString(t)},"Expected a string or a Date value for type ".concat(e)),n=t),"datetime'".concat(n,"'");case 1:return u.assert(function(){return _.isString(t)},"Expected a string value to encode for type ".concat(e)),Fd(t);case 5:return u.assert(function(){return _.isBoolean(t)},"Expected boolean values for type ".concat(e)),Nd(t);case 13:return u.assert(function(){return _.isString(t)},"Expected string values to encode for type ".concat(e)),t;default:u.assertFail("unsupported dsrValue for type ".concat(e))}}(this.rawValue||this.value,this.type)),this.typeEncodedValue},enumerable:!1,configurable:!0}),e.prototype.accept=function(r,n){return r.visitConstant(this,n)},e.prototype.getMetadata=function(){return{kind:1,type:this.type}},e.getNumericValue=function(r){if(Rf(r)&&_.isNumber(r.value))return r.value;u.assertFail("SQConstantExpr.getNumericValue - Unexpected SQExpr kind/value")},e.getTextValue=function(r){if(Is(r)&&_.isString(r.value))return r.value;u.assertFail("SQConstantExpr.getTextValue - Unexpected SQExpr kind/value")},e.getBooleanValue=function(r){if(Nf(r)&&_.isBoolean(r.value))return r.value;u.assertFail("SQConstantExpr.getBooleanValue - Unexpected SQExpr kind/value")},e.getDateValue=function(r){if(wn(r)&&_.isDate(r.value))return r.value;u.assertFail("SQConstantExpr.getDateValue - Unexpected SQExpr kind/value")},e}(U);Kt(Fe.prototype);var rp=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"unit"),u.assertValue(n,"arg"),(a=t.call(this,18,i)||this).unit=r,a.arg=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitDateSpan(this,n)},e}(U),np=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"unit"),u.assertValue(n,"amount"),u.assertValue(i,"arg"),(o=t.call(this,19,a)||this).unit=r,o.arg=i,o.amount=n,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitDateAdd(this,n)},e.prototype.getMetadata=function(r){return this.arg.getMetadata(r)},e}(U),U0=function(t){function e(r){return t.call(this,20,r)||this}return T(e,t),e.prototype.accept=function(r,n){return r.visitNow(this,n)},e.prototype.getMetadata=function(){return{kind:1,type:L.fromExtendedType(519)}},e}(U),O0=function(t){function e(r){return t.call(this,22,r)||this}return T(e,t),e.prototype.accept=function(r,n){return r.visitDefaultValue(this,n)},e}(U),z0=function(t){function e(r,n){var i=this;return u.assertAnyValue(r,"defaultValueOverridesAncestors"),(i=t.call(this,21,n)||this).defaultValueOverridesAncestors=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitAnyValue(this,n)},e}(U),ip=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"input"),u.assertValue(n,"fillRule"),(a=t.call(this,24,i)||this).input=r,a.rule=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitFillRule(this,n)},e}(U),q0=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"SQThemeDataColorExpr - colorId"),u.assertValue(n,"SQThemeDataColorExpr - percent"),u.assertValue(-1<=n&&n<=1,"percent"),(a=t.call(this,33,i)||this).colorId=r,a.percent=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitThemeDataColor(this,n)},e}(U),H0=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"packageName"),u.assertValue(i,"itemName"),(o=t.call(this,25,a)||this).packageName=r,o.packageType=n,o.itemName=i,o}return T(e,t),e.prototype.accept=function(r,n){return r.visitResourcePackageItem(this,n)},e}(U),G0=function(t){function e(r,n){var i=this;return u.assertValue(r,"source"),(i=t.call(this,31,n)||this).source=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitTransformTableRef(this,n)},e}(U),Q0=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"role"),(a=t.call(this,32,i)||this).role=r,n&&(a.transform=n),a}return T(e,t),e.prototype.accept=function(r,n){return r.visitTransformOutputRoleRef(this,n)},e.prototype.getMetadata=function(r){},e}(U),W0=function(t){function e(r,n){var i=this;return u.assertValue(r,"role"),(i=t.call(this,36,n)||this).role=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitRoleRef(this,n)},e}(U),j0=function(t){function e(r,n){var i=this;return u.assert(function(){return!_.isEmpty(r)},"name"),u.assertAnyValue(n,"annotations"),(i=t.call(this,45,n)||this).name=r,i}return T(e,t),e.prototype.accept=function(r,n){return r.visitSummaryValueRef(this,n)},e}(U),ap=function(t){function e(r){return t.call(this,37,r)||this}return T(e,t),e.prototype.accept=function(r,n){return r.visitAllRolesRef(this,n)},e}(U),op=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"source"),(a=t.call(this,38,i)||this).source=r,a.count=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitDiscretize(this,n)},e}(U),sp=function(t){function e(r,n,i){var a=this;return u.assertValue(r,"source"),u.assertValue(n,"member"),(a=t.call(this,40,i)||this).source=r,a.member=n,a}return T(e,t),e.prototype.accept=function(r,n){return r.visitMember(this,n)},e}(U),up=function(t){function e(r,n,i,a,o,s){var l=t.call(this,46,s)||this;return u.assertValue(r,"measure"),u.assertValue(n,"grouping"),u.assertAnyValue(i,"scalarKey"),u.assert(function(){return 1===_.size(n)},"exactly 1 grouping is allowed"),l.measure=r,l.grouping=n,l.scalarKey=i,l.pointsPerSparkline=a,l.includeMinGroupingInterval=o,l}return T(e,t),e.prototype.getMetadata=function(r){var i,n=this;return u.assertValue(r,"federatedSchema"),u.assert(function(){return 1===_.size(n.grouping)},"exactly 1 grouping is allowed"),{kind:1,type:L.fromDescriptor({misc:{sparkline:{groupingType:null===(i=this.grouping[0].getMetadata(r))||void 0===i?void 0:i.type}}})}},e.prototype.accept=function(r,n){return r.visitSparklineData(this,n)},e}(U);function je(t,e,r,n){return new Ga(t,e,r,n)}function rn(t,e){return _.isString(t),new vu(t,e)}function lp(t,e,r){return new Bd(t,e,r)}function Re(t,e,r){return new Cr(t,e,null,r)}function mu(t,e,r){return new Hd(t,e,r)}function cp(t,e,r,n,i,a,o){return new Gd(t,e,r,n,i,a,o)}function fp(t,e,r,n,i,a,o,s){return new Qd(t,e,r,n,i,a,o,s)}function Xt(t,e,r,n){return new en(t,e,r,n)}function wi(t,e,r){return new B0(t,e,r)}function Su(t,e,r,n){return new Wd(t,e,r,n)}function dp(t,e,r,n){return new jd(t,e,r,n)}function Vi(t,e,r,n){return new Ud(t,e,r,n)}function pp(t,e,r,n){return new Od(t,e,r,n)}function Ka(t,e,r){return new Qa(t,e,r)}function bu(t,e,r){return new zd(t,e,r)}function hp(t,e){return new L0(t,e)}function Ja(t,e,r,n){return new Jd(t,e,r,n)}function Mi(t,e,r){return new Yd(t,e,r)}function Ya(t,e,r,n){return new Kd(t,e,r,n)}function $a(t,e,r){return new $d(t,e,r)}function Eu(t,e){return new G0(t,e)}function Cu(t,e,r){return new Q0(t,e,r)}function wu(t,e){return new W0(t,e)}function vp(t,e){return new j0(t,e)}function gp(t){return new ap(t)}function st(t,e,r){return t?e?new Fn(t,e,r):t:e}function wr(t,e,r,n){return new Xd(t,e,r,n)}function nn(t,e,r){return new tn(t,e,null,r)}function Vu(t,e,r){return new tn(t,null,e,r)}function xi(t,e,r){if(!t)return e;if(!e)return t;if(vt(t)&&vt(e)){var n=function(t,e,r){if(t.args&&e.args&&t.values&&e.values){var n=t.args.length;if(n===e.args.length){for(var a=0;a<n;++a)if(!j(t.args[a],e.args[a]))return;var o=t.values.concat(e.values);return nn(t.args,o,r)}}}(t,e,r);if(n)return n}return new Wa(t,e,r)}function Rn(t,e,r,n){return new gu(t,e,r,n)}function Mu(t,e,r){return new Zd(t,e,r)}function yp(t,e,r){return new ja(t,e,r)}function mp(t,e){return new tp(t,e)}function Nn(t,e,r){return Rn(0,t,e,r)}function Xa(t,e){return new yu(t,e)}function Sp(t,e,r){return new ep(t,e,r)}var J0=new Fe(L.fromExtendedType(0),null,"null");function Lt(){return J0}var Y0=new Fe(L.fromExtendedType(1),"");function $0(){return Y0}function xu(t){return new U0(t)}function Za(t){return new O0(t)}function Di(t,e){return new z0(t,e)}function Zt(t,e){return new Fe(L.fromExtendedType(5),t,Nd(t),void 0,e)}function St(t,e,r,n){return new np(t,e,r,n)}function er(t,e,r){return new Fe(L.fromExtendedType(519),t,e,void 0,r)}function bt(t,e,r){return new rp(t,e,r)}function eo(t,e,r){return new Fe(L.fromExtendedType(258),t,e,void 0,r)}function an(t,e,r){return new Fe(L.fromExtendedType(259),t,e,void 0,r)}function kn(t,e,r){return new Fe(L.fromExtendedType(260),t,e,void 0,r)}function Ce(t,e,r){return u.assert(function(){return!e||e===Fd(t)},"Incorrect encoded value specified."),new Fe(L.fromExtendedType(1),t,e,void 0,r)}function on(t,e){return null==t?Lt():_.isBoolean(t)?Zt(t):_.isString(t)?Ce(t):_.isNumber(t)?e.integer&&If(t)?kn(t):an(t):t instanceof Date?er(t):void 0}function Ai(t,e,r,n){return new Fe(L.fromExtendedType(t),e,void 0,r,n)}function Du(t,e,r,n,i,a){return new up(t,e,r,n,i,a)}function X0(t){return iw.rewrite(t)}function Z0(t,e,r){if(di(t))return aw.rewrite(t,e,r)}function bp(t,e,r){return u.assertValue(t,"expr"),u.assertValue(e,"rule"),new ip(t,e,r)}function Au(t,e,r){return u.assertValue(t,"themeDataColor - colorId"),u.assertValue(e,"themeDataColor - percent"),new q0(t,e,r)}function Ep(t,e,r,n){return new H0(t,e,r,n)}function Cp(t,e,r){return new op(t,e,r)}function wp(t,e,r){return new sp(t,e,r)}function ew(t,e,r){return u.assertValue(null==t||function(t){return/^#([0-9a-f]{6}|[0-9a-f]{3})$/i.test(t)}(t),"SQExprBuilder.color - hexCode has to either not exist or be a valid hex code"),u.assertValue(e,"SQExprBuilder.color - colorName has to exist"),Ce(t||e,void 0,r)}function _u(t,e,r){return new Ld(t,"dax",e,r)}function Iu(t){if(u.assertValue(t,"expr"),Le(t)&&t.type.text)return t.value}var Vp=function(t){function e(r,n,i,a){var o=this;return u.assertValue(r,"schema"),u.assertValue(n,"aggrUtils"),(o=t.call(this)||this).schema=r,o.aggrUtils=n,o.context=a,i&&(o.errors=i),o}return T(e,t),e.prototype.visitIn=function(r){var n=t.prototype.visitIn.call(this,r),i=n.args,a=n.values;if(a){u.assert(function(){return!n.table},"values and table cannot both be specified for the In operator");for(var o=function(h){u.assert(function(){return h.length===i.length},"args and value tuple are not the same length");for(var v=0,g=h.length;v<g;++v)s.validateCompatibleType(i[v],h[v])},s=this,l=0,c=a;l<c.length;l++)o(c[l])}else{var d=n.table;u.assert(function(){return!!d},"either values or table must be non-null for an In operator"),this.validateIsTableRef(d)}return n},e.prototype.visitCompare=function(r){var n=t.prototype.visitCompare.call(this,r);return this.validateCompatibleType(n.left,n.right),n},e.prototype.visitColumnRef=function(r){if(Ps(r.source))return mt.getSubqueryExpression(r,this.context)||this.register(18),r;var i=me(r);return i&&this.validateColumnExpr(i),r},e.prototype.visitMeasureRef=function(r){var n=me(r);if(n){var i=br(n),a=this.validateEntity(i.schema,i.entity);if(a){var o=a.properties.withName(n.measure.name);(!o||1!==o.kind||!this.isQueryable(n))&&this.register(5)}}return r},e.prototype.visitAggr=function(r){var n=t.prototype.visitAggr.call(this,r);return Tu.getColumnRefSQExpr(this.schema,n.arg)&&(this.aggrUtils.isSupportedAggregate(r,this.schema,r.func,null,this.context)||this.register(0)),n},e.prototype.visitGroupRef=function(r){var n=me(r);if(n){var i=br(n),a=this.validateEntity(i.schema,i.entity);if(a){var o=a.properties.withName(n.groupingColumn.name);(!o||0!==o.kind||!this.validateExprSequence(r.groupedExprs)||!o.column.groupingMetadata||!this.isQueryable(n))&&this.register(4)}}return r},e.prototype.visitHierarchy=function(r){var n=me(r);if(n){var i=n.hierarchy;i?this.validateHierarchy(i.schema,i.entity,i.name):this.register(6)}return r},e.prototype.visitHierarchyLevel=function(r){var n=me(r);if(n){var i=n.hierarchyLevel,a=n.columnHierarchyLevelVariation;i?this.validateHierarchyLevel(i.schema,i.entity,i.name,i.level):a?this.validateHierarchyLevelVariation(a):this.register(7)}return r},e.prototype.visitPercentile=function(r){if(r.arg.accept(this),_.isEmpty(this.errors)){var n=r.arg.getMetadata(this.schema,this.context);(!n||0!==n.kind||!n.type||!n.type.integer&&!n.type.numeric)&&this.register(12)}return r},e.prototype.visitRangePercent=function(r){return(r.percent>1||r.percent<0)&&this.register(13),r.min.accept(this),r.max.accept(this),r},e.prototype.visitDiscretize=function(r){return r.source.accept(this),r.count<=0&&this.register(16),r},e.prototype.visitEntity=function(r){return this.validateEntity(r.schema,r.entity),r},e.prototype.visitSubqueryRef=function(r){return r},e.prototype.visitNamedQueryRef=function(r){return r},e.prototype.visitContains=function(r){return this.validateStartOrContainsArgs(r.left,r.right),r},e.prototype.visitStartsWith=function(r){return this.validateStartOrContainsArgs(r.left,r.right),r},e.prototype.visitArithmetic=function(r){return this.validateArithmeticTypes(r.operator,r.left,r.right),r},e.prototype.visitScopedEval=function(r){if(r.hasGlobalScope()||r.hasInnerMostScope())return r;for(var n=0,i=r.scope;n<i.length;n++){var a=i[n];Lf(a)||kt(a)||this.register(14)}return r},e.prototype.visitFilteredEval=function(r){r.expression.accept(this),0===_.size(r.filters)&&this.register(17);for(var n=0,i=r.filters;n<i.length;n++){var a=i[n];if(!_.isEmpty(a.target))for(var o=0,s=a.target;o<s.length;o++)s[o].accept(this);a.condition.accept(this)}return r},e.prototype.visitWithRef=function(r){return r},e.prototype.visitTransformTableRef=function(r){return r},e.prototype.visitTransformOutputRoleRef=function(r){return r},e.prototype.visitRoleRef=function(r){return r},e.prototype.visitSummaryValueRef=function(r){return r},e.prototype.visitAllRolesRef=function(r){return r},e.prototype.visitSparklineData=function(r){if(Oa(r.measure)){var n=r.measure.getMetadata(this.schema),i=null==n?void 0:n.type;(null==i||!i.numeric)&&(null==i||!i.integer)&&this.register(5)}else this.register(5);u.assert(function(){return 1===_.size(r.grouping)},"Only support 1 grouping for now"),_.some(r.grouping,function(l){return Oa(l)})&&this.register(3),r.measure.accept(this);for(var a=0,o=r.grouping;a<o.length;a++)o[a].accept(this);return r.scalarKey&&r.scalarKey.accept(this),r},e.prototype.visitNativeVisualCalc=function(r){return r},e.prototype.validateExprSequence=function(r){var n=this;return _.reduce(r,function(i,a){return i&&_.isEmpty(a.validate(n.schema,n.aggrUtils,n.errors,n.context))},!0)},e.prototype.validateStartOrContainsArgs=function(r,n){r.accept(this),n.accept(this),_.isEmpty(this.errors)&&(Le(n)&&n.type.text?this.validateCompatibleType(r,n,!0):this.register(10))},e.prototype.validateArithmeticTypes=function(r,n,i){mt.supportsArithmetic(r,n,this.schema)||this.register(9),mt.supportsArithmetic(r,i,this.schema)||this.register(10)},e.prototype.validateCompatibleType=function(r,n,i){var a=r.getMetadata(this.schema,this.context),o=a&&a.type,s=n.getMetadata(this.schema,this.context),l=s&&s.type;(i?!o||!l||!o.isCompatibleFrom(l):o&&l&&!o.isCompatibleFrom(l))&&this.register(11)},e.prototype.validateEntity=function(r,n){var i=this.schema.schema(r);if(i){var a=i.entities.withName(n);if(a)return a;this.register(2)}else this.register(1)},e.prototype.validateIsTableRef=function(r){1!==r.kind&&0!==r.kind&&this.register(15)},e.prototype.validateHierarchy=function(r,n,i){var a=this.validateEntity(r,n);if(a){var o=a.hierarchies.withName(i);if(o)return o;this.register(6)}},e.prototype.validateHierarchyLevel=function(r,n,i,a){var o=this.validateHierarchy(r,n,i);if(o){var s=o.levels.withName(a);if(s)return s;this.register(7)}},e.prototype.validateHierarchyLevelVariation=function(r){var n=r.source,i=this.schema.schema(n.schema),a=i.findProperty(n.entity,n.name);if(this.validateColumnExpr({column:r.source}),a&&a.column){var s=a.column.variations.withName(r.variationName);if(s){var l=i.findHierarchyByVariation(n.entity,n.name,r.variationName,r.level.name);if(l&&l.levels.withName(r.level.level))return s}this.register(8)}},e.prototype.validateColumnExpr=function(r){var n=r.column,i=this.validateEntity(n.schema,n.entity);if(i){var a=i.properties.withName(n.name);if(a&&0===a.kind&&this.isQueryable(r))return a;this.register(3)}},e.prototype.register=function(r){this.errors||(this.errors=[]),this.errors.push(r)},e.prototype.isQueryable=function(r){var n=br(r);if(r.hierarchyLevel||r.hierarchyLevelAggr){var i=function(t,e){var r=function(t){return t.hierarchyLevel||t.hierarchyLevelAggr||t.columnHierarchyLevelVariation&&t.columnHierarchyLevelVariation.level}(e);if(r)return kd(t,r.schema,r.entity,r.name,r.level)}(this.schema,r);return i&&1!==i.column.queryable}return 1!==this.schema.schema(n.schema).findProperty(n.entity,au(r)).queryable},e}(cu),Tu=function(t){function e(r){var n=t.call(this)||this;return n.schema=r,n}return T(e,t),e.prototype.visitColumnRef=function(r){return r},e.prototype.visitGroupRef=function(r){return r},e.prototype.visitHierarchyLevel=function(r){var n=r.level,i=r.arg,a=i.accept(this);if(i&&ci(i.arg)){var s=a.getTargetEntityForVariation(this.schema,i.arg.name);if(a&&s){var l=a.source.schema,c=je(l,s),f=this.schema.schema(l).findHierarchy(s,i.hierarchy);if(f)for(var d=0,p=f.levels;d<p.length;d++){var h=p[d];if(h.name===n)return new Cr(c,h.column.name)}}}else{var v=i.arg,g=kd(this.schema,v.schema,v.entity,i.hierarchy,r.level);if(g)return new Cr(i.arg,g.column.name)}},e.prototype.visitHierarchy=function(r){return r.arg.accept(this)},e.prototype.visitPropertyVariationSource=function(r){return new Cr(r.arg,r.property)},e.prototype.visitAggr=function(r){return r.arg.accept(this)},e.prototype.visitDefault=function(r){},e.getColumnRefSQExpr=function(r,n){var i=new e(r);return n.accept(i)},e}(Ye),rw=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitEntity=function(r){var n=this.result;this.result=void 0===n||j(n,r)?r:null},e.prototype.visitFilteredEval=function(r){r.expression.accept(this)},e.getEntityExpr=function(r){var n=new e;return r.accept(n),n.result||void 0},e}($t),nw=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitNativeVisualCalc=function(r){},e.prototype.visitDefault=function(r){return r.getTargetEntity().schema},e.getSchemaName=function(r){return r.accept(e.instance)},e.instance=new e,e}(Ye),iw=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitEntity=function(r){return r.variable?je(r.schema,r.entity):r},e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.instance=new e,e}(cu),aw=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r,n,i){return u.assertValue(r,"expr"),u.assert(function(){return di(r)},"should be a native visual calc"),r.accept(e.instance,{expression:n,name:i})},e.prototype.visitNativeVisualCalc=function(r,n){return _u(n.name,n.expression,r.getAnnotations())},e.instance=new e,e}(Zr);function _i(t){var e=new Ln;return t.accept(e),e.malformed?null:Lr(e.keys)}function to(t){var e=new Ln;return t.accept(e),e.malformed?null:Lr(e.values)}function Mp(t){var e=new Ln;return t.accept(e),e.malformed?null:Lr(e.pairs)}function ow(t){if(vt(t))return t;var e=new Ln;if(t.accept(e),!e.malformed){var r=Lr(e.keys),n=Lr(e.values);if(r&&n)return nn(r,[n])}}function sw(t,e){u.assertValue(t,"expr"),u.assertNonEmpty(e,"subsetFieldExprs");var r=new cw(e);return t.accept(r),r.getResult()}function uw(t,e){if(!e||!t)return[];var r=new dw(t);return e.accept(r),r.getValues()}var Ln=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.keys=[],r.values=[],r.pairs=[],r}return T(e,t),e.prototype.visitAnd=function(r){r.left.accept(this),r.right.accept(this)},e.prototype.visitCompare=function(r){0===r.comparison?(u.assert(function(){return r.left instanceof U&&r.right instanceof Fe},"invalid compare expr operands"),this.pairs.push(r),r.left.accept(this),r.right.accept(this)):this.visitDefault(r)},e.prototype.visitIn=function(r){for(var n=0,i=r.args;n<i.length;n++)i[n].accept(this);for(var o=0,s=r.values;o<s.length;o++)for(var c=0,f=s[o];c<f.length;c++)f[c].accept(this)},e.prototype.visitSelectRef=function(r){this.keys.push(r)},e.prototype.visitColumnRef=function(r){this.keys.push(r)},e.prototype.visitGroupRef=function(r){this.keys.push(r)},e.prototype.visitHierarchyLevel=function(r){this.keys.push(r)},e.prototype.visitConstant=function(r){this.values.push(r)},e.prototype.visitArithmetic=function(r){this.keys.push(r)},e.prototype.visitDefault=function(r){this.malformed=!0},e}(Ye),cw=function(t){function e(r){var n=t.call(this)||this;return u.assertNonEmpty(r,"identityFieldExprs"),n.identityFieldExprs=r,n.identityComparisonExprs=[],n.identityComparisonExprCount=0,n}return T(e,t),e.prototype.getResult=function(){var r=this;if(u.assert(function(){return r.identityComparisonExprCount===_.filter(r.identityComparisonExprs,function(s){return!!s}).length},"invariant: this.identityComparisonExprCount should equal to the number of defined elements in this.identityComparisonExprs array"),!this.malformed&&this.identityComparisonExprCount===this.identityFieldExprs.length){for(var n,i=0,a=this.identityComparisonExprs;i<a.length;i++){var o=a[i];n=n?st(n,o):o}return n}},e.prototype.visitAnd=function(r){r.left.accept(this),r.right.accept(this)},e.prototype.visitCompare=function(r){if(0===r.comparison){var n=_.findIndex(this.identityFieldExprs,function(i){return j(r.left,i)});n>=0&&!this.identityComparisonExprs[n]&&(this.identityComparisonExprs[n]=r,this.identityComparisonExprCount++)}else this.visitDefault(r)},e.prototype.visitDefault=function(r){this.malformed=!0},e}(Ye),fw=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitSelectRef=function(r){this.containsSelectRef=!0},e}($t),dw=function(t){function e(r){var n=t.call(this)||this;return n.targetExpr=r,n.orderedValues=[],n}return T(e,t),e.prototype.getValues=function(){return _.uniq(this.orderedValues)},e.prototype.visitAnd=function(r){r.left.accept(this),r.right.accept(this)},e.prototype.visitOr=function(r){r.left.accept(this),r.right.accept(this)},e.prototype.visitCompare=function(r){0===r.comparison&&(r.right instanceof Cr&&j(r.right,this.targetExpr)&&r.left instanceof Fe&&this.orderedValues.push(r.left.value),r.left instanceof Cr&&j(r.left,this.targetExpr)&&r.right instanceof Fe&&this.orderedValues.push(r.right.value))},e.prototype.visitIn=function(r){var n=-1;if(!r.table){for(var i=0;i<r.args.length;i++)if(j(r.args[i],this.targetExpr)){n=i;break}if(-1!==n)for(var a=0,o=r.values;a<o.length;a++){var l=o[a][n];l instanceof Fe&&this.orderedValues.push(l.value)}}},e}(Ye);function Pu(t){return JSON.stringify(t.accept(pw.instance))}function Vr(t){for(var e="[",r=0,n=t.length;r<n;r++)r>0&&(e+=","),e+=Pu(t[r]);return e+"]"}var pw=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitColumnRef=function(r){return{col:{s:r.source.accept(this),r:r.ref}}},e.prototype.visitMeasureRef=function(r){return{measure:{s:r.source.accept(this),r:r.ref}}},e.prototype.visitNativeMeasure=function(r){var n={l:r.language,e:r.expression,t:r.dataType};return r.proposedName&&(n.p=r.proposedName),r.expressionContentCache&&(n.c={}),r.expressionContentCache.dependencies&&(n.c.d=Vr(r.expressionContentCache.dependencies)),null!=r.expressionContentCache.unrecognizedIdentifiers&&(n.c.u=r.expressionContentCache.unrecognizedIdentifiers),{nativeMeasure:n}},e.prototype.visitNativeColumn=function(r){var n={l:r.language,e:r.expression,t:r.dataType,s:r.source.accept(this),f:r.format};return r.proposedName&&(n.p=r.proposedName),r.expressionContentCache&&(n.c={}),r.expressionContentCache.dependencies&&(n.c.d=Vr(r.expressionContentCache.dependencies)),null!=r.expressionContentCache.unrecognizedIdentifiers&&(n.c.u=r.expressionContentCache.unrecognizedIdentifiers),{nativeColumn:n}},e.prototype.visitAggr=function(r){return{agg:{a:r.arg.accept(this),f:r.func}}},e.prototype.visitEntity=function(r){return u.assertValue(r,"expr"),u.assertValue(r.entity,"expr.entity"),{e:r.entity}},e.prototype.visitHierarchyLevel=function(r){return{h:r.arg.accept(this),l:r.level}},e.prototype.visitHierarchy=function(r){return{e:r.arg.accept(this),h:r.hierarchy}},e.prototype.visitPropertyVariationSource=function(r){return{e:r.arg.accept(this),n:r.name,p:r.property}},e.prototype.visitAnd=function(r){return u.assertValue(r,"expr"),{and:{l:r.left.accept(this),r:r.right.accept(this)}}},e.prototype.visitCompare=function(r){return u.assertValue(r,"expr"),{comp:{k:r.comparison,l:r.left.accept(this),r:r.right.accept(this)}}},e.prototype.visitConstant=function(r){return u.assertValue(r,"expr"),{const:{t:r.type.primitiveType,v:hw(r.value)}}},e.prototype.visitArithmetic=function(r){return u.assertValue(r,"expr"),{arithmetic:{o:r.operator,l:r.left.accept(this),r:r.right.accept(this)}}},e.prototype.visitScopedEval=function(r){return u.assertValue(r,"expr"),{scopedEval:{e:r.expression.accept(this),s:Vr(r.scope)}}},e.prototype.visitFilteredEval=function(r){var n=this;return u.assertValue(r,"expr"),{filteredEval:{e:r.expression.accept(this),f:"[".concat(_.map(r.filters,function(a){return JSON.stringify((o=a,s={},_.isEmpty(o.target)||(s.t=_.map(o.target,function(l){return l.accept(n)})),s.c=o.condition.accept(n),s));var o,s}).join(", "),"]")}}},e.prototype.visitWithRef=function(r){return u.assertValue(r,"expr"),{withRef:{e:r.expressionName}}},e.prototype.visitTransformTableRef=function(r){return u.assertValue(r,"expr"),{transformTableRef:{source:r.source}}},e.prototype.visitTransformOutputRoleRef=function(r){u.assertValue(r,"expr");var n={transformOutputRoleRef:{role:r.role}};return r.transform&&(n.transformOutputRoleRef.transform=r.transform),n},e.prototype.visitFloor=function(r){u.assertValue(r,"expr");var n={floor:{a:r.arg.accept(this),s:r.size}};return null!=r.timeUnit&&(n.floor.timeunit=r.timeUnit),n},e.prototype.visitRoleRef=function(r){return u.assertValue(r,"expr"),{roleRef:{role:r.role}}},e.prototype.visitSummaryValueRef=function(r){return u.assertValue(r,"expr"),{summaryValueRef:{name:r.name}}},e.prototype.visitAllRolesRef=function(r){return u.assertValue(r,"expr"),{allRolesRef:{}}},e.prototype.visitNot=function(r){return u.assertValue(r,"expr"),{not:r.arg.accept(this)}},e.prototype.visitIn=function(r){return u.assertValue(r,"expr"),{in:{c:Vr(r.args),v:_.map(r.values,function(n){return Vr(n)})}}},e.prototype.visitSelectRef=function(r){return u.assertValue(r,"expr"),{n:r.expressionName}},e.prototype.visitSparklineData=function(r){var n;return u.assertValue(r,"expr"),{sparklineData:{m:r.measure.accept(this),g:Vr(r.grouping),s:null===(n=r.scalarKey)||void 0===n?void 0:n.accept(this)}}},e.prototype.visitDefault=function(r){u.assertFail("Unexpected expression type found in DataViewScopeIdentity.")},e.instance=new e,e}(Ye);function hw(t){return Hs(t)?Ue.fromDateWithEpochValue(t):t}function Ii(t,e,r){return(t=t||null)===(e=e||null)||!t==!e&&(u.assertValue(t,"x"),u.assertValue(e,"y"),j(t.expr,e.expr,r))}function Et(t){return new Dp(t)}var Dp=function(){function t(e){this.kind=1,u.assertValue(e,"expr"),this._expr=e,this._key=new Hr(function(){return Pu(e)})}return Object.defineProperty(t.prototype,"expr",{get:function(){return this._expr},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();Kt(Dp.prototype);var Ap=function(){function t(e){this.kind=2,u.assertValue(e,"scopeExprs"),this._exprs=e,this._key=new Hr(function(){return Vr(e)})}return Object.defineProperty(t.prototype,"exprs",{get:function(){return this._exprs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();function Sw(t,e){var r=_i(e.expr);return!!r&&mt.sequenceEqual(t.exprs,r)}function _p(t){return new Ip(t)}Kt(Ap.prototype);var Ip=function(){function t(e){this.kind=3,u.assertValue(e,"exprs"),this._exprs=e,this._key=new Hr(function(){return Vr(e)})}return Object.defineProperty(t.prototype,"exprs",{get:function(){return this._exprs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();function Tp(t,e){switch(u.assertValue(t,"DataViewWildcard.matches - wildcard"),t.matchingOption){case 0:return!0;case 1:return!e;case 2:return e;default:u.assertFail("DataViewWildcard.matches - Unsupported matchingOption")}}function Fu(t){return null==t&&(t=0),new Pp(t)}Kt(Ip.prototype);var Pp=function(){function t(e){var r=this;this.kind=4,u.assertValue(e,"matchingOption"),this._matchingOption=e,this._key=new Hr(function(){return JSON.stringify(r._matchingOption)})}return Object.defineProperty(t.prototype,"matchingOption",{get:function(){return this._matchingOption},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key.getValue()},enumerable:!1,configurable:!0}),t}();function Bt(t){return null!=t&&1===t.kind}function Mr(t){return null!=t&&3===t.kind}function tr(t){return null!=t&&2===t.kind}function rr(t){return null!=t&&0===t.kind}function xr(t){return null!=t&&4===t.kind}function Bn(t){return!(!t||!t.data)&&t&&t.data&&1===t.data.length&&xr(t.data[0])}function Rp(t){if(t&&!_.isEmpty(t.data)){for(var e=t.data.length,r=new Array(e),n=0;n<e;n++){var i=t.data[n];if(!Bt(i))return;r[n]=i}return r}}function Cw(t){if(t&&t.dataMap){var e=[];for(var r in t.dataMap){var n=hr(t.dataMap[r]);e.push.apply(e,n||[])}return e}}function Ru(t,e){if(!_.isEmpty(t)){var r=Np(t);if(!_.isEmpty(r))return function(t,e){if(!_.isEmpty(t)){for(var r,n=0,i=t;n<i.length;n++){var a=i[n],o=ow(a);r=r?xi(r,o):o||a}return r&&e&&(r=Xa(r)),function(t){var e=new fw;return t.accept(e),!!e.containsSelectRef}(r)?void u.assertFail("SelectRef based identities can not be translated into a filter without additional context."):Qe.fromSQExpr(r)}}(r,e)}}function ww(t){return Ru(_.map(t,function(e){return Dr(e)}))}function Np(t){if(!_.isEmpty(t)){for(var e=[],r=function(o,s){var l=t[o];u.assert(function(){return!!l},"There is an undefined selector in a list of selectors");var c=null==l?void 0:l.data,f=void 0;if(!_.isEmpty(c))for(var d=0,p=c.length;d<p;d++)f=st(f,(null==l?void 0:l.data[d]).expr);f&&e.push(f)},n=0,i=t.length;n<i;n++)r(n);return e}}function Vw(t){if(!_.isEmpty(t))for(var e=0,r=t;e<r.length;e++){var n=r[e];if(n.dataMap)for(var i in n.dataMap){var a=n.dataMap[i];if(!_.isEmpty(a)&&_.some(a,function(o){return null!=o}))return!0}}}function Ct(t,e,r){return(t=t||null)===(e=e||null)||!(!t!=!e||(u.assertValue(t,"x"),u.assertValue(e,"y"),t.metadata!==e.metadata)||!kp(t.data,e.data)||t.highlightMatching!==e.highlightMatching||(null==r||!r.skipId)&&t.id!==e.id||(null==r||!r.skipOrder)&&t.order!==e.order)}function kp(t,e){if((t=t||null)===(e=e||null))return!0;if(!t!=!e||t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(!Nu(t[r],e[r]))return!1;return!0}function Lp(t,e){return(t=t||null)===(e=e||null)||!t==!e&&Ct(Dr(t),Dr(e))}function Mw(t,e){if((t=t||null)===(e=e||null))return!0;if(!t!=!e||t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!Lp(t[r],e[r]))return!1;return!0}function Nu(t,e){return Bt(t)&&Bt(e)?Ii(t,e):Mr(t)&&Mr(e)||tr(t)&&tr(e)?function(t,e){return t===e||mt.sequenceEqual(t.exprs,e.exprs)}(t,e):rr(t)&&rr(e)?function(t,e){return t.key&&e.key&&t.key===e.key&&Ae(t.roles,e.roles,function(r,n){return r===n})}(t,e):!(!xr(t)||!xr(e))&&function(t,e){return!t&&!e||!(!t||!e)&&(u.assertValue(t,"x"),u.assertValue(e,"y"),t===e||t.matchingOption===e.matchingOption)}(t,e)}function Bp(t){var e;if(t.data)if(t.data.length>0){e="data: [".concat(t.data[0].key);for(var r=1,n=t.data.length;r<n;r++)e+=", ".concat(t.data[r].key);e+="]"}else e="data: []";var i=t.metadata;i&&(e?e+=", metadata: "+i:e="metadata: "+i);var a=t.id;return a&&(e?e+=", id: "+a:e="id: "+a),e?"{"+e+"}":"{}"}function ku(t,e){if(_.isEmpty(t.data))return["{}"];var r=[];if(e)r=_.map(t.data,function(s){return s.key});else for(var n=0,i=t.data;n<i.length;n++){var a=i[n];if(Bt(a)){var o=_i(a.expr);o=o||to(a.expr),_.forEach(o,function(s){r.push(Pu(s))})}}return r}function ro(t){u.assertValue(t,"selector");var e=t.data;return!!e&&_.some(e,function(r){return rr(r)||Mr(r)||xr(r)})}function no(t){u.assertValue(t,"selector");var e=t.data;if(_.isEmpty(e))return!1;for(var r=0,n=e;r<n.length;r++)if(rr(n[r]))return!0;return!1}function Dr(t){if(t){var e=[];for(var r in t.dataMap)for(var i=0,a=hr(t.dataMap[r]);i<a.length;i++)e.push(a[i]);var s={};return e.length>0&&(s.data=e),t.metadata&&(s.metadata=_.head(t.metadata)),t.id&&(s.id=t.id),s}}function nr(t,e){if(t&&t.metadata){u.assertNonEmpty(e,"getSelectorTargetExpr - selectTransforms");var r=_.find(e,function(n){return n.queryName===t.metadata});if(r)return r.expr}}function xw(t){return u.assertAnyValue(t,"selector"),t&&t.data?{data:t.data}:t}function Dw(t){var e={};return t.data&&(e.data=Ee([],t.data,!0)),t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),void 0!==t.highlightMatching&&(e.highlightMatching=t.highlightMatching),null!=t.order&&(e.order=t.order),e}function Lu(t,e){return!t&&!e||!(!t||!e||t.displayName!==e.displayName||t.queryName!==e.queryName||t.isMeasure!==e.isMeasure||t.type!==e.type||t.sort!==e.sort)}Kt(Pp.prototype);var io=function(t){return t[t.Default=0]="Default",t[t.Verbose=1]="Verbose",t[t.WholeUnits=2]="WholeUnits",t[t.DataLabels=3]="DataLabels",t}({});function Bu(t,e,r,n){if(u.assertAnyValue(t,"object"),u.assertValue(e,"propertyName"),!t)return r;if(n){var i=t.$instances;if(!i)return r;var a=i[n];if(!a)return r;t=a}var o=t[e];return void 0===o?r:o}function ir(t,e,r,n){return u.assertAnyValue(t,"objects"),u.assertValue(e,"propertyId"),u.assert(function(){return"$"!==e.propertyName.charAt(0)},"Properties starting with $ are reserved."),t?Bu(t[e.objectName],e.propertyName,r,n):r}function $e(t,e,r,n){var i;for(var a in u.assertValue(t,"DataViewObjects.mergeObjects - destination"),u.assertValue(e,"DataViewObjects.mergeObjects - source"),e){var o=e[a];if(null!=o){var s=t[a];if(!s){null==r?t[a]=o:(t[a]={$instances:(i={},i[r]=o,i)},null!=n&&(t[a].$instances[r].$order=n));continue}Up(s,o,r,n)}}}function Up(t,e,r,n){if(u.assertValue(t,"DataViewObjects.mergeObject - destination"),u.assertValue(e,"DataViewObjects.mergeObject - source"),u.assert(function(){return null==e.$instances},"DataViewObjects.mergeObject - source should not include $instances"),r){var i=t.$instances;null==i&&(i=t.$instances={});var a=i[r];a||(a=i[r]={}),Up(a,e,null),null!=n&&(a.$order=n)}else for(var o in e)"$instances"!==o&&"$order"!==o&&null!=e[o]&&(t[o]=e[o])}var Ti=function(){function t(){}return t.prototype._ensureIncludeZero=function(){this.includeZero&&(this.min>0&&!this.hasFixedMin&&(this.min=0),this.max<0&&!this.hasFixedMax&&(this.max=0))},t.prototype._ensureNotEmpty=function(){if(this.min===this.max)if(this.min){var e=this.min,r=gr(Math.abs(e)),n=void 0;r>=0&&r<4?(n=.5,this.forcedSingleStop=e):(n=vr(r)/2,this.forcedSingleStop=null),this.min=e-n,this.max=e+n}else this.min=0,this.max=t.DEFAULT_MAX,this.hasFixedMin=!0,this.hasFixedMax=!0},t.prototype._ensureDirection=function(){if(this.min>this.max){var e=this.min;this.min=this.max,this.max=e}},t.prototype.getSize=function(){return this.max-this.min},t.prototype.shrinkByStep=function(e,r){u.assertValue(e,"range"),u.assert(function(){return r>0},"step");var n=this.min/r,i=e.min/r,a=Math.floor(i-n);this.min+=a*r,n=this.max/r,i=e.max/r,a=Math.ceil(i-n),this.max+=a*r},t.calculate=function(e,r,n,i,a){u.assert(function(){return e<=r},"dataMin should be less or equal to dataMax."),u.assert(function(){return!n||!i||n<=i},"fixedMin should be less or equal to fixedMax.");var o=new t;return o.includeZero=!!a,o.hasDataRange=Un(e)&&Un(r),o.hasFixedMin=Un(n),o.hasFixedMax=Un(i),e=si(e,t.MIN_SUPPORTED_DOUBLE,t.MAX_SUPPORTED_DOUBLE),r=si(r,t.MIN_SUPPORTED_DOUBLE,t.MAX_SUPPORTED_DOUBLE),o.hasFixedMin&&o.hasFixedMax?(o.min=n,o.max=i):o.hasFixedMin?(o.min=n,o.max=r>n?r:n):o.hasFixedMax?(o.min=e<i?e:i,o.max=i):o.hasDataRange?(o.min=e,o.max=r):(o.min=0,o.max=0),o._ensureIncludeZero(),o._ensureNotEmpty(),o._ensureDirection(),0===o.min?o.hasFixedMin=!0:0===o.max&&(o.hasFixedMax=!0),o},t.calculateDataRange=function(e,r,n){return Un(e)&&Un(r)?t.calculate(e,r,null,null,n):t.calculateFixedRange(0,t.DEFAULT_MAX)},t.calculateFixedRange=function(e,r,n){u.assertValue(e,"fixedMin"),u.assertValue(r,"fixedMax");var i=new t;return i.hasDataRange=!1,i.includeZero=n,i.min=e,i.max=r,i._ensureIncludeZero(),i._ensureNotEmpty(),i._ensureDirection(),i.hasFixedMin=!0,i.hasFixedMax=!0,i},t.DEFAULT_MAX=10,t.MIN_SUPPORTED_DOUBLE=-1e307,t.MAX_SUPPORTED_DOUBLE=1e307,t}();function Un(t){return null!=t}var Ar=function(){function t(){}return t.calculate=function(e,r,n,i,a,o){u.assertValue(e,"range"),u.assert(function(){return void 0===r||r>=t.MIN_COUNT&&r<=t.MAX_COUNT},"expectedCount"),u.assert(function(){return void 0===i||i>=-308&&i<=308},"minPower"),u.assert(function(){return void 0===n||n>=0},"maxAllowedMargin");var s=new t;if(r=void 0===r?10:si(r,t.MIN_COUNT,t.MAX_COUNT),void 0===i&&(i=-308),void 0===a&&(a=!1),void 0===n&&(n=1),void 0===o&&(o=[1,2,5]),e.forcedSingleStop)return s.interval=e.getSize(),s.intervalOffset=s.interval-(e.forcedSingleStop-e.min),s.min=e.min,s.max=e.max,s.sequence=[e.forcedSingleStop],s;var m,l=0,c=0,f=9,d=n>0&&!e.hasFixedMin,p=n>0&&!e.hasFixedMax,v=gr(e.getSize()),g=gr(o[0]);if(v-=g,v-=gr(r),v=Math.max(v,i-g+1),0!==l){var S=vr(v),b=Af(e.min,S),E=_f(e.max,S);(C=Ti.calculateFixedRange(b,E)).shrinkByStep(e,l),c=C.min,f=C.max,m=Math.floor(C.getSize()/l)}else{var w=void 0;for(w=0;w<3;w++){for(var M=v+w,V=(S=vr(M),b=Af(e.min,S),E=_f(e.max,S),o.length),D=vr(M-1),A=0;A<V;A++){var C,P=o[A]*D;if((C=Ti.calculateFixedRange(b,E,a)).shrinkByStep(e,P),d&&e.min===C.min&&n>=1&&(C.min-=P),p&&e.max===C.max&&n>=1&&(C.max+=P),(m=Or(C.getSize()/P,Br))<=r||2===w&&A===V-1||1===r&&2===m&&(P>e.getSize()||e.min<0&&e.max>0&&2*P>=e.getSize())){l=P,c=C.min,f=C.max;break}}if(0!==l)break}}(m>32*r||m>t.MAX_COUNT)&&(l=(f-c)/(m=Math.min(32*r,t.MAX_COUNT))),s.min=c,s.max=f,s.interval=l,s.intervalOffset=c-e.min,s.maxAllowedMargin=n,s.canExtendMin=d,s.canExtendMax=p;var F=Ur(l,0);s.precision=F;var N=[],J=ga(c,F);for(N.push(J),A=0;A<m;A++)J=ga(J+l,F),N.push(J);return s.sequence=N,s.trimMinMax(e.min,e.max),s},t.calculateUnits=function(e,r,n,i){n=si(n,t.MIN_COUNT,t.MAX_COUNT),e===r&&(r=e+1);for(var o=0,s=0,l=i;s<l.length&&!(Or(r/(o=l[s]))-oi(e/o)<=n);s++);var d=-e;d%=o;var p=new t;p.sequence=[];for(var h=e+d;p.sequence.push(h),!(h>=r);h+=o);return p.interval=o,p.intervalOffset=d,p.min=p.sequence[0],p.max=p.sequence[p.sequence.length-1],p},t.prototype.trimMinMax=function(e,r){var n=(e-this.min)/this.interval,i=(this.max-r)/this.interval;(!this.canExtendMin||n>this.maxAllowedMargin&&n>.001)&&(this.min=e),(!this.canExtendMax||i>this.maxAllowedMargin&&i>.001)&&(this.max=r)},t.MIN_COUNT=1,t.MAX_COUNT=1e3,t}(),Fw=function(){function t(e){this.unit=e,this.sequence=[],this.min=new Date("9999-12-31T23:59:59.999Z"),this.max=new Date("0001-01-01T00:00:00.000Z")}return t.prototype.add=function(e){e<this.min&&(this.min=e),e>this.max&&(this.max=e),this.sequence.push(e)},t.prototype.moveToCover=function(e,r){var n=t.getDelta(e,r,this.unit),i=Math.floor(n/this.interval);for(this.min=t.addInterval(this.min,i*this.interval,this.unit),this.sequence=[],this.sequence.push(this.min),this.max=this.min;this.max<r;)this.max=t.addInterval(this.max,this.interval,this.unit),this.sequence.push(this.max)},t.calculate=function(e,r,n,i){switch(i||(i=t.getIntervalUnit(e,r,n)),i){case B.Year:return t.calculateYears(e,r,n);case B.Month:return t.calculateMonths(e,r,n);case B.Week:return t.calculateWeeks(e,r,n);case B.Day:return t.calculateDays(e,r,n);case B.Hour:return t.calculateHours(e,r,n);case B.Minute:return t.calculateMinutes(e,r,n);case B.Second:return t.calculateSeconds(e,r,n);case B.Millisecond:return t.calculateMilliseconds(e,r,n);default:u.assertFail("Unsupported DateTimeUnit")}},t.calculateYears=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return!n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"Expected count is out of range");var i=Ti.calculateDataRange(e.getFullYear(),r.getFullYear(),!1),a=Ar.calculate(Ti.calculate(0,i.max-i.min),n,0,null,null,[1,2,5]),o=Math.floor(i.min/a.interval)*a.interval,s=Ue.fromDateParts(o,0,1);return t.fromNumericSequence(s,a,B.Year)},t.calculateMonths=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=e.getFullYear(),a=r.getFullYear(),o=e.getMonth(),s=12*(a-i)+r.getMonth(),l=Ue.fromDateParts(i,0,1),c=Ar.calculateUnits(o,s,n,[1,2,3,6,12]);return t.fromNumericSequence(l,c,B.Month)},t.calculateWeeks=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var o=(e.getDay()-0+7)%7,s=e.getDate()-o,l=Ue.fromDateParts(e.getFullYear(),e.getMonth(),s),f=Or(t.getDelta(l,r,B.Week)),d=Ar.calculateUnits(0,f,n,[1,2,4,8]);return t.fromNumericSequence(l,d,B.Week)},t.calculateDays=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=Ue.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate()),o=Or(t.getDelta(e,r,B.Day)),s=Ar.calculateUnits(0,o,n,[1,2,7,14]);return t.fromNumericSequence(i,s,B.Day)},t.calculateHours=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=Ue.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate()),a=oi(t.getDelta(i,e,B.Hour)),o=Or(t.getDelta(i,r,B.Hour)),s=Ar.calculateUnits(a,o,n,[1,2,3,6,12,24]);return t.fromNumericSequence(i,s,B.Hour)},t.calculateMinutes=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=Ue.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),a=oi(t.getDelta(i,e,B.Minute)),o=Or(t.getDelta(i,r,B.Minute)),s=Ar.calculateUnits(a,o,n,[1,2,5,10,15,30,60,120,180,360,720,1440]);return t.fromNumericSequence(i,s,B.Minute)},t.calculateSeconds=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=Ue.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()),a=oi(t.getDelta(i,e,B.Second)),o=Or(t.getDelta(i,r,B.Second)),s=Ar.calculateUnits(a,o,n,[1,2,5,10,15,30,60,120,300,600,900,1800,3600]);return t.fromNumericSequence(i,s,B.Second)},t.calculateMilliseconds=function(e,r,n){u.assertValue(e,"dataMin"),u.assertValue(r,"dataMax"),u.assert(function(){return void 0===n||n>=t.MIN_COUNT&&n<=t.MAX_COUNT},"expected count is out of range");var i=Ue.fromDateParts(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()),a=t.getDelta(i,e,B.Millisecond),o=t.getDelta(i,r,B.Millisecond),s=Ar.calculate(Ti.calculate(a,o),n,0);return t.fromNumericSequence(i,s,B.Millisecond)},t.addInterval=function(e,r,n){switch(r=Math.round(r),n){case B.Year:return function(t,e){var r=t.getFullYear(),n=t.getMonth(),i=t.getDate(),a=2===n&&29===i,o=Ue.fromTimeValue(t.getTime());return r+=e,a&&!Op(r)&&(i=28),o.setUTCFullYear(r,n,i),o}(e,r);case B.Month:return function(t,e){var r=t.getFullYear(),n=t.getMonth(),i=t.getDate(),a=Ue.fromTimeValue(t.getTime());return r+=(e-e%12)/12,(n+=e%12)>11&&(n%=12,r++),i=Math.min(i,function(t,e){return Op(t)?Nw[e]:Rw[e]}(r,n)),a.setUTCFullYear(r,n,i),a}(e,r);case B.Week:return function(t,e){return zp(t,7*e)}(e,r);case B.Day:return zp(e,r);case B.Hour:return function(t,e){return Ue.fromTimeValue(t.getTime()+36e5*e)}(e,r);case B.Minute:return function(t,e){return Ue.fromTimeValue(t.getTime()+6e4*e)}(e,r);case B.Second:return function(t,e){return Ue.fromTimeValue(t.getTime()+1e3*e)}(e,r);case B.Millisecond:return function(t,e){return Ue.fromTimeValue(t.getTime()+e)}(e,r)}},t.fromNumericSequence=function(e,r,n){for(var i=new t(n),a=0,o=r.sequence;a<o.length;a++){var l=t.addInterval(e,o[a],n);i.add(l)}return i.interval=r.interval,i.intervalOffset=r.intervalOffset,i},t.getDelta=function(e,r,n){var i=0;switch(n){case B.Year:i=r.getFullYear()-e.getFullYear();break;case B.Month:i=12*(r.getFullYear()-e.getFullYear())+r.getMonth()-e.getMonth();break;case B.Week:i=(r.getTime()-e.getTime())/6048e5;break;case B.Day:i=(r.getTime()-e.getTime())/864e5;break;case B.Hour:i=(r.getTime()-e.getTime())/36e5;break;case B.Minute:i=(r.getTime()-e.getTime())/6e4;break;case B.Second:i=(r.getTime()-e.getTime())/1e3;break;case B.Millisecond:i=r.getTime()-e.getTime()}return i},t.getIntervalUnit=function(e,r,n){n=Math.max(n,2);var i=t.getDelta(e,r,B.Day);if(i>356&&i>=180*n)return B.Year;if(i>58&&i>7*n)return B.Month;if(i>14&&i>2*n)return B.Week;var a=t.getDelta(e,r,B.Hour);if(i>2&&a>12*n)return B.Day;if(a>=24&&a>=n)return B.Hour;var o=t.getDelta(e,r,B.Minute);if(o>2&&o>=n)return B.Minute;var s=t.getDelta(e,r,B.Second);if(s>2&&s>=.8*n)return B.Second;if(t.getDelta(e,r,B.Millisecond)>0)return B.Millisecond;var c=e;return 0!==c.getMilliseconds()?B.Millisecond:0!==c.getSeconds()?B.Second:0!==c.getMinutes()?B.Minute:0!==c.getHours()?B.Hour:1!==c.getDate()?B.Day:0!==c.getMonth()?B.Month:B.Year},t.MIN_COUNT=1,t.MAX_COUNT=1e3,t}(),Rw=[31,28,31,30,31,30,31,31,30,31,30,31],Nw=[31,29,31,30,31,30,31,31,30,31,30,31];function Op(t){return t%4==0&&t%100!=0||t%400==0}function zp(t,e){var r=t.getFullYear(),n=t.getMonth(),i=t.getDate(),a=Ue.fromTimeValue(t.getTime());return a.setUTCFullYear(r,n,i+e),a}var ut={NullValue:"(Blank)",BooleanTrue:"True",BooleanFalse:"False",NaNValue:"NaN",InfinityValue:"+Infinity",NegativeInfinityValue:"-Infinity",RestatementComma:"{0}, {1}",RestatementCompoundAnd:"{0} and {1}",RestatementCompoundOr:"{0} or {1}",DisplayUnitSystem_EAuto_Title:"Auto",DisplayUnitSystem_E0_Title:"None",DisplayUnitSystem_E3_LabelFormat:"{0}K",DisplayUnitSystem_E3_Title:"Thousands",DisplayUnitSystem_E6_LabelFormat:"{0}M",DisplayUnitSystem_E6_Title:"Millions",DisplayUnitSystem_E9_LabelFormat:"{0}bn",DisplayUnitSystem_E9_Title:"Billions",DisplayUnitSystem_E12_LabelFormat:"{0}T",DisplayUnitSystem_E12_Title:"Trillions",Percentage:"#,0.##%",Percentage1:"#,0.#%",TableTotalLabel:"Total",Tooltip_HighlightedValueDisplayName:"Highlighted",Funnel_PercentOfFirst:"Percent of first",Funnel_PercentOfPrevious:"Percent of previous",Funnel_PercentOfFirst_Highlight:"Percent of first (highlighted)",Funnel_PercentOfPrevious_Highlight:"Percent of previous (highlighted)",GeotaggingString_Continent:"continent",GeotaggingString_Continents:"continents",GeotaggingString_Country:"country",GeotaggingString_Countries:"countries",GeotaggingString_State:"state",GeotaggingString_States:"states",GeotaggingString_City:"city",GeotaggingString_Cities:"cities",GeotaggingString_Town:"town",GeotaggingString_Towns:"towns",GeotaggingString_Province:"province",GeotaggingString_Provinces:"provinces",GeotaggingString_County:"county",GeotaggingString_Counties:"counties",GeotaggingString_Village:"village",GeotaggingString_Villages:"villages",GeotaggingString_Post:"post",GeotaggingString_Zip:"zip",GeotaggingString_Code:"code",GeotaggingString_Place:"place",GeotaggingString_Places:"places",GeotaggingString_Address:"address",GeotaggingString_Addresses:"addresses",GeotaggingString_Street:"street",GeotaggingString_Streets:"streets",GeotaggingString_Longitude:"longitude",GeotaggingString_Longitude_Short:"lon",GeotaggingString_Longitude_Short2:"long",GeotaggingString_Latitude:"latitude",GeotaggingString_Latitude_Short:"lat",GeotaggingString_PostalCode:"postal code",GeotaggingString_PostalCodes:"postal codes",GeotaggingString_ZipCode:"zip code",GeotaggingString_ZipCodes:"zip codes",GeotaggingString_Territory:"territory",GeotaggingString_Territories:"territories"},Ww={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},Hp=1e15,Yw=/^([0\#,]*\.[0\#]+|[0\#,]+|g)$/i,$w=function(){function t(){}return t.prototype.project=function(e){return this.value?function(t){return ga(t,Ur(t))}(e/this.value):e},t.prototype.isApplicableTo=function(e){var r=Ur(e=Math.abs(e),3);return function(t,e,r){return r=jt(r,t,e),u.assert(function(){return r>=0},"precision"),t>e||Math.abs(t-e)<r}(e,this.applicableRangeMin,r)&&function(t,e,r){return r=jt(r,t,e),u.assert(function(){return r>=0},"precision"),t<e&&Math.abs(t-e)>r}(e,this.applicableRangeMax,r)},t.prototype.isScaling=function(){return this.value>1},t}(),ao=function(){function t(e){this.units=e||[]}return t.prototype.getUnits=function(e){void 0===e&&(e=!1);var r=_.clone(this.units);return e&&_.remove(r,function(n){return 0===n.value}),r},Object.defineProperty(t.prototype,"title",{get:function(){return this.displayUnit?this.displayUnit.title:void 0},enumerable:!1,configurable:!0}),t.prototype.update=function(e){void 0!==e&&(this.displayUnit=this.findApplicableDisplayUnit(e))},t.prototype.findApplicableDisplayUnit=function(e){for(var r=0,n=this.units;r<n.length;r++){var i=n[r];if(i.isApplicableTo(e))return i}},t.prototype.format=function(e,r,n,i){u.assert(function(){return"number"==typeof e},"value must be a number"),n=this.getNumberOfDecimalsForFormatting(n);var a="";return this.isFormatSupported(r)&&!this.hasScientificFormat(r)&&this.isScalingUnit()&&this.shouldRespectScalingUnit()&&(e=this.displayUnit.project(e),a=this.displayUnit.labelFormat),this.formatHelper(e,a,r,n,i)},t.prototype.isFormatSupported=function(e){return!t.UNSUPPORTED_FORMATS.test(e)},t.prototype.isPercentageFormat=function(e){return e&&e.indexOf("%")>=0},t.prototype.shouldRespectScalingUnit=function(){return!0},t.prototype.getNumberOfDecimalsForFormatting=function(e){return e},t.prototype.isScalingUnit=function(){return this.displayUnit&&this.displayUnit.isScaling()},t.prototype.formatHelper=function(e,r,n,i,a){if(("g"===n||"G"===n)&&null!=i&&(n="#,0.00"),(n=Js(n,i,a))&&!Ge.isStandardNumberFormat(n))return Ge.formatNumberWithCustomOverride(e,n,r);n||(n="G"),r||(r="{0}");var o=Ge.formatValue(e,n);return Ge.format(r,[o])},t.prototype.formatSingleValue=function(e,r,n,i){return this.update(this.shouldUseValuePrecision(e)?Ur(e,8):e),this.format(e,r,n,i)},t.prototype.shouldUseValuePrecision=function(e){if(0===this.units.length)return!0;for(var r=0,n=0,i=this.units;n<i.length;n++){var a=i[n];if(a.isScaling()){r=a.applicableRangeMin;break}}return Math.abs(e)<r},t.prototype.isScientific=function(e){return e<-Hp||e>Hp||-1e-4<e&&e<1e-4&&0!==e},t.prototype.hasScientificFormat=function(e){return e&&(-1!==e.toUpperCase().indexOf("E+")||-1!==e.toUpperCase().indexOf("E-"))},t.prototype.supportsScientificFormat=function(e){return!e||Yw.test(e)},t.prototype.shouldFallbackToScientific=function(e,r){return!this.hasScientificFormat(r)&&this.supportsScientificFormat(r)&&this.isScientific(e)},t.prototype.getScientificFormat=function(e,r,n,i){if(this.isFormatSupported(r)&&this.shouldFallbackToScientific(e,r)){var a=sd(e,r);return n&&(a=Js(a||"0",Math.abs(n),i)),a?a+"E+0":"0.##E+0"}return r},t.UNSUPPORTED_FORMATS=/^(p\d*)|(e\d*)$/i,t}(),Xw=function(t){function e(){return t.call(this,[])||this}return T(e,t),e}(ao),oo=function(t){function e(r){return t.call(this,e.getUnits(r))||this}return T(e,t),e.prototype.format=function(r,n,i,a){return n=this.getScientificFormat(r,n,i,a),t.prototype.format.call(this,r,n,i,a)},e.reset=function(){e.units=null},e.getUnits=function(r){return e.units||(e.units=Uu(r,function(n,i,a){return n-i>=1e3?n/10:a})).length>=1&&(e.units[e.units.length-1].applicableRangeMax=1/0),e.units},e}(ao),Wp=function(t){function e(r){return t.call(this,e.getUnits(r))||this}return T(e,t),e.reset=function(){e.units=null},e.getUnits=function(r){return e.units||(e.units=Uu(r)).length>=1&&(e.units[e.units.length-1].applicableRangeMax=1/0),e.units},e.prototype.format=function(r,n,i,a){return n=this.getScientificFormat(r,n,i,a),t.prototype.format.call(this,r,n,i,a)},e}(ao),jp=function(t){function e(r){return t.call(this,e.getUnits(r))||this}return T(e,t),e.prototype.isFormatSupported=function(r){return!e.UNSUPPORTED_FORMATS.test(r)},e.getUnits=function(r){if(!e.units){var n=[],i=function(s,l,c){return-1===s&&s-l>=1e3?s/10:c},a=r(-1);Ou(n,0,a.title,a.format,i),Ou(n,1,(a=r(0)).title,a.format,i),(e.units=n.concat(Uu(r,i))).length>=1&&(e.units[e.units.length-1].applicableRangeMax=1/0)}return e.units},e.prototype.format=function(r,n,i,a){return n=this.getScientificFormat(r,n,i,a),t.prototype.format.call(this,r,n,i,a)},e.UNSUPPORTED_FORMATS=/^(e\d*)$/i,e}(ao);function Uu(t,e){for(var r=[],n=3;n<24;n++){var i=t(n);i&&Ou(r,vr(n),i.title,i.format,e)}return r}function Ou(t,e,r,n,i){if(r||n){var a=e;if(t.length>0){var o=t[t.length-1];i&&(a=i(e,o.value,a)),o.applicableRangeMax=a}var s=new $w;s.value=e,s.applicableRangeMin=a,s.applicableRangeMax=1e3*a,s.title=r,s.labelFormat=n,t.push(s)}}function Kp(t){zu||(ot.information("allowFormatBeautification used",void 0,{key:t}),zu=!0)}var zu=!1;function tV(t){return ut[t]}var _e={null:ut.NullValue,true:ut.BooleanTrue,false:ut.BooleanFalse,NaN:ut.NaNValue,infinity:ut.InfinityValue,negativeInfinity:ut.NegativeInfinityValue,beautify:function(e){return function(t){var e=Ww[t];return e?(Kp(e),ut[e]||t):t}(e)},describe:function(e){return function(t){var e=-1===t?"Auto":t.toString(),i=ut["DisplayUnitSystem_E"+e+"_Title"],a=t<=0?"{0}":ut["DisplayUnitSystem_E"+e+"_LabelFormat"];if(i||a)return{title:i,format:a}}(e)},restatementComma:ut.RestatementComma,restatementCompoundAnd:ut.RestatementCompoundAnd,restatementCompoundOr:ut.RestatementCompoundOr},oV={displayName:"",type:L.fromPrimitiveTypeAndCategory(7)};function sV(t){return mi(t)}function uV(t){u.assertValue(t,"options"),_e=t,oo.reset(),Wp.reset()}function Jp(t,e){void 0===e&&(e=!1);var r=e?_e.beautify(t):t;return{format:function(i){return null==i?_e.null:Pi(i,r)}}}function lV(t){u.assertValue(t,"options");var e=t.allowFormatBeautification?_e.beautify(t.format):t.format;if(function(t){var e=t.value,r=t.value2,n=t.format,i=t.columnType;if(t.formatSingleValues&&n&&Math.abs(e)<1e4)if(yi(n)){if(If(e))return!1}else if(mi(n,!0).precision<2)return!1;if("number"==typeof e||"number"==typeof r)return!(i&&i.temporal&&i.temporal.year)}(t)){var r=Yp(t.displayUnitSystemType),n=!!t.formatSingleValues;r.update(Math.max(Math.abs(t.value||0),Math.abs(t.value2||0)));var a,i=null!=t.precision;return i?a=-t.precision:r.displayUnit&&r.displayUnit.value>1&&(a=-2),{format:function(l){var c=eh(l,!0);if(!_n(c))return c;var f=Number(l);return f&&!r.isScalingUnit()&&Math.abs(f)<1e3&&!i&&(l=ga(f)),n?r.formatSingleValue(f,e,a,i):r.format(f,e,a,i)},displayUnit:r.displayUnit,options:t}}if(function(t,e,r){return t instanceof Date&&e instanceof Date&&null!=r}(t.value,t.value2,t.tickCount)){var o=Fw.getIntervalUnit(t.value,t.value2,t.tickCount);return{format:function(l){return null==l?_e.null:Pi(l,Ge.dateFormatString(o))},options:t}}return Jp(e)}function qu(t,e,r){return null==t?_e.null:Pi(t,r?_e.beautify(e):e)}function cV(t,e,r,n,i){return!(r&&r.type&&r.type.dateTime)&&t instanceof Date?Pi(t,so(oV,null,!1),i):Pi(t,Xp(e,r,n),i)}function Yp(t){if(null==t)return new oo(_e.describe);switch(t){case io.Default:return new oo(_e.describe);case io.WholeUnits:return new Wp(_e.describe);case io.Verbose:return new Xw;case io.DataLabels:return new jp(_e.describe);default:return u.assertFail("Unknown display unit system type"),new oo(_e.describe)}}function fV(t){return void 0===t&&(t=!1),new jp(_e.describe).getUnits(t)}function so(t,e,r){if(t){if(e){var n=ir(t.objects,e);if(n)return n}if(!r&&t.type)return $p(t.type)}}function $p(t){return u.assertValue(t,"type must be defined"),t.dateTime?"d":t.integer?t.temporal&&t.temporal.year?"0":"g":t.numeric?"#,0.00":void 0}function hV(t,e){if(u.assertAnyValue(e,"format"),void 0!==t)return t;if("g"!==e&&"G"!==e){if(e){var n=mi(gi(e).positive,!0);if(n.hasDots)return n.optionalPrecision?void 0:n.precision}return 0}}function Xp(t,e,r,n){return ir(t,r)||so(e,r,n)}function Zp(t,e){var r;if(!t)return null;var n=t.length;if(n>0){r=t[0];for(var i=n-1,a=1,o=i;a<o;a++)r=Be(_e.restatementComma,r,t[a]);n>1&&(r=Be(e,r,t[i]))}else r=null;return r}function vV(t){return Zp(t,_e.restatementCompoundAnd)}function gV(t){return Zp(t,_e.restatementCompoundOr)}function Pi(t,e,r){var n=eh(t,r||!1);return _n(n)?Ge.formatValue(t,e):n}function eh(t,e){return null==t&&e?_e.null:!0===t?_e.true:!1===t?_e.false:"number"==typeof t&&isNaN(t)?_e.NaN:t===Number.NEGATIVE_INFINITY?_e.negativeInfinity:t===Number.POSITIVE_INFINITY?_e.infinity:""}var uo=function(){function t(e,r,n){this.selector=t.ensureSelector(e),this.highlight=r,this._columnLevelKeys=new Hr(function(){if(e)return ku(e,!1)}),this._identityLevelKeys=new Hr(function(){if(e)return ku(e,!0)}),this.selectorsByColumn=n}return t.fromSelectorsByColumn=function(e){return new t(Dr(e),!1,e)},t.fromSelectorsByColumnAndRoles=function(e,r){var i=new t(Dr(e),!1,e);return i.role=r,i},t.prototype.equals=function(e){return this.selector&&e.selector?this.highlight===e.highlight&&Ct(this.selector,e.selector):!this.selector==!e.selector&&this.highlight===e.highlight},t.isEqual=function(e,r){return e===r||null!=e&&null!=r&&e.equals(r)},t.prototype.includes=function(e,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),!e)return!1;var i=this.selector,a=e.selector;if(!i||!a)return!1;var o=i.data,s=a.data;if(!o&&i.metadata&&i.metadata!==a.metadata||!r&&this.highlight!==e.highlight)return!1;if(o){if(!s)return!1;if(o.length>0)for(var l=function(h,v){var g=o[h];if(n){var y=g.expr;if(!_.some(s,function(m){return function(t,e,r){if(!(t=t||null)!=!(e=e||null))return!1;u.assertValue(t,"thisComparisonExpr"),u.assertValue(e,"otherComparisonIdentity");var i=t,a=Mp(e.expr),o=Mp(i);if(!a||!o)return Ii(Et(i),e,r);for(var s=function(h){if(!_.some(a,function(v){return j(h,v,r)}))return{value:!1}},l=0,c=o;l<c.length;l++){var d=s(c[l]);if("object"==typeof d)return d.value}return!0}(y,m)}))return{value:!1}}else if(!s.some(function(m){return Ii(g,m)}))return{value:!1}},c=0,f=o.length;c<f;c++){var d=l(c);if("object"==typeof d)return d.value}}return!0},t.prototype.getKey=function(){return void 0===this._key&&(this._key="{selector: ".concat(this.selector?this.getSelectorKey():null,", highlight: ").concat(this.highlight,"}")),this._key},t.prototype.getDecomposedKeys=function(e){return e?this._identityLevelKeys.getValue():this._columnLevelKeys.getValue()},t.prototype.getKeyWithoutHighlight=function(){return void 0===this._keyWithoutHighlight&&(this._keyWithoutHighlight="{selector: ".concat(this.selector?this.getSelectorKey():null,"}")),this._keyWithoutHighlight},t.prototype.hasIdentity=function(){return this.selector&&!!this.selector.data},t.prototype.getSelector=function(){return this.selector},t.prototype.getSelectorsByColumn=function(){return this.selectorsByColumn},t.prototype.getSelectorKey=function(){return void 0===this._selectorKey&&(this._selectorKey=Bp(this.selector)),this._selectorKey},t.createNull=function(e){return void 0===e&&(e=!1),new t(null,e)},t.createWithId=function(e,r){void 0===r&&(r=!1);var n=null;return e&&(n={data:[e]}),new t(n,r)},t.createWithMeasure=function(e,r){void 0===r&&(r=!1),u.assertValue(e,"measureId");var i=new t({metadata:e},r);return i.selectorsByColumn={metadata:[e]},i},t.createWithIdAndMeasure=function(e,r,n){void 0===n&&(n=!1);var i={};return e&&(i.data=[e]),r&&(i.metadata=r),!e&&!r&&(i=null),new t(i,n)},t.createWithIdAndMeasureAndCategory=function(e,r,n,i,a){void 0===i&&(i=!1),void 0===a&&(a=[]);var o=this.createWithIdAndMeasure(e,r,i);return o.selector&&(o.selectorsByColumn={},e&&n&&(o.selectorsByColumn.dataMap={},o.selectorsByColumn.dataMap[n]=[e]),r&&(o.selectorsByColumn.metadata=[r]),_.isEmpty(a)||(o.selectorsByColumn.valueDetails=a)),o},t.createWithIds=function(e,r,n){void 0===n&&(n=!1);var i=null,a=t.idArray(e,r);return a&&(i={data:a}),new t(i,n)},t.createWithIdsAndMeasure=function(e,r,n,i){void 0===i&&(i=!1);var a={},o=t.idArray(e,r);return o&&(a.data=o),n&&(a.metadata=n),!e&&!r&&!n&&(a=null),new t(a,i)},t.createWithSelectorForColumnAndMeasure=function(e,r,n,i){void 0===n&&(n=!1),void 0===i&&(i=[]);var a={};return _.isEmpty(e)||(a.dataMap=e),r&&(a.metadata=[r]),!e&&!r&&(a=null),_.isEmpty(i)||(a.valueDetails=i),new t(Dr(a),n,a)},t.createWithSelectorForColumnAndMeasures=function(e,r,n,i){void 0===i&&(i=!1);var a={};return _.isEmpty(e)||(a.dataMap=e),_.isEmpty(r)||(a.metadata=r),n&&(a.valueDetails=n),!e&&_.isEmpty(r)&&(a=null),new t(Dr(a),i,a)},t.createWithHighlight=function(e){u.assertValue(e,"original"),u.assert(function(){return!e.highlight},"!original.highlight");var r=new t(e.getSelector(),!0);return r.selectorsByColumn=e.selectorsByColumn,r},t.idArray=function(e,r){if(e||r){var n=[];return e&&n.push(e),r&&r!==e&&n.push(r),n}},t.ensureSelector=function(e){return e&&e.data&&(e.data=_.uniqWith(e.data,Nu)),e},t}();function On(t,e,r){var i,n=t.format;return{expr:t.expr,get formattedValue(){return void 0===i&&(i=qu(e,n)),i},value:e,identity:r,queryName:t.queryName}}var tt=function(){function t(){}return t.builder=function(){return new t},t.prototype.withColumnIdentity=function(e,r,n){var i;return this.addItemToDataMap(r,e),n&&(this.ensureValueDetails(),(i=this.valueDetails).push.apply(i,n)),this},t.prototype.withCategoryIdentity=function(e,r,n){return e&&e.source&&e.source.queryName&&(this.ensureValueDetails(),this.valueDetails.push(On(e.source,e.values[r],e.identity[r])),this.addItemToDataMap(e.source.queryName,n)),this},t.prototype.withCategory=function(e,r,n,i){if(void 0===i&&(i=!1),function(t){return t&&void 0!==t.length}(e)){if(i&&n)for(var a=0,o=e;a<o.length;a++)this.addCategoryValueDetails(o[a],r);e[0]&&n&&e[0].identity&&this.addItemToDataMap(n,e[0].identity[r])}else i&&this.addCategoryValueDetails(e,r),e&&e.source&&e.source.queryName&&e.identity&&this.addItemToDataMap(e.source.queryName,e.identity[r]);return this},t.prototype.addCategoryValueDetails=function(e,r){e&&e.source&&e.source.queryName&&e.identity&&(this.ensureValueDetails(),this.valueDetails.push(On(e.source,e.values[r],e.identity[r])))},t.prototype.withSeries=function(e,r,n){return void 0===n&&(n=!1),e&&e.source&&e.source.queryName&&r&&(n&&function(t){return t&&t.values&&t.values[0]&&!!t.values[0].values}(r)&&(this.ensureValueDetails(),this.valueDetails.push(On(e.source,r.name,r.identity))),this.addItemToDataMap(e.source.queryName,r.identity)),this},t.prototype.withMeasure=function(e,r,n){if(this.ensureMeasures(),null!=e&&this.measures.push(e),r&&r.source.queryName===e)if(this.ensureValueDetails(),n>=0)this.valueDetails.push(On(r.source,r.values[n],void 0));else for(var i=0,a=r.values;i<a.length;i++)this.valueDetails.push(On(r.source,a[i],void 0));return this},t.prototype.withMeasures=function(e){this.ensureMeasures();for(var r=0,n=e;r<n.length;r++)this.measures.push(n[r]);return this},t.prototype.createSelectionId=function(){return uo.createWithSelectorForColumnAndMeasures(this.dataMap,this.measures,this.valueDetails)},t.prototype.clone=function(){var e=new t,r=this.dataMap;if(r){var n=e.dataMap={};for(var i in this.dataMap)n[i]=Ee([],r[i]||[],!0)}return this.measures&&(e.measures=Ee([],this.measures||[],!0)),e},t.prototype.ensureMeasures=function(){void 0===this.measures&&(this.measures=[])},t.prototype.ensureValueDetails=function(){void 0===this.valueDetails&&(this.valueDetails=[])},t.prototype.addItemToDataMap=function(e,r){if(r){this.dataMap||(this.dataMap={});var n=this.dataMap,i=n[e];if(null==i)return void(n[e]=[r]);i.push(r)}},t}();function wt(t,e){for(var r,n=e.split(".");r=n.shift();){if(!t||null==t[r])return!1;t=t[r]}return!0}var lo="noQueryName",oe=function(){function t(e,r,n,i){this.deepestNodeLevelInPath=-1,this.measures=r||[],this.dataMap=e||null,this.nodeIsCollapsed=null!=n?n:null,this.nodeIndexes=null!=i?i:[]}return t.prototype.withCategory=function(e,r,n){var i,a;return void 0===n&&(n=!1),e&&e.source&&e.identity&&e.identity[r]&&(i=e.identity[r],a=e.source.queryName||lo),this.addItemToDataMap(a,i),this},t.prototype.withSeries=function(e,r,n){var i,a;return void 0===n&&(n=!1),e&&e.source&&r&&(i=r.identity,a=e.source.queryName||lo),this.addItemToDataMap(a,i),this},t.prototype.withMeasure=function(e){return this.measures.push(e),this},t.prototype.withMatrixNode=function(e,r,n){if(void 0===n&&(n=!1),!e)return this;var i,a,s=e.level;return e.identity&&r&&r[s]&&r[s].sources&&r[s].sources[0]&&(i=e.identity,a=r[s].sources[0].queryName||lo),this.addItemToDataMap(a,i,e.isCollapsed,s,e.nodeIndex),this},t.prototype.withTable=function(e,r,n){var i,a;return void 0===n&&(n=!1),e&&e.identity&&null!=r&&(a=(i=e.identity[r])?JSON.stringify(i):lo),this.addItemToDataMap(a,i),this},t.prototype.equals=function(e){var r=e;return!!(this.compareMeasures(this.measures,r.measures)&&this.compareMetadata(this.getSelector(),r.getSelector())&&this.compareMetadata(r.getSelector(),this.getSelector()))},t.prototype.createSelectionId=function(e){return this.key=JSON.stringify(this.dataMap)+JSON.stringify(this.measures),this},t.prototype.getKey=function(){return this.key},t.prototype.includes=function(e,r){void 0===r&&(r=!1);var n=e;return!!(!this.dataMap&&this.compareMeasures(this.measures,n.measures)||this.dataMap&&n.dataMap&&this.compareMetadata(this.getSelector(),n.getSelector()))},t.prototype.hasIdentity=function(){return!!this.dataMap},t.prototype.compareMeasures=function(e,r){if(e.length!==r.length)return!1;for(var n=0,i=r;n<i.length;n++)if(-1===e.indexOf(i[n]))return!1;return!0},t.prototype.compareMetadata=function(e,r){if(!e.data&&r.data||e.data&&!r.data)return!1;if(!e.data&&!r.data)return!0;for(var n=function(c){if(!r.data.some(function(f){return JSON.stringify(f)===JSON.stringify(c)}))return{value:!1}},i=0,a=e.data;i<a.length;i++){var s=n(a[i]);if("object"==typeof s)return s.value}return!0},t.prototype.addItemToDataMap=function(e,r,n,i,a){if(r){this.dataMap||(this.dataMap={});var o=this.dataMap,s=o[e];if(null==s)return o[e]=[r],null!=n&&null!=i&&i>this.deepestNodeLevelInPath&&(this.nodeIsCollapsed=n,this.deepestNodeLevelInPath=i),void(null!=a&&this.nodeIndexes.push(a));s.push(r)}},t.prototype.getSelector=function(){var e=this,r={data:void 0,metadata:_.head(this.measures)};if(this.dataMap){r.data=[];var n=function(s){u.assert(function(){return e.dataMap[s].length<=1},"dataMap can only have one selector per column"),r.data.push(i.dataMap[s][0])},i=this;for(var a in this.dataMap)n(a)}return r},t.prototype.getSelectorsByColumn=function(){return null},t}();function Ut(t,e,r){if(u.assertValue(t,"fullString"),u.assertValue(e,"from"),u.assertValue(r,"length"),u.assert(function(){return e>=0},"from >= 0"),u.assert(function(){return r>=0},"length >= 0"),u.assert(function(){return e+r<=t.length},"(from + length) <= fullString.length"),0===r)return null;for(var n=0,i=0,a=e+r-1;i<r;i++,a--){var o=t.charCodeAt(a)-48;if(o<0||9<o)return null;n+=o*vr(i)}return n}var yV={major:0,minor:0,patch:0};function Ot(t){u.assertValue(t,"versionString");for(var i,e=0,r=0,n=0,a=0,o=0,s=0,l=t.length;o<=l;o++){var c=o===l?46:t.charCodeAt(o);switch(c){case 46:case 45:if(o===s)return;var f=Ut(t,s,o-s);if(null==f)return;switch(a){case 0:e=f;break;case 1:r=f;break;case 2:n=f;break;default:return}if(a++,s=o+1,45===c){if(3!==a||!mV(i=t.substr(o+1)))return;o=l}break;default:if(c<48||c>57)return}}var d={major:e,minor:r,patch:n};return i&&(d.prerel=i),d}function mV(t){u.assertValue(t,"prerel");for(var e=0,r=t.length;e<r;e++){var n=t.charCodeAt(e);if(!(65<=n&&n<=90||97<=n&&n<=122||48<=n&&n<=57||45===n||46===n))return!1}return!0}function sn(t,e){return u.assertValue(t,"v1"),u.assertValue(e,"v2"),co(Vt(t),Vt(e))>0}function _r(t,e){return u.assertValue(t,"v1"),u.assertValue(e,"v2"),co(Vt(t),Vt(e))<0}function th(t,e){return u.assertValue(t,"v1"),u.assertValue(e,"v2"),co(Vt(t),Vt(e))>=0}function rh(t,e){return u.assertValue(t,"v1"),u.assertValue(e,"v2"),t=Vt(t),e=Vt(e),!co(Vt(t),Vt(e))}function Vt(t){return _.isString(t)?Ot(t)||yV:t}function co(t,e){var r=fo(t.major,e.major);return r||(r=fo(t.minor,e.minor))||(r=fo(t.patch,e.patch))?r:function(t,e){var r=_.isEmpty(t),n=_.isEmpty(e);if(r)return n?0:1;if(n)return-1;var i=Ut(t,0,t.length),a=Ut(e,0,e.length);return null!=i?null!=a?fo(i,a):-1:null!=a?1:t.localeCompare(e)}(t.prerel,e.prerel)}function fo(t,e){var r=(t=t||0)-(e=e||0);return 0===r?0:r<0?-1:(u.assert(function(){return r>0},"diff > 0"),1)}var ze=function(){function t(e,r){void 0===r&&(r=!1),this.dataPointObjectName="dataPoint",this.filterPropertyIdentifier={objectName:"general",propertyName:"filter"},this.hostServices=e.hostServices,this.apiVersion=e.apiVersion,this.selectedIds=[],this.promiseFactory=this.hostServices.promiseFactory(),this.noIframe=r}return t.prototype.select=function(e,r){void 0===r&&(r=!1);var n=this.promiseFactory.defer();return e?(e instanceof Array||(e=[e]),this.hostServices.shouldRetainSelection()?this.sendSelectionToHost(e,r):(this.selectInternal(e,r),this.sendSelectionToHost(this.selectedIds,r)),n.resolve(this.selectedIds),n.promise):(n.reject(),n.promise)},t.prototype.showContextMenu=function(e,r,n){var i=this.promiseFactory.defer();return e||(e={}),this.sendContextMenuToHost(e,r,n),i.resolve(null),i.promise},t.prototype.toggleExpandCollapse=function(e,r){var n=this.promiseFactory.defer();return this.sendExpandCollapseToHost(e,!0===r),n.resolve(null),n.promise},t.prototype.hasSelection=function(){return this.selectedIds.length>0},t.prototype.clear=function(){var e=this.promiseFactory.defer();return this.selectedIds=[],this.sendSelectionToHost([]),e.resolve(null),e.promise},t.prototype.getSelectionIds=function(){return this.selectedIds},t.prototype.setSelectionIds=function(e){this.selectedIds=e},t.prototype.sendSelectionToHost=function(e,r){if(this.noIframe||!this.apiVersion||_r(this.apiVersion,"2.0.0")){var n=this.dataPointObjectName,i={type:0,visualObjects:_.chain(e).filter(function(o){return o.hasIdentity()}).map(function(o){return{objectName:n,selectorsByColumn:o.getSelectorsByColumn()}}).value(),selectors:void 0,selectionMode:r?3:0},a=!1;_.isEmpty(e)||(a=e[0].getSelector()&&!e[0].getSelectorsByColumn()),a&&(i.selectors=_.chain(e).filter(function(o){return o.hasIdentity()}).map(function(o){return o.getSelector()}).value()),this.hostServices.onSelect(i)}else this.hostServices.sendSelectionIdsToHost(this.prepareCustomVisualSelectEventArgs(e,r))},t.prototype.sendContextMenuToHost=function(e,r,n){e&&r&&this.hostServices.customVisualOnContextMenu({data:[e],position:r,dataRoles:n?[n]:void 0})},t.prototype.sendExpandCollapseToHost=function(e,r){e&&null!=e.nodeIsCollapsed&&this.hostServices.customVisualOnExpandCollapse({data:e,entireLevel:r})},t.prototype.selectInternal=function(e,r){var n=this;e.length<1||(e.length>1?this.selectedIds=r?e.filter(function(i){return!n.selectedIds.some(function(a){return a.equals(i)})}).concat(this.selectedIds.filter(function(i){return!e.some(function(a){return a.equals(i)})})):e:t.containsSelection(this.selectedIds,e[0])?this.selectedIds=r?this.selectedIds.filter(function(i){return!e[0].equals(i)}):this.selectedIds.length>1?e:[]:r?this.selectedIds.push(e[0]):this.selectedIds=e)},t.containsSelection=function(e,r){return e.some(function(n){return r.equals(n)})},t.getSelectorsByColumn=function(e){return e&&e[0]instanceof oe?e:_(e).filter(function(r){return r&&r.hasIdentity}).map(function(r){return r.getSelectorsByColumn()}).compact().value()},t.createChangeForFilterProperty=function(e,r){var n={},i={objectName:e.objectName,selector:void 0,properties:n};return null==r?(n[e.propertyName]={},{remove:[i]}):(n[e.propertyName]=r,{merge:[i]})},t.prototype.getFilterFromSelectors=function(){if(this.hasSelection())return Ru(_.chain(this.selectedIds).filter(function(r){return r.hasIdentity()}).map(function(r){return r.getSelector()}).value(),!1)},t.prototype.prepareCustomVisualSelectEventArgs=function(e,r){var n={selectionIds:[],multiSelect:r};if(e&&e[0]&&(e[0].dataMap||e[0].measures))for(var i=0,a=e;i<a.length;i++)n.selectionIds.push(a[i]);return n},t.prototype.applySelectionFilter=function(){this.hostServices.persistProperties(t.createChangeForFilterProperty(this.filterPropertyIdentifier,this.getFilterFromSelectors()))},t.prototype.registerOnSelectCallback=function(e){this.onSelectCallback=e},t.prototype.invokeOnSelectCallback=function(e){_.isFunction(this.onSelectCallback)&&this.onSelectCallback(e)},t}(),CV={version:"1.1.0",overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,type:Wt(i)},o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}}}},hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colors:wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()}}};function Mt(t){return new nh(t)}function se(t){return new wV(t)}var nh=function(){function t(e){this.colorPalette={},this.colorIndex=0,this.colors=e}return t.prototype.getColor=function(e){var r=this.colorPalette[e];if(r)return r;var n=this.colors;return r=this.colorPalette[e]=n[this.colorIndex++],this.colorIndex>=n.length&&(this.colorIndex=0),r},t.prototype.reset=function(){return this.colorIndex=0,this.colorPalette={},this},t}(),wV=function(t){function e(r){var n=this,i=r.colorPalette.dataColors;(n=t.call(this,i.getAllColors())||this).isHighContrast=r.isHighContrast,n.foreground=r.colorPalette.foreground,n.foregroundLight=r.colorPalette.foregroundLight,n.foregroundDark=r.colorPalette.foregroundDark,n.foregroundNeutralLight=r.colorPalette.foregroundNeutralLight,n.foregroundNeutralDark=r.colorPalette.foregroundNeutralDark,n.foregroundNeutralSecondary=r.colorPalette.foregroundNeutralSecondary,n.foregroundNeutralSecondaryAlt=r.colorPalette.foregroundNeutralSecondaryAlt,n.foregroundNeutralSecondaryAlt2=r.colorPalette.foregroundNeutralSecondaryAlt2,n.foregroundNeutralTertiary=r.colorPalette.foregroundNeutralTertiary,n.foregroundNeutralTertiaryAlt=r.colorPalette.foregroundNeutralTertiaryAlt,n.foregroundSelected=r.colorPalette.foregroundSelected,n.foregroundButton=r.colorPalette.foregroundButton,n.background=r.colorPalette.background,n.backgroundLight=r.colorPalette.backgroundLight,n.backgroundNeutral=r.colorPalette.backgroundNeutral,n.backgroundDark=r.colorPalette.backgroundDark,n.hyperlink=r.colorPalette.hyperlink,n.visitedHyperlink=r.colorPalette.visitedHyperlink,n.mapPushpin=r.colorPalette.mapPushpin,n.shapeStroke=r.colorPalette.shapeStroke;var a=i.getSentimentColors();n.bad=a.bad,n.neutral=a.neutral,n.good=a.good;var o=i.getGradientColors();return n.minimum=o.minColor,n.center=o.midColor,n.maximium=o.maxColor,n.null=o.nullColor,n.negative=a.bad,n.positive=a.good,n.selection=r.colorPalette.selection,n.separator=r.colorPalette.separator,n}return T(e,t),e}(nh),xV={version:"1.2.0",overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,type:Wt(i)};r.colorPalette.reset();var o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}}}},hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)}}}};function lt(t){return new DV(t)}var DV=function(){function t(e){this.hostServices=e.hostServices,this.tooltipService=this.hostServices.tooltips()}return t.prototype.enabled=function(){return this.tooltipService&&this.tooltipService.enabled()},t.prototype.show=function(e){if(this.enabled()){var r={coordinates:e.coordinates,dataItems:e.dataItems,isTouchEvent:e.isTouchEvent,identities:ze.getSelectorsByColumn(e.identities)};this.tooltipService.show(r)}},t.prototype.move=function(e){if(this.enabled()){var r={coordinates:e.coordinates,dataItems:e.dataItems,isTouchEvent:e.isTouchEvent,identities:ze.getSelectorsByColumn(e.identities)};this.tooltipService.move(r)}},t.prototype.hide=function(e){this.enabled()&&this.tooltipService.hide(e)},t}(),_V={version:"1.3.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host})}}},TV={version:"1.4.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),locale:e.host.locale()}}},FV={version:"1.5.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive}}},kV={version:"1.6.0",overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,editMode:i.editMode,type:Wt(i)};r.colorPalette.reset();var o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}}}},hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive}}};function ee(t){return new LV(t)}var LV=function(){function t(e){this.hostServices=e.hostServices,this.telemetryService=this.hostServices&&this.hostServices.telemetry&&this.hostServices.telemetry(),this.instanceId=this.telemetryService&&this.telemetryService.instanceId}return t.prototype.trace=function(e,r){this.telemetryService&&this.telemetryService.trace(e,r)},t}();function BV(t){switch(t){case 3:return"VisualEventError";case 2:return"VisualEventTrace";case 0:return"VisualEventRenderStarted";case 1:return"VisualEventRenderCompleted";default:return void u.assertFail("Unknown VisualEventType: "+t)}}var OV={version:"1.7.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),telemetry:ee({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o){if(i){var s=[];s.push(i),e.host.applyJsonFilter(s,a,o)}else e.host.applyJsonFilter(null,a,o)}}}},qV={version:"1.8.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),telemetry:ee({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()}}}};function te(t){return new HV(t)}var HV=function(){function t(e){this.hostServices=e.hostServices,this.authenticationService=this.hostServices&&this.hostServices.authenticationService&&this.hostServices.authenticationService(),this.promiseFactory=this.hostServices.promiseFactory()}return t.prototype.getResourceUrl=function(){return this.authenticationService?this.authenticationService.getResourceUrl():this.promiseFactory.reject()},t.prototype.getAADAuthenticationToken=function(){return this.authenticationService?this.authenticationService.getAADAuthenticationToken():this.promiseFactory.reject()},t.prototype.getAADToken=function(){return this.authenticationService?this.authenticationService.getAADToken():this.promiseFactory.reject()},t.prototype.getWACToken=function(e,r){return this.authenticationService?this.authenticationService.getWACToken(e,r):this.promiseFactory.reject()},t.prototype.getSignedInAccessToken=function(){return this.promiseFactory.reject()},t.prototype.getClusterInfo=function(){return this.promiseFactory.reject()},t}(),QV={version:"1.9.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()}}}},re=function(){function t(e){this.localizationResources=e}return t.prototype.getDisplayName=function(e){var r=this.localizationResources;return r&&r.localizedStrings&&r.localizedStrings.hasOwnProperty(e)?r.localizedStrings[e]:r&&r.enUSStrings&&r.enUSStrings.hasOwnProperty(e)?r.enUSStrings[e]:e},t}(),jV={version:"1.10.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return new ze({hostServices:e.host})},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)}}}},JV={version:"1.11.0",hostAdapter:function(e){return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){var i=e.host;return i.selectionManager=new ze({hostServices:i}),i.selectionManager},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)}}}},XV={version:"1.12.0",overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,editMode:i.editMode,operationKind:i.operationKind,type:Wt(i)};r.colorPalette.reset();var o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}}}},hostAdapter:function(e){var r=e.host;return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return r.selectionManager=new ze({hostServices:r}),r.selectionManager},colorPalette:Mt(wt(e,"style.colorPalette.dataColors.getAllColors")?e.style.colorPalette.dataColors.getAllColors():Ke.getDefaultColors()),persistProperties:function(a){return e.host.persistProperties(a)},tooltipService:lt({hostServices:e.host}),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(a,o,s,l){if(a){var c=[];c.push(a),e.host.applyJsonFilter(c,o,s,l)}else e.host.applyJsonFilter(null,o,s,l)},launchUrl:function(a){return e.host.launchUrl(a)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}},eM={version:"1.13.0",hostAdapter:function(e){var r=e.host;return{createSelectionIdBuilder:function(){return new tt},createSelectionManager:function(){return r.selectionManager=new ze({hostServices:r}),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}},Hu="2.0.0",rM={version:Hu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Hu,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=new ze({hostServices:r,apiVersion:Hu}),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:lt({hostServices:e.host}),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}},Gu="2.1.0",aM={version:Gu,overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,editMode:i.editMode,operationKind:i.operationKind,type:Wt(i),jsonFilters:i.jsonFilters};r.colorPalette.reset();var o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}}}},hostAdapter:function(e){var r=e.host;return r.apiVersion=Gu,{createSelectionIdBuilder:function(){return r.createSelectionIdBuilder()},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Gu),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}},Qu="2.2.0",sM={version:Qu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Qu,{createSelectionIdBuilder:function(){return r.createSelectionIdBuilder()},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Qu),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i){var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()}}}};function de(t){return new uM(t)}var uM=function(){function t(e){this.eventService=e&&e.eventService&&e.eventService()}return t.prototype.renderingStarted=function(e){this.eventService&&this.eventService.renderingStarted(e)},t.prototype.renderingFinished=function(e){this.eventService&&this.eventService.renderingFinished(e)},t.prototype.renderingFailed=function(e,r){this.eventService&&this.eventService.renderingFailed(e,r)},t}();function pe(t){return new lM(t)}var lM=function(){function t(e){this.storageService=e&&e.localStorageService&&e.localStorageService(),this.promiseFactory=e.promiseFactory()}return t.prototype.status=function(){return null!=this.storageService?this.storageService.getStorageStatus():this.promiseFactory.resolve(2)},t.prototype.get=function(e){return null!=this.storageService&&e?this.storageService.getStorageData(e):this.promiseFactory.reject()},t.prototype.set=function(e,r){return null!=this.storageService&&e&&r?this.storageService.setStorageData(e,r):this.promiseFactory.reject()},t.prototype.remove=function(e){null!=this.storageService&&e&&this.storageService.removeStorageData(e)},t}(),Wu="2.3.0",dM={version:Wu,overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,editMode:i.editMode,operationKind:i.operationKind,jsonFilters:i.jsonFilters,type:Wt(i),updateId:i.updateId};r.colorPalette.reset();var o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}}}},hostAdapter:function(e){var r=e.host;return r.apiVersion=Wu,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Wu),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:pe(r),eventService:de(r)}}},ju="2.4.0",hM={version:ju,hostAdapter:function(e){var r=e.host;return r.apiVersion=ju,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(ju),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:pe(r),eventService:de(r)}}},Ku="2.5.0",gM={version:Ku,hostAdapter:function(e){var r=e.host;return r.apiVersion=Ku,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Ku),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:pe(r),eventService:de(r)}}},Ju="2.6.0",SM={version:Ju,overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,editMode:i.editMode,isInFocus:!!i.isInFocus,operationKind:i.operationKind,jsonFilters:i.jsonFilters,type:Wt(i),updateId:i.updateId};r.colorPalette.reset();var o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}}}},hostAdapter:function(e){var r=e.host;return r.apiVersion=Ju,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Ju),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:pe(r),eventService:de(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)}}}},Yu="3.2.0",EM={version:Yu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Yu,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Yu),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:pe(r),eventService:de(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},$u="3.3.0",wM={version:$u,hostAdapter:function(e){var r=e.host;return r.apiVersion=$u,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager($u),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(){return r.fetchMoreData()},storageService:pe(r),eventService:de(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},Xu="3.4.0",MM={version:Xu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Xu,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Xu),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(i){return r.fetchMoreData(i)},storageService:pe(r),eventService:de(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},Zu="3.5.0",DM={version:Zu,hostAdapter:function(e){var r=e.host;return r.apiVersion=Zu,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(Zu),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(i){return r.fetchMoreData(i)},storageService:pe(r),eventService:de(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},el="3.6.0",_M={version:el,hostAdapter:function(e){var r=e.host;return r.apiVersion=el,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(el),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(i){return r.fetchMoreData(i)},storageService:pe(r),eventService:de(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv}}},tl="3.7.0",TM={version:tl,hostAdapter:function(e){var r=e.host;return r.apiVersion=tl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return r.selectionManager=r.createSelectionManager(tl),r.selectionManager},colorPalette:se(e.style),persistProperties:function(i){return e.host.persistProperties(i)},tooltipService:r.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),allowInteractions:!(!e||!e.interactivity)&&e.interactivity.isVisualInteractive,applyJsonFilter:function(i,a,o,s){if(i)if(Array.isArray(i))e.host.applyJsonFilter(i,a,o,s);else{var l=[];l.push(i),e.host.applyJsonFilter(l,a,o,s)}else e.host.applyJsonFilter(null,a,o,s)},launchUrl:function(i){return e.host.launchUrl(i)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(i){return r.fetchMoreData(i)},storageService:pe(r),eventService:de(r),switchFocusModeState:function(i){return r.switchFocusModeState(i)},hostEnv:e.hostEnv,displayWarningIcon:function(i,a){return r.displayWarningIcon(i,a)}}}},rl="3.8.0",FM={version:rl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=rl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(rl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}};function Ie(t){return new RM(t)}var RM=function(){function t(e){this.downloadService=e&&e.downloadService&&e.downloadService(),this.promiseFactory=e.promiseFactory()}return t.prototype.exportStatus=function(){return null!=this.downloadService?this.downloadService.getExportStatus():this.promiseFactory.resolve(2)},t.prototype.exportVisualsContent=function(e,r,n,i){return null!=this.downloadService?this.downloadService.exportVisualsContent(e,r,n,i).then(function(a){return a.downloadCompleted}):this.promiseFactory.reject()},t.prototype.exportVisualsContentExtended=function(e,r,n,i){return null!=this.downloadService?this.downloadService.exportVisualsContent(e,r,n,i):this.promiseFactory.reject()},t}(),nl="3.9.0",kM={version:nl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=nl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(nl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}},il="4.0.0",BM={version:il,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=il,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(il),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}},al="4.1.0",OM={version:al,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=al,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(al),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}},ol="4.2.0",qM={version:ol,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=ol,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(ol),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}},sl="4.3.0",GM={version:sl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=sl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(sl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)}}}};function Xe(t){return new QM(t)}var QM=function(){function t(e){this.licenseManagerService=e&&e.licenseManagerService&&e.licenseManagerService(),this.promiseFactory=e.promiseFactory()}return t.prototype.getAvailableServicePlans=function(){return this.licenseManagerService?this.licenseManagerService.getAvailableServicePlans():this.promiseFactory.reject()},t.prototype.notifyLicenseRequired=function(e){return this.licenseManagerService?this.licenseManagerService.notifyLicenseRequired(e):this.promiseFactory.reject()},t.prototype.notifyFeatureBlocked=function(e){return this.licenseManagerService?this.licenseManagerService.notifyFeatureBlocked(e):this.promiseFactory.reject()},t.prototype.clearLicenseNotification=function(){return this.licenseManagerService?this.licenseManagerService.clearLicenseNotification():this.promiseFactory.reject()},t}(),ul="4.4.0",jM={version:ul,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=ul,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(ul),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i)}}},ll="4.5.0",JM={version:ll,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=ll,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(ll),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i)}}};function ct(t){return new YM(t)}var YM=function(){function t(e){this.webAccessService=e&&e.webAccessService&&e.webAccessService(),this.promiseFactory=e.promiseFactory()}return t.prototype.webAccessStatus=function(e){return null!=this.webAccessService?this.webAccessService.getWebAccessStatus(e):this.promiseFactory.resolve(2)},t}(),cl="4.6.0",XM={version:cl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=cl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(cl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i)}}},fl="4.7.0",ex={version:fl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=fl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(fl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)}}}},dl="5.0.0",rx={version:dl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=dl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(dl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)}}}},pl="5.1.0",ix={version:pl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=pl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(pl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)}}}},hl="5.2.0",ox={version:hl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=hl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(hl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)}}}},vl="5.3.0",ux={version:vl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=vl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(vl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)}}}},gl="5.4.0",cx={version:gl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=gl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(gl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)}}}};function zn(t){return new fx(t)}var fx=function(){function t(e){this.storageV2Service=e&&e.localStorageV2Service&&e.localStorageV2Service(),this.promiseFactory=e.promiseFactory()}return t.prototype.status=function(){return null!=this.storageV2Service?this.storageV2Service.getStorageStatus():this.promiseFactory.resolve(2)},t.prototype.get=function(e){return null!=this.storageV2Service&&e?this.storageV2Service.getStorageData(e):this.promiseFactory.reject()},t.prototype.set=function(e,r){return null!=this.storageV2Service&&e&&r?this.storageV2Service.setStorageData(e,r):this.promiseFactory.reject()},t.prototype.remove=function(e){null!=this.storageV2Service&&e&&this.storageV2Service.removeStorageData(e)},t}(),yl="5.5.0",px={version:yl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=yl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(yl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:zn(i)}}};function Fi(t){return new hx(t)}var hx=function(){function t(e){this.acquireAADTokenService=e&&e.acquireAADTokenService&&e.acquireAADTokenService(),this.promiseFactory=e.promiseFactory()}return t.prototype.acquireAADToken=function(){return null!=this.acquireAADTokenService?this.acquireAADTokenService.acquireAADToken():this.promiseFactory.reject()},t.prototype.acquireAADTokenstatus=function(){return null!=this.acquireAADTokenService?this.acquireAADTokenService.getAcquireAADTokenStatus():this.promiseFactory.resolve(2)},t}(),ml="5.6.0",gx={version:ml,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=ml,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(ml),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:zn(i),acquireAADTokenService:Fi(i)}}},Sl="5.7.0",mx={version:Sl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=Sl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(Sl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:zn(i),acquireAADTokenService:Fi(i),setCanDrill:function(o){return i.setCanDrill(o)}}}};function bl(t){return new Sx(t)}var Sx=function(){function t(e){var r;this.subSelectionService=null===(r=null==e?void 0:e.visualHostSubSelectionService)||void 0===r?void 0:r.call(e)}return t.prototype.subSelect=function(e){this.subSelectionService&&this.subSelectionService.subSelect(e)},t.prototype.updateRegionOutlines=function(e){this.subSelectionService&&this.subSelectionService.updateRegionOutlines(e)},t}(),El="5.8.0",Cx={version:El,overloads:function(e,r){return{update:function(i){if(e.update){var a={viewport:i.viewport,dataViews:i.dataViews,viewMode:i.viewMode,editMode:i.editMode,isInFocus:!!i.isInFocus,operationKind:i.operationKind,jsonFilters:i.jsonFilters,type:Wt(i),updateId:i.updateId,subSelections:i.subSelections,formatMode:i.formatMode};r.colorPalette.reset();var o=e.constructor.__transform__;_.isFunction(o)?e.update(a,o(a.dataViews)):e.update(a)}},getSubSelectionStyles:function(i){if(e.visualOnObjectFormatting&&_.isFunction(e.visualOnObjectFormatting.getSubSelectionStyles))return e.visualOnObjectFormatting.getSubSelectionStyles(i)},getSubSelectionShortcuts:function(i,a){if(e.visualOnObjectFormatting&&_.isFunction(e.visualOnObjectFormatting.getSubSelectionShortcuts))return e.visualOnObjectFormatting.getSubSelectionShortcuts(i,a)},getSubSelectables:function(i){if(e.visualOnObjectFormatting&&e.visualOnObjectFormatting.getSubSelectables&&_.isFunction(e.visualOnObjectFormatting.getSubSelectables))return e.visualOnObjectFormatting.getSubSelectables(i)}}},hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=El,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(El),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:zn(i),acquireAADTokenService:Fi(i),setCanDrill:function(o){return i.setCanDrill(o)},subSelectionService:bl(i)}}},ih=function(){function t(){}return t.prototype.compareCustomVisualOpaqueIdentities=function(e,r){return function(t,e){return t&&e?t.identityIndex===e.identityIndex:t===e}(e,r)},t}(),Cl="5.9.0",wl="5.10.0",Ax=[ub,CV,xV,_V,TV,FV,kV,OV,qV,QV,jV,JV,XV,eM,rM,aM,sM,dM,hM,gM,SM,EM,wM,MM,DM,_M,TM,FM,kM,BM,OM,qM,GM,jM,JM,XM,ex,rx,ix,ox,ux,cx,px,gx,mx,Cx,{version:Cl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=Cl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(Cl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:zn(i),acquireAADTokenService:Fi(i),setCanDrill:function(o){return i.setCanDrill(o)},subSelectionService:bl(i),createOpaqueUtils:function(){return new ih}}}},{version:wl,hostAdapter:function(e){var r,n,i=e.host;return i.apiVersion=wl,{createSelectionIdBuilder:function(){return new oe},createSelectionManager:function(){return i.selectionManager=i.createSelectionManager(wl),i.selectionManager},colorPalette:se(e.style),persistProperties:function(o){return e.host.persistProperties(o)},tooltipService:i.createTooltipService(),telemetry:ee({hostServices:e.host}),authenticationService:te({hostServices:e.host}),locale:e.host.locale(),hostCapabilities:{allowInteractions:!(null===(r=e.interactivity)||void 0===r||!r.isVisualInteractive),allowModalDialog:!(null===(n=e.interactivity)||void 0===n||!n.allowModalDialog)},applyJsonFilter:function(o,s,l,c){if(o)if(Array.isArray(o))e.host.applyJsonFilter(o,s,l,c);else{var f=[];f.push(o),e.host.applyJsonFilter(f,s,l,c)}else e.host.applyJsonFilter(null,s,l,c)},launchUrl:function(o){return e.host.launchUrl(o)},instanceId:e.host.instanceId,refreshHostData:function(){return e.host.refreshHostData()},createLocalizationManager:function(){return new re(e.localizationResources)},fetchMoreData:function(o){return i.fetchMoreData(o)},storageService:pe(i),downloadService:Ie(i),eventService:de(i),switchFocusModeState:function(o){return i.switchFocusModeState(o)},hostEnv:e.hostEnv,openModalDialog:function(o,s,l){return i.openModalDialog(o,s,l)},displayWarningIcon:function(o,s){return i.displayWarningIcon(o,s)},licenseManager:Xe(i),webAccessService:ct(i),drill:function(o){return i.drill(o)},applyCustomSort:function(o){return i.applyCustomSort(o)},storageV2Service:zn(i),acquireAADTokenService:Fi(i),setCanDrill:function(o){return i.setCanDrill(o)},subSelectionService:bl(i),createOpaqueUtils:function(){return new ih}}}}];function ve(t,e){if(null===t)return null;var r=Object.create(t);return e&&e(r),r}function k(t){return null===t?null:(function(t){if(null==t)return!1;var e=Object.getPrototypeOf(t);return e!==Object.prototype&&e!==Array.prototype}(t)||(t=ve(t)),t)}function zt(t,e){if(null!=t){for(var r,n=0,i=t.length;n<i;n++){var a=e(t[n]);a&&(r||(r=ve(t)),r[n]=a)}return r}}var Vl=[];Vl[1]="RegisteredResources",Vl[2]="SharedResources";var uh={};function po(t){return Ri(t,function(e){var r=L.fromDescriptor(e.type).formatting;return r&&r.formatString})}function Ml(t,e){if(u.assertValue(t,"descriptors"),u.assertValue(e,"propertyId"),!_.isEmpty(t)){var r=t[e.objectName];if(r&&!_.isEmpty(r.properties))return r.properties[e.propertyName]}}function Ri(t,e){if(u.assertAnyValue(t,"descriptors"),u.assertAnyValue(e,"propPredicate"),t)for(var r in t){var n=t[r].properties;for(var i in n)if(e(n[i]))return{objectName:r,propertyName:i}}}uh[1]=!0,uh[2]=!0;var nD={objectName:"general",propertyName:"filter"},uD=function(){function t(e,r){var n=this;this.wrappedVisual=e,this.run=r,u.assertValue(r,"run must be defined in VisualOutsideZoneAdapter"),e.update&&(this.update=function(i){return n.apply(n.wrappedVisual.update,i)}),e.onResizing&&(this.onResizing=function(i,a){n.apply(n.wrappedVisual.onResizing,i,a)}),e.onDataChanged&&(this.onDataChanged=function(i){n.apply(n.wrappedVisual.onDataChanged,i)}),e.onSelectionStateChanged&&(this.onSelectionStateChanged=function(i){n.apply(function(){return n.wrappedVisual.onSelectionStateChanged(i)})})}return t.prototype.init=function(e){return this.apply(this.wrappedVisual.init,e)},t.prototype.destroy=function(){this.apply(this.wrappedVisual.destroy)},t.prototype.onViewModeChanged=function(e){this.apply(this.wrappedVisual.onViewModeChanged,e)},t.prototype.onClearSelection=function(){this.apply(this.wrappedVisual.onClearSelection)},t.prototype.onRestoreSelection=function(e){return this.apply(this.wrappedVisual.onRestoreSelection,e)},t.prototype.canResizeTo=function(e){return this.apply(this.wrappedVisual.canResizeTo,e)},t.prototype.enumerateObjectInstances=function(e){return this.apply(this.wrappedVisual.enumerateObjectInstances,e)},t.prototype.enumerateObjectInstancesAsync=function(e){return this.apply(this.wrappedVisual.enumerateObjectInstancesAsync,e)},t.prototype.enumerateObjectRepetition=function(){return this.apply(this.wrappedVisual.enumerateObjectRepetition)},t.prototype.enumerateObjectRepetitionAsync=function(){return this.apply(this.wrappedVisual.enumerateObjectRepetitionAsync)},t.prototype.visualHasMethod=function(e){return this.apply(this.wrappedVisual.visualHasMethod,e)},t.prototype.unwrap=function(){var e=this.wrappedVisual;return e.unwrap?e.unwrap():e},Object.defineProperty(t.prototype,"sandbox",{get:function(){var r;return null===(r=this.wrappedVisual)||void 0===r?void 0:r.sandbox},enumerable:!1,configurable:!0}),t.prototype.getTelemetryInformation=function(){return this.apply(this.wrappedVisual.getTelemetryInformation)},t.prototype.getFormattingModel=function(){return this.apply(this.wrappedVisual.getFormattingModel)},t.prototype.getFormattingModelAsync=function(){return this.apply(this.wrappedVisual.getFormattingModelAsync)},t.prototype.resolveFormattingPlaceholder=function(e){var r=this;return this.run(function(){return r.wrappedVisual.resolveFormattingPlaceholder(e)})},t.prototype.getSubSelectionStyles=function(e){var r=this;return this.run(function(){return r.wrappedVisual.getSubSelectionStyles(e)})},t.prototype.getSubSelectionShortcuts=function(e,r){var n=this;return this.run(function(){return n.wrappedVisual.getSubSelectionShortcuts(e,r)})},t.prototype.getSubSelectables=function(e){var r=this;return this.run(function(){return r.wrappedVisual.getSubSelectables(e)})},t.prototype.getNextSubSelectable=function(e,r){var n=this;return this.run(function(){return n.wrappedVisual.getNextSubSelectable(e,r)})},t.prototype.getSubSelectionStylesAsync=function(e){var r=this;return this.run(function(){return r.wrappedVisual.getSubSelectionStylesAsync(e)})},t.prototype.getSubSelectionShortcutsAsync=function(e,r){var n=this;return this.run(function(){return n.wrappedVisual.getSubSelectionShortcutsAsync(e,r)})},t.prototype.getSubSelectablesAsync=function(e){var r=this;return this.run(function(){return r.wrappedVisual.getSubSelectablesAsync(e)})},t.prototype.onDataViewObjectChanged=function(e,r){return this.apply(this.wrappedVisual.onDataViewObjectChanged,e,r)},t.prototype.apply=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=this.wrappedVisual;return this.run(function(){return e.apply(i,r)})},t}();function lD(t,e){void 0===e&&(e=!1);try{if(!t)return;var r=t.stack;if(!r)return;var n=r.indexOf("\n");return-1===n?void 0:(r=r.substring(n+1),e&&(r=r.replace(/\s*((ms-pbi|https):\/\/\S*|\(.*?\))/g,function(i){var a=i.match(/([\w\.-]+\.(js|html)(:\d+:\d+)?)/);return null!=a?" (".concat(a[1],")"):""})),r)}catch(i){return"Error at cleanExceptionStack"}}function cD(t){var e;try{if(t instanceof TypeError||t instanceof ReferenceError||"ChunkLoadError"===t.name)return t.message;if(t)return"Error of type ".concat(t.name," had a ").concat(null===(e=t.message)||void 0===e?void 0:e.length," characters long message")}catch(r){return"Error at cleanExceptionMessage"}}var q={},fh=yt.generateGuid;function H(t,e){return function(r){return ye(ye({name:t,time:It(),id:fh()},e),{info:r,formatted:function(){return function(t,e,r){if(r){var n=[];for(var i in r){var a=e[r[i]];(void 0===a||!1===a)&&n.push(r[i])}e=_.omit(e,n)}return _.extend(t,e),t}({},r,null==e?void 0:e.optionalParameters)}})}}var Wh,ph="BaseEvent",hh=(q[ph]=H(ph),"TimedEvent"),vh=(q[hh]=H(hh),"Verbose"),gh=(q[vh]=H(vh),"VerboseTimedEvent"),Sh=(q[gh]=H(gh),q.Trace=H("Trace"),q.Error=H("Error"),"ErrorWithStackTrace"),bh=(q[Sh]=H(Sh),"ErrorWithStackTraceAndSourceDetails"),Eh=(q[bh]=H(bh),"LLMEncodingError"),Ch=(q[Eh]=H(Eh),"CustomerAction"),wh=(q[Ch]=H(Ch),"PBI.Dashboard.RootSession"),Vh=(q[wh]=H(wh),"PBI.WFE.Error"),Mh=(q[Vh]=H(Vh),"PBI.Dashboard.ErrorDialog"),xh=(q[Mh]=H(Mh),"PBI.Dashboard.UnhandledAngularException"),Dh=(q[xh]=H(xh),"PBI.Data.Exception"),xl=(q[Dh]=H(Dh),"PBI.Visual.Exception"),Ah=q[xl]=H(xl),_h="PBI.Dashboard.UnhandledException",Ih=(q[_h]=H(_h),"PBI.HandledException"),Th=(q[Ih]=H(Ih),"PBI.Dashboard.ReportTilePopulateException"),Ph=(q[Th]=H(Th),"PBI.Dashboard.UnhandledStacklessException"),Fh=(q[Ph]=H(Ph,{logRatio:1e-4}),"PBI.Visual.Error"),Rh=(q[Fh]=H(Fh),"PBI.WFE.ReopenUserAccount"),Nh=(q[Rh]=H(Rh),"PBI.WFE.AccountClosedPage"),kh=(q[Nh]=H(Nh),"PBI.WFE.AbtSignoutRedirectPage"),Lh=(q[kh]=H(kh),"PBI.Visual.Warning"),Dl=(q[Lh]=H(Lh),"PBI.Visual.ApiUsage"),Bh=q[Dl]=H(Dl),Uh="PBI.Visual.CustomVisualsGenericEvent",Oh=(q[Uh]=H(Uh),"PBI.EX.CopyActionClicked"),zh=(q[Oh]=H(Oh),"StartActivity"),qh=(q[zh]=H(zh),"EndActivity"),Hh=(q[qh]=H(qh),"PBI.App.SignInError"),Gh=(q[Hh]=H(Hh),"PBI.App.TokenRefreshError"),Qh=(q[Gh]=H(Gh),"PBI.Storytelling.BrowserNotSupportedLoaded"),vD=(q[Qh]=H(Qh),function(){function t(e,r,n,i,a,o,s){this.wrappedVisual=e,this.visualPlugin=r,this.promiseFactory=n,this.telemetryService=i,this.isPluginInError=a,this.certifiedEventsService=o,this.silent=s,this.initCalled=!1,this.visualLoadStartTime=It(),this.startTimeISO=(new Date).toISOString()}return t.prototype.init=function(e){var r=this;if(this.initCalled=!0,e&&e.host&&e.host.telemetry){var n=e.host.telemetry();this.visualName=n&&n.visualName,this.instanceId=n&&n.instanceId}if(this.wrappedVisual.init)return this.executeSafelyAsync(function(){return r.wrappedVisual.init(e)})},t.prototype.checkInit=function(){return!!this.initCalled||(ot.assertFail("Another visual method was called before init"),!1)},t.prototype.destroy=function(){var e=this;this.wrappedVisual.destroy&&this.executeSafely(function(){return e.wrappedVisual.destroy()})},t.prototype.update=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.update)return this.executeSafelyAsync(function(){return nt(r,void 0,void 0,function(){var n,i,a,o,s,l,c,f,d,p,h;return it(this,function(v){switch(v.label){case 0:return[4,this.wrappedVisual.update(e)];case 1:return v.sent(),this.telemetryService&&this.startTimeISO&&this.visualPlugin.custom&&(i=(n=this.visualPlugin).version,a=n.apiVersion,o=(new Date).toISOString(),this.telemetryService.logEvent(Bh,{name:this.visualPlugin.name,apiVersion:a,custom:!!this.visualPlugin.custom,visualVersion:i,visualName:this.visualName,instanceId:this.instanceId,start:this.startTimeISO,end:o,isError:this.isPluginInError,errorSource:"User"}),this.startTimeISO=null,this.visualLoadStartTime&&(null===(s=this.certifiedEventsService)||void 0===s||s.logTimedStandardizedFeatureEvent({activityAttributes:{apiMajorVersion:a&&(null===(l=Ot(a))||void 0===l?void 0:l.major),apiMinorVersion:a&&(null===(c=Ot(a))||void 0===c?void 0:c.minor),visualMajorVersion:i&&(null===(f=Ot(i))||void 0===f?void 0:f.major),visualMinorVersion:i&&(null===(d=Ot(i))||void 0===d?void 0:d.minor)},activityName:Dl,correlationId:null===(h=null===(p=this.telemetryService)||void 0===p?void 0:p.root)||void 0===h?void 0:h.id,operationEndTime:It(),operationStartTime:this.visualLoadStartTime,visualId:this.visualPlugin.name}),this.visualLoadStartTime=null)),[2]}})})})},t.prototype.onResizing=function(e,r){var n=this;this.checkInit(),this.wrappedVisual.onResizing&&this.executeSafely(function(){return n.wrappedVisual.onResizing(e,r)})},t.prototype.onDataChanged=function(e){var r=this;this.checkInit(),this.wrappedVisual.onDataChanged&&this.executeSafely(function(){return r.wrappedVisual.onDataChanged(e)})},t.prototype.onViewModeChanged=function(e){var r=this;this.checkInit(),this.wrappedVisual.onViewModeChanged&&this.executeSafely(function(){return r.wrappedVisual.onViewModeChanged(e)})},t.prototype.onSelectionStateChanged=function(e){var r=this;this.checkInit(),this.wrappedVisual.onSelectionStateChanged&&this.executeSafely(function(){return r.wrappedVisual.onSelectionStateChanged(e)})},t.prototype.onClearSelection=function(){var e=this;this.checkInit(),this.wrappedVisual.onClearSelection&&this.executeSafely(function(){return e.wrappedVisual.onClearSelection()})},t.prototype.onRestoreSelection=function(e){var r=this;return this.checkInit(),!!this.wrappedVisual.onRestoreSelection&&this.executeSafely(function(){return r.wrappedVisual.onRestoreSelection(e)})},t.prototype.canResizeTo=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.canResizeTo)return this.executeSafely(function(){return r.wrappedVisual.canResizeTo(e)})},t.prototype.enumerateObjectInstances=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.enumerateObjectInstances)return this.executeSafely(function(){return r.wrappedVisual.enumerateObjectInstances(e)})},t.prototype.enumerateObjectRepetition=function(){var e=this;if(this.checkInit(),this.wrappedVisual.enumerateObjectRepetition)return this.executeSafely(function(){return e.wrappedVisual.enumerateObjectRepetition()})},t.prototype.enumerateObjectInstancesAsync=function(e){var r=this;return this.checkInit(),this.visualAdapter.enumerateObjectInstancesAsync?this.executeSafely(function(){return r.visualAdapter.enumerateObjectInstancesAsync(e)}):this.promiseFactory.resolve(this.enumerateObjectInstances(e))},t.prototype.enumerateObjectRepetitionAsync=function(){var e=this;return this.checkInit(),this.visualAdapter.enumerateObjectRepetitionAsync?this.executeSafely(function(){return e.visualAdapter.enumerateObjectRepetitionAsync()}):this.promiseFactory.resolve(this.enumerateObjectRepetition())},Object.defineProperty(t.prototype,"sandbox",{get:function(){return this.visualAdapter&&this.visualAdapter.sandbox},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualAdapter",{get:function(){return this.wrappedVisual},enumerable:!1,configurable:!0}),t.prototype.unwrap=function(){var e=this.wrappedVisual;return e.unwrap?e.unwrap():e},t.prototype.visualHasMethod=function(e){var r=this.wrappedVisual;return r&&r.visualHasMethod(e)},t.prototype.getTelemetryInformation=function(){var e=this;if(this.checkInit(),this.wrappedVisual.getTelemetryInformation)return this.executeSafely(function(){return e.wrappedVisual.getTelemetryInformation()})},t.prototype.getFormattingModel=function(){var e=this;if(this.checkInit(),this.wrappedVisual.getFormattingModel)return this.executeSafely(function(){return e.wrappedVisual.getFormattingModel()})},t.prototype.getFormattingModelAsync=function(){var e=this;return this.checkInit(),this.visualAdapter.getFormattingModelAsync?this.executeSafely(function(){return e.visualAdapter.getFormattingModelAsync()}):this.promiseFactory.resolve(this.getFormattingModel())},t.prototype.resolveFormattingPlaceholder=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.resolveFormattingPlaceholder)return this.executeSafely(function(){return r.wrappedVisual.resolveFormattingPlaceholder(e)})},t.prototype.getSubSelectionStyles=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.getSubSelectionStyles)return this.executeSafely(function(){return r.wrappedVisual.getSubSelectionStyles(e)})},t.prototype.getSubSelectionShortcuts=function(e,r){var n=this;if(this.checkInit(),this.wrappedVisual.getSubSelectionShortcuts)return this.executeSafely(function(){return n.wrappedVisual.getSubSelectionShortcuts(e,r)})},t.prototype.getSubSelectables=function(e){var r=this;if(this.checkInit(),this.wrappedVisual.getSubSelectables)return this.executeSafely(function(){return r.wrappedVisual.getSubSelectables(e)})},t.prototype.getNextSubSelectable=function(e,r){var n=this;if(this.checkInit(),this.wrappedVisual.getNextSubSelectable)return this.executeSafely(function(){return n.wrappedVisual.getNextSubSelectable(e,r)})},t.prototype.getSubSelectionStylesAsync=function(e){var r=this;return this.checkInit(),this.wrappedVisual.getSubSelectionStylesAsync?this.executeSafely(function(){return r.wrappedVisual.getSubSelectionStylesAsync(e)}):this.promiseFactory.resolve(this.getSubSelectionStyles(e))},t.prototype.getSubSelectionShortcutsAsync=function(e,r){var n=this;return this.checkInit(),this.wrappedVisual.getSubSelectionShortcutsAsync?this.executeSafely(function(){return n.wrappedVisual.getSubSelectionShortcutsAsync(e,r)}):this.promiseFactory.resolve(this.getSubSelectionShortcuts(e,r))},t.prototype.getSubSelectablesAsync=function(e){var r=this;return this.checkInit(),this.wrappedVisual.getSubSelectablesAsync?this.executeSafely(function(){return r.wrappedVisual.getSubSelectablesAsync(e)}):this.promiseFactory.resolve(this.getSubSelectables(e))},t.prototype.onDataViewObjectChanged=function(e,r){var n=this;if(this.checkInit(),this.visualAdapter.onDataViewObjectChanged)return this.executeSafely(function(){return n.wrappedVisual.onDataViewObjectChanged(e,r)})},t.prototype.executeSafely=function(e){try{return e()}catch(r){this.telemetryService&&this.logVisualExceptionEvent(r)}},t.prototype.executeSafelyAsync=function(e){return nt(this,void 0,void 0,function(){var r;return it(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return[2,n.sent()];case 2:return r=n.sent(),this.telemetryService&&this.logVisualExceptionEvent(r),[3,3];case 3:return[2]}})})},t.prototype.logVisualExceptionEvent=function(e){!function(t,e,r,n,i,a){var o,s,l,c,f,d=!(null==e||!e.custom),p=e||{},h=p.version,v=p.apiVersion;i.logEvent(Ah,{visualType:e.name,isCustom:d,apiVersion:v,visualName:r,instanceId:n,isDeprecated:!!e.isDeprecated,source:t.fileName,lineNumber:t.lineNumber,columnNumber:t.columnNumber,message:d?void 0:cD(t),stack:d?void 0:lD(t)}),d&&(null==a||a.logStandardizedFeatureEvent({activityAttributes:{apiMajorVersion:v&&(null===(o=Ot(v))||void 0===o?void 0:o.major),apiMinorVersion:v&&(null===(s=Ot(v))||void 0===s?void 0:s.minor),visualMajorVersion:h&&(null===(l=Ot(h))||void 0===l?void 0:l.major),visualMinorVersion:h&&(null===(c=Ot(h))||void 0===c?void 0:c.minor),isDeprecated:!(null==e||!e.isDeprecated)},activityName:xl,activityStatus:"Failed",correlationId:null===(f=null==i?void 0:i.root)||void 0===f?void 0:f.id,visualId:null==e?void 0:e.name}))}(e,this.visualPlugin,this.visualName,this.instanceId,this.telemetryService,this.certifiedEventsService)},t}());function Ni(){return new yD}var Gn=function(t){return t[t.pending=0]="pending",t[t.resolved=1]="resolved",t[t.rejected=2]="rejected",t}({}),yD=function(){function t(){}return t.prototype.defer=function(e){return new mD($.Deferred())},t.prototype.reject=function(e){var r=this.defer();return r.reject(e),r.promise},t.prototype.resolve=function(e){var r=this.defer();return r.resolve(e),r.promise},t.prototype.all=function(e){return this.when.apply(this,e).then(function(){return Array.prototype.slice.call(arguments)})},t.prototype.allSettled=function(e){var r=this.defer(),n=e.length;if(n>0)for(var i=0,a=[],o=function(c){e[c].then(function(f){a[c]={value:f,type:0}}).catch(function(f){a[c]={value:f,type:1}}).finally(function(){++i===n&&r.resolve(a)})},s=0;s<n;s++)o(s);else r.resolve([]);return r.promise},t.prototype.when=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=e.map(function(a){return a&&a.promise?a.promise:a});if(1===n.length){var i=n[0];return null!=i&&i.pipe?new Al(i):this.resolve(i)}return new Al($.when.apply($,n))},t}(),mD=function(){function t(e){u.assertValue(e,"deferred"),this.deferred=e,this.promise=new Al(e.promise())}return t.prototype.resolve=function(e){this.deferred.resolveWith(this.deferred.promise,[e])},t.prototype.reject=function(e){this.deferred.rejectWith(this.deferred.promise,[e])},t}(),Al=function(){function t(e){this[Wh]="Promise",u.assertValue(e,"promise"),this.promise=e}return t.prototype.then=function(e,r){var n=t.wrapCallback(e),i=t.wrapCallback(r);return new t(this.promise.pipe(n||null,i))},t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(e){return this.promise.always(t.wrapCallback(e)),this},t.wrapCallback=function(e){return e&&function(){var r=e.apply(this,arguments);return r instanceof t?r.promise:r}},t}();Wh=Symbol.toStringTag;var un=function(){function t(r){var n=this;if(this[e]="Promise",t.useNativePromise)return new window.Promise(r);this.defer=t.ensureFactory().defer(),r(function(i){return n.onResolve(i)},function(i){return n.onReject(i)})}var e;return t.prototype.then=function(r,n){return this.hasRejectionHandling=this.hasRejectionHandling||void 0!==n,this.defer.promise.then(r,n)},t.prototype.catch=function(r){return this.hasRejectionHandling=this.hasRejectionHandling||void 0!==r,this.defer.promise.catch(r)},t.prototype.finally=function(r){return this.defer.promise.finally(r)},t.init=function(r,n,i,a){u.assertValue(r,"promiseFactory"),u.assertAnyValue(n,"exceptionHandler"),u.assert(function(){return i||!t.defaultFactoryWasProvided},"powerbi.Promise was used before being initialized - that is legitimate in test scenarios only"),null!=a&&(t.useNativePromise=a),t.factory=r,t.exceptions=n,t.defaultFactoryWasProvided=!1},t.setUseNativePromise=function(r){t.useNativePromise=r},t.ensureFactory=function(){var r=t.factory;return r||(r=t.factory=Ni(),t.defaultFactoryWasProvided=!0),r},t.resolve=function(r){return t.useNativePromise?window.Promise.resolve(r):new t(function(n,i){return n(r)})},t.reject=function(r){return t.useNativePromise?window.Promise.reject(r):new t(function(n,i){return i(r)})},t.allSettled=function(r){return t.useNativePromise?window.Promise.allSettled(r):new t(function(n,i){var a=r.length;if(a>0)for(var o=[],s=0;s<a;s++)r[s].then(function(l){return o.push({value:l,type:0})}).catch(function(l){return o.push({value:l,type:1})}).finally(function(){o.length===a&&n(o)});else n([])})},t.prototype.onResolve=function(r){var n=this;u.assertAnyValue(r,"value"),function(t){return t&&_.isFunction(t.then)}(r)?r.then(function(i){return n.onResolve(i)},function(i){return n.onReject(i)}):this.defer.resolve(r)},t.prototype.onReject=function(r){if(u.assertAnyValue(r,"error"),!this.hasRejectionHandling&&r instanceof Error&&!r.suppressExceptionHandler){var n=t.exceptions;n&&(r.suppressExceptionHandler=!0,n(r))}this.defer.reject(r)},e=Symbol.toStringTag,t.useNativePromise=!0,t}(),bD=function(){function t(e){var r=this;this.wrappedVisual=e,e.update&&(this.update=function(n){return r.trackVisualTime(function(){return r.wrappedVisual.update(n)},function(){return n&&n.parentContextActivity?n.parentContextActivity.createChildActivity({name:"Visual Update"}):void 0})}),e.onResizing&&(this.onResizing=function(n,i){r.trackVisualTime(function(){return r.wrappedVisual.onResizing(n,i)})}),e.onDataChanged&&(this.onDataChanged=function(n){r.trackVisualTime(function(){return r.wrappedVisual.onDataChanged(n)})}),e.onSelectionStateChanged&&(this.onSelectionStateChanged=function(n){r.trackVisualTime(function(){return r.wrappedVisual.onSelectionStateChanged(n)})})}return t.prototype.init=function(e){var r=this;if(this.wrappedVisual.init)return this.trackVisualTime(function(){return r.wrappedVisual.init(e)})},t.prototype.destroy=function(){var e=this;this.wrappedVisual.destroy&&this.trackVisualTime(function(){return e.wrappedVisual.destroy()})},t.prototype.onViewModeChanged=function(e){var r=this;this.wrappedVisual.onViewModeChanged&&this.trackVisualTime(function(){return r.wrappedVisual.onViewModeChanged(e)})},t.prototype.onClearSelection=function(){var e=this;this.wrappedVisual.onClearSelection&&this.trackVisualTime(function(){return e.wrappedVisual.onClearSelection()})},t.prototype.onRestoreSelection=function(e){var r=this;return!!this.wrappedVisual.onRestoreSelection&&this.trackVisualTime(function(){return r.wrappedVisual.onRestoreSelection(e)})},t.prototype.canResizeTo=function(e){var r=this;if(this.wrappedVisual.canResizeTo)return this.trackVisualTime(function(){return r.wrappedVisual.canResizeTo(e)})},t.prototype.enumerateObjectInstances=function(e){var r=this;if(this.wrappedVisual.enumerateObjectInstances)return this.trackVisualTime(function(){return r.wrappedVisual.enumerateObjectInstances(e)})},t.prototype.enumerateObjectRepetition=function(){var e=this;if(this.wrappedVisual.enumerateObjectRepetition)return this.trackVisualTime(function(){return e.wrappedVisual.enumerateObjectRepetition()})},t.prototype.enumerateObjectInstancesAsync=function(e){var r=this;return this.visualAdapter.enumerateObjectInstancesAsync?this.trackVisualTime(function(){return r.visualAdapter.enumerateObjectInstancesAsync(e)}):un.resolve(this.enumerateObjectInstances(e))},t.prototype.enumerateObjectRepetitionAsync=function(){var e=this;return this.visualAdapter.enumerateObjectRepetitionAsync?this.trackVisualTime(function(){return e.visualAdapter.enumerateObjectRepetitionAsync()}):un.resolve(this.enumerateObjectRepetition())},Object.defineProperty(t.prototype,"sandbox",{get:function(){return this.visualAdapter&&this.visualAdapter.sandbox},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualAdapter",{get:function(){return this.wrappedVisual},enumerable:!1,configurable:!0}),t.prototype.unwrap=function(){var e=this.wrappedVisual;return e.unwrap?e.unwrap():e},t.prototype.visualHasMethod=function(e){var r=this.wrappedVisual;return r&&r.visualHasMethod(e)},t.prototype.getTelemetryInformation=function(){var e=this;if(this.wrappedVisual.getTelemetryInformation)return this.trackVisualTime(function(){return e.wrappedVisual.getTelemetryInformation()})},t.prototype.getFormattingModel=function(){var e=this;if(this.wrappedVisual.getFormattingModel)return this.trackVisualTime(function(){return e.wrappedVisual.getFormattingModel()})},t.prototype.getFormattingModelAsync=function(){var e=this;return this.visualAdapter.getFormattingModelAsync?this.trackVisualTime(function(){return e.visualAdapter.getFormattingModelAsync()}):un.resolve(this.getFormattingModel())},t.prototype.resolveFormattingPlaceholder=function(e){var r=this;if(this.wrappedVisual.resolveFormattingPlaceholder)return this.trackVisualTime(function(){return r.wrappedVisual.resolveFormattingPlaceholder(e)})},t.prototype.getSubSelectionStyles=function(e){var r=this;if(this.wrappedVisual.getSubSelectionStyles)return this.trackVisualTime(function(){return r.wrappedVisual.getSubSelectionStyles(e)})},t.prototype.getSubSelectionShortcuts=function(e,r){var n=this;if(this.wrappedVisual.getSubSelectionShortcuts)return this.trackVisualTime(function(){return n.wrappedVisual.getSubSelectionShortcuts(e,r)})},t.prototype.getSubSelectables=function(e){var r=this;if(this.wrappedVisual.getSubSelectables)return this.trackVisualTime(function(){return r.wrappedVisual.getSubSelectables(e)})},t.prototype.getNextSubSelectable=function(e,r){var n=this;if(this.wrappedVisual.getNextSubSelectable)return this.trackVisualTime(function(){return n.wrappedVisual.getNextSubSelectable(e,r)})},t.prototype.getSubSelectionStylesAsync=function(e){var r=this;return this.wrappedVisual.getSubSelectionStylesAsync?this.trackVisualTime(function(){return r.wrappedVisual.getSubSelectionStylesAsync(e)}):un.resolve(this.getSubSelectionStyles(e))},t.prototype.getSubSelectionShortcutsAsync=function(e,r){var n=this;return this.wrappedVisual.getSubSelectionShortcutsAsync?this.trackVisualTime(function(){return n.wrappedVisual.getSubSelectionShortcutsAsync(e,r)}):un.resolve(this.getSubSelectionShortcuts(e))},t.prototype.getSubSelectablesAsync=function(e){var r=this;return this.wrappedVisual.getSubSelectablesAsync?this.trackVisualTime(function(){return r.wrappedVisual.getSubSelectablesAsync(e)}):un.resolve(this.getSubSelectables(e))},t.prototype.onDataViewObjectChanged=function(e,r){var n=this;if(this.wrappedVisual.onDataViewObjectChanged)return this.trackVisualTime(function(){return n.wrappedVisual.onDataViewObjectChanged(e,r)})},t.prototype.trackVisualTime=function(e,r){var n=r&&r();try{return e()}finally{n&&n.resolve()}},t}(),_l=[];function K(){return function(t,e,r){Object.defineProperty(r.value,"approvedMessage",{value:!0})}}function Qn(){return _l}Ax.forEach(function(t){return function(t){Qn().push(t)}(t)});var jh=function(){function t(r,n,i,a,o,s){this.plugin=r,this.creator=n,this.promiseFactory=i,this.telemetryService=a,this.module=o,this.certifiedEventsService=s,this.initialized=!1,this.destroyed=!1,this.isPluginInError=!1,u.assertValue(r,"plugin"),u.assertValue(n||this.plugin.createES6,"creator"),u.assertValue(i,"promiseFactory"),u.assertAnyValue(this.telemetryService,"telemetryService"),u.assertAnyValue(o,"module"),u.assertAnyValue(this.certifiedEventsService,"certifiedEventsService");var l=r.apiVersion,c=this.getVersionIndex(l);l?c>-1?(this.apiVersionIndex=c,this.legacy=!1):(u.assertFail("The API version '"+l+"' is invalid."),this.isPluginInError=!0):this.legacy=!0}var e;return t.prototype.init=function(r){return nt(this,void 0,void 0,function(){return it(this,function(n){return this.initializedPromise=this.initImpl(r),[2,this.initializedPromise]})})},t.prototype.initImpl=function(r){return nt(this,void 0,void 0,function(){var n,i,a,o,s=this;return it(this,function(l){switch(l.label){case 0:return u.assert(function(){return!s.initialized},"Unexpected `init` after already initialized"),u.assertValue(r.element,"options.element"),u.assertValue(r.host,"options.host"),r.element.empty(),r=ve(r),this.legacy?(a={module:this.module,featureSwitches:r.featureSwitches},this.plugin.createES6?(n=this,[4,this.plugin.createES6(a)]):[3,2]):[3,5];case 1:return n.visual=l.sent(),this.destroyed?[2]:[3,3];case 2:this.visual=this.creator(a),l.label=3;case 3:return[4,this.visualLegacy.init(r)];case 4:return l.sent(),this.destroyed?[2]:[3,9];case 5:return i=this.host=_l[this.apiVersionIndex].hostAdapter(r),a={element:r.element.get(0),host:i,module:this.module,featureSwitches:r.featureSwitches},this.plugin.createES6?(o=this,[4,this.plugin.createES6(a)]):[3,7];case 6:return o.visual=l.sent(),this.destroyed?[2]:[3,8];case 7:this.visual=this.creator(a),l.label=8;case 8:this.overloadMethods(),l.label=9;case 9:return this.initialized=!0,[2]}})})},t.prototype.update=function(r){return nt(this,void 0,void 0,function(){var n,i=this;return it(this,function(a){switch(a.label){case 0:return u.assertValue(function(){return i.initialized},"Expected `init` before `update`"),n=this.initializedPromise,[4,this.initializedPromise];case 1:return a.sent(),u.assert(function(){return i.initializedPromise===n},"Unexpected re-initialize during update"),this.destroyed||!this.initialized?[2]:(this.plugin.systemVisual||((r=ve(r)).visualDefinitionData=void 0,r.dataTransforms=void 0),(r.type&_t.Resize)===_t.Resize&&this.visualHasMethod("onResizing")?this.plugin.custom&&this.visualHasMethod("update")?[4,this.visualLegacy.update(r)]:[3,3]:[3,4]);case 2:if(a.sent(),this.destroyed)return[2];a.label=3;case 3:return this.onResizing(r.viewport,r.resizeMode),[3,7];case 4:return this.visualHasMethod("update")?[4,this.visualLegacy.update(r)]:[3,6];case 5:return a.sent(),this.destroyed?[2]:[3,7];case 6:(!r.type||r.type&_t.Data)&&this.onDataChanged(_.pick(r,["dataViews","operationKind"])),r.type&_t.ViewMode&&this.onViewModeChanged(r.viewMode),a.label=7;case 7:return[2]}})})},t.prototype.destroy=function(){this.visualHasMethod("destroy")&&this.visualLegacy.destroy(),this.initialized=!1,this.destroyed=!0},t.prototype.enumerateObjectInstances=function(r){if(this.visualHasMethod("enumerateObjectInstances"))return this.visualLegacy.enumerateObjectInstances(r)},t.prototype.enumerateObjectRepetition=function(){if(this.visualHasMethod("enumerateObjectRepetition"))return this.visualLegacy.enumerateObjectRepetition()},t.prototype.enumerateObjectInstancesAsync=function(r){return this.visualHasMethod("enumerateObjectInstancesAsync")?this.visualAdapter.enumerateObjectInstancesAsync(r):this.promiseFactory.resolve(this.enumerateObjectInstances(r))},t.prototype.enumerateObjectRepetitionAsync=function(){return this.visualHasMethod("enumerateObjectRepetitionAsync")?this.visualAdapter.enumerateObjectRepetitionAsync():this.promiseFactory.resolve(this.enumerateObjectRepetition())},Object.defineProperty(t.prototype,"sandbox",{get:function(){return this.visualAdapter&&this.visualAdapter.sandbox},enumerable:!1,configurable:!0}),t.prototype.onResizing=function(r,n){this.visualHasMethod("onResizing")&&this.visualLegacy.onResizing(r,n)},t.prototype.onDataChanged=function(r){this.visualHasMethod("onDataChanged")&&this.visualLegacy.onDataChanged(r)},t.prototype.onViewModeChanged=function(r){this.visualHasMethod("onViewModeChanged")&&this.visualLegacy.onViewModeChanged(r)},t.prototype.onSelectionStateChanged=function(r){this.visualHasMethod("onSelectionStateChanged")&&this.visualLegacy.onSelectionStateChanged(r)},t.prototype.onClearSelection=function(){this.visualHasMethod("onClearSelection")&&this.visualLegacy.onClearSelection()},t.prototype.onRestoreSelection=function(r){if(this.visualHasMethod("onRestoreSelection"))return this.visualLegacy.onRestoreSelection(r)},t.prototype.canResizeTo=function(r){if(this.visualHasMethod("canResizeTo"))return this.visualLegacy.canResizeTo(r)},t.prototype.unwrap=function(){return this.visual},t.prototype.getTelemetryInformation=function(){if(this.visualHasMethod("getTelemetryInformation"))return this.visualLegacy.getTelemetryInformation()},t.prototype.getFormattingModel=function(){if(this.visualHasMethod("getFormattingModel"))return this.visualAdapter.getFormattingModel()},t.prototype.getFormattingModelAsync=function(){return this.visualHasMethod("getFormattingModelAsync")?this.visualAdapter.getFormattingModelAsync():this.promiseFactory.resolve(this.getFormattingModel())},t.prototype.resolveFormattingPlaceholder=function(r){if(this.visualHasMethod("resolveFormattingPlaceholder"))return this.visualLegacy.resolveFormattingPlaceholder(r)},t.prototype.getSubSelectionStyles=function(r){if(this.visualHasMethod("getSubSelectionStyles"))return this.visualAdapter.getSubSelectionStyles(r)},t.prototype.getSubSelectionShortcuts=function(r,n){if(this.visualHasMethod("getSubSelectionShortcuts"))return this.visualAdapter.getSubSelectionShortcuts(r,n)},t.prototype.getSubSelectables=function(r){if(this.visualHasMethod("getSubSelectables"))return this.visualAdapter.getSubSelectables(r)},t.prototype.getNextSubSelectable=function(r,n){if(this.visualHasMethod("getNextSubSelectable"))return this.visualAdapter.getNextSubSelectable(r,n)},t.prototype.getSubSelectionStylesAsync=function(r){return this.visualHasMethod("getSubSelectionStylesAsync")?this.visualAdapter.getSubSelectionStylesAsync(r):this.promiseFactory.resolve(this.getSubSelectionStyles(r))},t.prototype.getSubSelectionShortcutsAsync=function(r,n){return this.visualHasMethod("getSubSelectionShortcutsAsync")?this.visualAdapter.getSubSelectionShortcutsAsync(r,n):this.promiseFactory.resolve(this.getSubSelectionShortcuts(r,n))},t.prototype.getSubSelectablesAsync=function(r){return this.visualHasMethod("getSubSelectablesAsync")?this.visualAdapter.getSubSelectablesAsync(r):this.promiseFactory.resolve(this.getSubSelectables(r))},t.prototype.onDataViewObjectChanged=function(r,n){if(this.visualHasMethod("onDataViewObjectChanged"))return this.visualAdapter.onDataViewObjectChanged(r,n)},Object.defineProperty(t.prototype,"visualNew",{get:function(){if(!this.legacy)return this.visual},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualLegacy",{get:function(){if(this.legacy)return this.visual},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visualAdapter",{get:function(){return this.visual},enumerable:!1,configurable:!0}),t.prototype.visualHasMethod=function(r){var n=this.legacy?this.visualLegacy:this.visualNew;return function(t){return t&&"debugVisual"===t}(this.plugin.name)?n&&_.isFunction(n[r])&&n.visualHasMethod(r):n&&_.isFunction(n[r])},t.prototype.getVersionIndex=function(r){if(r)for(var n=Qn().length,i=0;i<n;i++)if(Qn()[i].version===r)return i;return-1},t.prototype.overloadMethods=function(){var r=this.getCompiledOverloads();for(var n in r)this[n]=r[n]},t.prototype.getCompiledOverloads=function(){for(var r={},n=this.apiVersionIndex,i=this.visualNew,a=0;a<=n;a++){var o=Qn()[a].overloads;_.isFunction(o)&&_.assign(r,o(i,this.host))}return r},W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",Object)],t.prototype,"enumerateObjectInstancesAsync",null),W([K(),x("design:type",Function),x("design:paramtypes",[]),x("design:returntype",Object)],t.prototype,"enumerateObjectRepetitionAsync",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object,Number]),x("design:returntype",void 0)],t.prototype,"onResizing",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"onDataChanged",null),W([K(),x("design:type",Function),x("design:paramtypes",[Number]),x("design:returntype",void 0)],t.prototype,"onViewModeChanged",null),W([K(),x("design:type",Function),x("design:paramtypes",[Boolean]),x("design:returntype",void 0)],t.prototype,"onSelectionStateChanged",null),W([K(),x("design:type",Function),x("design:paramtypes",[]),x("design:returntype",void 0)],t.prototype,"onClearSelection",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",Boolean)],t.prototype,"canResizeTo",null),W([K(),x("design:type",Function),x("design:paramtypes",[]),x("design:returntype",Object)],t.prototype,"getTelemetryInformation",null),W([K(),x("design:type",Function),x("design:paramtypes",[]),x("design:returntype",Object)],t.prototype,"getFormattingModelAsync",null),W([K(),x("design:type",Function),x("design:paramtypes",["function"==typeof(e="undefined"!=typeof TFormattingPlaceholder&&TFormattingPlaceholder)?e:Object]),x("design:returntype",Object)],t.prototype,"resolveFormattingPlaceholder",null),W([K(),x("design:type",Function),x("design:paramtypes",[Array]),x("design:returntype",Object)],t.prototype,"getSubSelectionStyles",null),W([K(),x("design:type",Function),x("design:paramtypes",[Array,String]),x("design:returntype",Array)],t.prototype,"getSubSelectionShortcuts",null),W([K(),x("design:type",Function),x("design:paramtypes",[Number]),x("design:returntype",Array)],t.prototype,"getSubSelectables",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object,Boolean]),x("design:returntype",Object)],t.prototype,"getNextSubSelectable",null),W([K(),x("design:type",Function),x("design:paramtypes",[Array]),x("design:returntype",Object)],t.prototype,"getSubSelectionStylesAsync",null),W([K(),x("design:type",Function),x("design:paramtypes",[Array,String]),x("design:returntype",Object)],t.prototype,"getSubSelectionShortcutsAsync",null),W([K(),x("design:type",Function),x("design:paramtypes",[Number]),x("design:returntype",Object)],t.prototype,"getSubSelectablesAsync",null),W([K(),x("design:type",Function),x("design:paramtypes",[Array,Number]),x("design:returntype",Array)],t.prototype,"onDataViewObjectChanged",null),t}();function ho(){return new xD}var Kh=!1;!function(){if(!Kh){var t=ho;Ea().createColorAllocatorFactory=function(){return t()},Kh=!0}}();var xD=function(){function t(){}return t.prototype.fromFillRule=function(e,r){var n=e.linearGradient2,i=e.linearGradient3;if(n||i){var a;i&&(a=void 0===i.min.value&&void 0===i.max.value&&void 0!==i.mid.value);var o=n?n.min:i.min,s=n?n.max:i.max;if(void 0===o.value&&(o.value=r.aggregates&&r.aggregates.min),void 0===s.value&&(s.value=r.aggregates&&r.aggregates.max),void 0!==o.value&&void 0!==s.value)return i&&void 0===i.mid.value&&(i.mid.value=(o.value+s.value)/2),n?new DD(n,r):a?new _D(i,r):new AD(i,r)}},t}();function Il(t){return t.strategy===uu}function Tl(t){switch(t.strategy){case vd:return;case gd:return t.color;case uu:u.assertFail("getColorFromNullStrategy - called with asZero");break;default:u.assertFail("getColorFromNullStrategy - Unexpected null strategy: "+t.strategy)}}var DD=function(){function t(e,r){this.options=e,this.source=r,u.assertValue(e,"options"),u.assertValue(r,"source");var n=e.min,i=e.max;this.scale=ui([n.value,i.value],[n.color,i.color],!0)}return t.prototype.color=function(e){var r=this.options.nullColoringStrategy;if(null===e&&r){if(!Il(r))return Tl(r);e=0}return this.scale(e)},t.prototype.getRule=function(){return{linearGradient2:this.options}},t.prototype.getSource=function(){return this.source},t}(),AD=function(){function t(e,r){this.options=e,this.source=r,u.assertValue(e,"options"),u.assertValue(r,"source"),this.options=e;var n=e.min,i=e.mid,a=e.max;this.scale=ui([n.value,i.value,a.value],[n.color,i.color,a.color],!0)}return t.prototype.color=function(e){var r=this.options.nullColoringStrategy;if(null===e&&r){if(!Il(r))return Tl(r);e=0}return this.scale(e)},t.prototype.getRule=function(){return{linearGradient3:this.options}},t.prototype.getSource=function(){return this.source},t}(),_D=function(){function t(e,r){this.options=e,this.source=r,u.assertValue(e,"options"),u.assertValue(r,"source"),this.options=e;var n=e.min,i=e.mid,a=e.max;this.scale1=ui([n.value,i.value],[n.color,i.color],!0),this.scale2=ui([i.value,a.value],[i.color,a.color],!0)}return t.prototype.color=function(e){var r=this.options.nullColoringStrategy;if(null===e&&r){if(!Il(r))return Tl(r);e=0}return e<=this.options.mid.value?this.scale1(e):this.scale2(e)},t.prototype.getRule=function(){return{linearGradient3:this.options}},t.prototype.getSource=function(){return this.source},t}(),TD=function(){function t(e,r){if(u.assertValue(e,"plugins"),r){var n=function(o){u.assert(function(){return!!_.find(e,function(s){return s.name===r[o].extends})},"plugin extension type '".concat(o,"' extends a plugin '").concat(r[o].extends,"' which doesn't exist")),u.assert(function(){return!_.some(e,function(s){return s.name===r[o].name})},"Cannot register plugin extension type '".concat(o,"'. A plugin with that name already exists."))};for(var i in r)n(i)}this.plugins=e,this.extensions=r||{}}return t.prototype.getPlugin=function(e){return this.plugins[Yh(e)]},t.prototype.getExtension=function(e){return this.extensions[e]},t}();function vo(t){return u.assertValue(t,"reference"),Yh(t.type)}function Yh(t){return t||"dsr"}var ND=function(){function t(e,r){u.assertValue(e,"factory"),u.assertValue(r,"hostServices"),this.factory=e,this.hostServices=r,this.readers={},this.queryGen={},this.schemaReaders={}}return t.prototype.reader=function(e){var r=this;return u.assertAnyValue(e,"typeOrTypes"),this.findSinglePropertyDefinition(hr(e),function(n){return n.reader(r.hostServices)},_.noop,this.readers)},t.prototype.readerType=function(e){var r=this;u.assertAnyValue(e,"typeOrTypes");var n=this.resolvePluginProperty(hr(e),function(i){return i.reader(r.hostServices)},_.noop,this.readers);return n&&n.type},t.prototype.queryGenerator=function(e){return u.assertAnyValue(e,"typeOrTypes"),this.findSinglePropertyDefinition(hr(e),function(r){return r.queryGenerator&&r.queryGenerator()},_.noop,this.queryGen)},t.prototype.queryExtensionLookup=function(e){u.assertAnyValue(e,"referenceOrReferences");var r=hr(e),n=_.chain(r).map(function(o){return vo(o)}).uniq().value(),i=this.findSingleBasePropertyDefinition(n,function(o){return o.queryExtensionProvider&&$h(o.name,r,o.queryExtensionProvider)});return function(t,e){if(t||e)return t?function(r,n){return t(r,n,e)}:e}(this.findSingleExtensionPropertyDefinition(n,function(o){return o.queryExtensionProvider&&$h(o.name,r,o.queryExtensionProvider)}),i)},t.prototype.schemaReader=function(e){var r=this;return u.assertAnyValue(e,"type"),this.findSinglePropertyDefinition([e],function(n){return n.schemaReader&&n.schemaReader(r.hostServices)},function(n){return n.schemaReader&&n.schemaReader(r.hostServices)},this.schemaReaders)},t.prototype.getCacheKey=function(e){var r=hr(e);return r.length<2?r[0]:"["+r.join(",")+"]"},t.prototype.findSinglePropertyDefinition=function(e,r,n,i){var a=this.getCacheKey(e),o=i[a];if(o)return o;var s=this.resolvePluginProperty(e,r,n,i);return s?i[a]=s.property:void 0},t.prototype.findSingleExtensionPropertyDefinition=function(e,r){for(var n,i,a=0,o=e;a<o.length;a++){var s=o[a],l=this.factory.getPlugin(s);if(l){if(i&&i!==l.name)return;i=l.name}else{var c=this.factory.getExtension(s);if(!c||i&&i!==c.extends)return;i=c.extends;var f=r(c);if(f){if(n&&f!==n)return;n=f}}}return n},t.prototype.findSingleBasePropertyDefinition=function(e,r){for(var n,i,a=0,o=e;a<o.length;a++){var l=this.factory.getPlugin(o[a]);if(l){if(i&&i!==l.name)return;i=l.name;var c=r(l);if(c){if(n&&c!==n)return;n=c}}}return n},t.prototype.resolvePluginProperty=function(e,r,n,i){for(var a,o=0,s=e;o<s.length;o++){var c=this.resolveProperty(s[o],r,n,i);if(!c||a&&c.property!==a.property)return;a=c}return a},t.prototype.resolveProperty=function(e,r,n,i){var a,o;if(i&&(o=i[a=this.getCacheKey(e)]))return{type:e,property:o};var s=this.factory.getPlugin(e);if(s)return(o=r(s))?(i&&(i[a]=o),{type:e,property:o}):void 0;var l=this.factory.getExtension(e);return l?(o=n(l))?(i&&(i[a]=o),{type:e,property:o}):this.resolveProperty(l.extends,r,n,i):void 0},t}();function $h(t,e,r){for(var n=[],i=0,a=e;i<a.length;i++){var o=a[i],s=vo(o);s===t&&n.push(o[s])}return r(n)}var Xh={},go=function(){function t(){}return t.clearQueryString=function(e){var r=t.parseQueryString();return delete r[e],t.rebuildQueryString(r)},t.clearQueryStrings=function(e){for(var r=t.parseQueryString(),n=0,i=e;n<i.length;n++)delete r[i[n]];return t.rebuildQueryString(r)},t.addOrUpdateQueryString=function(e,r){var n=t.parseQueryString();return n[e]=r,t.rebuildQueryString(n)},t.addOrUpdateQueryStringToUrl=function(e,r){for(var n=t.parseUrl(e),i=t.clearAllQueriesFromUrl(e),a=0,o=Object.keys(r);a<o.length;a++){var s=o[a];n[s]=r[s]}return i+t.rebuildQueryString(n)},t.getQueryStringValue=function(e){return t.parseQueryString()[e]},t.isQueryParamSet=function(e,r){var n=Xh[e];if(!r||void 0===n){var i=t.getQueryStringValue(e);n=null!=i&&"false"!==i&&("1"===i||"true"===i.toLowerCase()||i.length>1),r&&(Xh[e]=n)}return n},t.parseUrl=function(e){var r=e.indexOf("?"),n=r>=0?e.substr(r):void 0;return t.parseQueryString(n)},t.parseQueryString=function(e){void 0===e&&(e=window.location.search);var r={},n=e;if(n&&"?"===n.substr(0,1))for(var a=0,o=n.substr(1).split("&");a<o.length;a++){var l=o[a].split("="),c=l[0],d=l.slice(1).join("=");r[decodeURIComponent(c)]=decodeURIComponent(d)}return r},t.parseQueryStringWithMultipleKeyValues=function(e){void 0===e&&(e=window.location.search);var r={},n=e;if(n&&"?"===n.substr(0,1))for(var a=0,o=n.substr(1).split("&");a<o.length;a++){var l=o[a].split("="),c=l[0],d=l.slice(1).join("="),p=decodeURIComponent(d);r[decodeURIComponent(c)]?r[decodeURIComponent(c)].push(p):r[decodeURIComponent(c)]=[p]}return r},t.rebuildQueryString=function(e){var r="",n=!0;for(var i in e)n||(r+="&"),r+=encodeURIComponent(i)+"=",e[i]&&(r+=encodeURIComponent(e[i])),n=!1;return n||(r="?"+r),r},t.clearAllQueriesFromUrl=function(e){var r=e.indexOf("?"),n=e.indexOf("#");return n>=0&&(n<r||-1===r)&&(r=n),r>=0?e.substr(0,r):e},t.fileOfUrl=function(e){var r=(e=t.clearAllQueriesFromUrl(e)).lastIndexOf("/");return-1!==r&&(e=e.substring(r+1)),e},t.OriginClientActivityIdParameterName="caid",t.OriginRootActivityIdParameterName="raid",t.OriginActivityIdParameterName="aid",t}();function Zh(){var t=Bs();return t.QueryStringUtil||(t.QueryStringUtil={}),t.QueryStringUtil}var ev=!1;function BD(){return window}function OD(t,e,r){return void 0===e&&(e=3),void 0===r&&(r=0),function(n,i,a){u.assertValue(n,"target"),u.assertValue(i,"propertyKey");var o=a.value;return a.value=function(){for(var s=this,l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];u.assert(function(){return!_.isEmpty(t)},"eventName"),u.assert(function(){return 0!==e},"activityAction");for(var f=BD();!(f==window.top||f.featureSwitchService&&f.telemetryService);)f=f.parent;var v,d=f.featureSwitchService,p=f.telemetryService,h=!1;if(d&&d.isFeatureSwitchesRegistered()&&d.featureSwitches&&d.featureSwitches.telemetryV2&&p||(h=!0),h)return v=o.apply(this,l);var g=Zone&&Zone.current,y=g&&g.get("data"),m=y&&y.monitoredActivity;ie(e,1)&&(m=p.startMonitoredActivity(m,t,{baseVersion:"v2",isFireAndForget:1===r||void 0}),g=m.currentZone),u.assertValue(g,"currentZone");try{g.run(function(){return v=o.apply(s,l)})}catch(S){if(ie(e,2))return void yo(m,S);throw S}return ie(e,2)&&(u.assert(function(){return g.name===t},"Event name should be same as the current zone name"),v&&_.isObject(v)&&v.then&&_.isFunction(v.then)?v.then(function(){yo(m)},function(S){yo(m,S)}):(u.assertValue(m,"Decorated method called without a start action"),yo(m))),v},a}}function yo(t,e){u.assertValue(t,"Decorated method called without a start action"),t&&(e?t.reject(e):t.resolve())}!function(){if(!ev){var t=go.getQueryStringValue;Zh().getQueryStringValue=function(r){return t(r)};var e=go.parseQueryString;Zh().parseQueryString=function(r){return void 0===r&&(r=window.location.search),e(r)},ev=!0}}();var t,Wn=(t={},window.powerbi||(window.powerbi={}),window.powerbi.visuals||(window.powerbi.visuals={}),window.powerbi.visuals.plugins?t=window.powerbi.visuals.plugins:window.powerbi.visuals.plugins=t,t),Tt=function(t){return t[t.CustomVisualJavascript=0]="CustomVisualJavascript",t[t.CustomVisualsCss=1]="CustomVisualsCss",t[t.CustomVisualScreenshot=2]="CustomVisualScreenshot",t[t.CustomVisualIcon=3]="CustomVisualIcon",t[t.CustomVisualWatermark=4]="CustomVisualWatermark",t[t.CustomVisualMetadata=5]="CustomVisualMetadata",t[t.Image=100]="Image",t[t.ShapeMap=200]="ShapeMap",t[t.CustomTheme=201]="CustomTheme",t[t.BaseTheme=202]="BaseTheme",t[t.DashboardTheme=203]="DashboardTheme",t[t.DashboardBaseTheme=204]="DashboardBaseTheme",t[t.HighContrastTheme=205]="HighContrastTheme",t[t.AppNavigation=206]="AppNavigation",t[t.AppTheme=207]="AppTheme",t[t.AppBaseTheme=208]="AppBaseTheme",t}({}),tv="PBI.ApprovedResource.FailLoaded",rv=(q[tv]=H(tv),"PBI.ApprovedResource.SuccessfulLoad"),nv=(q[rv]=H(rv),"PBI.ApprovedResource.EndpointDown"),iv=(q[nv]=H(nv),"PBI.ApproveResource.LoadResourcePackage"),av=(q[iv]=H(iv),"PBI.AppSourceResource.EndpointDown"),ov=(q[av]=H(av),"PBI.VisualConsent.Register"),sv=(q[ov]=H(ov),"PBI.VisualConsent.Set"),uv=(q[sv]=H(sv),"PBI.VisualConsent.Get"),lv=(q[uv]=H(uv),"PBI.VisualEvent.DownloadContentEvent"),cv=(q[lv]=H(lv),"PBI.TrustedVisual.Load"),fv=(q[cv]=H(cv),"PBI.TrustedVisual.GetConsent"),dv=(q[fv]=H(fv),"PBI.VisualAuthentication.GetResourceUrl"),pv=(q[dv]=H(dv),"PBI.VisualAuthentication.GetAADToken"),hv=(q[pv]=H(pv),"PBI.VisualAuthentication.GetWACToken"),Pl=(q[hv]=H(hv),"PBI.LocalResource.LoadResourcePackageItem"),vv=(q[Pl]=H(Pl),"PBI.VisualAuthentication.BlockAccessToken"),gv=(q[vv]=H(vv),"PBI.AdminControl.Initialized"),yv=(q[gv]=H(gv),"PBI.Pbiviz.UnzipFailed"),mv=(q[yv]=H(yv),"PBI.CustomVisualsLicense.LicensesLoaded"),Sv=(q[mv]=H(mv),"PBI.CustomVisualsLicense.GetServicePlansCalled"),bv=(q[Sv]=H(Sv),"PBI.CustomVisualsLicense.PrefetchServicePlansCalled"),Ev=(q[bv]=H(bv),"PBI.VisualEvent.LocalStorageV2Event"),Cv=(q[Ev]=H(Ev),"PBI.VisualEvent.AcquireAADToken"),jn=(q[Cv]=H(Cv),{});function mo(t,e){var r=Vl[t]||e;return u.assertValue(r,"Invalid package name for resource package"),r}function QD(t){return function(e){return e.get(t)}}function Ir(t,e){return"function"==typeof t?t(e):"string"==typeof t?t:void 0}jn[Tt.BaseTheme]=function(t){return"BaseThemes/".concat(t,".json")},jn[Tt.CustomTheme]=function(t){return"BuiltInThemes/".concat(t,".json")},jn[Tt.HighContrastTheme]=function(t){return"HighContrastThemes/".concat(t,".json")},jn[Tt.Image]=function(t){return"Images/".concat(t)},jn[Tt.ShapeMap]=function(t){return"Shapemaps/".concat(t,".json")};var WD=["displayName","description","placeHolderText"],jD={get:function(e){return e},getOptional:function(e){return e},format:function(e){return e}};function So(t){t.apiVersion?function(t){!function(t){t&&(function(t){for(var e in t){var r=t[e];if(r){var n=r.properties;if(n)for(var i in n){var a=n[i];if(a){var o=a.type;o&&o.enumeration&&(o.enumeration=su(o.enumeration))}}}}}(t.objects),function(t){for(var e in t){var r=t[e];r&&r.kind&&(r.kind=Vv(r.kind.toString()))}}(t.dataRoles),function(t){for(var e in t){var r=t[e];if(r){var n=r.conditions;if(n)for(var i in n){var a=n[i];if(a)for(var o in a){var s=a[o];s&&s.kind&&(a[o].kind=Vv(s.kind.toString()))}}}}}(t.dataViewMappings))}(t.capabilities)}(t):function(t){!function(t){t&&(function(t){for(var e in t){var r=t[e];if(r){var n=(r=t[e]=_.mapValues(r,bo)).properties;if(n)for(var i in n){var a=n[i];if(a){var o=(a=n[i]=_.mapValues(a,bo)).type;if(o&&o.enumeration&&_.isFunction(o.enumeration.members)){var s=o.enumeration.members().map(function(l){return _.mapValues(l,bo)});o.enumeration=su(s)}}}}}}(t.objects),function(t){for(var e in t){var r=t[e];r&&(t[e]=_.mapValues(r,bo))}}(t.dataRoles))}(t.capabilities)}(t)}function Vv(t){switch(t.toLowerCase()){case"grouping":case at.Grouping.toString():return at.Grouping;case"measure":case at.Measure.toString():return at.Measure;case"groupingormeasure":case at.GroupingOrMeasure.toString():return at.GroupingOrMeasure}}function bo(t,e){return _.isString(t)||-1===_.indexOf(WD,e)?t:Ir(t,jD)}function Eo(t,e,r,n){void 0===r&&(r=!1),void 0===n&&(n=null);var i={major:1,minor:8,patch:0},a=document.createElement("script");a.innerHTML=r?n&&sn(n,i)||rh(n,i)?function(t){return"\n                (function(powerbi) {\n                    var window = this;\n\n                    //These 2 lines are needed to trick lodash into using this as global scope\n                    var self = this;\n                    self.Object = Object;\n\n                    //de-reference powerbi loaded modules\n                    var $, jQuery, _;\n                    window.jQuery = window.$ = undefined;\n                    window._ = undefined;\n\n                    ".concat(t,";\n\n                    //overwrite global variables with window values for PowerBI libraries\n                    $ = jQuery = window.$;\n                    _ = window._\n                }).call(\n                    //generate isolated clone of window object\n                    (function(w) {\n                        var wKeys = Object.getOwnPropertyNames(w);\n                        var nextW = w;\n                        while ((nextW = Object.getPrototypeOf(nextW))) {\n                            wKeys = wKeys.concat(Object.getOwnPropertyNames(nextW));\n                        }\n                        var newWindow = Object.create(w);\n                        //rebuild some of the window properties so they work correctly\n                        for (var i = 0; i < wKeys.length; i++) {\n                            try {\n                                var key = wKeys[i];\n                                var item = w[key];\n                                //rebind native functions to proper window context\n                                if (typeof item === 'function') {\n                                    if ((/\\{\\s*\\[native code\\]\\s*\\}/).test('' + Function.prototype.toString.call(item))) {\n                                        newWindow[key] = item.bind(w);\n                                        //remap prototype\n                                        newWindow[key].prototype = item.prototype;\n                                        //remap own properties\n                                        var fKeys = Object.getOwnPropertyNames(item);\n                                        for (var j = 0; j < fKeys.length; j++) {\n                                            var fKey = fKeys[j];\n                                            if(fKey === 'arguments' || fKey === 'caller') continue;\n                                            try {\n                                                newWindow[key][fKey] = item[fKey];\n                                            } catch (e) { /* catch protected function properties */}\n                                        }\n                                    }\n                                //map getters to proper context (needed for firefox only)\n                                } else if (typeof item === 'object') {\n                                \t\tif (key ===\"window\" || key === \"self\"){\n                                            Object.defineProperty(newWindow, key, {\n                                                get: (function(newWindow) {\n                                                    return function() {\n                                                        return newWindow;\n                                                    }\n                                                })(newWindow),\n                                                set: function() { }\n                                        });\n                                    } else {\n                                        Object.defineProperty(newWindow, key, {\n                                            get: (function(item) {\n                                                return function() {\n                                                    return item;\n                                                }\n                                            })(item),\n                                            set: function() { }\n                                        });\n                                    }\n                                } else if (typeof item === 'number' || typeof item === 'boolean' || typeof item === 'string') {\n                                      Object.defineProperty(newWindow, key, {\n                                          get: (function(w, keyString) {\n                                              return function() {\n                                                  return w[keyString];\n                                              }\n                                          })(w, key.toString()),\n                                          set: (function(w, keyString) {\n                                              return function(newValue) {\n                                                  w[keyString] = newValue;\n                                              }\n                                          })(w, key.toString())\n                                      });\n                                }\n                            } catch (e) { /* catch sandbox security exceptions */ }\n                        }\n                        return newWindow;\n                    })(window),\n                    powerbi || (powerbi = {})\n                );\n            ")}(e):function(t){return"\n                (function(powerbi) {\n                    var window = this;\n\n                    //These 2 lines are needed to trick lodash into using this as global scope\n                    var self = this;\n                    self.Object = Object;\n\n                    //de-reference powerbi loaded modules\n                    var $, jQuery, _;\n                    window.jQuery = window.$ = undefined;\n                    window._ = undefined;\n\n                    ".concat(t,";\n\n                    //overwrite global variables with window values for PowerBI libraries\n                    $ = jQuery = window.$;\n                    _ = window._\n                }).call(\n                    //generate isolated clone of window object\n                    (function(w) {\n                        var wKeys = Object.getOwnPropertyNames(w);\n                        var nextW = w;\n                        while ((nextW = Object.getPrototypeOf(nextW))) {\n                            wKeys = wKeys.concat(Object.getOwnPropertyNames(nextW));\n                        }\n                        var newWindow = Object.create(w);\n                        //rebuild some of the window properties so they work correctly\n                        for (var i = 0; i < wKeys.length; i++) {\n                            try {\n                                var key = wKeys[i];\n                                var item = w[key];\n                                //rebind native functions to proper window context\n                                if (typeof item === 'function') {\n                                    if ((/\\{\\s*\\[native code\\]\\s*\\}/).test('' + Function.prototype.toString.call(item))) {\n                                        newWindow[key] = item.bind(w);\n                                        //remap prototype\n                                        newWindow[key].prototype = item.prototype;\n                                        //remap own properties\n                                        var fKeys = Object.getOwnPropertyNames(item);\n                                        for (var j = 0; j < fKeys.length; j++) {\n                                            var fKey = fKeys[j];\n                                            if(fKey === 'arguments' || fKey === 'caller') continue;\n                                            try {\n                                                newWindow[key][fKey] = item[fKey];\n                                            } catch (e) { /* catch protected function properties */}\n                                        }\n                                    }\n                                //map getters to proper context (needed for firefox only)\n                                } else if (typeof item === 'object') {\n                                    Object.defineProperty(newWindow, key, {\n                                        get: (function(item) {\n                                            return function() {\n                                                return item;\n                                            }\n                                        })(item),\n                                        set: function() { }\n                                    });\n                                }\n                            } catch (e) { /* catch sandbox security exceptions */ }\n                        }\n                        return newWindow;\n                    })(window),\n                    powerbi || (powerbi = {})\n                );\n            ")}(e):e,a.id="js-"+t,a.setAttribute("name",t),document.body.appendChild(a)}function Co(t,e){var r=$("<style></style>",{html:e,id:"css-"+t});r.attr("name",t),$("head").append(r)}function xv(t,e){!function(t,e,r){u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t&&(xt(t,e,r),ki(t,e,r),cn(t,e))}(t,e,"MatrixColumnsGroup")}function ln(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.bind;n&&e.visitRole(n.to,r)}function xt(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.for;n&&e.visitRole(n.in,r)}function gA(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.composite;if(n){e.enterComposite&&e.enterComposite(t);for(var i=0,a=n;i<a.length;i++){var o=a[i];ln(o,e,r),xt(o,e,r)}e.exitComposite&&e.exitComposite(t)}}function ki(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.select;if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];ln(o,e,r),xt(o,e,r)}}function cn(t,e){if(u.assertValue(t,"mapping"),u.assertValue(e,"visitor"),e.visitReduction){var r=t.dataReductionAlgorithm;r&&e.visitReduction(r)}}function wo(t,e){u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t&&(fn(t,e,"CategoricalCategory"),Dt(t,e,"CategoricalCategory"),Li(t,e,"CategoricalCategory"),dn(t,e))}function Nl(t,e){if(u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t){fn(t,e,"CategoricalValue"),Dt(t,e,"CategoricalValue"),Li(t,e,"CategoricalValue");var r=t.group;if(r)for(var n=0,i=r.select;n<i.length;n++){var a=i[n];fn(a,e,"CategoricalValueGroup"),Dt(a,e,"CategoricalValueGroup")}}}function kl(t,e){!function(t,e,r){if(u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t){Dt(t,e,r),function(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.select;if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];fn(o,e,r),Dt(o,e,r),AA(o,e,r)}}(t,e,r),dn(t,e);var n=t.values;if(!n)return;Dt(n,e,"MatrixRowsScopedValue"),Li(n,e,"MatrixRowsScopedValue")}}(t,e,"MatrixRowsGroup")}function Av(t,e){!function(t,e,r){u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t&&(Dt(t,e,r),Li(t,e,r),dn(t,e))}(t,e,"MatrixIntersection")}function fn(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.bind;n&&e.visitRole(n.to,r)}function Dt(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.for;n&&e.visitRole(n.in,r)}function AA(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.composite;if(n){e.enterComposite&&e.enterComposite();for(var i=0,a=n;i<a.length;i++){var o=a[i];fn(o,e,r),Dt(o,e,r)}e.exitComposite&&e.exitComposite()}}function Li(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.select;if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];fn(o,e,r),Dt(o,e,r)}}function dn(t,e){if(u.assertValue(t,"mapping"),u.assertValue(e,"visitor"),e.visitReduction){var r=t.dataReductionAlgorithm;r&&e.visitReduction(r)}}function pn(t){return t&&t.usage&&t.usage.regression||void 0}var hn=function(){function t(e){this.includeScopedValuesRoles=e,this.roleNames=[]}return t.prototype.visitRole=function(e,r){(this.includeScopedValuesRoles||"MatrixRowsScopedValue"!==r)&&this.roleNames.push(e)},t.fromMatrixRows=function(e,r){var n=new this(r);return kl(e,n),n.roleNames},t.fromMatrixColumns=function(e){var r=new this;return kl(e,r),r.roleNames},t.fromMatrixValues=function(e){var r=new this;return Av(e,r),r.roleNames},t.FromCategoricalValues=function(e){var r=new this;return Nl(e,r),r.roleNames},t.fromCategoricalCategories=function(e){var r=new this;return wo(e,r),r.roleNames},t}();function Tv(t,e){if(u.assertValue(t,"categoricalRoleMappings"),u.assertValue(e,"rolesGetter"),0!==_.size(t)){var r=_.map(t,function(i){return e(i)}),n=r[0];if(!(r.length>=2)||_.every(r,function(i){return Ae(i,n,function(a,o){return a===o})}))return n}}function Pv(t){if(u.assertValue(t,"categoricalRoleMapping"),!t.categories)return[];var e=[];return wo(t.categories,{visitRole:function(n){e.push(n)}}),e}function Bi(t){if(u.assertAnyValue(t,"roleMappings"),!t)return 0;for(var e=0,r=0,n=t;r<n.length;r++){var i=n[r];i.categorical&&(e|=1),i.matrix&&(e|=2),i.single&&(e|=8),i.table&&(e|=8),i.tree&&(e|=16)}return e}function Ui(t){if(t){if(t.top)return"top";if(t.window)return"window";if(t.bottom)return"bottom";if(t.binnedLineSample)return"binnedLineSample";if(t.overlappingPointsSample)return"overlappingPointsSample";if(t.sample)return"sample";if(t.topNPerLevel)return"topNPerLevel"}}function Oi(t){return!!(t&&t.propertyIdentifier&&t.propertyIdentifier.objectName&&t.propertyIdentifier.propertyName)}var Lv=function(){function t(e){this.expectedContext=e,this._items=[]}return Object.defineProperty(t.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),t.prototype.visitRole=function(e,r){var n;r===this.expectedContext&&(n=this._items).push.apply(n,e.items||[])},t.fromMatrixRows=function(e){if(!e.rows)return[];var r=new this("MatrixRowsGroup");return function(t,e){!function(t,e,r){if(u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t){var n=null==t?void 0:t.values;xt(t,e,r),function(t,e,r){u.assertValue(t,"mapping"),u.assertValue(e,"visitor");var n=t.select;if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];ln(o,e,r),xt(o,e,r),gA(o,e,r)}}(t,e,r),u.assert(function(){return!(t.dataReductionAlgorithm&&function(t){return t&&_.some(t,function(e){return e.dataReductionAlgorithm})}(t.select))},"Mapping has overall data reduction but also scoped data reduction(s)"),cn(t,e),n&&(xt(n,e,"MatrixRowsScopedValue"),ki(n,e,"MatrixRowsScopedValue"))}}(t,e,"MatrixRowsGroup")}(e.rows,r),r.items},t.fromMatrixColumns=function(e){if(!e.columns)return[];var r=new this("MatrixColumnsGroup");return xv(e.columns,r),r.items},t}();function qe(t,e){var r;if(e)return t&&(r=t[e.propertyIdentifier.objectName]),Bu(r,e.propertyIdentifier.propertyName,e.defaultValue)}function KA(t,e){var r=t.capabilities,n=Vo(t,e)||Vo(t,"en-US");return r&&n&&Bv(r,n),t}function Vo(t,e){var r=function(t){return{ar:"ar-SA",bg:"bg-BG",ca:"ca-ES",cs:"cs-CZ",da:"da-DK",de:"de-DE",el:"el-GR","en-US":"en-US",es:"es-ES",et:"et-EE",eu:"eu-ES",fi:"fi-FI",fr:"fr-FR",gl:"gl-ES",he:"he-IL",hi:"hi-IN",hr:"hr-HR",hu:"hu-HU",id:"id-ID",it:"it-IT",ja:"ja-JP",kk:"kk-KZ",ko:"ko-KR",lt:"lt-LT",lv:"lv-LV",ms:"ms-MY",no:"nb-NO",nl:"nl-NL",pl:"pl-PL",br:"pt-BR",pt:"pt-PT",ro:"ro-RO",ru:"ru-RU",sk:"sk-SK",si:"sl-SI","sr-Cyrl":"sr-Cyrl-RS","sr-Latn":"sr-Latn-RS",sv:"sv-SE",th:"th-TH",tr:"tr-TR",uk:"uk-UA",vi:"vi-VN","zh-Hans":"zh-CN","zh-Hant":"zh-TW"}[t]||t||navigator.language}(e);return t&&t.stringResources?t.stringResources[r]:null}function Bv(t,e){for(var r in t)t.hasOwnProperty(r)&&("object"==typeof t[r]?Bv(t[r],e):"displayNameKey"===r&&t.displayName?t.displayName=Ul(e,t.displayNameKey)||t.displayName:"descriptionKey"===r&&t.description?t.description=Ul(e,t.descriptionKey)||t.description:"placeHolderTextKey"===r&&t.placeHolderText&&(t.placeHolderText=Ul(e,t.placeHolderTextKey)||t.placeHolderText))}function Ul(t,e){return t[e]}function $A(t,e,r){return new ZA(t,e,r||new XA(t.promiseFactory))}var Uv,XA=function(){function t(e){this.promiseFactory=e}return t.prototype.get=function(e,r,n){return u.assertFail("Referenced omitted sharedResourceItemProxy"),this.promiseFactory.reject()},t.prototype.getBlob=function(e,r,n){return u.assertFail("Referenced omitted sharedResourceItemProxy"),this.promiseFactory.reject()},t}(),ZA=function(){function t(e,r,n){this.provider=r,this.sharedResourceItemProxy=n,this.promiseFactory=e&&e.promiseFactory,this.locale=e&&e.locale,this.telemetryV2Enabled=e&&e.telemetryV2Enabled}return t.prototype.loadTrustedResourcePackages=function(e){return u.assertFail("Not supported"),this.promiseFactory.reject()},t.prototype.loadResourcePackages=function(e){u.assertValue(e,"resourcePackages");for(var r=[],n=0,i=e;n<i.length;n++)r.push(this.loadResourcePackage(i[n]));return this.promiseFactory.all(r)},t.prototype.loadResourcePackage=function(e){u.assertValue(e,"resourcePackage");var r=[];if(e&&e.items)for(var n=0,i=e.items;n<i.length;n++)r.push(this.loadCustomVisualResourcePackageItem(i[n],e));return this.promiseFactory.all(r)},t.prototype.loadResourcePackageItem=function(e,r){var n=function(t,e){return u.assertAnyValue(t,"It's possible it doesn't exist, lodash returns undefined for us."),_.find(t&&t.items,function(r){return r.name===e})}(e,r);return n?n.content?this.promiseFactory.resolve(n.content):this.loadBlob(e.id,e.name,n):(ot.warning("loadResourcePackageItem: item not found in package"),this.promiseFactory.resolve(null))},t.prototype.loadSharedResource=function(e,r){return r===Tt.Image?this.sharedResourceItemProxy.getBlob(null,mo(2),e,{retries:1}):this.sharedResourceItemProxy.get(null,mo(2),e,{retries:1})},t.prototype.loadVisualPlugin=function(e){var r=this;u.assertValue(e,"resourcePackage");var n=this.promiseFactory.defer();return e&&e.items&&e.items.length>0?this.loadResourcePackage(e).then(function(){var i=Wn[e.name];i?(i.iconUrl=r.getIconUrl(e),n.resolve(i)):n.reject("Unable to load visual plugin from resource package")}).catch(function(){n.reject("failed to resolve all promises")}):n.resolve(null),n.promise},t.prototype.destroy=function(){},t.prototype.loadVisualPlugins=function(e){u.assertValue(e,"resourcePackages");var r=[];if(e)for(var n=0,i=e;n<i.length;n++)r.push(this.loadVisualPlugin(i[n]));return this.promiseFactory.all(r)},t.prototype.getIconUrl=function(e){var n=$("#css-"+e.name)[0],i=_.find(document.styleSheets,function(s){return s.ownerNode===n});if(!i)return"";for(var a=0;a<i.cssRules.length;a++){var o=i.cssRules[a];if(o.selectorText&&o.selectorText===".visual-icon."+e.name)return o.style.backgroundImage}return""},t.prototype.loadCustomVisualResourcePackageItem=function(e,r){switch(e.type){case Tt.CustomVisualJavascript:return this.loadCustomVisualJS(r.id,r.name,e);case Tt.CustomVisualsCss:return this.loadCustomVisualCss(r.id,r.name,e);case Tt.CustomVisualMetadata:return this.loadCustomVisualMetadata(r.id,r.name,e)}},t.prototype.loadCustomVisualJS=function(e,r,n){var i=this,a=this.promiseFactory.defer();return n.content?(Eo(r,n.content),a.resolve(n.content)):(u.assertValue(this.provider,"resourceItemProxy is undefined"),this.provider.get(e,r,n.path,{retries:1}).then(function(o){Eo(r,o),n.content=o,i.transformPlugin(r).then(function(){return a.resolve(o)},function(s){return a.reject(s)})}).catch(function(o){a.reject(o)})),a.promise},t.prototype.transformPlugin=function(e){var r=Wn[e];return r?(So(r),this.promiseFactory.resolve()):this.promiseFactory.reject("Unable to load visual plugin from resource package: "+e)},t.prototype.loadCustomVisualCss=function(e,r,n){var i=this.promiseFactory.defer();return n.content?(Co(r,n.content),i.resolve(n.content)):(u.assertValue(this.provider,"resourceItemProxy is undefined"),this.provider.get(e,r,n.path,{retries:1}).then(function(a){Co(r,a),n.content=a,i.resolve(a)}).catch(function(a){i.reject(a)})),i.promise},t.prototype.loadCustomVisualMetadata=function(e,r,n){var i=this,a=this.promiseFactory.defer();try{n.content?a.resolve(this.createPlugin(r,n.content)):this.provider.get(e,r,n.path,{retries:1}).then(function(o){n.content=o,a.resolve(i.createPlugin(r,o))}).catch(function(o){a.reject(o)})}catch(o){a.reject(o)}return a.promise},t.prototype.createPlugin=function(e,r){u.assertAnyValue(r,"pbivizJsonString");var n=r;"object"!=typeof r&&(n=JSON.parse(r));var i=function(t,e,r){u.assertAnyValue(t,"pbivizjson"),u.assertAnyValue(t.content,"content"),u.assertAnyValue(t.content.iconBase64,"iconBase64"),t=e?KA(t,e):t;var n=e?Vo(t,e):null,i=Vo(t,"en-US"),o={name:t.visual.guid,apiVersion:t.apiVersion,class:t.visual.visualClassName,displayName:t.visual.displayName,capabilities:t.capabilities,custom:!0,iconUrl:'url("'+t.content.iconBase64+'")',content:t.content,version:t.visual.version,create:function(){return null},customizeQuery:function(l){return null},localizationResources:n||i?{enUSStrings:i,localizedStrings:n}:null,supportUrl:t.visual.supportUrl,source:0,publisher:t.author?t.author.name:void 0};return t.capabilities&&(t.capabilities.subtotals||t.capabilities.dataReductionCustomization)&&(o.customizeQuery=function(s){return function(t,e){e&&e.subtotals&&e.subtotals.matrix&&function(t){return t&&function(t){return t&&Oi(t.columnSubtotals)&&Oi(t.columnSubtotalsPerLevel)&&Oi(t.levelSubtotalEnabled)&&Oi(t.rowSubtotals)&&Oi(t.rowSubtotalsPerLevel)}(t.matrix)}(e.subtotals)&&function(t,e){u.assert(function(){return!!t},"options not defined"),u.assert(function(){return!!t.dataViewMappings},"dataViewMappings not defined");var r=t.dataViewMappings[0];if(r&&r.matrix&&r.metadata){var n=r.matrix;(function(t,e,r){var n=t.metadata.objects,i=t.metadata.columns,a=Lv.fromMatrixRows(e),o=qe(n,r.rowSubtotals),s=qe(n,r.rowSubtotalsPerLevel),l=2;if(null!=r.rowSubtotalsType&&"Top"===qe(n,r.rowSubtotalsType)&&(l=1),!_.isEmpty(a))for(var f=function(g){var y=_.find(i,function(S){return S.queryName===g.queryName});if(!y)return"continue";var m=qe(y.objects,r.levelSubtotalEnabled);g.subtotalType=!o||s&&!m?0:l},d=0,p=a;d<p.length;d++)f(p[d])})(r,n,e),function(t,e,r){var n=t.metadata.objects,i=t.metadata.columns,a=Lv.fromMatrixColumns(e),o=qe(n,r.columnSubtotals),s=qe(n,r.columnSubtotalsPerLevel);if(!_.isEmpty(a))for(var l=function(h){var v=_.find(i,function(y){return y.queryName===h.queryName});if(!v)return"continue";var g=qe(v.objects,r.levelSubtotalEnabled);h.subtotalType=!o||s&&!g?0:2},c=0,f=a;c<f.length;c++)l(f[c])}(r,n,e)}}(t,e.subtotals.matrix),e&&e.dataReductionCustomization&&function(t,e){var r,n,i,a,o,s,l,c,f,d,p,h,v,g=null===(r=null==t?void 0:t.dataViewMappings)||void 0===r?void 0:r[0],y=null===(n=null==g?void 0:g.metadata)||void 0===n?void 0:n.objects,m=Bi(t.dataViewMappings);if(function(t,e,r){var n=!0;if(!e||!e.dataReductionCustomization)return!1;switch(t){case 2:if(r.matrix){var i=qe(e,r.matrix.rowCount),a=qe(e,r.matrix.columnCount);void 0!==i&&(n=n&&i>=15&&i<=3e4),void 0!==a&&(n=n&&a>=1&&a<=2e3)}break;case 8:r.table&&void 0!==(i=qe(e,r.table.rowCount))&&(n=n&&i>=15&&i<=3e4);break;case 1:if(r.categorical){var o=qe(e,r.categorical.categoryCount),s=qe(e,r.categorical.groupedValuesCount);void 0!==o&&(n=n&&o>=15&&o<=3e4),void 0!==s&&(n=n&&s>=1&&s<=2e3)}}return n}(m,y,e))switch(m){case 2:var b=qe(y,e.matrix.rowCount),E=qe(y,e.matrix.columnCount),C=null===(a=null===(i=g.matrix)||void 0===i?void 0:i.columns)||void 0===a?void 0:a.dataReductionAlgorithm,w=null===(s=null===(o=g.matrix)||void 0===o?void 0:o.rows)||void 0===s?void 0:s.dataReductionAlgorithm;E&&C&&(C[Ui(C)].count=E),b&&w&&(w[Ui(w)].count=b);break;case 8:b=qe(y,e.table.rowCount),w=null===(c=null===(l=null==g?void 0:g.table)||void 0===l?void 0:l.rows)||void 0===c?void 0:c.dataReductionAlgorithm,b&&w&&(w[Ui(w)].count=b);break;case 1:var D=qe(y,e.categorical.categoryCount),A=qe(y,e.categorical.groupedValuesCount);C=null===(p=null===(d=null===(f=null==g?void 0:g.categorical)||void 0===f?void 0:f.values)||void 0===d?void 0:d.group)||void 0===p?void 0:p.dataReductionAlgorithm,w=null===(v=null===(h=null==g?void 0:g.categorical)||void 0===h?void 0:h.categories)||void 0===v?void 0:v.dataReductionAlgorithm,A&&C&&(C[Ui(C)].count=A),D&&w&&(w[Ui(w)].count=D)}}(t,e.dataReductionCustomization)}(s,t.capabilities)}),o}(n,this.locale);So(i);var a=Wn[i.name];return a&&!a.custom&&(i.custom=!1),a&&(i.favoriteId=a.favoriteId,i.isOutOfBox=a.isOutOfBox),Wn[i.name]=i,i},t.prototype.loadBlob=function(e,r,n){var i=this.promiseFactory.defer(this.telemetryV2Enabled);return n.contentBlob?i.resolve(n.contentBlob):n.promise?n.promise.then(function(a){return i.resolve(a)}):(n.promise=this.provider.getBlob(e,r,n.path,{retries:1}),n.promise.then(function(a){n.contentBlob=a,i.resolve(a)}).catch(function(a){i.reject(a)}).finally(function(){delete n.promise})),i.promise},W([OD(Pl),x("design:type",Function),x("design:paramtypes",[Object,String]),x("design:returntype",Object)],t.prototype,"loadResourcePackageItem",null),t}(),t_=function(){function t(e){this.windowMessageProxy=e}return t.prototype.logStandardizedFeatureEvent=function(e){this.windowMessageProxy.postMessage({eventName:"logStandardizedFeatureEvent",arguments:[e]})},t.prototype.logTimedStandardizedFeatureEvent=function(e){this.windowMessageProxy.postMessage({eventName:"logTimedStandardizedFeatureEvent",arguments:[e]})},t.prototype.startTimedStandardizedFeatureEvent=function(e){return new r_(this,e)},t}(),r_=function(){function t(e,r){this.certifiedEventsService=e,this.event=_.cloneDeep(r),this.event.operationStartTime=It()}return t.prototype.setAttributes=function(e){this.event.activityAttributes=ye({},e)},t.prototype.setAttribute=function(e,r){this.event.activityAttributes[e]=r},t.prototype.getAttributes=function(){return this.event.activityAttributes},t.prototype.complete=function(e,r){this.event.resultCode=r,this.event.activityStatus=e,this.event.operationEndTime=It(),this.certifiedEventsService.logTimedStandardizedFeatureEvent(this.event)},t}(),o_=function(){function t(e){this.windowMessageProxy=e}return t.prototype.getOpenActivityById=function(e){},t.prototype.suspend=function(){},t.prototype.resume=function(){},t.prototype.flush=function(){},t.prototype.restart=function(){},t.prototype.stopActivity=function(e,r,n){},t.prototype.startPerfEventDeprecated=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new qt(o)},t.prototype.logEvent=function(e,r){return u.assert(function(){return!_.isArray(r)},"Parameters has to be an object and instance of some telemetry factory arguments"),e===Bh?this.windowMessageProxy.postMessageAsync({eventName:"logEvent",arguments:["VisualApiUsage",r]}):e===Ah?this.windowMessageProxy.postMessageAsync({eventName:"logEvent",arguments:["VisualException",r]}):u.assertFail("Unknown eventFactory name ["+e+"]: sandboxTelemetryProxyService.ts#logEvent"),null},t.prototype.logTelemetryData=function(e,r,n){return null},t.prototype.logChildEvent=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i]},t.prototype.startActivity=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new qt(o)},t.prototype.startChildActivity=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i]},t.prototype.startEvent=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={info:{}};return new qt(a)},t.prototype.startMonitoredActivity=function(e,r,n){var a={info:{}};return{activityEvent:a,activityDeferred:new qt(a)}},t.prototype.startChildEvent=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new qt(o)},t.prototype.logTrace=function(e){},Object.defineProperty(t.prototype,"sessionId",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appInstanceId",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){},enumerable:!1,configurable:!0}),t.prototype.setHostInfo=function(e,r){},t.prototype.getHostData=function(){},t.prototype.setExpAssignmentContext=function(e){},t}(),qt=function(){function t(e){var r=this;u.assertValue(e,"event"),this.event=e,this.promise=new un(function(n,i){r.onResolve=n,r.onReject=i})}return t.prototype.resolve=function(){this.isEnded=!0,this.onResolve()},t.prototype.cancel=function(e){return e?this.resolve():this.reject({isCancelled:!0,errorCode:"non-ignorable cancellation of deferred telemety event"})},t.prototype.reject=function(e){this.isEnded=!0,this.onReject()},t.prototype.isActive=function(){return!this.isEnded},t}(),u_=function(){function t(){}return t.prototype.getOpenActivityById=function(e){},t.prototype.suspend=function(){},t.prototype.resume=function(){},t.prototype.flush=function(){},t.prototype.restart=function(){},t.prototype.stopActivity=function(e,r,n){},t.prototype.startPerfEventDeprecated=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new qt(o)},t.prototype.logEvent=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return null},t.prototype.logTelemetryData=function(e,r,n){return null},t.prototype.logChildEvent=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i]},t.prototype.startActivity=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new qt(o)},t.prototype.startChildActivity=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i]},t.prototype.startEvent=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a={info:{}};return new qt(a)},t.prototype.startMonitoredActivity=function(e,r,n){var a={info:{}};return{activityEvent:a,activityDeferred:new qt(a)}},t.prototype.startChildEvent=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o={info:{}};return new qt(o)},t.prototype.logTrace=function(e){},Object.defineProperty(t.prototype,"sessionId",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appInstanceId",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){},enumerable:!1,configurable:!0}),t.prototype.setHostInfo=function(e,r){},t.prototype.getHostData=function(){},t.prototype.setExpAssignmentContext=function(e){},t}();function zi(t){return new Ov(t)}var Ov=function(){function t(e){var r=this;this[Uv]="Promise",u.assertValue(e,"deferred"),this.deferred=e,this.state=0,e.promise.then(function(){return r.state=1},function(){return r.state=2})}return t.prototype.then=function(e,r){return this.deferred.promise.then(e,r)},t.prototype.catch=function(e){return this.deferred.promise.catch(e)},t.prototype.finally=function(e){return this.deferred.promise.finally(e)},t.prototype.resolved=function(){return 1===this.state},t.prototype.rejected=function(){return 2===this.state},t.prototype.pending=function(){return 0===this.state},t.prototype.reject=function(e){this.pending()&&(this.deferred.reject(e),this.state=2)},t}();Uv=Symbol.toStringTag;var zv="PBI.Data.QueryData",qv=(q[zv]=H(zv),"PBI.Data.QueryCancellation"),c_=q[qv]=H(qv,{logRatio:1e-4}),Hv="PBI.Data.ClientCacheHit",Gv=q[Hv]=H(Hv,{logRatio:1e-4}),Qv="PBI.Data.GetConceptualSchema",Wv=(q[Qv]=H(Qv),"PBI.Data.ClearConceptualSchemaCache"),jv=(q[Wv]=H(Wv),"PBI.Data.ExecuteQuery"),Ol=q[jv]=H(jv),Kv="PBI.Data.DsrToDataView",f_=q[Kv]=H(Kv,{logRatio:1e-4}),vn="Client Error Code",Jv="Error Code",Yv="Error Details",zl="HTTP Request Id",$v=function(){function t(e){this.code=e,this.ignorable=!1,u.assertValue(e,"code")}return t.prototype.getDetails=function(e){return{resourceKey:"ClientError_UnknownClientErrorKey",message:e.get("ClientError_UnknownClientErrorValue"),displayableErrorInfo:[{errorInfoKey:e.get("ClientError_UnknownClientErrorKey"),errorInfoValue:e.get("ClientError_UnknownClientErrorValue")}],debugErrorInfo:[{errorInfoKey:vn,errorInfoValue:this.code}]}},t}(),Xv={additionalInfoKey:"Rls_Unauthorized_VisualErrorTitle",additionalInfoValue:"Rls_Unauthorized_VisualErrorMessage",localizedMessage:"Rls_Unauthorized_VisualError",helpLinkInfo:{helpLink:"https://go.microsoft.com/fwlink/?LinkID=785016",helpLinkType:1}},g_={RLSNotAuthorizedForModel:Xv,NotAuthorizedForImpersonation:Xv,TokenExpired:{localizedMessage:"ClientError_TokenExpired"}},m_=function(){function t(e,r,n,i,a){this.statusCode=e,this.httpRequestId=r,this.detailedErrorCode=n,this.detailedMessage=i,this.source=a,u.assertValue(e,"httpStatusCode")}return Object.defineProperty(t.prototype,"code",{get:function(){return this.detailedErrorCode||"HttpClientError"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.httpRequestId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpStatusCode",{get:function(){return this.statusCode},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){var r=this.detailedErrorCode&&g_[this.detailedErrorCode];if(r){var n=r.localizedMessage,i=r.additionalInfoKey||"DsrError_Key",a=r.additionalInfoValue||n||"DsrError_UnknownErrorValue",o=r.helpLinkInfo;return{resourceKey:i,message:n?e.get(n):null,displayableErrorInfo:[{errorInfoKey:e.get(i),errorInfoValue:e.get(a)}],debugErrorInfo:[],helpLink:o&&o.helpLink,helpLinkType:o&&o.helpLinkType,hideAdditionalErrorInfo:!0,source:this.source}}return this.getGenericErrorDetails(e)},t.prototype.getGenericErrorDetails=function(e){var r={resourceKey:"DsrError_Key",message:e.get("ServerError_NetworkConnectionIssue"),displayableErrorInfo:[{errorInfoKey:e.get("DsrError_Key"),errorInfoValue:e.get("DsrError_UnknownErrorValue")},{errorInfoKey:e.get("ClientError_HttpResponseStatusCodeKey"),errorInfoValue:this.httpStatusCode.toString()}],debugErrorInfo:[{errorInfoKey:zl,errorInfoValue:this.httpRequestId},{errorInfoKey:vn,errorInfoValue:this.code}],source:this.source};return this.detailedMessage&&r.debugErrorInfo&&r.debugErrorInfo.push({errorInfoKey:Yv,errorInfoValue:this.detailedMessage}),this.detailedErrorCode&&r.debugErrorInfo&&r.debugErrorInfo.push({errorInfoKey:Jv,errorInfoValue:this.detailedErrorCode}),r},t}(),S_=function(){function t(){this.errorCode="QueryCacheMissError"}return Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){return{message:e.get("ServiceError_QueryExecutionIsPaused"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_QueryExecutionRequired"),errorInfoValue:e.get("ServiceError_VisualCannotBeUpdatedWithoutQuery")},{errorInfoKey:e.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:this.code}],debugErrorInfo:[{errorInfoKey:vn,errorInfoValue:this.code}]}},t}(),b_=function(){function t(){}return Object.defineProperty(t.prototype,"code",{get:function(){return"EmptyData"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("InvalidDataFormat_DataFormatIsInvalid")}],debugErrorInfo:[{errorInfoKey:vn,errorInfoValue:this.code}]}},t}(),E_=function(){function t(){}return Object.defineProperty(t.prototype,"code",{get:function(){return"InvalidDataResponse"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("InvalidDataResponse_ServerError")}],debugErrorInfo:[{errorInfoKey:vn,errorInfoValue:this.code}]}},t}(),V_=function(){function t(e,r,n){this.promiseFactory=e,this.dataReaderProvider=r,this.dataReaders={},this.telemetryService=n}return t.prototype.execute=function(e){return u.assertValue(e,"options"),this.getReader(e.type).execute(e.query,e.kinds,e.perfId)},t.prototype.getReader=function(e){var r=this.dataReaders[e];if(r)return r;var n=this.dataReaderProvider.reader(e);return u.assertValue(n,"Could not find data reader for type: ".concat(e)),this.dataReaders[e]=new x_(e,n,this.promiseFactory,this.telemetryService)},t.prototype.stopCommunication=function(e){this.getReader(e).stopCommunication()},t.prototype.resumeCommunication=function(e){this.getReader(e).resumeCommunication()},t.prototype.clearCache=function(e,r){this.getReader(e).clearCache(r)},t.prototype.rewriteCacheEntries=function(e,r,n){this.getReader(e).rewriteCacheEntries(r,n)},t.prototype.setLocalCacheResult=function(e,r){return this.getReader(e.type).setLocalCacheResult(e.query,r)},t}(),x_=function(){function t(e,r,n,i){u.assertAnyValue(e,"pluginName"),u.assertValue(r,"reader"),u.assertValue(n,"promiseFactory"),u.assertValue(i,"telemetryService"),this.name=e,this.reader=r,this.promiseFactory=n,this.telemetryService=i}return t.prototype.execute=function(e,r,n){var i=this;u.assertValue(e,"options"),u.assertAnyValue(n,"perfId");var a=this.promiseFactory.defer(e.telemetryV2Enabled),o=this.reader;if(o.execute){var s=o.execute(e,n);s.then(function(c){if(c){var f=i.transform(c,r,n,e.performanceActivity),d=f.error;if(f.performanceActivities&&d&&(d.performanceActivities=f.performanceActivities),d)return a.reject(d),void i.telemetryService.logEvent(Ol,{requestId:c.requestId,isError:!0,errorSource:"PowerBI",errorCode:d.code});a.resolve({dataReaderResult:f,dataViewSource:{data:c}})}else a.reject(new b_),i.telemetryService.logEvent(Ol,{isError:!0,errorSource:"PowerBI",errorCode:"DataProxy_EmptyData"})},function(c){a.reject(c),(!c||!c.ignorable)&&i.telemetryService.logEvent(Ol,{requestId:null==c?void 0:c.requestId,isError:!0,errorSource:"PowerBI",errorCode:c?c.code:"DataProxy_ProviderError"})}).catch(function(c){a.reject(c)});var l=zi(a);return l.catch(function(c){c=c||new E_,s.reject(c)}),l}return e.command?a.resolve({dataReaderResult:this.transform(e.command,r,n)}):a.reject(),zi(a)},t.prototype.stopCommunication=function(){var e=this.reader;e.stopCommunication&&e.stopCommunication()},t.prototype.resumeCommunication=function(){var e=this.reader;e.resumeCommunication&&e.resumeCommunication()},t.prototype.clearCache=function(e){var r=this.reader.cache;r&&r.clear(e)},t.prototype.rewriteCacheEntries=function(e,r){var n=this.reader.cache;n&&n.rewrite(e,r)},t.prototype.setLocalCacheResult=function(e,r){var n=this.reader;n.setLocalCacheResult&&n.setLocalCacheResult(e,r)},t.prototype.transform=function(e,r,n,i){var a=this.reader;if(a.transform)return a.transform(e,r||31,n,i);var o={metadata:{columns:[]}};return o[this.name]=e,{dataView:o}},t}(),D_=function(){function t(e,r){void 0===r&&(r={}),u.assertNonEmpty(e,"Empty roles"),this.roles=e,this.root={identityValues:null,children:[],parent:null},this.levels=[];var i=r.canCollapseRoot,a=r.collapseParentAfterRemovingChildLevel;this.supportsMerge=!!r.supportsMerge,this.canCollapseRoot=!!i,this.collapseParentAfterRemovingChildLevel=!!a}return t.prototype.updateLevels=function(e,r){if(!_.isEmpty(e)&&(0!==r||this.canCollapseRoot)){u.assert(function(){return r<=_.size(e)},"Number of active projections cannot be greater than the number of projections");var n=e.length,i=this.levels;this.levels=new Array(n);for(var a=0;a<n;a++){var o=a>=r-1,s=i[a],l=[e[a]];s&&_.isEqual(s.queryRefs,l)?(this.levels[a]=s,s.isCollapsed=o):this.levels[a]={isCollapsed:o,queryRefs:l,toggledNodes:[]}}this.canCollapseRoot&&(0===r?this.root.isToggled=!0:delete this.root.isToggled),this.pinLevels(r)}},t.prototype.clone=function(){for(var e=this,r={supportsMerge:this.supportsMerge,canCollapseRoot:this.canCollapseRoot,collapseParentAfterRemovingChildLevel:this.collapseParentAfterRemovingChildLevel},n=new t(_.clone(this.roles),r),i=new Array(this.levels.length),a=0;a<this.levels.length;a++)i[a]=[];return n.levels=_.map(this.levels,function(o,s){return e.cloneExpansionLevel(o,i,s)}),n.root=this.cloneExpansionNode(this.root,null,i,-1),n},t.prototype.isStateModified=function(){return _.some(this.levels,function(e){return!e.isCollapsed})||!_.isEmpty(this.root.children)},t.prototype.addLevel=function(e,r){var n=this;u.assert(function(){return n.supportsMerge});var i=_.findLastIndex(this.levels,function(c){return c.isPinned}),a={isCollapsed:!0,queryRefs:[e],toggledNodes:[],isPinned:r<=i||void 0};u.assert(function(){return r<=_.size(n.levels)},"position > count of levels");for(var o=_.findIndex(this.levels,function(c){return!_.isEmpty(c.toggledNodes)},r),l=-1===o?r:o;l<_.size(this.levels);l++)this.setLevelState(l,!0);if(this.levels.splice(r,0,a),this.unlockLevels(r),a.isPinned)for(l=0;l<r;l++)delete this.levels[l].AIInformation},t.prototype.removeLevel=function(e){var n,r=this;u.assert(function(){return r.supportsMerge}),u.assert(function(){return e>=0&&e<_.size(r.levels)},"invalid level position"),this.collapseParentAfterRemovingChildLevel&&(n=this.getVisibleDescendentsDepth(this.root,-1)),this.removeIntermediateNodes(this.root,-1,function(i){return i===e}),this.levels.splice(e,1),this.collapseParentAfterRemovingChildLevel&&e>0&&e===n-1&&this.setLevelState(e-1,!0),e<_.size(this.levels)&&this.unlockLevels(e)},t.prototype.moveLevels=function(e,r,n){var i,a=this;u.assert(function(){return a.supportsMerge}),u.assert(function(){return e<_.size(a.levels)},"sourceIndex >= count of level"),u.assert(function(){return r<_.size(a.levels)},"targetIndex >= count of level");var o=_.findLastIndex(this.levels,function(p){return p.isPinned}),s=Math.min(e,r);if(r>e){u.assert(function(){return e+n<=_.size(a.levels)},"sourceIndex + count exceeds level count"),this.removeIntermediateNodes(this.root,-1,function(p){return p>=e&&p<e+n});for(var l=e;l<Math.min(e+n,_.size(this.levels));l++)this.levels[l].toggledNodes=[]}var c=this.levels.splice(e,n);(i=this.levels).splice.apply(i,Ee([r,0],c||[],!1));var f=_.findIndex(this.levels,function(p){return!_.isEmpty(p.toggledNodes)},r);for(l=-1===f?r:f;l<_.size(this.levels);l++)this.setLevelState(l,!0);if(this.unlockLevels(s),e>o&&r<=o?_.forEach(c,function(p){return p.isPinned=!0}):e<=o&&r>o&&_.forEach(c,function(p){return p.isPinned=!1}),_.forEach(c,function(p){return delete p.AIInformation}),this.levels[r].isPinned)for(l=0;l<r;l++)delete this.levels[l].AIInformation},t.prototype.getVisibleDescendentsDepth=function(e,r){var n=this.levels.length;if(u.assert(function(){return r<n},"node out of bounds"),-1===r&&this.canCollapseRoot&&e.isToggled)return 0;for(var i=[e];;){if(r===n-1)return r+1;for(var a=this.levels[r]&&this.levels[r].isCollapsed,o=void 0,s=[],l=0,c=i;l<c.length;l++){var f=c[l];!a==!f.isToggled&&(s.push.apply(s,f.children||[]),o=!0)}if(o&&r++,!(s.length>0))break;i=s}for(;r<n-1&&(-1===r||!this.levels[r].isCollapsed);)r++;return r+1},t.prototype.removeIntermediateNodes=function(e,r,n){var i=this;if(n(r)){var a=!!e.isToggled!=!!this.levels[r].isCollapsed;_.pull(e.parent.children,e),_.forEach(e.children,function(o){a&&(o.isToggled=!i.levels[r+1].isCollapsed),o.parent=e.parent,e.parent.children.push(o)})}_.forEach(Ee([],e.children||[],!0),function(o){return i.removeIntermediateNodes(o,r+1,n)})},t.prototype.cloneExpansionLevel=function(e,r,n){return{isCollapsed:e.isCollapsed,identityKeys:this.cloneExpressionList(e.identityKeys),queryRefs:_.clone(e.queryRefs),toggledNodes:r[n],isPinned:e.isPinned,isLocked:e.isLocked,AIInformation:e.AIInformation?{method:e.AIInformation.method,disabled:e.AIInformation.disabled}:void 0}},t.prototype.cloneExpansionNode=function(e,r,n,i){var a={identityValues:this.cloneExpressionList(e.identityValues),children:[],parent:r};void 0!==e.isToggled&&(a.isToggled=e.isToggled),i>=0&&n[i].push(a);for(var o=0,s=e.children;o<s.length;o++)a.children.push(this.cloneExpansionNode(s[o],a,n,i+1));return a},t.prototype.cloneExpressionList=function(e){return e?_.map(e,function(r){return r}):null},t.prototype.setNodeState=function(e,r){var n=this;if(e&&_.isEmpty(e.data))return u.assert(function(){return n.canCollapseRoot},"Collapse to root capability is not enabled"),r?this.root.isToggled=!0:delete this.root.isToggled,this.root;var i=Rp(e);if(i){for(var a=i.length,o=this.root,s=0;s<a;s++){var l=i[s],c=_i(l.expr);if(!this.ensureLevel(s,c))return;var d=to(l.expr);o=this.ensureChildNode(s,o,d,s===a-1?r:void 0)}if(!this.pruneNonToggledLeaf(o))return o}},t.prototype.ensureLevel=function(e,r){var n=this.levels[e];if(u.assertValue(n,"level does not exist"),n.identityKeys){if(!Ae(n.identityKeys,r,j))return}else n.identityKeys=r;return n},t.prototype.ensureChildNode=function(e,r,n,i){u.assertValue(r,"parent"),u.assertValue(n,"identityValues"),u.assertValue(e>=0,"levelIdx >= 0");var a=this.levels[e];u.assertValue(a,"level does not exist");var o=this.findNodeMatchingIdentities(r.children,n);return o||r.children.push(o={children:[],identityValues:n,parent:r}),void 0!==i&&(i!==!!a.isCollapsed?(o.isToggled=!0,_.indexOf(a.toggledNodes,o)<0&&a.toggledNodes.push(o)):(delete o.isToggled,a.toggledNodes=_.filter(a.toggledNodes,function(s){return s!==o}))),o},t.prototype.pruneNonToggledLeaf=function(e){u.assertValue(e,"node");for(var r=!1;e.parent&&!e.isToggled&&_.isEmpty(e.children);)e.parent.children=_.filter(e.parent.children,function(n){return n!==e}),e=e.parent,r=!0;return r},t.prototype.setLevelState=function(e,r){var n=this;if(-1===e)return u.assert(function(){return n.canCollapseRoot},"Collapse to root capability is not enabled"),void(r?this.root.isToggled=!0:delete this.root.isToggled);u.assert(function(){return e>-1},"levelIdx");var i=this.levels[e];if(i){i.isCollapsed=r;for(var a=0,o=i.toggledNodes;a<o.length;a++){var s=o[a];delete s.isToggled,this.pruneNonToggledLeaf(s)}i.toggledNodes=[]}},t.prototype.pinLevels=function(e){var r=this;u.assert(function(){return e<=_.size(r.levels)},"Requested pinning of too many levels");for(var n=0;n<Math.min(e,_.size(this.levels));n++)this.levels[n].isPinned=!0},t.prototype.unpinLevels=function(e){var r=this;u.assert(function(){return e<_.size(r.levels)},"Level does not exist");var n=this.getVisibleDescendentsDepth(this.root,-1);u.assert(function(){return e>=n-1},"cannot unpin projected level");for(var i=Math.max(e,n-1);i<_.size(this.levels);i++)delete this.levels[i].isPinned},t.prototype.lockLevels=function(e){var r=this;u.assert(function(){return e<=_.size(r.levels)},"Requested locking of too many levels");for(var n=0;n<Math.min(e,_.size(this.levels));n++)this.levels[n].isLocked=!0},t.prototype.unlockLevels=function(e){var r=this;u.assert(function(){return e<_.size(r.levels)},"Level does not exist");for(var n=e;n<_.size(this.levels);n++)delete this.levels[n].isLocked},t.prototype.setAILevelInformation=function(e,r){var n=this;u.assert(function(){return e<_.size(n.levels)},"Level does not exist"),r?this.levels[e].AIInformation=_.cloneDeep(r):delete this.levels[e].AIInformation},t.prototype.getAILevelInformation=function(e){var r=this;return u.assert(function(){return e<_.size(r.levels)},"Level does not exist"),_.cloneDeep(this.levels[e].AIInformation)},t.prototype.isWholeLevelExpanded=function(e){var r=this.levels[e];return!r||!r.isCollapsed&&_.isEmpty(r.toggledNodes)},t.prototype.isHierarchyExpanded=function(){var e=this;u.assertNonEmpty(this.levels,"levels"),u.assert(function(){return e.isWholeLevelCollapsed(e.levels.length-1)},"Last level should be collapsed");for(var r=0;r<this.levels.length-1;r++)if(!this.isWholeLevelExpanded(r))return!1;return!0},t.prototype.isWholeLevelCollapsed=function(e){var r=this.levels[e];return r&&r.isCollapsed&&_.isEmpty(r.toggledNodes)},t.prototype.getNodeLevelState=function(e,r,n){if(u.assertNonEmpty(e,"identities"),u.assert(function(){return n>=0},"levelIndex >= 0"),n>=this.levels.length)return{isNodeCollapsed:!1,levelHasToggledNodes:!1};var i=e[0],a=this.ensureLevel(n,_i(i.expr));if(a){var l,o=!_.isEmpty(a.toggledNodes),s=to(i.expr);return r&&(l=this.findNodeMatchingIdentities(r.children,s)),1===e.length?l?{isNodeCollapsed:l.isToggled?!a.isCollapsed:a.isCollapsed,levelHasToggledNodes:o}:{isNodeCollapsed:a.isCollapsed,levelHasToggledNodes:o}:(e.splice(0,1),this.getNodeLevelState(e,l,n+1))}},t.prototype.rewrite=function(e){for(var r=0,n=this.levels;r<n.length;r++){var i=n[r];i.identityKeys&&(i.identityKeys=_.map(i.identityKeys,function(a){return a.accept(e)}))}return this.root=this.rewriteNodeExpansionState(this.root,e),this},t.prototype.rewriteNodeExpansionState=function(e,r){var n=this;return e.identityValues&&(e.identityValues=_.map(e.identityValues,function(i){return i.accept(r)})),e.children=_.map(e.children,function(i){return n.rewriteNodeExpansionState(i,r)}),e},t.prototype.findNodeMatchingIdentities=function(e,r){return _.find(e,function(n){return Ae(n.identityValues,r,j)})},t}();function Gl(t){return!!(t.gradient||t.solid||t.pattern)}function Ql(t){return!(!t.linearGradient2&&!t.linearGradient3)}function Wl(t){var e=t;if(!_.isArray(e))return!1;for(var r=0,n=e;r<n.length;r++)if(!n[r].textRuns)return!1;return!0}function jl(t){return!!(t.axisColor&&t.negativeColor&&t.negativeColor)}function Mo(t){return"Icon"===t.kind}function Zv(t){return"ExprList"===t.kind}function qi(t){return null!=t&&"ErrorRange"===t.kind}function eg(t){return null!=(null==t?void 0:t.suggestedUtterances)}function tg(t){return null!=t&&"ItemLocation"===t.kind}function rg(t){return null!=t&&!!t.highlights}function Kl(t,e){for(var r={data:[],id:t.id,metadata:t.metadata,order:t.order},n=0,i=t.data;n<i.length;n++){var a=i[n];if(rr(a)){var o=e(a.roles);if(!_.isEmpty(o)){for(var s=0,l=o;s<l.length;s++)r.data.push(_p(l[s]));continue}}else r.data.push(a)}return r}function Jl(t,e){for(var r=0,n=t;r<n.length;r++){var a=n[r].roles;if(!a||!_.some(e,function(o){return a[o]}))return!1}return!0}function ft(t,e,r,n,i){var a;u.assertValue(e,"evalContext"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefns");for(var o,s=0,l=n;s<l.length;s++){var c=l[s],f=c.name;i&&(i.objectName=f);var d=t.run(f,e,r[f],c.properties,i);d&&(o||(o={}),o[f]?$e(o,((a={})[f]=d,a)):o[f]=d)}return o}function U_(t,e){var r;u.assertValue(t,"grouped"),u.assertAnyValue(e,"selector"),e&&e.data?r=t.data:e&&e.metadata?(t.metadata||(t.metadata=[]),r=t.metadata):(t.metadataOnce||(t.metadataOnce=[]),r=t.metadataOnce),u.assert(function(){return!!r},"GroupedObjects is not defined.  Indicates malformed selector.");for(var n=0,i=r;n<i.length;n++){var a=i[n];if(Ct(e,a.selector))return a}var o={selector:e,objects:[]};return r.push(o),o}function H_(t,e){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i&&i.index===e)return i.format}}function G_(t,e,r,n){n&&ng(t,e,{metadata:r},Ce(n))}function Q_(t,e,r,n){n&&ng(t,e,{metadata:r},n)}function ng(t,e,r,n){var i;if(r){var a=t.metadata;a||(a=t.metadata=[]),i=a}else{var o=t.metadataOnce;o||(o=t.metadataOnce=[{selector:r,objects:[]}]),i=o}var l,s=function(t,e){u.assertValue(t,"objects"),u.assertAnyValue(e,"selector");for(var r=0,n=t.length;r<n;r++){var i=t[r];if(Ct(i.selector,e))return i}}(i,r);if(s){var c=s.objects;if(l=function(t,e){u.assertValue(t,"objectDefns"),u.assertValue(e,"objectName");for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i.name===e)return i}}(c,e.objectName),l){if(l.properties[e.propertyName])return}else c.push(l={name:e.objectName,properties:{}})}else i.push({selector:r,objects:[l={name:e.objectName,properties:{}}]});l.properties[e.propertyName]=n}function K_(t,e){u.assertValue(t,"metadataColumn"),u.assertValue(e,"targetRoles");var r=t.roles;return!!r&&_.some(e,function(n){return r[n]})}function J_(t,e){if(u.assertAnyValue(t,"roles"),u.assertValue(e,"targetRole"),!t||!t[e])return!1;if(_.size(t)>=2)for(var r in t)if(r!==e&&t[r])return!1;return!0}function xo(t,e,r){u.assertAnyValue(t,"columnSources"),u.assertValue(e,"projectionOrdering"),u.assertAnyValue(r,"filterByRoles");var n=[];if(!_.isEmpty(t))for(var i=function(t){u.assertValue(t,"selectIndicesByProjectionOrder");for(var e={},r=0,n=t.length;r<n;r++){var i=t[r],a=e[i];a||(a=e[i]=[]),a.push(r)}return e}(e),a=0,o=t.length;a<o;a++){var s=t[a];if(!r||K_(s,r)){var l=i[s.index];if(_.isEmpty(l))n.push({metadataColumn:s,sourceIndex:a,projectionOrderIndex:void 0});else for(var c=0,f=l;c<f.length;c++)n.push({metadataColumn:s,sourceIndex:a,projectionOrderIndex:f[c]})}}return n}function or(t,e,r){if(u.assertValue(t,"expr"),u.assertNonEmpty(e,"columns"),!Jt(t))return _.find(e,function(i){return j(i.expr,t)&&i.groupName===r});var n=_.find(e,function(i){return i.queryName===t.expressionName&&i.groupName===r});return n?0!==t.attributeKind?n:n.formatSource&&n.formatSource.formatString?n.formatSource.formatString:void 0:void 0}function Do(t,e){u.assertValue(t,"column"),u.assertValue(e,"aggrFunc");var r=t.aggregates;if(r)switch(e){case 3:return r.min;case 4:return r.max;case 2:return r.count;case 1:return r.average;case 6:return r.median;default:return}}function Yl(t){return new X_(t)}var X_=function(){function t(e){var r;this.dataView=e,u.assertValue(e,"dataView"),this.columnsByRole={},this.valueSources=[];var n={};if(this.dataView.values)for(var i=0,a=this.dataView.values;i<a.length;i++){var o=a[i];this.valueSources.push(o.source);var s=o.source.rootSource;s&&(n[o.source.index]=s)}(r=this.valueSources).unshift.apply(r,_.values(n))}return t.prototype.getExprColumn=function(e,r){return or(e,this.valueSources,r?void 0:this.groupName)},t.prototype.getScopedEvalExprValue=function(e){var r=e.decomposeGlobalAggregateOfScopedExpr();if(r){var n=_.chain(this.valueSources).filter(function(a){return null==a.groupName}).value(),i=or(r.source,n);return i?Do(i,r.func):void 0}if(e.hasInnerMostScope())return this.getExprValue(e.expression);e.hasGlobalScope()?u.assertFail("Attempt to evaluate a scoped expression within the Global scope"):u.assertFail("Evaluation of Partial-Scope expressions is not supported")},t.prototype.getExprValue=function(e){var r=this.index;if(_.isNumber(r)){var n=this.dataView.values;if(n){var i=or(e,this.valueSources,this.groupName),a=_.find(n,function(o){return o.source===i});if(a)return this.useHighlightValues?a.highlights[r]:a.values[r]}}},t.prototype.getRoleValues=function(e){var r=this,n=this.columnsByRole,i=n[e];if(i||(i=n[e]=function(t,e){return u.assertValue(t,"dataViewCategorical"),ig(t.values,e)||ig(t.categories,e)}(this.dataView,e)),i&&null!=this.index)return _.map(i,function(o){return o.values[r.index]})},t.prototype.setCurrentRowIndex=function(e){u.assertValue(e,"index"),this.index=e},t.prototype.resetCurrentRowIndex=function(){delete this.index},t.prototype.setCurrentColumnGroupName=function(e){u.assertValue(void 0!==e,"groupName"),this.groupName=e},t.prototype.useHighlights=function(e){this.useHighlightValues=e},t}();function ig(t,e){if(u.assertAnyValue(t,"columns"),t){for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n],o=a.source.roles;!o||!o[e]||r.push(a)}return r}}function Ao(t,e){return e?new eI(t):new tI(t)}var eI=function(){function t(e){var r;if(u.assertValue(e,"selector"),u.assertValue(e.data,"selector.data"),this.dataParts=e.data,Bn(e))this.isWildcard=!0;else{var n=_.last(e.data);this.totalIdentity=tr(n)?n:null,this.totalIdentity&&(this.dataParts=this.dataParts.slice(0,e.data.length-1)),this.selectorDataExprs=t.flattenDataParts(this.dataParts),this.keys=_.map(this.selectorDataExprs,function(i){return i.key}),this.totalIdentity&&(r=this.keys).push.apply(r,this.totalIdentity.exprs||[])}}return t.prototype.matches=function(e,r){if(this.isWildcard)return Tp(this.dataParts[0],!_.isEmpty(r));if(e.length!==this.dataParts.length||_.isEmpty(r)&&this.totalIdentity||!_.isEmpty(r)&&!this.totalIdentity||this.totalIdentity&&!ws(this.totalIdentity.exprs,r,j))return!1;if(_.isEmpty(e)&&_.isEmpty(this.dataParts))return!0;var n=t.flattenDataParts(e);return!_.isEmpty(n)&&ws(this.selectorDataExprs,n,t.isDataExprsMatch)},t.prototype.matchesKeys=function(e,r){if(this.isWildcard)return e.length===r;var n=_.flatten(e);return 0!==this.keys.length&&0!==n.length&&this.keys.length===n.length&&ws(n,this.keys,j)},t.flattenDataParts=function(e){for(var r=[],n=0,i=e;n<i.length;n++){var a=i[n];if(Bt(a)){var o=new Ln;a.expr.accept(o);for(var s=0;s<o.pairs.length;s++)r.push({value:o.values[s],key:o.keys[s]})}else if(Mr(a))for(var l=0,c=a.exprs;l<c.length;l++)r.push({key:c[l]});else{if(!tr(a))return u.assertFail("unexpected Selector data item kind: "+a.kind.toString()),[];u.assertFail("Selector.matchesData: ScopeTotal should appear at the end of Selector.Data elements")}}return r},t.isDataExprsMatch=function(e,r){return u.assert(function(){return null!=e.value||null!=r.value},"isDataExprsMatch cant have two dataExprs with values not defined. It means they are both wildcards."),e.value&&r.value?j(e.key,r.key)&&j(e.value,r.value):j(e.key,r.key)},t}(),tI=function(){function t(e){var r;if(this.selector=e,u.assertValue(this.selector,"selector"),u.assertValue(this.selector.data,"selector.data"),this.isWildcard=Bn(this.selector),this.dataParts=this.selector.data,this.keys=[],!this.isWildcard)for(var n=0,i=this.dataParts;n<i.length;n++){var o=t.getDataRepetitionIdentityKeys(i[n]);if(!o){this.keys=[];break}(r=this.keys).push.apply(r,o)}}return t.prototype.matches=function(e,r){u.assertValue(e,"identities");var n=this.dataParts,i=n.length,a=e.length,o=!_.isEmpty(r);if(o&&a++,this.isWildcard)return Tp(n[0],o);if(i!==a)return!1;for(var s=0,l=e.length;s<l;s++){var c,f=e[s];if(rr(c=n[s]))return u.assertFail("Selector.matchesData: RoleWildCard should be converted to ScopeWildCards before matching"),!1;if(Bt(c)){if(!Ii(c,f))return!1}else{if(!Mr(c))return tr(c)?(_.isEmpty(r)||u.assertFail("Selector.matchesData: ScopeTotal should appear at the end of Selector.Data elements"),!1):(u.assertFail("unexpected Selector data item kind: "+c.kind.toString()),!1);if(!Sw(c,f))return!1}}return!!_.isEmpty(r)||tr(c=_.last(n))&&function(t,e){return!_.isEmpty(e)&&mt.sequenceEqual(t.exprs,e)}(c,r)},t.prototype.matchesKeys=function(e,r){if(u.assertValue(e,"keysList"),u.assert(function(){return e.length<=r},"expected keysList to be within the hierarchy levels"),this.isWildcard)return e.length===r;var n=_.flatten(e),i=this.keys.length;if(0===i||0===n.length||i!==n.length)return!1;for(var a=0;a<i;a++)if(!j(n[a],this.keys[a]))return!1;return!0},t.getDataRepetitionIdentityKeys=function(e){return Bt(e)?_i(e.expr):Mr(e)||tr(e)?e.exprs:void(rr(e)?u.assertFail("Selector.matchesData: RoleWildCard should be converted to ScopeWildCards before matching"):xr(e)?u.assertFail("Selector.matchesData: Wildcard should match anything without identity check"):u.assertNever(e))},t}();function nI(t,e,r,n,i,a,o,s){if(u.assertValue(t,"dataViewCategorical"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"selector"),u.assertValue(n,"containsWildcard"),u.assertValue(i,"objectDefns"),t.categories&&0!==t.categories.length){var l=function(t,e,r){u.assertValue(t.categories[0],"dataViewCategorical.categories[0]");for(var n=t.categories[0].identity,i=[],a=0,o=t.categories;a<o.length;a++){var s=o[a];if(!s.identityFields||!r.matchesKeys([s.identityFields],1))return;i.push(s)}u.assert(function(){return i.length===t.categories.length},"Column length mismatch");var l=e.metadata;if(l){var c=t.values;if(c)for(var f=0,d=c.length;f<d;f++){var p=c[f];if(p.source.queryName===l){i=[p];break}}}return{columns:i,identities:n}}(t,r,a);if(l){var d,c=function(t){return _.some(t.values,function(e){return!!e.highlights})}(t),f=l.identities,p=Yl(t);if(f){for(var h,v,g=0,y=f.length;g<y;g++)if(n||a.matches([f[g]])){switch(p.setCurrentRowIndex(g),r.highlightMatching){case void 0:case 0:h=!0,v=!1;break;case 1:h=!0,v=c;break;case 2:h=!c,v=c;break;default:u.assertNever(r.highlightMatching)}if(h){p.useHighlights(!1);var S=ft(o,p,e,i,s);if(S)for(var b=0,E=l.columns;b<E.length;b++){var w=(C=E[b]).objects;w||(w=C.objects=new Array(y)),w[g]||(w[g]={}),$e(w[g],S,r.id,r.order)}d=!0}if(v){p.useHighlights(!0);var M=ft(o,p,e,i,s);if(M)for(var V=0,D=l.columns;V<D.length;V++){var C,A=(C=D[V]).highlightObjects;A||(A=C.highlightObjects=new Array(y)),A[g]||(A[g]={}),$e(A[g],M,r.id,r.order)}d=!0}if(!n)return d}return d}}}}function ag(t,e,r){return u.assertAnyValue(e,"propertyDefn"),!!(e instanceof U&&Jt(e)&&0===e.attributeKind)||function(t,e,r){return r.measureDrivenDataLabels&&"labels"===t&&null!=e}(t,e,r)||qi(e)||function(t,e,r){var n,i,a=null===(i=null===(n=e.solid)||void 0===n?void 0:n.color)||void 0===i?void 0:i.kind;return r.categoricalSecondaryCF&&-1!==["labels","categoryLabels","totals"].indexOf(t)&&(24===a||42===a||4===a||3===a)}(t,e,r)}function oI(t,e,r,n,i,a,o,s,l){u.assertValue(t,"dataViewCategorical"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"selector"),u.assertValue(n,"containsWildcard"),u.assertValue(i,"objectDefns");var c=t.values;if(c&&c.identityFields&&a.matchesKeys([c.identityFields],1)){var f=c.grouped();if(f){for(var v,d=Yl(t),p=r.metadata,h=sg(i,ag,l),g=0,y=f;g<y.length;g++){var m=y[g];if(void 0!==m.name){_.isEmpty(h)||(d.setCurrentColumnGroupName(m.name),lI(e,r,h,o,s,d,m,l));var S=m.values;if(n||a.matches([m.identity])){var b=ft(o,d,e,i,s);if(b)if(p)for(var E=0,C=S.length;E<C;E++){var w=S[E],M=w.source;if(M.queryName===p){var V=ve(M),D=V.objects;D||(D=V.objects={}),$e(D,b,r.id,r.order),w.source=V,v=!0;break}}else{var A=m.objects;A||(A=m.objects={}),$e(A,b,r.id,r.order),og(c,f),v=!0}if(!n)return!0}}}return v}}}function og(t,e){t.grouped=e?function(){return e}:function(){return function(t){u.assertValue(t,"values");for(var r,e=[],n=0,i=t.length;n<i;n++){var a=t[n];if(!r||r.identity!==a.identity){if(r={values:[]},a.identity){r.identity=a.identity;var o=a.source;void 0!==o.groupName?r.name=o.groupName:o.displayName&&(r.name=o.displayName)}e.push(r)}r.values.push(a)}return e}(t)}}function uI(t,e,r,n,i,a,o){if(u.assertValue(t,"dataViewCategorical"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"selector"),u.assertValue(n,"objectDefns"),_.isEmpty(t.categories)){var s=t.values;if(!s||_.isEmpty(s.identityFields)){var l=function(t,e){var r=e.metadata;if(void 0!==r&&t)return u.assert(function(){return 1===_.filter(t,function(n){return n.source.queryName===r}).length},"Only one column has to match"),_.find(t,function(n){return n.source.queryName===r})}(t.values,r);if(l){var c=Yl(t),f=Bn(r);if(n=sg(n,ag,o),!_.isEmpty(n)&&f){u.assert(function(){return t.values.length>0},"dataViewCategorical.values.length > 0"),u.assert(function(){return t.values[0].values.length<=1},"There has to be max 1 row since there are no category groupings"),c.setCurrentRowIndex(0);var p=ft(i,c,e,n,a);if(p){var h=l.objects;h||(h=l.objects=[]),h[0]||(h[0]={}),$e(h[0],p,r.id,r.order)}}}}}}function lI(t,e,r,n,i,a,o,s){if(u.assertValue(t,"objectDescriptors"),u.assertValue(e,"selector"),u.assertValue(r,"objectDefns"),u.assertValue(a,"evalContext"),u.assertValue(o,"valueGrouping"),Bn(e))for(var l=function(t,e,r){return void 0===(null==e?void 0:e.metadata)&&r.categoricalSecondaryCF?t:_.filter(t,function(n){return n.source.queryName===e.metadata})}(o.values,e,s),c=0,f=l;c<f.length;c++){var d=f[c];u.assertValue(d.source.groupName===o.name,"targetColumn.source.groupName");for(var p=d.values.length,h=0;h<p;h++){a.setCurrentRowIndex(h),a.useHighlights(!1);var v=ft(n,a,t,r,i);if(v){var g=d.objects;g||(g=d.objects=new Array(p)),g[h]||(g[h]={}),$e(g[h],v,e.id,e.order)}if(null!=d.highlights){a.useHighlights(!0);var y=ft(n,a,t,r,i);if(y){var m=d.highlightObjects;m||(m=d.highlightObjects=new Array(p)),m[h]||(m[h]={}),$e(m[h],y,e.id,e.order)}}a.resetCurrentRowIndex()}}}function cI(t,e){return no(e)&&(e=Kl(e,function(r){return function(t,e){if(e.categories)for(var r=0,n=e.categories;r<n.length;r++){var i=n[r];if(i.source&&Jl([i.source],t))return[i.identityFields]}}(r,t)})),e}function sg(t,e,r){return u.assertValue(t,"objectDefns"),_.chain(t).map(function(n){return ye(ye({},n),{properties:_.pickBy(n.properties,function(i){return e(n.name,i,r)})})}).filter(function(n){return!_.isEmpty(Object.keys(n.properties))}).value()}function Hi(t,e){var r=t.roles;return r&&r[e]}function $l(t){return u.assertValue(t,"node"),_.isEmpty(t.children)}function _o(t,e){if(u.assertAnyValue(t,"rootNodes"),u.assertValue(e,"callback"),t)if(function(t){return function(t){u.assertValue(t,"obj");for(var e=t;null!=e;){if(_.isArray(e))return!0;e=Object.getPrototypeOf(e)}return!1}(t)}(t))for(var r=0,n=t;r<n.length;r++){var i=n[r];i&&Xl(i,[],e)}else Xl(t,[],e)}function Xl(t,e,r){u.assertValue(t,"matrixNode"),u.assertValue(e,"traversalPath"),u.assertValue(r,"callback"),u.assert(function(){return!_.includes(e,t)},"pre-condition: traversalPath must not already contain matrixNode"),e.push(t);var n=r(t,e),i=null!=n&&0!==n;if(1===n){var a=t.children;if(!_.isEmpty(a))for(var o=0,s=a;o<s.length;o++){var l=s[o];if(l&&!(i=Xl(l,e,r)))break}}return u.assert(function(){return _.last(e)===t},"pre-condition: the callback given to forEachNodeDepthFirst() is not supposed to modify the traversalPath argument array."),e.pop(),i}function ug(t,e,r){if(u.assertValue(t,"node"),u.assert(function(){return e>=0},"targetLevel >= 0"),u.assertValue(r,"callback"),t.level!==e){var n=t.children;if(n&&n.length>0)for(var i=0,a=n.length;i<a;i++)ug(n[i],e,r)}else r(t)}function Gi(t,e,r){u.assertValue(t,"node"),u.assert(function(){return e>=0},"deepestLevelToInherit >= 0"),u.assertValue(r,"useInheritSingle");var n=t,i=void 0===t.level;if(i||t.level<=e){var o=r?k:ve,s=o(t);if((i||t.level<e)&&!_.isEmpty(t.children)){s.children=o(t.children);for(var c=0,f=s.children.length;c<f;c++)s.children[c]=Gi(s.children[c],e,r)}n=s}return n}function Io(t){u.assertAnyValue(t,"matrixOrHierarchy");var e=!1;if(t)if(function(t){return"rows"in t&&"columns"in t&&"valueSources"in t}(t))e=Io(t.rows)||Io(t.columns);else{var r=t.levels;if(!_.isEmpty(r))for(var n=0,i=r;n<i.length;n++){var a=i[n];if(a.sources&&a.sources.length>=2&&(u.assert(function(){return _.every(a.sources,function(s){return s.isMeasure===a.sources[0].isMeasure})},"pre-condition: in a valid DataViewMatrix, the source columns in each of its hierarchy levels must either be all non-measure columns (i.e. a grouping level) or all measure columns (i.e. a measure headers level)"),!a.sources[0].isMeasure)){e=!0;break}}}return e}function lg(t){return u.assertValue(t,"levels"),_.map(t,function(e){return{selectIndices:_.map(e.sources,function(i){return i.index})}})}function cg(t){return!t||_.isEmpty(t.levels)?0:t.levels.length-(Qi(t.levels)?1:0)}function Qi(t){return u.assertAnyValue(t,"columnHierarchyLevels"),!_.isEmpty(t)&&fg(_.last(t))}function fg(t){return u.assertAnyValue(t,"columnHierarchyLevel"),t&&_.every(t.sources,function(e){return e.isMeasure})}function To(t){u.assertValue(t,"undefined Level");var e=t.valueSources;if(e)return u.assert(function(){return _.isEqual(_.keys(e),["0"])},"There is no support for Measures with a Scope containing any column levels"),u.assertValue(e[0],"Empty Scoped measures metadata"),e[0]}function Po(t){if(u.assertValue(t,"getNodeScopedValues called for an Undefined node"),u.assertAnyValue(t.nodeValues,"Synchronized nodes have undefined nodeValues"),t.nodeValues)return u.assert(function(){return _.isEqual(_.keys(t.nodeValues),["0"])},"There is no support for Measures with a Scope containing any column levels"),t.nodeValues[0]}var CI=function(){function t(e,r){if(this.dataView=e,u.assertValue(e,"dataView"),e){this.columnLeavesPath=function(t){if(u.assertAnyValue(null==t?void 0:t.children,"A Matrix with Column Totals off and all data filtered out has undefined columns root"),!t||_.isEmpty(t.children))return[];var e=[];return function(t,e){u.assertAnyValue(t,"rootNodes"),u.assertValue(e,"callback"),_o(t,function(n,i){return $l(n)&&e(0,0,i),1})}(t,function(r,n,i){e.push(_.clone(i))}),e}(e.columns.root),this.hasColumnGrouping=cg(this.dataView.columns)>0,this.valueSourcesQueryNames=_.map(e.valueSources,function(o){return o.queryName}),this.scopedValueSourcesByLevel={},this.scopedValuesQueryNamesByLevel={};var n=e.rows.levels;if(u.assertAnyValue(n,"A Matrix without Row groupings will not have a Row level"),!_.isEmpty(n))for(var i=0;i<n.length;i++){var a=To(n[i]);this.scopedValueSourcesByLevel[i]=a,a&&(this.scopedValuesQueryNamesByLevel[i]=_.map(a,function(o){return o.queryName}))}}}return t.prototype.setAsRowNode=function(e){u.assertNonEmpty(e,"Invalid context: Empty rowPath"),this.rowPath=e,this.nodeValue=void 0,this.columnPath=void 0,this.nodeValueIndex=void 0,this.forHighlight=void 0,this.isScopedValue=!1},t.prototype.setAsColumnNode=function(e){u.assertNonEmpty(e,"Invalid context: Empty columnPath"),this.columnPath=e,this.nodeValue=void 0,this.rowPath=void 0,this.nodeValueIndex=void 0,this.forHighlight=void 0,this.isScopedValue=!1},t.prototype.setAsIntersection=function(e,r,n,i,a){void 0===a&&(a=!1),u.assertValue(e,"Invalid context: Undefined intersection"),u.assertNonEmpty(r,"Intersection context must have a rowPath"),u.assertNonEmpty(n,"Intersection context must have a columnPath"),u.assert(function(){return null!=i&&i>=0},"Intersection context must have a valid nodeValueIndex"),u.assertAnyValue(a,"By default, FALSE"),this.nodeValue=e,this.rowPath=r,this.columnPath=n,this.nodeValueIndex=i,this.forHighlight=!!a,this.isScopedValue=!1},t.prototype.setAsScopedValue=function(e,r,n,i){void 0===i&&(i=!1),u.assertValue(e,"Invalid context: Undefined intersection"),u.assertNonEmpty(r,"Intersection context must have a rowPath"),u.assertAnyValue(i,"By default, FALSE"),this.nodeValue=e,this.rowPath=r,this.columnPath=void 0,this.nodeValueIndex=n,this.forHighlight=!!i,this.isScopedValue=!0,u.assert(function(){return _.isEqual(_.keys(_.last(r).nodeValues),["0"])},"Scoped Values are expected to be grouped by Rows only")},t.prototype.getScopedEvalExprValue=function(e){var r=e.decomposeGlobalAggregateOfScopedExpr();if(r){var n=or(r.source,this.getContextValueSources());return n?Do(n,r.func):void 0}if(e.hasInnerMostScope())return this.getExprValue(e.expression);e.hasGlobalScope()?u.assertFail("Attempt to evaluate a scoped expression within the Global scope"):u.assertFail("Evaluation of Partial-Scope expressions is not supported")},t.prototype.getExprValue=function(e){return u.assertValue(e,"matrixEvalContext - Undefined expr"),this.nodeValue?this.evaluateMatrixMeasure(e):this.rowPath?this.evaluateRowHeader(e):this.columnPath?this.evaluateColumnHeader(e):void u.assertFail("getExprValue - context is empty")},t.prototype.getExprColumn=function(e){return or(e,this.getContextValueSources())},t.prototype.findExprValueSourceIndex=function(e){var r=this.getContextValueSources();if(u.assertAnyValue(r,"For ScopedValues, DataView may contain cached Data without Value Sources"),!r)return-1;var n=or(e,r);return n?r.indexOf(n):-1},t.prototype.evaluateMatrixMeasure=function(e){u.assertValue(this.rowPath,"matrixEvalContext.evaluateIntersection - Undefined this.rowNode"),u.assertValue(this.isScopedValue||this.columnPath,"matrixEvalContext.evaluateIntersection - Undefined this.columnNode");var r=this.nodeValue.valueSourceIndex||0,n=this.findExprValueSourceIndex(e);if(!(n<0)){var i;if(n===r)i=this.nodeValue;else{var a=n-r+this.nodeValueIndex,o=_.last(this.rowPath),s=this.isScopedValue?Po(o):o.values;if(!(i=null==s?void 0:s[a]))return}return this.forHighlight?i.highlight:i.value}},t.prototype.evaluateRowHeader=function(e){var r=this;u.assert(function(){return!r.columnPath},"matrixEvalContext.evaluateRowHeader - context has columnNode"),u.assert(function(){return!r.nodeValue},"matrixEvalContext.evaluateRowHeader - context has value");var n=this.findExprValueSourceIndex(e);if(!(n<0)){var a,i=_.last(this.rowPath);if(i&&(a=this.shouldConsiderScopedValues(i.level)?Po(i):i.values,u.assertAnyValue(a,"node.values or node.nodeValues may be undefined (e.g. for Synchronized Nodes) even if ValueSources exist"),a))return a[n].value}},t.prototype.evaluateColumnHeader=function(e){var r=this;u.assert(function(){return!r.rowPath},"matrixEvalContext.evaluateColumnHeader - context has rowNode"),u.assert(function(){return!r.nodeValue},"matrixEvalContext.evaluateColumnHeader - context has value"),u.assertFail("matrixEvalContext.evaluateColumnHeader - only constant exprs are supported")},t.prototype.getRoleValues=function(e){var r=this;u.assert(function(){return!r.columnPath||!r.nodeValue},"getRoleValues returns values for row groupings only"),u.assert(function(){return!r.isScopedValue},"getRoleValues is unimplemented for ScopedMeasures");var n=_.last(this.rowPath);if(n&&!n.isSubtotal){for(var i=this.dataView.valueSources,a=[],o=0,s=i.length;o<s;o++)Hi(i[o],e)&&a.push(n.values[o].value);if(a.length>0)return a}},t.prototype.getDataView=function(){return this.dataView},t.prototype.getValueSourcesQueryNames=function(){return this.valueSourcesQueryNames},t.prototype.getScopedValueSourcesQueryNames=function(e){return this.scopedValuesQueryNamesByLevel[e]},t.prototype.getContextValueSourcesQueryNames=function(){return this.isScopedValue?(u.assertValue(this.nodeValue,"Checking for a Scoped Measure is only supported within a ScopedMeasure value"),this.scopedValuesQueryNamesByLevel[_.last(this.rowPath).level]):this.valueSourcesQueryNames},t.prototype.getContextValueSources=function(){if(this.nodeValue)return u.assertNonEmpty(this.rowPath,"Hierarchy Root doesn't have a scope"),this.isScopedValue?this.scopedValueSourcesByLevel[this.getRowLevelIndex()]:this.dataView.valueSources;if(this.rowPath){var e=this.getRowLevelIndex();return this.shouldConsiderScopedValues(e)?this.scopedValueSourcesByLevel[e]:this.dataView.valueSources}u.assertFail(this.columnPath?"Only constant exprs are supported":"Context is empty")},t.prototype.shouldConsiderScopedValues=function(e){return this.hasColumnGrouping||e<this.dataView.rows.levels.length-1},t.prototype.getRowLevelIndex=function(){return u.assertValue(this.rowPath,"this.rowPath"),_.last(this.rowPath).level},t}();function dg(t){if(_.isEmpty(t))return[];for(var e=[],r=0,n=t;r<n.length;r++){for(var a=[],o=0,s=n[r].sources;o<s.length;o++){var l=s[o];l.identityExprs&&a.push.apply(a,l.identityExprs||[])}_.isEmpty(a)||e.push(a)}return e}function pg(t,e){for(var r=[],n=t.length,i=0;i<n;i++)if(r.push(t[i]),e.matchesKeys(r,n))return!0;return!1}function hg(t,e,r,n,i,a,o,s,l){if(u.assertAnyValue(n,"dataViewMatrixHierarchy"),u.assertValue(i,"objectDescriptors"),u.assertValue(o,"selector"),u.assertValue(a,"objectDefns"),n){var c=n.root;if(c){var f=vg(t,e,r,[c],i,a,o,s,l);if(f){var d=k(n);return d.root=f,d}}}}function vg(t,e,r,n,i,a,o,s,l){return u.assertValue(e,"evalContext"),u.assertValue(n,"nodePath"),u.assertValue(i,"objectDescriptors"),u.assertValue(o,"selectorInfo"),u.assertValue(a,"objectDefns"),$l(_.last(n))?"Rows"===t&&(o.canMatchScopedValue||o.canMatchIntersection)?function(t,e,r,n,i,a,o,s){u.assertNonEmpty(r,"evaluateDataRepetitionMatrixNodeValues - no row leaves"),u.assert(function(){return a.canMatchIntersection||a.canMatchScopedValue},"Unexpected Selector");var l=_.last(r),c=k(l),f=a.canMatchScopedValue,d=a.selector,p=f?Po(l):l.values,h=f?t.getScopedValueSourcesQueryNames(l.level)||[]:t.getValueSourcesQueryNames(),v=f?h.length:t.columnLeavesPath.length;if(!_.isEmpty(p)){p=k(p);for(var g=!1,y=function(b){var E=p[b];if(u.assertAnyValue(E,"By-Design, ValueCollection can be sparse"),!E)return"continue";var M,C=f?void 0:t.columnLeavesPath[b];if(!function(t,e,r,n,i,a){if(e!==t.metadata)return!1;for(var o=[],s=[],l=0,c=r;l<c.length;l++)(f=c[l]).identity&&o.push(f.identity);if(!i){for(var d=0,p=n;d<p.length;d++){var f;(f=p[d]).identity&&o.push(f.identity)}_.last(n).isSubtotal&&s.push.apply(s,gg(n)||[])}return _.last(r).isSubtotal&&s.push.apply(s,gg(r)||[]),_.isEmpty(s)&&(s=void 0),a.matches(o,s)}(a.selector,h[E.valueSourceIndex||0],r,C,f,a.selectorComparer))return"continue";s&&(M={warnings:s,selector:d,targetExpr:nr(d,e)});var V=function(P){f?t.setAsScopedValue(E,r,b,P):t.setAsIntersection(E,r,C,b,P);var F=ft(o,t,n,i,M);if(F){var N=k(E);P&&!N.highlightObjects?N.highlightObjects={}:!P&&!N.objects&&(N.objects={}),$e(P?N.highlightObjects:N.objects,F,d.id,d.order),g=!0,E=p[b]=N}},D=void 0!==E.highlight;switch(d.highlightMatching){case void 0:case 0:V(!1);break;case 1:V(!1),D&&V(!0);break;case 2:V(!!D);break;default:u.assertNever(d.highlightMatching)}},m=0;m<v;m++)y(m);if(g)return f?c.nodeValues={0:p}:c.values=p,c}}(e,r,n,i,a,o,s,l):void 0:function(t,e,r,n,i,a,o,s,l){var p,c=o.selector,f=o.selectorComparer,d=e.getDataView();n[0]===d.rows.root?p=d.rows:n[0]===d.columns.root?p=d.columns:u.assertFail("dataViewTransform.evaluateDataRepetitionMatrixNodeChildren: incorrect nodePath");var h=_.last(n),v=h.children;u.assertNonEmpty(v,"evaluateDataRepetitionMatrixNodeChildren - empty children list");var g=!1,y=!1,m=h.childIdentityFields,S=[],b=v[0].level;u.assert(function(){return 0===b||b<p.levels.length},"evaluateDataRepetitionMatrixNodeChildren: childLevel exceeding hierarchy levels");var E=d.valueSources.length>1&&p===d.columns,C=E&&b===p.levels.length-1;if(!_.isEmpty(p.levels)){var w=p.levels[b],M=w.sources;if(C){S=e.getValueSourcesQueryNames();var V=_.compact(_.map(n,function(ht){return ht.identity})),D=void 0;h.isSubtotal&&n.length>1&&(D=n[n.length-2].childIdentityFields),g=null!=o.selector.metadata&&_.some(S,function(ht){return ht===c.metadata})&&f.matches(V,D),y=!1}else if(!_.isEmpty(m)){S=_.map(M,function(ht){return ht.queryName});var A=_.map(n,function(ht){return ht.childIdentityFields});g=null==c.metadata&&f.matchesKeys(A,p.levels.length-(E?1:0));var F=To(w);u.assert(function(){return!F||p===d.rows},"Scoped measures on Column nodes are not supported"),y=F&&null!=c.metadata&&null!=_.find(F,function(ht){return ht.queryName===c.metadata}),u.assert(function(){return!g||!y},"A Selector can't match nodes and Scoped measures")}}for(var N=!1,J=yg(h),le=0,ce=v.length;le<ce;le++){var Y=!1,Ve=v[le],Te=yg(Ve),xe=n.concat(Te),Ne=!1;if(g||y){p===d.rows?g&&e.setAsRowNode(xe):p===d.columns?e.setAsColumnNode(xe):u.assertFail("dataViewTransform.evaluateDataRepetitionMatrixNodeChildren: incorrect nodePath");for(var fe=[],Pe=0,pt=xe;Pe<pt.length;Pe++){var ni=pt[Pe];ni.identity&&fe.push(ni.identity)}var kr=void 0;_.isEmpty(S)||(kr=S[Ve.levelSourceIndex||0]);var pa=void 0;if(Ve.isSubtotal&&(C?n.length>1&&(pa=n[n.length-2].childIdentityFields):pa=m),(null==c.metadata||c.metadata===kr&&!o.isWildcard)&&f.matches(fe,pa)){Ne=!0;var ai=void 0;l&&(ai={warnings:l,selector:c,targetExpr:nr(c,r)});var ha=ft(s,e,i,a,ai);ha&&(Y=!0,Te.objects||(Te.objects={}),$e(Te.objects,ha,c.id,c.order))}}if(Ne&&!o.isWildcard||vg(t,e,r,xe,i,a,o,s,l)&&(Y=!0),Y&&(N=!0,J.children[le]=Te,!o.containsWildcard))break}if(N)return J}(t,e,r,n,i,a,o,s,l)}function gg(t){var e=_.findLast(t,function(r){return null!=r.childIdentityFields});return e?e.childIdentityFields:[]}function yg(t){if(Object.getPrototypeOf(t)!==Object.prototype)return t;var e=k(t);return t.children&&(e.children=k(t.children)),e}function mg(t,e){if(!t||!e)return[];for(var r=[],n=0,i=e.levels;n<i.length;n++){for(var o=[],s=0,l=i[n].sources;s<l.length;s++){var c=l[s];c.identityExprs&&Jl([c],t)&&o.push.apply(o,c.identityExprs||[])}_.isEmpty(o)||r.push(o)}return r}function Pt(t){return!!t&&(void 0!==t.selector&&void 0!==t.propertyIdentifier)}var II=function(){function t(){this.references=[]}return t.prototype.accept=function(e){this.references.push(e)},t}();function Zl(t){var e=t;return u.assertValue(e,"textRunDefinition"),_.isString(e.value)||Pt(e.value)||e.value instanceof U}function Sg(t){var e=t;return u.assertValue(e,"textRunDefinitionGeneric"),_.isString(e.value)||function(t){return t&&t.expr}(e.value)||Pt(e.value)}function ec(t){var e=t;return u.assertValue(e,"textRunConditionalDefinition"),_.isArray(e.cases)&&void 0!==e.defaultCase&&_.isArray(e.defaultCase.textRuns)&&Pt(e.expression)}function bg(t){var e=t;return u.assertValue(e,"conditionalDefinitionGeneric"),_.isArray(e.cases)&&void 0!==e.defaultCase&&void 0!==e.expression}function FI(t,e){if(u.assertValue(t,"paragraph"),!_.isEmpty(t.textRuns))for(var r=0,n=t.textRuns;r<n.length;r++){var i=n[r];Zl(i)?tc(i,e):ec(i)?RI(i,e):u.assertNever(i)}}function tc(t,e){u.assertValue(t,"textRun"),u.assertValue(t.value,"textRun.value"),!_.isString(t.value)&&Eg(t.value,e)}function Eg(t,e){if(Pt(t))return e.visitValueRef(t);e.visitExpr(t)}function RI(t,e){u.assertValue(t,"textRunConditional"),u.assertValue(t.expression,"expression"),u.assertValue(t.defaultCase,"defaultCase"),u.assertValue(t.cases,"cases");for(var r=0,n=t.cases;r<n.length;r++)for(var a=0,o=n[r].textRuns;a<o.length;a++)tc(o[a],e);for(var l=0,c=t.defaultCase.textRuns;l<c.length;l++)tc(c[l],e);Pt(t.expression)&&Eg(t.expression,e)}function Cg(t,e){if(e in t.properties)return delete t.properties[e],!0}function NI(t){u.assertAnyValue(t,"DataViewObjectDefinition.reduce - defn can have any value.");var e=t&&t.properties;if(e){for(var r in e)_.isEmpty(e[r])&&Cg(t,r);if(!_.isEmpty(e))return t}}function rc(t,e,r){u.assertValue(t,"defns");var n=t[e];n||(t[e]=[],n=t[e]);for(var i=0,a=n.length;i<a;i++){var o=n[i];if(Ct(o.selector,r))return o}return n.push({selector:r,properties:{}}),n[n.length-1]}function kI(t,e,r,n){u.assertValue(t,"defns");var i=_.find(t[e],function(a){return Ct(a.selector,r)});i&&(i.selector=n)}function LI(t,e,r){u.assertValue(t,"defns");var n=t[e];if(!n)return!1;var i=_.remove(n,function(a){return Ct(a.selector,r)}).length>0;return _.isEmpty(n)&&delete t[e],i}function BI(t,e){if(t&&e)for(var r in e)for(var i=0,a=e[r];i<a.length;i++){var o=a[i];for(var s in o.properties)nc(t,r,o.selector,s)}}function UI(t,e,r){if(u.assertValue(t,"Trying to cascade into undefined DataViewObjectDefinitions"),t&&e)for(var n in e){var i=e[n];if(i){var a=t[n];a||(a=t[n]=[]),zI(a,i,r)}}}function OI(t,e,r,n,i){var a=Mg(t,e,r);if(a){var o=a.properties[n];o&&(rc(t,i,r).properties[n]=o,delete a.properties[n])}}function zI(t,e,r){var n;if(r)t.splice.apply(t,Ee([0,0],e||[],!1));else for(var i=0,a=e;i<a.length;i++){var o=a[i];n=!1;for(var s=0,l=t;s<l.length;s++){var c=l[s];if(Ct(c.selector,o.selector)){wg(c.properties,o.properties),n=!0;break}}if(!n){var f={selector:o.selector,properties:{}};wg(f.properties,o.properties),t.push(f)}}}function wg(t,e){for(var r in e){var n=e[r];n&&(t[r]||(t[r]=n))}}function nc(t,e,r,n){u.assertValue(t,"defns");var i=ji(t,e,r),a=_.sumBy(i,function(o){return Cg(o,n)?1:0});return function(t,e,r){if(null==(null==r?void 0:r.order))return!1;var n=ji(t,e.objectName,r,{skipId:!0,skipOrder:!0}).filter(function(d){var p;return null!=(null===(p=d.properties)||void 0===p?void 0:p[e.propertyName])}),i=_.map(n,function(d){var p;return null===(p=d.selector)||void 0===p?void 0:p.order}).filter(function(d){return null!=d}).sort();i=_.uniq(i);for(var a=function(p,h){var v;return null!=(null===(v=p.selector)||void 0===v?void 0:v.order)&&(p.selector.order=h++),h},o=0,s=function(p){var h=_.filter(n,function(S){var b;return(null===(b=S.selector)||void 0===b?void 0:b.order)===p});if(u.assert(function(){return!!h.length},"should find definitions that match given order"),1===h.length)o=a(h[0],o);else{var v=_.findIndex(h,function(S){return Ct(S.selector,r)});v>=0&&(o=a(h[v],o),h.splice(v,1));for(var g=0,y=h;g<y.length;g++)o=a(y[g],o)}_.pullAll(n,h)},l=0,c=i;l<c.length;l++)s(c[l])}(t,{objectName:e,propertyName:n},r),a}function Wi(t,e,r,n){u.assertValue(t,"defns"),u.assertValue(e,"propertyId"),rc(t,e.objectName,r).properties[e.propertyName]=n}function HI(t,e,r,n,i){var a=xg(e,r);a?i?Wi(t,a,n,i):nc(t,a.objectName,n,a.propertyName):u.assertFail("Property does not have an associated format string object")}function ic(t,e,r){var n=Vg(t,e,r);if(n)return n[e.propertyName]}function Vg(t,e,r){var n=ji(t,e.objectName,r);if(n)for(var i=0,a=n;i<a.length;i++){var o=a[i];if(o.properties[e.propertyName])return o.properties}}function GI(t,e,r,n){var i=xg(e,r);if(i){var a=ic(t,i,n);if(a){if(oc(a)&&Is(a))return a;u.assertFail("Format value is not of the expected type")}}else u.assertFail("Property does not have an associated format string object")}function Mg(t,e,r){if(u.assertAnyValue(t,"defns"),u.assertValue(e,"objectName"),u.assertAnyValue(r,"selector"),t){var n=t[e];if(n)for(var i=0,a=n.length;i<a;i++){var o=n[i];if(Ct(o.selector,r))return o}}}function ji(t,e,r,n){if(u.assertAnyValue(t,"defns"),u.assertValue(e,"objectName"),u.assertAnyValue(r,"selector"),!t)return[];var i=t[e];return i?_.filter(i,function(a){return Ct(a.selector,r,n)}):[]}function xg(t,e){var r=Ml(t,e);if(r)return r.formatStringProperty;u.assertFail("Property is missing from the object descriptors")}function Fo(t,e){return t===e||(t instanceof Qe&&e instanceof Qe?Qe.isSameFilter(t,e):t instanceof U&&e instanceof U?j(t,e):ed(t,e))}function QI(t,e){if(u.assertValue(t,"a"),u.assertValue(e,"b"),Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(!Fo(t[r],e[r]))return!1;return!0}function WI(t,e){u.assertValue(t,"a"),u.assertValue(e,"b");var r=[];for(var n in t)Fo(t[n],e[n])||r.push(n);for(var n in e)_.includes(r,n)||Fo(t[n],e[n])||r.push(n);return r}function ac(t,e){u.assertAnyValue(t,"value"),u.assertValue(e,"DataViewObjectDefinition.encodePropertyValue - typeDescriptor should exist");var r=e,n=e;if(r.variantDeleteEmpty&&r.variant&&null==t)return t;if(r.bool||r.operations&&r.operations.searchEnabled)return"boolean"!=typeof t&&(t=!1),Zt(!!t);if(r.text||r.duration||r.scripting&&r.scripting.source)return Ce(t?t.toString():"");if(r.numeric){if($.isNumeric(t))return an(+t)}else if(r.integer){if($.isNumeric(t))return kn(Math.floor(+t))}else if(n.fill){if(t){var i=t;return null==i.id||null==i.shade?{solid:{color:Ce((i.value||t).toString())}}:{solid:{color:Au(i.id,i.shade)}}}if(null===t&&n.fill.solid&&n.fill.solid.color){var a=!1,o=n.fill.solid.color;if("boolean"!=typeof o&&(a=o.nullable),a)return{solid:{color:Lt()}}}}else if(r.formatting){if(!(r.formatting.labelDisplayUnits||r.formatting.displayUnitsWithoutAuto||r.formatting.fontSize))return Ce(t?t.toString():"");if(null!=t)return an(+t)}else{if(r.enumeration||r.flagsEnumeration)return $.isNumeric(t)?an(+t):Ce(t?t.toString():"");if(r.misc)t=t?Ce(t.toString()):null;else if(r.dateTime)t=t?er(t):null;else if(!r.variant)if(n.image){if(t){var s=t,l={name:Ce(s.name.toString()),url:Ce(s.url.toString())};return s.scaling&&(l.scaling=Ce(s.scaling.toString())),l}}else if(n.geoJson){if(t){var c=t;return{type:Ce(c.type.toString()),name:Ce(c.name.toString()),content:c.content?Ce(c.content.toString()):Lt()}}}else if(r.reference)(r.reference.bookmark||r.reference.section||r.reference.perspective||r.reference.bookmarkGroup||r.reference.rowRefText)&&(t=Ce(t?t.toString():""));else if(n.filter)u.assert(function(){return t instanceof Qe},"DataViewObjectDefinition.encodePropertyValue - When encoding a filter it should be of type Semantic Filter");else{if(n.paragraphs){var d=t,p=[];if(_.isEmpty(d))return p;for(var h=0,v=d;h<v.length;h++){var g=v[h],y=ye(ye({},g),{textRuns:[]});if(_.isEmpty(g.textRuns))p.push(y);else{for(var m=0,S=g.textRuns;m<S.length;m++){var b=S[m];if(Sg(b))y.textRuns.push(b);else if(bg(b)){var E=void 0;_.isNumber(b.expression)?E=ac(b.expression,{integer:!0}):Pt(b.expression)?E=b.expression:u.assertNever(b.expression);var C={cases:[],defaultCase:b.defaultCase,expression:E};if(!_.isEmpty(b.cases))for(var w=0,M=b.cases;w<M.length;w++){var V=M[w],D={pattern:ac(V.pattern,{integer:!0}),textRuns:V.textRuns};C.cases.push(D)}y.textRuns.push(C)}else u.assertNever(b)}p.push(y)}}return p}if(!n.queryTransform){if(n.exprList){var P={exprs:[],kind:"ExprList"};return P.exprs=_.map(t.exprs,function(J){return J}),P}if(n.itemLocation){var F=t,N={kind:"ItemLocation",byReference:{itemId:Ce(F.byReference.itemId)}};return F.byReference.workspaceId&&(N.byReference.workspaceId=Ce(F.byReference.workspaceId)),F.byReference.folderId&&(N.byReference.folderId=Ce(F.byReference.folderId)),N}u.assertFail("DataViewObjectDefinition.encodePropertyValue - The value couldn't be encoded, make sure that the descriptor is valid and handled in here.")}}}return t}function jI(t){var e={};for(var r in t){var n=t[r];_.isEmpty(n)||(e[r]=Dg(n))}return e}function KI(t){if(_.isEmpty(t))return!0;for(var e in t){var r=t[e];if(!_.isEmpty(r))for(var n=0,i=r;n<i.length;n++)if(!_.isEmpty(i[n].properties))return!1}return!0}function Dg(t){for(var e=[],r=0,n=t;r<n.length;r++){var i=n[r];e.push({properties:JI(i.properties),selector:i.selector})}return e}function JI(t){return u.assertValue(t,"original"),_.clone(t)}function YI(t){return!!t&&!!(t instanceof U||function(t){return!!t&&(t instanceof Qe||Gl(t)||Ql(t)||function(t){return!!t.identityFieldsValues}(t)||function(t){return t.name instanceof U&&t.url instanceof U}(t)||Wl(t)||function(t){return t.name instanceof U&&t.content instanceof U&&t.type instanceof U}(t)||function(t){return!(!t.algorithm||!t.parameters)}(t)||jl(t)||Mo(t)||Zv(t)||qi(t)||eg(t)||tg(t)||rg(t))}(t))}function $I(t,e,r){for(var n in t){var i=t[n],a=e&&e[n];if(i&&(!e||a))for(var o=0,s=i;o<s.length;o++){var l=s[o];for(var c in l.properties)!l.properties[c]||e&&(!a||!a.properties[c])||r(l.properties,c,l.selector,n,a)}}}function XI(t){var e=t.definitions,r=t.descriptors,n=t.visitor,i=t.structuralObjectVisitor;u.assertValue(e,"dataViewObjectDefinition.visitPropertyExprs - definitions"),u.assertAnyValue(r,"dataViewObjectDefinition.visitPropertyExprs - if descriptors exist we only visit valid objects, otherwise everything"),u.assertAnyValue(n,"dataViewObjectDefinition.visitPropertyExprs - visitor"),u.assertAnyValue(i,"dataViewObjectDefinition.visitPropertyExprs - visitor"),u.assert(function(){return!!n||!!i},"Either sqExprVisitor or structuralObjectVisitor are required");var a=[],o={stopVisiting:!1};function s(y,m,S){var b=y[m];if(n&&b instanceof U)n(b,y,m,S,a,o);else if("object"==typeof b&&(i&&i(b,y,m,S,a,o),n))for(var E in b){if(o.stopVisiting)return;a.push(E),s(b,E,S),a.pop()}}for(var l in e){var c=r&&r[l];if(!_.isEmpty(e[l])&&(c||!r)){for(var f=0,d=e[l];f<d.length;f++){var h=d[f].properties;if(h)for(var v in h){if(o.stopVisiting)return;var g=c&&c.properties[v];(g||!r)&&s(h,v,g&&g.type)}}u.assert(function(){return _.isEmpty(a)},"DataViewObjectDefinition.visitPropertyExprs - propertyPath should be empty after iterating through object properties")}}}function ZI(t){if(u.assertAnyValue(t,"DataViewObjectDefinitions.reduce - objects can be undefined"),!_.isEmpty(t)){for(var e in t)if(t[e]){for(var r=[],n=0,i=t[e];n<i.length;n++){var o=NI(i[n]);o&&r.push(o)}_.isEmpty(r)?delete t[e]:t[e]=r}else delete t[e];if(!_.isEmpty(t))return t}}function oc(t){return t instanceof U}function Ro(t){return t&&"ExprWithContext"===t.propertyDefinitionKind}var sr=function(){function t(e){this.families=e}return Object.defineProperty(t.prototype,"family",{get:function(){return this.getFamily()},enumerable:!1,configurable:!0}),t.prototype.getFamily=function(){return this.families.join(", ")},Object.defineProperty(t.prototype,"css",{get:function(){return this.getCSS()},enumerable:!1,configurable:!0}),t.prototype.getCSS=function(){return this.families?this.families.map(function(e){return e.indexOf(" ")>-1?"'".concat(e,"'"):e}).join(", "):null},t}(),Ht={light:new sr(["Segoe UI Light","wf_segoe-ui_light","helvetica","arial","sans-serif"]),semilight:new sr(["Segoe UI Semilight","wf_segoe-ui_semilight","helvetica","arial","sans-serif"]),regular:new sr(["Segoe UI","wf_segoe-ui_normal","helvetica","arial","sans-serif"]),semibold:new sr(["Segoe UI Semibold","wf_segoe-ui_semibold","helvetica","arial","sans-serif"]),bold:new sr(["Segoe UI Bold","wf_segoe-ui_bold","helvetica","arial","sans-serif"]),lightSecondary:new sr(["wf_standard-font_light","helvetica","arial","sans-serif"]),regularSecondary:new sr(["wf_standard-font","helvetica","arial","sans-serif"]),boldSecondary:new sr(["wf_standard-font_bold","helvetica","arial","sans-serif"]),glyphs:new sr(["PowerVisuals"])},eT={"Segoe UI Light":Ht.light,"Segoe UI Semilight":Ht.semilight,"Segoe UI":Ht.regular,"Segoe UI Semibold":Ht.semibold,"Segoe (Bold)":Ht.bold,"Segoe UI Bold":Ht.bold,DIN:Ht.regularSecondary,"DIN Light":Ht.lightSecondary,Heading:Ht.light,Body:Ht.regular};function No(t){var e=eT[t];return e?e.family:t}function Gt(t,e,r,n,i){if(t?null==t.color&&(t.color=r||e.color):t={color:r||e.color},null==t.fontSize){var a=_.toNumber(e.fontSize);u.assert(function(){return!isNaN(a)},"visualStyle > applyTextClassDefaults: given textClass fontSize is NaN; cannot transform"),t.fontSize=(null==n?a:Math.round(a*n*10)/10)+""}if(null==t.fontWeight&&null!=i)switch(i){case"700":t.fontWeight="700";break;case"600":t.fontWeight="600";break;default:t.fontWeight=e.fontWeight}return t.fontFace=t.fontFace||e.fontFace,t}var uT={"ui-background":"var(--colorNeutralBackground1)","ui-backgroundSecondary":"var(--colorNeutralBackground3)"},sc={misc:{imageUrl:!0}},dT=function(){function t(e,r,n,i,a,o,s,l,c,f){this.featureSwitches=e,this.warningType=r,this.propertyId=n,this.selector=i,this.objectDisplayNameGetter=a,this.propertyDisplayNameGetter=o,this.valueExpr=s,this.value=l,this.expectedValueType=c,this.columnExpr=f,1===this.warningType?(u.assertValue(c,"expectedValueType"),this.titleKey="DataBoundExprWarning_InvalidType_Title",this.hintKey="DataBoundExprWarning_InvalidType_Message"):2===this.warningType?(this.titleKey="DataBoundExprWarning_MissingReference_Title",this.hintKey="DataBoundExprWarning_MissingReference_Message"):(this.titleKey="VisualWarning_PropertyEvaluation_Tooltip_Header",this.hintKey="VisualWarning_PropertyEvaluation_Tooltip_Hint_Color")}return Object.defineProperty(t.prototype,"code",{get:function(){switch(this.warningType){case 1:return"DataBoundExprWarningTypeInvalidType";case 2:return"DataBoundExprWarningTypeMissingReference";case 0:return"DataBoundExprWarningTypeInvalidValue";default:u.assertNever(this.warningType)}},enumerable:!1,configurable:!0}),t.prototype.getMessages=function(e,r){if(r){if(this.cachedMessage)return this.cachedMessage;var i=e.get("NamePattern_Colon"),a=[],o=this.propertyDisplayNameGetter instanceof Function?this.propertyDisplayNameGetter(e):this.propertyDisplayNameGetter,s=Be(e.get(this.titleKey),o),l=this.objectDisplayNameGetter instanceof Function?this.objectDisplayNameGetter(e):this.objectDisplayNameGetter;if(!this.featureSwitches.useModernFormatPane){var c=Be(i,e.get("VisualWarning_PropertyEvaluation_Tooltip_Section"),l);a.push(c)}var f=r(this.valueExpr);if(f){var d=Be(i,e.get("Field_Source"),f);a.push(d)}if(void 0!==this.columnExpr){var p=r(this.columnExpr),h=Be(i,e.get("Field_Target"),p);a.push(h)}if(1===this.warningType&&this.expectedValueType){var v=Be(i,e.get("DataBoundExprWarning_ExpectedDataType"),t.getPrimitiveValueType(this.expectedValueType,e));a.push(v)}if(0===this.warningType&&this.value){var g=Be(i,e.get("Value"),this.value.toString());a.push(g)}var y=e.get(this.hintKey);return a.push(y),this.cachedMessage={title:s,message:y,detail:a.join("\n")},this.cachedMessage}u.assertFail("DataViewObjectEvaluationWarning - getMessages - setSQExprTranslator needed for correct warning")},t.prototype.getTitle=function(e){var r=this.propertyDisplayNameGetter instanceof Function?this.propertyDisplayNameGetter(e):this.propertyDisplayNameGetter;return Be(e.get(this.titleKey),r)},t.prototype.getMessage=function(e){return e.get(this.hintKey)},t.getPrimitiveValueType=function(e,r){switch(e.primitiveType){case 1:return r.get("Text");case 2:case 3:case 4:return r.get("ConditionalFormattingDialog_Number");case 5:return r.get("ConditionalFormattingDialog_Boolean");case 6:case 7:return r.get("ConditionalFormattingDialog_Date");default:u.assertFail("Invalid expected data type")}},t}(),hT=function(){function t(){this.cache=[]}return t.prototype.get=function(e){u.assertValue(e,"key");for(var r=0,n=this.cache;r<n.length;r++){var i=n[r];if(i.key===e)return i.allocator}},t.prototype.register=function(e,r){var n=this;return u.assertValue(e,"key"),u.assert(function(){return void 0!==r},"colorAllocator (it can be null, but not undefined)"),u.assert(function(){return null==n.get(e)},"Trying to re-register for same key expr."),this.cache.push({key:e,allocator:r}),this},t}();function Ig(){var t=function(r){};return{getExprValue:t,getExprColumn:t,getScopedEvalExprValue:t,getRoleValues:t}}var uc=function(){function t(){}return t.prototype.evaluate=function(e){u.assertFail("Abstract method RuleEvaluation.evaluate not implemented.")},t}(),Kn=function(){function t(e,r){var n=this;this.featureSwitches=e,this.visualStyle=r,u.assertValue(this.featureSwitches,"featureSwitches"),this.colorAllocatorCache=new hT,this.expressionEvaluator=new vT(function(i){return n.evaluateThemeDataColor(i)},function(i,a){return n.ensureColorAllocator(i,a)})}return t.prototype.getObjectsRules=function(){return this.objectsRules},t.prototype.run=function(e,r,n,i,a){if(u.assertValue(r,"evalContext"),u.assertAnyValue(n,"objectDescriptor"),u.assertValue(i,"propertyDefinitions"),n){var o,s=n.properties;for(var l in i){this.propertyId={objectName:e,propertyName:l};var c=i[l],f=s[l];if(f){a&&(a.objectDescriptor=n,a.propertyName=l);var d=this.evaluateProperty(r,f,c);void 0!==d&&(o||(o={}),o[l]=d)}}return this.propertyId=void 0,o}},t.prototype.evaluateProperty=function(e,r,n,i){var a,o,s;u.assertValue(e,"evalContext"),u.assertValue(r,"propertyDescriptor"),u.assertValue(n,"propertyDefinition");var l=r.type;if(l&&l.expression)return n;var f,c=this.evaluateValue(e,n,L.fromDescriptor(r.type));return void 0!==c||n instanceof uc?c:(l.fillRule?f=this.evaluateFillRule(n):null!==(o=null===(a=l.fill)||void 0===a?void 0:a.solid)&&void 0!==o&&o.color&&null!==(s=null==n?void 0:n.solid)&&void 0!==s&&s.color?f=this.evaluateSolidColorFill(e,n,l.fill.solid.color.nullable):l.dataBars&&(f=this.evaluateDataBars(e,n)),f?(i&&f.error&&i.warnings.push(new dT(this.featureSwitches,0,{objectName:i.objectName,propertyName:i.propertyName},i.selector,i.objectDescriptor.displayName,r.displayName,f.error.expr,f.error.value,null,i.targetExpr)),f.value):l.image?this.evaluateImage(e,n):l.paragraphs?this.evaluateParagraphs(e,n):l.geoJson?this.evaluateGeoJson(e,n):l.filter?this.evaluateSemanticFilter(n):l.icon?this.evaluateIcon(e,n):l.exprList?this.evaluateExprList(n):l.errorRange?this.evaluateErrorRange(e,n):l.qnaVisualLink?this.evaluateQnaVisualLink(e,n):l.itemLocation?this.evaluateItemLocation(e,n):l.annotationType?this.evalulateAnnotationType(e,n):void 0)},t.prototype.evaluateSemanticFilter=function(e){return e},t.prototype.evaluateSolidColorFill=function(e,r,n){var i;if(null!==(i=null==r?void 0:r.solid)&&void 0!==i&&i.color){var a=this.evaluateColor(e,r.solid.color,n);if(a.error)return a;var o=a.value;if(o||null===o&&n)return{value:{solid:{color:o}}}}},t.prototype.ensureColorAllocator=function(e,r){var n=this.colorAllocatorCache.get(e);return void 0!==n||(n=this.createColorAllocator(e,r),this.colorAllocatorCache.register(e,n,this.propertyId),this.propertyId&&n&&this.addObjectRule(n)),n},t.prototype.addObjectRule=function(e){this.objectsRules||(this.objectsRules={});var r=this.objectsRules[this.propertyId.objectName];r||(r=this.objectsRules[this.propertyId.objectName]={}),r[this.propertyId.propertyName]={gradient:{options:e.getRule(),source:e.getSource()}}},t.prototype.createColorAllocator=function(e,r){var n=r.getExprColumn(e.input,this.featureSwitches.categoricalSecondaryCF);if(!n)return null;var i=this.evaluateFillRule(e.rule).value;return i?ho().fromFillRule(i,n):null},t.prototype.evaluateFillRule=function(e){var n,r=Ig();if(e.linearGradient2){if((a=this.evaluateColorStop(r,(i=e.linearGradient2).min)).error)return a;if((o=this.evaluateColorStop(r,i.max)).error)return o;if(n={linearGradient2:{min:a.value,max:o.value}},s=this.evaluateNullStrategy(r,i.nullColoringStrategy)){if(s.error)return s;n.linearGradient2.nullColoringStrategy=s.value}}else if(e.linearGradient3){var i,a;if((a=this.evaluateColorStop(r,(i=e.linearGradient3).min)).error)return a;var o,s,c=this.evaluateColorStop(r,i.mid);if(c.error)return c;if((o=this.evaluateColorStop(r,i.max)).error)return o;if(n={linearGradient3:{min:a.value,mid:c.value,max:o.value}},s=this.evaluateNullStrategy(r,i.nullColoringStrategy)){if(s.error)return s;n.linearGradient3.nullColoringStrategy=s.value}}return{value:n}},t.prototype.evaluateColorStop=function(e,r){u.assertValue(e,"evalContext"),u.assertValue(r,"colorStop");var n=this.evaluateColor(e,r.color,!1);if(n.error)return n;var i={color:n.value},a=this.evaluateValue(e,r.value,t.numericType);return null!=a&&(i.value=a),{value:i}},t.prototype.evaluateColor=function(e,r,n){u.assertValue(e,"evalContext"),u.assertValue(r,"evaluateColor - color");var i=this.evaluateValue(e,r,t.colorValueType),a=null!=i?function(t,e){u.assertValue(e,"EvalContext.getThemeColor - colorName should't be null");var r=t.colorPalette,n=r.dataColors.getGradientColors(),i=r.dataColors.getSentimentColors(),a=r[e]||n[e]||i[e];return u.assertAnyValue(a,"getThemeColor - If this is not a theme color it's likely a custom color (like rgba),\n                we should consider updating dataViewObjectEvaluator logic to only call this if it's a theme color."),null==a?void 0:a.value}(this.visualStyle,i):i;if(null!=a)return{value:a};if(null===i&&n)return{value:null};if(!i)return{value:void 0};var o=i.toString();if(o){var s=o.replace(/\s+/g,"");!function(t){return/(#([\da-f]{3}){1,2}|(rgb|hsl)a\((\d{1,3}%?,\s?){3}(1.0|1|0|0?\.\d+)\)|(rgb|hsl)\(\d{1,3}%?(,\s?\d{1,3}%?){2}\))/gi.test(t)}(s)?(o=function(t){return u.assertValue(t,"getWebColorValue - colorName"),Fb[t.toLocaleLowerCase()]}(s),null==o&&(o=function(t){return u.assertValue(t,"getUIThemeColorValue - colorName"),uT[t]}(s))):o=s}return void 0===o?{error:{expr:r,value:i}}:{value:o}},t.prototype.evaluateNullStrategy=function(e,r){if(r){u.assertValue(e,"evaluateNullStrategy - undefined evalContext"),u.assertValue(r.strategy,"evaluateNullStrategy - undefined strategy");var n={strategy:this.evaluateValue(e,r.strategy,t.nullStrategyType)};if(r.color){var i=this.evaluateColor(e,r.color,!1);if(i.error)return i;n.color=i.value}return{value:n}}},t.prototype.evaluateImage=function(e,r){if(u.assertValue(e,"evalContext"),u.assertAnyValue(r,"definition"),r){var n={name:this.evaluateValue(e,r.name,t.textType),url:this.evaluateValue(e,r.url,L.fromDescriptor(sc))};return r.scaling&&(n.scaling=this.evaluateValue(e,r.scaling,t.textType)),n}},t.prototype.evaluateParagraphs=function(e,r){var n=this;if(u.assertValue(e,"evalContext"),u.assertAnyValue(r,"definition"),r)return this.evaluateArrayCopyOnChange(e,r,function(i,a){return n.evaluateParagraph(i,a)})},t.prototype.evaluateParagraph=function(e,r){var n=this;u.assertValue(e,"evalContext"),u.assertValue(r,"definition");var i,a=r.textRuns,o=this.evaluateArrayCopyOnChange(e,a,function(s,l){return n.evaluateTextRun(s,l)});return a!==o&&((i=_.clone(r)).textRuns=o),i||r},t.prototype.evaluateTextRun=function(e,r){return u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),Zl(r)?this.evaluateTextRunDefinition(e,r):ec(r)?this.evaluateTextRunConditional(e,r):void u.assertNever(r)},t.prototype.evaluateTextRunDefinition=function(e,r){var n,i;r.value instanceof U?(n=r.value,i=this.evaluateValue(e,r.value,t.textType)):i=r.value;var a={value:i};return r.textStyle&&(a.textStyle=r.textStyle),r.url&&(a.url=r.url),r.mentionEmail&&(a.mentionEmail=r.mentionEmail),n&&(a.valueExpr=n),a},t.prototype.evaluateTextRunConditional=function(e,r){var n=this;return{cases:this.evaluateArrayCopyOnChange(e,r.cases,function(a,o){return n.evaluateTextRunConditionalCase(a,o)}),defaultCase:this.evaluateTextRunCaseValue(e,r.defaultCase),expression:this.evaluateTextRunConditionalExpression(e,r.expression)}},t.prototype.evaluateTextRunConditionalCase=function(e,r){return ye({pattern:this.evaluateValue(e,r.pattern,t.textType)},this.evaluateTextRunCaseValue(e,r))},t.prototype.evaluateTextRunCaseValue=function(e,r){var n=this;return{textRuns:this.evaluateArrayCopyOnChange(e,r.textRuns,function(a,o){return n.evaluateTextRunDefinition(a,o)})}},t.prototype.evaluateTextRunConditionalExpression=function(e,r){return r instanceof U?this.evaluateValue(e,r,t.textType):Pt(r)?r:void u.assertNever(r)},t.prototype.evaluateGeoJson=function(e,r){if(u.assertValue(e,"evalContext"),u.assertAnyValue(r,"definition"),r)return{name:this.evaluateValue(e,r.name,t.textType),type:this.evaluateValue(e,r.type,t.textType),content:this.evaluateValue(e,r.content,t.textType)}},t.prototype.evaluateDataBars=function(e,r){var n=this.evaluateSolidColorFill(e,r.positiveColor,!1);if(n.error)return{error:n.error};var i=this.evaluateSolidColorFill(e,r.negativeColor,!1);if(i.error)return{error:i.error};var a=this.evaluateSolidColorFill(e,r.axisColor,!1);return a.error?{error:a.error}:{value:{minValue:this.evaluateValue(e,r.minValue,t.numericType),maxValue:this.evaluateValue(e,r.maxValue,t.numericType),positiveColor:n.value,negativeColor:i.value,axisColor:a.value,reverseDirection:this.evaluateValue(e,r.reverseDirection,t.boolType),hideText:this.evaluateValue(e,r.hideText,t.boolType),totalMatchingOption:this.evaluateValue(e,r.totalMatchingOption,t.integerType)}}},t.prototype.evaluateIcon=function(e,r){var n;if(u.assertValue(e,"evalContext"),u.assertAnyValue(r,"definition"),Mo(r)){var i={kind:"Icon"};if(r.layout&&(i.layout=this.evaluateValue(e,r.layout,t.textType)),r.verticalAlignment&&(i.verticalAlignment=this.evaluateValue(e,r.verticalAlignment,t.textType)),r.value){var a=this.evaluateValue(e,r.value,t.textType);if(null===a)i.value=null;else if(void 0===a)i.value=null;else{var o=function(t,e){return u.assertValue(t,"getThemeIcon - visualStyle"),u.assertValue(e,"getThemeIcon - iconId"),t.icons[e]}(this.visualStyle,a);if(o)if(o.svgId){var s=null===(n=o.description)||void 0===n?void 0:n.resourceKey;i.value={svgId:o.svgId},s&&(i.value.descriptionKey=s)}else o.url?i.value={url:o.url}:u.assertFail("incorrect themeIcon");else i.value={url:a}}}return i}},t.prototype.evaluateThemeDataColor=function(e){return function(t,e){var r;return u.assertValue(t,"getThemeDataColor - visualStyle"),u.assertValue(e,"getThemeDataColor - colorIdx"),null===(r=t.colorPalette.dataColors.getBasePickerColors()[e])||void 0===r?void 0:r.value}(this.visualStyle,e)},t.prototype.evaluateExprList=function(e){if(u.assertAnyValue(e,"definition"),Zv(e))return{exprs:e.exprs,kind:"ExprList"}},t.prototype.evaluateArrayCopyOnChange=function(e,r,n){u.assertValue(e,"evalContext"),u.assertValue(r,"definitions"),u.assertValue(n,"evaluator");for(var i,a=0,o=r.length;a<o;a++){var s=r[a],l=n(e,s);!i&&s!==l&&(i=_.take(r,a)),i&&i.push(l)}return i||r},t.prototype.evaluateErrorRange=function(e,r){if(u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),qi(r)){if(r.explicit)return this.evaluateExplicitErrorRange(e,r.explicit);if(r.symmetricalExplicit)return this.evaluateSymmetricalErrorRange(e,r.symmetricalExplicit);if(r.standardDeviation)return this.evaluateStandardDeviationErrorRange(e,r.standardDeviation);if(r.percentage)return this.evaluatePercentageErrorRange(e,r.percentage);if(r.percentile)return this.evaluatePercentileErrorRange(e,r.percentile)}},t.prototype.evaluateExplicitErrorRange=function(e,r){var n={isRelative:!0===this.evaluateValue(e,r.isRelative,t.boolType)};return r.lowerBound&&(n.lowerBound=this.evaluateValue(e,r.lowerBound,t.numericType)),r.upperBound&&(n.upperBound=this.evaluateValue(e,r.upperBound,t.numericType)),{explicit:n}},t.prototype.evaluateSymmetricalErrorRange=function(e,r){return{symmetricalExplicit:{delta:this.evaluateValue(e,r.delta,t.numericType)}}},t.prototype.evaluateStandardDeviationErrorRange=function(e,r){return{standardDeviation:{value:this.evaluateValue(e,r.value,t.numericType),multiplier:this.evaluateValue(e,r.multiplier,t.numericType)}}},t.prototype.evaluatePercentageErrorRange=function(e,r){return{percentage:{lowerBoundDelta:this.evaluateValue(e,r.lowerBoundDelta,t.numericType),upperBoundDelta:this.evaluateValue(e,r.upperBoundDelta,t.numericType)}}},t.prototype.evaluatePercentileErrorRange=function(e,r){return{percentile:{lowerBound:this.evaluateValue(e,r.lowerBound,t.numericType),upperBound:this.evaluateValue(e,r.upperBound,t.numericType)}}},t.prototype.evaluateQnaVisualLink=function(e,r){if(u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),eg(r))return{suggestedUtterances:_.map(r.suggestedUtterances,function(n){return{utterance:n.utterance}})}},t.prototype.evaluateItemLocation=function(e,r){if(u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),tg(r)&&r.byReference){var n={byReference:{itemId:this.evaluateValue(e,r.byReference.itemId,t.textType)}};return r.byReference.workspaceId&&(n.byReference.workspaceId=this.evaluateValue(e,r.byReference.workspaceId,t.textType)),r.byReference.folderId&&(n.byReference.folderId=this.evaluateValue(e,r.byReference.folderId,t.textType)),n}},t.prototype.evalulateAnnotationType=function(e,r){if(u.assertValue(e,"evalContext"),u.assertValue(r,"definition"),rg(r)){var n={};if(r.highlights.color&&(n.color=this.evaluateValue(e,r.highlights.color,t.textType)),r.highlights.backColor&&(n.backColor=this.evaluateValue(e,r.highlights.backColor,t.textType)),r.highlights.emphasizeText&&(n.emphasizeText=this.evaluateValue(e,r.highlights.emphasizeText,t.boolType)),!_.isEmpty(n))return n}},t.prototype.evaluateValue=function(e,r,n){return r instanceof U?this.expressionEvaluator.evaluate(r,e):r instanceof uc?r.evaluate(e):void 0},t.boolType=L.fromDescriptor({bool:!0}),t.colorValueType=L.fromDescriptor({formatting:{color:!0}}),t.numericType=L.fromDescriptor({numeric:!0}),t.integerType=L.fromDescriptor({integer:!0}),t.textType=L.fromDescriptor({text:!0}),t.nullStrategyType=L.fromDescriptor({enumeration:PC}),t}(),vT=function(t){function e(r,n){var i=t.call(this)||this;return i.dataColorEvaluator=r,i.colorAllocatorGetter=n,i}return T(e,t),e.prototype.evaluate=function(r,n){if(null!=r)return r.accept(this,n)},e.prototype.visitColumnRef=function(r,n){return n.getExprValue(r)},e.prototype.visitConstant=function(r,n){return r.value},e.prototype.visitMeasureRef=function(r,n){return n.getExprValue(r)},e.prototype.visitArithmetic=function(r,n){return n.getExprValue(r)},e.prototype.visitNativeMeasure=function(r,n){return n.getExprValue(r)},e.prototype.visitAggr=function(r,n){return n.getExprValue(r)},e.prototype.visitScopedEval=function(r,n){return n.getScopedEvalExprValue(r)},e.prototype.visitFillRule=function(r,n){var i=this.colorAllocatorGetter(r,n);if(i){var a=this.evaluate(r.input,n);if(void 0!==a)return i.color(a)}},e.prototype.visitPercentile=function(r,n){return n.getExprValue(r)},e.prototype.visitRangePercent=function(r,n){var i=this.evaluate(r.min,n);if(_.isFinite(i)){var a=this.evaluate(r.max,n);if(_.isFinite(a)){var o=r.percent;return 0===o?i:1===o?a:i+o*(a-i)}}},e.prototype.visitSelectRef=function(r,n){return n.getExprValue(r)},e.prototype.visitThemeDataColor=function(r,n){var i=this.dataColorEvaluator(r.colorId);if(i)return function(t,e){var r=parseInt(t.slice(1),16),n=e<0?0:255,i=e<0?-1*e:e,a=r>>16,o=r>>8&255,s=255&r;return"#"+(16777216+65536*(Math.round((n-a)*i)+a)+256*(Math.round((n-o)*i)+o)+(Math.round((n-s)*i)+s)).toString(16).slice(1)}(i,r.percent)},e.prototype.visitNot=function(r,n){return!this.evaluate(r.arg,n)},e.prototype.visitAnd=function(r,n){return r.left.accept(this,n)&&r.right.accept(this,n)},e.prototype.visitContains=function(r,n){if(!r.isOrdinalEvaluation())return u.assertFail("Contains expression should be evaluated as ordinal"),!1;var i=this.getExprString(r.left,n),a=this.getExprString(r.right,n);return _.isString(i)?Ma(i,a):(u.warn("Contains expression should only be applied to string types"),!1)},e.prototype.visitStartsWith=function(r,n){if(!r.isOrdinalEvaluation())return u.assertFail("StartsWith expression should be evaluated as ordinal"),!1;var i=this.getExprString(r.left,n),a=this.getExprString(r.right,n);return _.isString(i)?function(t,e){return null!=t&&0===t.indexOf(e)}(i,a):(u.warn("StartsWith expression should only be applied to strings"),!1)},e.prototype.getExprString=function(r,n){var i;if(null!==r)return null!==(i=Iu(r))&&void 0!==i?i:this.evaluate(r,n)},e.prototype.visitCompare=function(r,n){var i=this.evaluate(r.left,n);if(_.isNaN(i))return!1;var a=this.evaluate(r.right,n);if(_.isNaN(a))return!1;var o=r.comparison;if(r.isOrdinalEvaluation())return 0===o?i===a:(u.assertFail("An ordinal comparison with QueryExpressionKind other than 'Equal' is not supported"),!1);if(null===a||null===i)return a===i&&(0===o||2===o||4===o);switch(o){case 0:return i===a;case 1:return i>a;case 2:return i>=a;case 3:return i<a;case 4:return i<=a}},e.prototype.visitConditional=function(r,n){var i=r.cases;if(u.assertNonEmpty(i,"ExpressionEvaluator.visitConditional - Empty cases"),!_.isEmpty(i))for(var a=0,o=i;a<o.length;a++){var s=o[a],c=s.value;if(!0===this.evaluate(s.condition,n))return this.evaluate(c,n)}return this.evaluate(r.defaultValue,n)},e}(bi),Fg=function(){function t(e,r,n,i){u.assertValue(e,"items"),this.items=e,this._activeProjectionRefs=r,this._showAll=n,this.parameters=i||[]}return t.prototype.all=function(){return this.items},t.prototype.resetHiddenState=function(e){if(!_.isEmpty(this.items))for(var r=0,n=this.items;r<n.length;r++){var i=n[r];i.queryRef===e&&delete i.hidden}},t.prototype.toggleHidden=function(e){if(!_.isEmpty(this.items))for(var r=0,n=this.items;r<n.length;r++){var i=n[r];i.queryRef===e&&(i.hidden=!i.hidden)}},t.prototype.resetAllHiddenState=function(){for(var e=0,r=this.items;e<r.length;e++)delete r[e].hidden},t.prototype.projected=function(){return _.isEmpty(this.items)?this.items:_.filter(this.items,function(e){return e&&!e.hidden})},t.prototype.addProjection=function(e,r){var n,i,a;r&&(n=r.fieldIndex,i=r.parameter,a=r.indexInParameter);var o=this.getProjectionIndex(n,i,a);this.fixUpParameterIndices(i,n,1),o>=this.items.length?this.items.push(e):this.items.splice(o,0,e)},t.prototype.removeProjection=function(e){var r,n,i;e&&(r=e.fieldIndex,n=e.parameter,i=e.indexInParameter),u.assert(function(){return null!=r||null!=n&&null!=i},"When removing a projection we expect field index or the parameter options to be complete.");var a=this.getProjectionIndex(r,n,i);this.fixUpParameterIndices(n,r,-1),this.items.splice(a,1)},t.prototype.fixUpParameterIndices=function(e,r,n){for(var i=0,a=this.parameters;i<a.length;i++){var o=a[i];e?o.index===e.index&&(void 0===o.length&&(o.length=0),o.length+=n):null!=r&&o.index>=r&&(n>0?o.index>=r:o.index>r)&&(o.index+=n)}},t.prototype.moveFields=function(e,r,n){var i,o,s,l,a=this;if(0===this.parameters.length)o=e,s=n,l=r;else{if(u.assert(function(){return e>=0&&e<a.getFieldCount()&&r>=0&&r<a.getFieldCount()},"Should use valid field indices"),u.assert(function(){return e+n<=a.getFieldCount()},"Should not attempt to move more fields than exist in collection"),u.assert(function(){return r+n<=a.getFieldCount()},"Moving projections should not change the length of collection"),n<=0||e===r)return[];o=this.convertFieldIndexToProjectionIndex(e);var f=this.indexOfLastProjectionInField(e+n-1);s=f-o+1,l=this.convertFieldIndexToProjectionIndex(r),r>e&&(l+=this.indexOfLastProjectionInField(r+n-1)-l+1-s);for(var v=0,g=this.parameters;v<g.length;v++){var y=g[v];y.index>=e&&y.index<=e+n-1?y.index=r+y.index-e:y.index>e&&y.index<=r+n-1?y.index-=n:y.index<e&&y.index>=r&&(y.index+=n)}if(f<o)return[]}var m=this.items.splice(o,s);return(i=this.items).splice.apply(i,Ee([l,0],m||[],!1)),m},t.prototype.assignProjection=function(e,r){this.items[r]=e},t.prototype.updateQueryRef=function(e,r){this.items[e].queryRef=r},t.prototype.getQueryRefs=function(){return _.map(this.items,function(e){return e.queryRef})},t.prototype.getFieldParameters=function(){return this.parameters},t.prototype.addFieldParameter=function(e){for(var r=0,n=this.parameters;r<n.length;r++){var i=n[r];i.index>=e.index&&i.index++}this.parameters.push(e)},t.prototype.getColumnProjectionIndex=function(e){var r=this;return u.assert(function(){return!_.find(r.parameters,function(n){return n.index===e})},"Should not be called on parameters"),this.convertFieldIndexToProjectionIndex(e)},t.prototype.getProjectionsByProjectionIndex=function(e){var r=this.convertProjectionIndexToFieldIndex(e),n=this.getParameterByFieldIndex(r);return n?this.getParameterProjections(n):[this.items[e]]},t.prototype.getProjectionsByFieldIndex=function(e){var r=this.getParameterByFieldIndex(e);if(r){var n=this.getParameterProjections(r),i=_.filter(n,function(s){return null!=s});return i.length!==n.length&&u.assertFail("The projection should exist, but in some extraordinary scenario it does not exist"),i}var a=this.convertFieldIndexToProjectionIndex(e),o=this.items[a];return null==o?(u.assertFail("The projection should exist, but in some extraordinary scenario it does not exist"),[]):[o]},t.prototype.convertProjectionIndexToFieldIndex=function(e){var r,n;if(_.isEmpty(this.parameters))return e;for(var i=0,a=0,s=0,l=_.sortBy(this.parameters,function(f){return f.index});s<l.length;s++){var c=l[s];if(i+e-a<c.index)break;if((a+=c.index-i-1)+(null!==(r=c.length)&&void 0!==r?r:0)>e)return c.index;i=c.index,a+=null!==(n=c.length)&&void 0!==n?n:0}return i+e-a},t.prototype.doesParameterExist=function(e){return _.some(this.parameters,function(r){return r.index===e})},t.prototype.getParameterProjectionIndex=function(e,r){var n=this;return u.assert(function(){return e&&null!=r},"Parameter and indexInParameter should both be defined"),u.assert(function(){return n.doesParameterExist(e.index)},"Parameter should exist for this projection"),this.convertFieldIndexToProjectionIndex(e.index)+r},t.prototype.getColumnProjection=function(e){if(!this.doesParameterExist(e))return this.items[this.getColumnProjectionIndex(e)]},t.prototype.getParameterProjections=function(e){if(!e||!e.length)return[];var r=this.convertFieldIndexToProjectionIndex(e.index);return this.items.slice(r,r+e.length)},t.prototype.removeFieldParameters=function(e){for(var r=function(c){var f=_.findIndex(n.parameters,function(y){return y.index===c.index&&j(y.expr,c.expr)});if(f<0)return{value:!1};var d=n.parameters.splice(f,1)[0],p=d.index;u.assert(function(){return 0===d.length||null==d.length},"there should be no projections for this removed parameter");for(var h=0,v=n.parameters;h<v.length;h++){var g=v[h];g.index>p&&g.index--}},n=this,i=0,a=e;i<a.length;i++){var s=r(a[i]);if("object"==typeof s)return s.value}return!0},t.prototype.findParameterBySQExpr=function(e){return _.isEmpty(this.parameters)?[]:this.parameters.filter(function(r){return j(r.expr,e)})},t.prototype.getParameterByFieldIndex=function(e){return _.find(this.parameters,function(r){return r.index===e})},Object.defineProperty(t.prototype,"activeProjectionRefs",{get:function(){return this._activeProjectionRefs},set:function(r){if(_.isEmpty(r))this._activeProjectionRefs=void 0;else{for(var n=this.items.map(function(s){return s.queryRef}),i=0,a=r;i<a.length;i++)if(!_.includes(n,a[i]))return;this._activeProjectionRefs=r}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showAll",{get:function(){return this._showAll},set:function(r){this._showAll=r},enumerable:!1,configurable:!0}),t.prototype.addActiveQueryReference=function(e){this._activeProjectionRefs?this._activeProjectionRefs.push(e):this._activeProjectionRefs=[e]},t.prototype.getLastActiveQueryReference=function(){if(!_.isEmpty(this._activeProjectionRefs))return this._activeProjectionRefs[this._activeProjectionRefs.length-1]},t.prototype.replaceQueryRef=function(e,r){var n=this;u.assertValue(e,"oldQueryRef"),u.assertValue(r,"newQueryRef"),u.assert(function(){return e!==r},"oldQueryRef !== newQueryRef"),u.assert(function(){return _.isEmpty(n._activeProjectionRefs)},"replaceQueryRef(...) is not supported on the QueryProjectionCollection of a drillable role");for(var i=0,a=this.items;i<a.length;i++){var o=a[i];o.queryRef===e&&(o.queryRef=r)}},t.prototype.clone=function(){return new t(_.cloneDeep(this.items),_.clone(this._activeProjectionRefs),this._showAll,_.map(this.parameters,function(e){return{expr:e.expr,index:e.index,length:e.length}}))},t.prototype.getProjectionIndex=function(e,r,n){var i,a;if(r){var o=null!==(i=r.length)&&void 0!==i?i:0;null!=n?(u.assert(function(){return n<=o},"indexInParameter should not exceed the current length of the parameter's projections."),a=this.convertFieldIndexToProjectionIndex(r.index)+n):a=this.convertFieldIndexToProjectionIndex(r.index)+o}else a=null!=e?this.convertFieldIndexToProjectionIndex(e):this.items.length;return a},t.prototype.convertFieldIndexToProjectionIndex=function(e){return function(t,e){for(var r,n=_.filter(e,function(l){return l.index<t}),i=t,a=0,o=n;a<o.length;a++)i+=(null!==(r=o[a].length)&&void 0!==r?r:0)-1;return i}(e,this.parameters)},t.prototype.indexOfLastProjectionInField=function(e){var r=this.convertFieldIndexToProjectionIndex(e),n=_.find(this.parameters,function(i){return i.index===e});return n&&(r+=n.length-1),r},t.prototype.getFieldCount=function(){for(var e,r=this.items.length,n=0,i=this.parameters;n<i.length;n++)r-=(null!==(e=i[n].length)&&void 0!==e?e:0)-1;return r},t}();function gn(t,e,r){if(u.assertValue(t,"expr"),u.assertAnyValue(e,"selectTransforms"),!e)return-1;var n;Jt(t)&&(n=t.expressionName);for(var i=r||0,a=e.length;i<a;i++){var o=e[i];if(o&&(!n||o.queryName))if(n){if(o.queryName===n)return i}else if(j(o.expr,t))return i}return-1}function ko(t,e){return new ET(t,e)}Kt(Fg.prototype);var ET=function(){function t(e,r){this.dataView=e,this.selectTransforms=r,u.assertValue(e,"dataView"),u.assertAnyValue(r,"selectTransforms")}return t.prototype.getExprColumn=function(e){var r=gn(e,this.selectTransforms);if(!(r<0))return _.find(this.dataView.metadata.columns,function(n){return n.index===r})},t.prototype.getScopedEvalExprValue=function(e){var r=e.decomposeGlobalAggregateOfScopedExpr();if(r){var n=or(r.source,this.dataView.metadata.columns);return n?Do(n,r.func):void 0}if(e.hasGlobalScope())return this.getExprValue(e.expression);e.hasInnerMostScope()?u.assertFail("Attempt to evaluate a scoped expression within the Global scope"):u.assertFail("Evaluation of Partial-Scope expressions is not supported")},t.prototype.getExprValue=function(e){var r=this.dataView,n=this.selectTransforms;if(r&&n){if(et(e)||Sa(e)||Mn(e)||kf(e)){var i=function(t,e,r){u.assertValue(t,"expr"),u.assertValue(e,"selectTransforms"),u.assertValue(r,"columns");var n,i=-1;do{if((i=gn(t,e,i+1))<0)break;if(n=_.find(r,function(o){return o.index===i&&o.aggregates&&void 0!==o.aggregates.single}))return n.aggregates.single}while(i<e.length);if(et(t)||Sa(t)){var a=t.arg;if(Qr(a)&&a.hasInnerMostScope()?i=gn(a.expression,e):(Jt(a)||Mn(a)||et(a)||Ts(a))&&(i=gn(a,e)),!(i<0)&&(n=_.find(r,function(o){return o.index===i&&o.aggregates})))return function(t,e){var r,n;if(u.assertValue(t,"aggregates"),u.assertValue(e,"expr"),Sa(e)){var i=_.find(t.percentiles,function(a){return a.k===e.k&&e.exclusive===!!a.exclusive});if(i)return i.value}else if(et(e))switch(u.assertValue(e.func,"func"),e.func){case 3:return null!==(r=t.min)&&void 0!==r?r:t.minLocal;case 4:return null!==(n=t.max)&&void 0!==n?n:t.maxLocal;case 6:return t.median;case 1:return t.average}u.assertFail("Only Percentile, Min, Max, Median, Average are supported as Aggregate of Aggregates")}(n.aggregates,t)}}(e,n,r.metadata.columns);if(void 0!==i)return i}if(r.table)return _.isEmpty(r.table.columns)||_.isEmpty(r.table.rows)||!_.isEmpty(r.table.identityFields)?void 0:(u.assert(function(){return 1===r.table.rows.length},"A data view with no identity fields should have a single row"),Rg(e,n,r.table.columns,r.table.rows[0]));if(r.categorical&&!_.isEmpty(r.metadata.columns)&&!_.isEmpty(r.categorical.values))return function(t,e,r){u.assertValue(t,"expr"),u.assertValue(e,"selectTransforms"),u.assertValue(r,"categorical");var n=r.values;if(u.assertValue(n,"categorical.values"),1===n.grouped().length&&!r.categories){var i=gn(t,e);if(!(i<0)){var a=_.findIndex(n,function(s){return s.source.index===i});if(-1!==a){var o=n[a].values;if(o&&1===o.length)return o[0]}}}}(e,n,r.categorical);r.matrix||r.tree||u.assert(function(){return _.isEqual(Object.getOwnPropertyNames(r),["metadata"])},"staticEvalContext.getExprValue received a dataView that is not currently supported (only table and categorical are implemented)")}},t.prototype.getRoleValues=function(e){},t}();function Rg(t,e,r,n){if(u.assertValue(t,"expr"),u.assertValue(e,"selectTransforms"),u.assertNonEmpty(r,"tableColumns"),u.assertValue(n,"tableRow"),1===n.length&&null===n[0])return null;var i=gn(t,e);if(!(i<0)){var a=_.findIndex(r,function(l){return l.index===i});if(!(a<0)){if(Jt(t)&&0===t.attributeKind){var o=r[a];if((a=r.indexOf(o.formatSource&&o.formatSource.formatString))<0)return}return u.assert(function(){return a in n},"Cannot get expr value from table row. Row values don't contain an element for the matching data column"),n[a]}}}function xT(t,e){return new DT(t,e)}var DT=function(){function t(e,r){this.dataView=e,this.selectTransforms=r,u.assertValue(e,"dataView"),u.assertValue(r,"selectTransforms")}return t.prototype.getExprColumn=function(e){return or(e,this.dataView.columns)},t.prototype.getScopedEvalExprValue=function(e){var r=e.decomposeGlobalAggregateOfScopedExpr();if(r){var n=or(r.source,this.dataView.columns);return n?Do(n,r.func):void 0}if(e.hasInnerMostScope())return this.getExprValue(e.expression);e.hasGlobalScope()?u.assertFail("Attempt to evaluate a scoped expression within the Global scope"):u.assertFail("Evaluation of Partial-Scope expressions is not supported")},t.prototype.getExprValue=function(e){u.assertValue(e,"expr");var r=this.row;if(null!=r)return Rg(e,this.selectTransforms,this.dataView.columns,r)},t.prototype.getRoleValues=function(e){},t.prototype.setCurrentRow=function(e){u.assertValue(e,"row"),this.row=e},t}();function _T(t,e,r,n,i,a,o,s,l,c,f,d,p){if(u.assertValue(t,"evalContext"),u.assertValue(r,"columns"),u.assertValue(n,"rows"),u.assertAnyValue(i,"identities"),u.assertAnyValue(a,"identityFields"),u.assertValue(o,"objectDescriptors"),u.assertValue(s,"selector"),u.assertValue(c,"objectDefns"),s.metadata&&!_.isEmpty(s.data)){var h=_.findIndex(r,function(V){return V.queryName===s.metadata});if(!(h<0)&&f.matchesKeys([a],1)){var v;if(_.every(r,function(V){return V.isMeasure})){u.assert(function(){return _.isEmpty(i)},"table identity mismatch with identityFields"),u.assert(function(){return _.isEmpty(a)},"table identity mismatch with identityFields"),u.assert(function(){return 1===n.length},"table without identity has incorrect row count");var g=Ng(t,e,r,n[0],a,o,s,c,f,d,p);g&&((v=k(n))[0]=g)}else{if(_.some(s.data,function(V){return xr(V)&&2===V.matchingOption}))return;u.assert(function(){return n.length===i.length},"row length mismatch");for(var y=r.length,m=0,S=i.length;m<S;m++)if(l||f.matches([i[m]])){t.setCurrentRow(n[m]);var E=void 0;p&&(E={warnings:p,selector:s,targetExpr:nr(s,e)});var C=ft(d,t,o,c,E);if(C){v||(v=k(n));var w=v[m]=k(v[m]),M=w.objects;M||(w.objects=M=new Array(y)),M[h]||(M[h]={}),$e(M[h],C,s.id,s.order)}if(!l)break}}return v}}}function IT(t,e){return no(e)&&(e=Kl(e,function(r){return function(t,e){if(!t)return[];for(var r=[],n=0,i=e.columns;n<i.length;n++){var a=i[n];a.identityExprs&&Jl([a],t)&&r.push(Ee([],a.identityExprs||[],!0))}return r}(r,t)})),e}function Ng(t,e,r,n,i,a,o,s,l,c,f){u.assertValue(t,"evalContext"),u.assertValue(r,"columns"),u.assertValue(n,"row"),u.assertValue(a,"objectDescriptors"),u.assertValue(o,"selector"),u.assertValue(s,"objectDefns");var d=_.isEmpty(i)?void 0:i;if(o.metadata&&l.matches([],d)){var p=_.findIndex(r,function(S){return S.queryName===o.metadata});if(!(p<0)){var v,g,h=r.length;t.setCurrentRow(n),f&&(g={warnings:f,selector:o,targetExpr:nr(o,e)});var y=ft(c,t,a,s,g);if(y){var m=(v=k(n)).objects;m||(v.objects=m=new Array(h)),m[p]||(m[p]={}),$e(m[p],y)}return v}}}var PT=function(t){function e(r,n){var i=this;return u.assertValue(r,"inputRole"),u.assertValue(n,"allocator"),(i=t.call(this)||this).inputRole=r,i.allocator=n,i}return T(e,t),e.prototype.evaluate=function(r){u.assertValue(r,"evalContext");var n=r.getRoleValues(this.inputRole);u.assert(function(){return _.size(n)<=1},"Color Rule Evaluation can run with only one value");var i=_.head(n);if(void 0!==i)return this.allocator.color(i)},e}(uc);function Tr(t,e,r){void 0===t&&(t=[]);var n=t;return og(n),e&&(n.identityFields=e),r&&(n.source=r),n}function Lo(t,e,r,n,i,a,o,s,l){if(u.assertValue(t,"dataView"),u.assertValue(e,"targetDataViewKinds"),u.assertAnyValue(r,"objectDescriptors"),u.assertAnyValue(n,"objectDefinitions"),u.assertAnyValue(i,"selectTransforms"),r){var c=function(t,e,r,n){var i;u.assertValue(t,"dataView"),u.assertValue(e,"objectDescriptors"),u.assertAnyValue(r,"prototype");var a=po(e);if(a&&t.metadata&&!_.isEmpty(t.metadata.columns)){for(var s,o=!1,l=0,c=t.metadata.columns;l<c.length;l++){var f=c[l],d=f.queryName;if(f.formatSource&&(null===(i=null==f?void 0:f.aggregates)||void 0===i||!i.single)){o||(s=r?k(r):{},o=!0);var p={metadata:f.queryName,data:[Fu()],highlightMatching:1},h=wi(d,0);if(Wi(s,a,p,h),null!=n&&n.cardReferenceLabels&&f.relatedObjects)for(var v=0,g=Object.keys(f.relatedObjects);v<g.length;v++)for(var y=g[v],m=f.relatedObjects[y],S=0,b=Object.keys(m);S<b.length;S++){var E=b[S],C=Ml(e,{objectName:y,propertyName:E});if(null!=C&&C.formatStringProperty)for(var w=0,M=m[E];w<M.length;w++)Wi(s,C.formatStringProperty,M[w],h)}}}return s}}(t,r,n,o);c&&(n=c);var f=function(t){u.assertAnyValue(t,"objectDefinitions");var e={data:[]};if(t)for(var r in t)for(var n=t[r],i=0,a=n.length;i<a;i++){var o=n[i];U_(e,o.selector).objects.push({name:r,properties:o.properties})}return e}(n);!function(t,e,r,n){u.assertValue(t,"objectsForAllSelectors"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"columns"),u.assertAnyValue(n,"selectTransforms"),n&&(function(t,e,r,n){u.assertValue(t,"objectsForAllSelectors"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"columns"),u.assertValue(n,"selectTransforms");var i=po(e);if(i)for(var a=0,o=n.length;a<o;a++){var s=n[a];s&&(u.assertValue(s.queryName,"selectTransform.queryName"),G_(t,i,s.queryName,s.format||H_(r,a)))}}(t,e,r,n),function(t,e,r){u.assertValue(t,"objectsForAllSelectors"),u.assertValue(e,"objectDescriptors"),u.assertValue(r,"selectTransforms");var n=function(t){return Ri(t,function(e){var r=e.type;return r&&!!r.expression&&r.expression.defaultValue})}(e);if(n)for(var i=0,a=r;i<a.length;i++){var o=a[i];o&&(u.assertValue(o.queryName,"selectTransform.queryName"),Q_(t,n,o.queryName,o.defaultValue))}}(t,e,n))}(f,r,t.metadata.columns,i);var d=f.metadataOnce,p=f.data;d&&function(t,e,r,n,i,a,o,s,l){var c;u.assertValue(t,"dataView"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector"),u.assertValue(i,"dataObjects"),u.assertValue(a,"targetDataViewKinds");for(var f=new Kn(s,o),d=0,p=n;d<p.length;d++){var h=p[d],v=h.selector&&h.selector.id,g=null===(c=h.selector)||void 0===c?void 0:c.order,y=h.objects;u.assertValue(!_.isEmpty(y),"objectDefns");var m=ko(t,e),S=void 0;l&&(S={warnings:l,selector:h.selector,targetExpr:nr(h.selector,e)});var b=ft(f,m,r,y,S);if(b){var E=t.metadata.objects;for(var C in E||(E=t.metadata.objects={}),$e(E,b,v,g),b){var w=b[C],M=r[C];for(var V in w){var D=M.properties[V],A=D.rule;if(A){var P=kT(t,A,C,w[V],D.type);_.isEmpty(P)||i.push.apply(i,P||[])}}}}}}(t,i,r,d,p,e,a,o,s);var h=f.metadata;_.isEmpty(h)||function(t,e,r,n,i,a,o){u.assertValue(t,"dataView"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");for(var s=new Kn(a,i),l=0,c=n;l<c.length;l++){var f=c[l],d=f.selector,p=f.objects;u.assertValue(d,"selector"),u.assertValue(p,"objectDefns");for(var h=t.metadata.columns,v=d.metadata,g=ko(t,e),y=0,m=h.length;y<m;y++){var S=h[y];if(S.queryName===v){var b=void 0;o&&(b={warnings:o,selector:d,targetExpr:nr(d,e)});var E=ft(s,g,r,p,b);E&&(S.objects||(S.objects={}),$e(S.objects,E,d.id,d.order))}}}}(t,i,r,h,a,o,s),_.isEmpty(p)||function(t,e,r,n,i,a,o,s,l){u.assertValue(t,"dataView"),u.assertValue(e,"targetDataViewKinds"),u.assertAnyValue(r,"selectTransforms"),u.assertValue(n,"objectDescriptors"),u.assertValue(i,"dataViewObjectDefnsForSelector"),u.assertValue(a,"DataViewTransform.evaluateDataRepetition - visualStyle");var c=new Kn(s,a);t.categorical&&ie(e,1)&&function(t,e,r,n,i,a,o,s){u.assertValue(t,"dataViewCategorical"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");for(var l=0,c=n;l<c.length;l++){var f=c[l],d=f.selector,p=f.rules,h=f.objects;u.assertValue(d,"selector"),u.assertAnyValue(p,"rules"),u.assertValue(h,"objectDefns");var v=ro(d),g=Ao(d=cI(t,d),i);o&&(o.selector=d,o.targetExpr=nr(d,e)),nI(t,r,d,v,h,g,a,o),oI(t,r,d,v,h,g,a,o,s),uI(t,r,d,h,a,o,s)}}(t.categorical,r,n,i,o,c,l&&{warnings:l},s);var d=t.matrix;if(d&&ie(e,2)){var p=function(t,e,r,n,i,a,o,s){u.assertValue(t,"dataViewMatrix"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");var l=t.valueSources,c=l.length,f=function(t,e){return new CI(t,e)}(t,a),d=t.rows.levels;u.assertAnyValue(d,"A Matrix with no Row groupings has empty Row levels");var p=dg(d),h=dg(t.columns.levels),v=[];v.push.apply(v,p||[]),v.push.apply(v,h||[]);for(var g=!1,y=k(t),m=function(w){u.assertValue(w.selector,"selector"),u.assertAnyValue(w.rules,"rules");var M=w.objects;u.assertValue(M,"objectDefns");var V=function(t,e){return no(e)&&(e=Kl(e,function(r){return function(t,e){if(e){var r=[];return r.push.apply(r,mg(t,e.rows)||[]),r.push.apply(r,mg(t,e.columns)||[]),r}}(r,t)})),e}(t,w.selector),D=Ao(V,i),A=ro(V),P=Bn(V),F=null==V.metadata&&pg(p,D),N=function(t,e,r,n){if(u.assertAnyValue(t,"A Matrix with no Row groupings has empty Row levels and can't hold ScopedValues"),_.isEmpty(t)||(u.assertValue(r,"selectorComparer"),u.assertAnyValue(n,"selectorMetadata"),u.assert(function(){return t.length===e.length},"levels identity keys mismatch"),!n))return!1;for(var i=0;i<t.length;i++)if(r.matchesKeys(_.take(e,i+1),i+1)){var a=To(t[i]);if(!_.isEmpty(a)&&_.find(a,function(o){return o.queryName===n}))return!0}return!1}(d,p,D,V.metadata),J=(c>1||c<=1&&null==V.metadata)&&pg(h,D),le=null!=V.metadata&&c>0&&_.some(l,function(Te){return Te.queryName===V.metadata})&&D.matchesKeys(v,v.length),ce={selector:V,selectorComparer:D,containsWildcard:A,isWildcard:P,canMatchColumnNode:J,canMatchRowNode:F,canMatchIntersection:le,canMatchScopedValue:N},Y=void 0,Ve=void 0;J&&(Ve=hg("Columns",f,e,y.columns,r,M,ce,o,s)),(le||N||F)&&(Y=hg("Rows",f,e,y.rows,r,M,ce,o,s)),(Y||Ve)&&(g=!0,Y&&(y.rows=Y),Ve&&(y.columns=Ve))},S=0,b=n;S<b.length;S++)m(b[S]);if(g)return y}(d,r,n,i,o,s,c,l);p&&(t.matrix=p)}var h=t.table;if(h&&ie(e,8)){var v=function(t,e,r,n,i,a,o){u.assertValue(t,"dataViewTable"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");for(var s=!1,l=0,c=n;l<c.length;l++){var f=c[l],d=f.selector,p=f.objects;u.assertValue(d,"selector"),u.assertValue(p,"objectDefns");var h=ro(d),v=Ao(d=IT(t,d),i),g=xT(t,e),y=void 0;_.isEmpty(t.rows)||(y=_T(g,e,t.columns,t.rows,t.identity,t.identityFields,r,d,h,p,v,a,o));var m=void 0;t.totals&&(m=Ng(g,e,t.columns,t.totals,t.identityFields,r,d,p,v,a,o)),(y||m)&&(s=!0,t=k(t),y&&(t.rows=y),m&&(t.totals=m))}if(s)return t}(h,r,n,i,o,c,l);v&&(t.table=v)}var g=t.single;if(u.assert(function(){return!g||!!g&&!!h},"DataViewTable should be always present with DataViewSingle"),g&&h&&ie(e,4)){var y=function(t,e,r,n,i,a,o){u.assertValue(t,"dataView"),u.assertAnyValue(e,"selectTransforms"),u.assertValue(r,"objectDescriptors"),u.assertValue(n,"objectDefnsForSelector");for(var s,l=ko(t,e),c=0,f=n;c<f.length;c++){var d=f[c],p=d.selector,h=d.objects,v=Ao(p,i);if(u.assertValue(p,"selector"),u.assertValue(h,"objectDefns"),p.metadata===t.single.column.queryName&&v.matches([])){var g=void 0;o&&(g={warnings:o,selector:p,targetExpr:nr(p,e)});var y=ft(a,l,r,h,g);y&&(s||(s=k(t.single)),s.objects||(s.objects={}),$e(s.objects,y,p.id,p.order))}}return s}(t,r,n,i,o,c,l);y&&(t.single=y)}t.metadata.objectsRules=c.getObjectsRules()}(t,e,i,r,p,a,l,o,s)}}function kT(t,e,r,n,i){u.assertValue(t,"dataView"),u.assertValue(e,"ruleDesc"),u.assertValue(n,"propertyValue"),u.assertValue(i,"ruleType");var a=e.output;if(a){var o=function(t){return u.assertValue(t,"selectorRoles"),[{data:[Pf(t)]}]}(a.selector);if(i.fillRule)return function(t,e,r,n,i){u.assertValue(t,"dataView"),u.assertValue(e,"ruleDesc"),u.assertValue(r,"selectorsToCreate"),u.assertValue(i,"propertyValue");var a=function(t,e,r){u.assertValue(t,"dataView"),u.assertValue(e,"identifier"),u.assertValue(1,"identifierKind");var n=t.metadata.columns;return _.find(n,function(i){return i.roles&&i.roles[e]})}(t,e.inputRole);if(a){var o=ho().fromFillRule(i,a);if(o){var s=new PT(e.inputRole,o),l={};l[e.output.property]={solid:{color:s}};for(var c=[],f=0,d=r.length;f<d;f++)c.push({selector:r[f],rules:[s],objects:[{name:n,properties:l}]});return c}}}(t,e,o,r,n)}}function lc(t){return void 0===t.source.index}function cc(t){return _.some(t,lc)}function kg(t){return u.assertValue(t,"categories"),!_.isEmpty(t)&&t[0].objects}function fc(t){u.assertValue(t,"dataViewCategorical");var e=_.isEmpty(t.categories)?_.isEmpty(t.values)?0:t.values[0].values.length:t.categories[0].values.length;return u.assert(function(){return _.every(t.categories,function(r){return r.values.length===e})},"Invariant: every category column is expected to have the same number of values."),u.assert(function(){return _.every(t.categories,function(r){return r.identity.length===e})},"Invariant: every category column is expected to have the same number of identities as there are values."),u.assert(function(){return _.every(t.values,function(r){return r.values.length===e})},"Invariant: every value column is expected to have the same number of values."),e}function Lg(t){u.assertValue(t,"categorical");var e=t.values;if(e){var n;if(e.source){n=k(e.grouped());var i=0===fc(t),a=e.length>=1&&(i||void 0!==_.head(e).identity);if(!_.isEmpty(e)&&a)for(var s,o=0,l=function(h,v){var g=e[h];if(lc(g))return"continue";if(!s||g.identity!==s.identity){var y=n[o];y?s=k(y):(u.assert(function(){return!g.identity},"!currentValueColumn.identity -- Extra valueGroup items should be statics (no identity)."),s=y=n[o]={values:null}),n[o]=s,s.values=[],o++,u.assert(function(){return g.identity===s.identity},"expecting the value columns are sequenced by series groups")}s.values.push(g)},c=0,f=e.length;c<f;c++)l(c);else for(c=0,f=n.length;c<f;c++){var d=n[c];_.isEmpty(d.values)||(n[c]=d=k(d),d.values=[])}}else n=[{values:e}];e.grouped=function(){return n},t.values=e}}function Bg(t,e){u.assertValue(t,"measureSources"),u.assertValue(e,"projectionOrder");var r=xo(t,e);if(!Ae(t,r=_.chain(r).filter(function(i){return void 0!==i.projectionOrderIndex}).sortBy(function(i){return i.projectionOrderIndex}).value(),function(i,a){return i.index===a.metadataColumn.index}))return r}function Ug(t){if(u.assertValue(t,"groups"),!_.isEmpty(t))return _.chain(t[0].values).map(function(r){return r.source}).filter(function(r){return void 0!==r.index}).value()}function rP(t,e,r,n,i){u.assertValue(t,"dataView"),u.assertAnyValue(e,"objectDescriptors"),u.assertAnyValue(r,"applicableRoleMappings"),u.assertAnyValue(n,"projectionActiveItems");var a=t,o=t.categorical;if(o){var s=function(t,e,r){u.assertValue(t,"dataViewCategorical"),u.assertAnyValue(e,"applicableRoleMappings");var n,i=_.chain(e).filter(function(c){return!pn(c)}).map(function(c){return c.categorical}).value(),a=!_.isEmpty(i)&&_.every(i,function(c){return!!c});if(a){var o=function(t){u.assertNonEmpty(t,"categoricalRoleMappings"),u.assert(function(){return _.every(t,function(r){return!!r})},"categoricalRoleMappings must not contain falsy element");var e=Tv(t,Pv);if(1===_.size(e))return _.head(e)}(i);if(o&&_.includes(r,o)&&function(t,e){u.assertValue(t,"categoricalRoleName"),u.assertNonEmpty(e,"roleMappings"),u.assert(function(){return _.every(e,function(n){return n.categorical})},"All specified roleMappings are expected to target categorical");var r=_.every(e,function(n){return!_.isEmpty(n.conditions)&&_.every(n.conditions,function(i){return i[t]&&1===i[t].max})});return r}(o,e)){var s=_.filter(t.categories,function(c){return c.source.roles&&!!c.source.roles[o]});if(!_.isEmpty(s)){var l=_.every(s,function(c){return c.values.length===s[0].values.length});l&&(n={roleName:o,categories:s})}}}return n}(o,r,i),l=function(t){var e=_.find(t,function(a){return a.expr&&Gr(a.expr)});if(e){var n=e.expr.arg;if(li(n)){var i=n.arg;if(ci(i))return i.property}}}(t.metadata.columns);if(s&&(s.categories.length>=2||l)){var c=_.chain(n&&n[s.roleName]).filter(function(d){return d.suppressConcat}).map(function(d){return d.queryRef}).value();a=function(t,e,r,n,i,a,o){void 0===o&&(o=!1),u.assert(function(){return t&&t.categorical&&_.size(t.categorical.categories)>=1},"dataView && dataView.categorical && _.size(dataView.categorical.categories) >= 1"),u.assertAnyValue(e,"formatStringPropId"),u.assertValue(r,"roleName"),u.assert(function(){return!_.isEmpty(n)},"!_.isEmpty(columnsSortedByProjectionOrdering)"),u.assert(function(){return _.every(n,function(M){return _.includes(t.categorical.categories,M)})},"every column in columnsSortedByProjectionOrdering should exist in dataView.categorical.categories");var c,f,s=n.length-1,l=_.filter(n,function(M,V){return V===s||!_.includes(i,M.source.queryName)});1===n.length?(o||(c=l[0].values),f=l[0].source.type):(o||(c=function(t,e){u.assertValue(t,"columnsSortedByProjectionOrdering"),u.assertAnyValue(e,"formatStringPropId");for(var r=[],n=0,i=t;n<i.length;n++)for(var a=i[n],o=so(a.source,e),s=0,l=a.values.length;s<l;s++){var f=qu(a.values&&a.values[s],o);r[s]=void 0===r[s]?f:r[s]+" "+f}return r}(l,e)),f=L.fromDescriptor({text:!0}));var p=function(t,e,r,n){var i;if(u.assertValue(t,"roleName"),u.assertNonEmpty(e,"sourceColumnsSortedByProjectionOrdering"),u.assert(function(){return 1===_.chain(e).map(function(p){return p.isMeasure}).uniq().value().length},"pre-condition: caller code should not attempt to combine a mix of measure columns and non-measure columns"),n)i=function(t,e){return t+" "+e}(n,_.last(e).displayName);else for(var o=0,s=e;o<s.length;o++){var l=s[o];i=null==i?l.displayName:i+" "+l.displayName}var c={};c[t]=!0;var f={displayName:i,roles:c,type:r},d=_.last(e);return void 0!==d.isMeasure&&(f.isMeasure=d.isMeasure),f.queryName=d.queryName,f}(r,_.map(l,function(M){return M.source}),f,a),h=k(t);if(function(t,e){u.assertValue(t,"transformedDataView"),u.assertValue(e,"newColumn");var r=k(t.metadata.columns);r.push(e);var n=k(t.metadata);n.columns=r,t.metadata=n}(h,p),!o){var v=t.categorical,y=function(t,e,r,n){u.assert(function(){return t&&t.length>=1},"sourceColumnsSortedByProjectionOrdering && sourceColumnsSortedByProjectionOrdering.length >= 1"),u.assertValue(e,"columnMetadata"),u.assertValue(r,"concatenatedValues"),u.assertAnyValue(n,"dataViewObjects");var i={source:e,values:r},a=t[0];return a.identity&&(i.identity=a.identity),a.identityFields&&(i.identityFields=a.identityFields),n&&(i.objects=n),i}(l,p,c,kg(v.categories)),m=_.last(n),S=_.findIndex(v.categories,function(M){return M===m}),b=k(v.categories);b.splice(S,0,y);for(var E=function(V){_.find(n,function(D){return D===b[V]})&&b.splice(V,1)},C=b.length-1;C>=0;C--)E(C);var w=k(v);w.categories=b,h.categorical=w}return h}(t,po(e),s.roleName,s.categories,c,l)}}return a}var zg={objectName:"scalarKey",propertyName:"min"};function hP(t,e,r){if(u.assertValue(e,"Category type is not specified"),!_.isDate(t)||!e||!e.temporal)return null;var n=t;return e.temporal.year?function(t){return u.assertValue(t,"date"),t.getFullYear()}(n):e.temporal.quarter?function(t,e){u.assertValue(t,"date");return Be(e,Math.floor((t.getMonth()+3)/3).toLocaleString())}(n,r):e.temporal.month?function(t){return u.assertValue(t,"date"),Ge.formatValue(t,"MMMM")}(n):e.temporal.day?function(t){return u.assertValue(t,"date"),t.getDate()}(n):void 0}function SP(t,e){u.assertValue(t,"dataViewMatrix"),e.columnHierarchyRewritten||(t.columns=ve(t.columns));var r=t.columns;e.rowHierarchyRewritten||(t.rows=ve(t.rows));var n=t.rows;if(!(r.levels.length>1)){var i={level:0},a=r.root.children,o=_.size(a),s=n.levels.length;if(o>0){var l=0,c=function(h){if(h.values){i.values||(i.values={});for(var v=0;v<o;v++)i.values[l++]=h.values[v];h.values=void 0}if(o>1){h.children||(h.children=[]);for(var g=0;g<o;g++){var y={level:s};y.levelSourceIndex=a[g].levelSourceIndex,h.isSubtotal&&(y.isSubtotal=!0),h.children.push(y)}}};e.hierarchyTreesRewritten?qg(n.root,c):t.columns.root=dc(n.root,c)}else e.hierarchyTreesRewritten||(t.columns.root=function(t){return dc(t)}(n.root));if(o>1&&(n.levels.push({sources:r.levels[0].sources}),r.levels.length=0),e.hierarchyTreesRewritten)t.columns.root=n.root,t.rows.root={children:[i]};else{var d=ve(t.rows.root);d.children=[i],t.rows.root=d}t.columns.levels=n.levels,t.rows.levels=[]}}function qg(t,e){var r=t.children;if(r&&r.length>0)for(var n=0,i=r.length;n<i;n++)qg(r[n],e);else e(t)}function dc(t,e){var r={};return e&&(r.nodeProcessor=function(n){_.isEmpty(n.children)&&e(n)}),pc(t,r)}function pc(t,e){var r,n,i=ve(t),a=t.children;if(!(e.nodeProcessor&&e.nodeProcessor(i),_.isEmpty(a)||null!==(n=null===(r=e.skipChildren)||void 0===r?void 0:r.call(e,t))&&void 0!==n&&n))for(var s=a.length,l=i.children=new Array(s),c=0;c<s;c++)l[c]=pc(a[c],e);return i}function Hg(t,e,r){if(_.isEmpty(r))return[];var n=hn.fromMatrixValues(e);if(_.isEmpty(n))return[];var a=xo(r,hc(t,n),n);return _.chain(a).filter(function(o){return void 0!==o.projectionOrderIndex}).sortBy(function(o){return o.projectionOrderIndex}).value()}function hc(t,e){u.assertValue(t,"projectionOrdering"),u.assertValue(e,"roles");for(var r=[],n=0,i=e;n<i.length;n++){var o=t[i[n]];_.isEmpty(o)||r.push.apply(r,o||[])}return r}function Gg(t,e){return u.assertValue(t,"valueSources"),u.assertValue(e,"valueProjectionOrdering"),Ae(t,e,function(r,n){return r===n.metadataColumn})}function Qg(t,e,r,n,i){u.assertValue(t,"prototypeRowHierarchy"),u.assertNonEmpty(e,"originalValueSources"),u.assertValue(r,"projectedValueSourceEntries"),u.assert(function(){return void 0===i||0===n.length},"staticValueSources are not supported with Scoped Measures");var s,c,a=e.length,o=r.length,l=k(t),f=function(h,v){var g=v?h.values:Po(h);if(g&&0!==a){if(!c){c=0;var y={};for(var m in g)c++,y[g[m].valueSourceIndex||0]=!0;a=Object.keys(y).length}if(void 0===s){if(a>o&&n.length>0&&(a-=n.length,0==(c-=n.length)))return;u.assert(function(){return c%a==0},"expecting the intersection values to have one value per measure column per column group instance"),s=c/a}else u.assert(function(){return s===c/a},"expecting every interaction values collection to have the same length");var S;if(o>0){S={};for(var b=0;b<s;b++)for(var E=b*a,C=b*o,w=0;w<o;w++)w!==((V=g[E+r[w].sourceIndex]).valueSourceIndex||0)&&((V=k(V)).valueSourceIndex=w||void 0),S[C+w]=V;for(var D=o,A=Object.keys(S).length,P=c+n.length,F=c;F<P;F++){var V;(V=g[F]).valueSourceIndex=D++||void 0,S[A++]=V}}else S=void 0;v?h.values=S:h.nodeValues=S?{0:S}:void 0}};return l.root=void 0===i?dc(l.root,function(p){return f(p,!0)}):pc(l.root,{nodeProcessor:function(h){h.level===i&&f(h,!1)},skipChildren:function(h){return h.level>=i}}),l}function Wg(t,e){u.assertValue(t,"matrixHierarchy"),u.assertValue(e,"projectionOrdering");var n,r=t.levels,i=_.chain(r).map(function(d,p){return p}).filter(function(d){var p=r[d];return _.size(p.sources)>=2&&!fg(p)}).value();if(!_.isEmpty(i)){for(var a=_.uniq(e),o=i.length-1;o>=0;o--){var s=i[o],l=t.levels[s],c=MP(l,a);if(!_.isEmpty(c)){void 0===n&&((n=k(t)).levels=k(t.levels),n.root=Gi(t.root,s,!0));var f=k(l);n.levels[s]=xP(f,c),DP(n.root,s,c)}}return n}}function MP(t,e){u.assertValue(t,"hierarchyLevel"),u.assertValue(e,"hierarchyProjection");var r,n=t.sources;if(n&&n.length>=2){var i=xo(n,e);u.assert(function(){return _.every(i,function(o){return o.metadataColumn.isMeasure||void 0!==o.projectionOrderIndex||null==e[o.sourceIndex]})},"Removed grouping during Matrix Projection ordering");var a=_.sortBy(i,function(o){return o.projectionOrderIndex});r=_.map(a,function(o,s){return{originalSourceIndex:o.sourceIndex,newSourceIndex:s}})}return r}function xP(t,e){u.assertValue(t,"transformingHierarchyLevel"),u.assertNonEmpty(e,"levelSourceIndexMappings");var r=t.sources;t.sources=r.slice(0);for(var n=function(l){u.assert(function(){return l.originalSourceIndex<r.length},"pre-condition: The value in every mapping in the specified levelSourceIndicesReorderingMap must be a valid index to the specified hierarchyLevel.sources array property"),t.sources[l.newSourceIndex]=r[l.originalSourceIndex]},i=0,a=e;i<a.length;i++)n(a[i]);return t}function DP(t,e,r){u.assertValue(t,"transformingHierarchyRootNode"),u.assertNonEmpty(r,"levelSourceIndexMappings"),u.assert(function(){return r.length===_.uniqBy(r,function(i){return i.originalSourceIndex}).length},"levelSourceIndexMappings must not contain duplicate originalSourceIndex");var n=_.reduce(r,function(i,a){return i[a.originalSourceIndex]=a,i},{});return ug(t,e,function(i){var a=i.levelValues;if(!_.isEmpty(a)){u.assert(function(){return _.every(a,function(p){return!!n[p.levelSourceIndex]})},"Invalid levelSourceIndexMappings or transformingHierarchyRootNode: levelSourceIndexMappings should contain an entry for every levelSourceIndex in the matrix hierarchy.");for(var o=_.sortBy(a,function(p){var h=n[p.levelSourceIndex];return h&&h.newSourceIndex}),s=0,l=o.length;s<l;s++){var c=k(o[s]),f=n[c.levelSourceIndex];c.levelSourceIndex=f&&f.newSourceIndex,o[s]=c}i.levelValues=o;var d=_.last(o);i.value!==d.value&&(i.value=d.value),(i.levelSourceIndex||0)!==d.levelSourceIndex&&(i.levelSourceIndex=d.levelSourceIndex)}}),t}function jg(t,e){u.assert(function(){return t&&_.every(t.children,function(n){return n.level===t.children[0].level})},"node must be defined and all of its child nodes must have the same level value."),u.assertValue(e,"measureHeadersLevelIndex");var r=t.children;return!_.isEmpty(r)&&r[0].level===e}function Kg(t,e,r,n){for(var i=new Array(e),a=0,o=e;a<o;a++){var s=void 0,l=n&&n[a].sourceIndex;null!=l&&(s=r.children&&r.children[l]);var c=s?k(s):{};c.level=t,r.isSubtotal&&(c.isSubtotal=!0),c.levelSourceIndex=a>0?a:void 0,i[a]=c}return i}function PP(t){u.assertValue(t,"options");var e=_.filter(t.dataRoles,function(r){return!_.isEmpty(r.requiredTypes)});!function(t,e,r){if(u.assertValue(t,"dataview"),!_.isEmpty(e)&&!_.isEmpty(r)){for(var n=function(t,e){if(!t||!e)return function(){return!1};for(var r={},n=0,i=t;n<i.length;n++){var a=i[n],o=a.roles;if(o)for(var s=0,l=e;s<l.length;s++)if(o[l[s].name]){r[a.index]=!0;break}}return function(f){return!isNaN(f)&&!!r[f]}}(t.metadata.columns,r),i=function(t,e){if(!t||!e)return function(){return!0};for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n],o=kP(a,e);o&&(r[a.index]=o)}return function(s,l){return!r[s]||r[s](l)}}(t.metadata.columns,r),a={},o=0,s=e;o<s.length;o++){var l=s[o];l.table&&t.table&&(a.table=!0),l.matrix&&t.matrix&&(a.matrix=!0),l.categorical&&t.categorical&&(a.categorical=!0),l.tree&&t.tree&&(a.tree=!0),l.single&&t.single&&(a.single=!0)}a.categorical&&function(t,e,r){var n=t&&t.values;if(n){var i=n.grouped();if(i)for(var a=0,o=i;a<o.length;a++)for(var c=0,f=o[a].values;c<f.length;c++){var d=f[c],p=d.source.index;if(e(p))for(var h=0,v=d.values.length;h<v;h++)d.values=Jn(d.values,h,p,r)}}}(t.categorical,n,i),a.table&&function(t,e,r){var n=t&&t.columns;if(n){for(var i=[],a=0,o=n;a<o.length;a++){var s=o[a];e(s.index)&&i.push(s.index)}for(var l=t.rows,c=0,f=l.length;c<f;c++)for(var d=0,p=i;d<p.length;d++){var h=p[d];l[c]=Jn(l[c],h,h,r)}}}(t.table,n,i),a.tree&&Jg(t.tree.root,n,i),a.matrix&&function(t,e,r){var n=t&&t.rows&&t.rows.root;n&&Yg(t,n,e,r)}(t.matrix,n,i),a.single&&function(t,e,r,n){if(t.single){for(var i=[],a=0,o=r;a<o.length;a++){var s=o[a];s.name&&i.push(s.name)}for(var l=t.metadata.columns,c=0,f=e;c<f.length;c++){var p=f[c].single.role;if(-1!==i.indexOf(p)){var h=HP(l,p);return void(h&&(t.single=Jn(t.single,"value",h.index,n)))}}}}(t,e,r,i)}}(t.dataview,t.dataViewMappings,e)}function kP(t,e){var r=function(t,e){var r=[],n=t&&t.roles;if(!n)return r;for(var i=0,a=e;i<a.length;i++){var o=a[i];if(n[o.name])for(var s=0,l=o.requiredTypes;s<l.length;s++){var f=L.fromDescriptor(l[s]);r.push(f)}}return r}(t,e);if(!_.isEmpty(r))return function(n){return function(t,e){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.numeric||i.integer)return"number"==typeof t}return!1}(n,r)}}function Jg(t,e,r){if(t.values)for(var n in t.values)e(n)&&("object"==typeof t.values[n]&&"value"in t.values[n]?t.values[n]=Jn(t.values[n],"value",n,r):t.values=Jn(t.values,+n,+n,r));else if(t.children)for(var i=0,a=t.children;i<a.length;i++)Jg(a[i],e,r)}function Yg(t,e,r,n){if(e.values)for(var i in e.values){var a=e.values[i],s=t.valueSources[a.valueSourceIndex||0].index;_.isNumber(s)&&r(s)&&(e.values[i]=Jn(a,"value",s,n))}else if(e.children)for(var l=0,c=e.children;l<c.length;l++)Yg(t,c[l],r,n)}function Jn(t,e,r,n){if(t){var i=t[e];return null!==i&&!n(r,i)&&((t=k(t))[e]=null),t}}function HP(t,e){for(var r=0,n=t;r<n.length;r++){var i=n[r],a=i&&i.roles;if(a&&a[e])return i}}var QP=function(){function t(){this.originalDynamicFormatColumns=[],this.categoryIndexToDynamicFormatColumn=[]}return t.prototype.trackOriginalDynamicFormatColumn=function(e,r){this.originalDynamicFormatColumns.push({valueColumnIndex:e,dynamicFormatStringColumn:r})},t.prototype.addPivotedDynamicFormatColumn=function(e,r,n){var i=this;void 0===this.categoryIndexToDynamicFormatColumn[e]&&(this.categoryIndexToDynamicFormatColumn[e]=[]),u.assert(function(){return void 0===i.categoryIndexToDynamicFormatColumn[e][r]},"categoryIndexToDynamicFormatColumn[".concat(e,"][").concat(r,"] === undefined")),this.categoryIndexToDynamicFormatColumn[e][r]=n},t.prototype.getPivotedDynamicFormatColumn=function(e,r){var n=this.getValueColumnIndex(e);if(void 0!==n)return u.assertValue(this.categoryIndexToDynamicFormatColumn[n][r],"categoryIndexToDynamicFormatColumn[".concat(n,"][").concat(r,"]")),this.categoryIndexToDynamicFormatColumn[n][r]},t.prototype.getValueColumnIndex=function(e){var r=_.find(this.originalDynamicFormatColumns,function(n){return n.dynamicFormatStringColumn===e});if(r)return r.valueColumnIndex},t}();function jP(t,e,r,n,i){if(!function(t,e,r,n,i){if(_.isEmpty(e)||!t||_.isEmpty(i))return!1;var a=_.filter(i,function(m){return!pn(m)});if(1!==a.length)return!1;var o=a[0].categorical;if(!o)return!1;var s=t.matrix;if(!s||!s.rows||!s.rows.levels||2!==s.rows.levels.length)return!1;var l=[],c=[],f=function(S,b){var E=n[S];if(E)for(var C=0,w=E.all();C<w.length;C++){var M=w[C];r[M.queryRef]===at.Grouping&&b.push(M.queryRef)}};if(wo(o.categories,{visitRole:function(S){f(S,l)}}),function(t,e){if(u.assertAnyValue(t,"mapping"),u.assertValue(e,"visitor"),t){var r=t.group;r&&(e.visitRole(r.by,"CategoricalSeries"),dn(r,e))}}(o.values,{visitRole:function(S){f(S,c)}}),Nl(o.values,{visitRole:function(S){f(S,c)}}),_.isEmpty(l)||_.isEmpty(c))return!1;for(var d=0,p=s.columns.levels;d<p.length;d++)for(var v=0,g=p[d].sources;v<g.length;v++)if(!g[v].isMeasure)return!1;return!0}(t,e,r,n,i))return t;var a={metadata:{columns:Vf(t.metadata.columns)}};if(t.single&&(a.single=t.single),t.table&&(a.table=t.table),t.matrix){var o=function(t){var fe,Pe,e=t.rows,r=e.root,n=r.children,i=[],a=e.levels[0],o=r.childIdentityFields,s={},l=[],c=e.levels[1],f=_.isEmpty(n)?void 0:n[0].childIdentityFields,d=t.valueSources.length,p=function(fe){var Pe=s[fe.key];return u.assert(function(){return void 0!==Pe},"findcat() !== undefined"),Pe};if(n)for(var v=0,g=n;v<g.length;v++){i.push(y=g[v]);for(var m=0,S=y.children;m<S.length;m++)fe=b=S[m],Pe=void 0,void 0,void 0===s[Pe=fe.identity.key]&&(s[Pe]=l.length,l.push(fe))}for(var E=new Array(l.length),C=0;C<i.length;++C)for(var y,w=0,M=(y=n[C]).children;w<M.length;w++){var b;E[V=p((b=M[w]).identity)]||(E[V]=new Array(i.length)),E[V][C]=b.values}var D={root:{children:_.map(i,function(Ne){var fe=k(Ne);return fe.level=0,fe.children=void 0,fe.childIdentityFields=void 0,fe}),childIdentityFields:o},levels:[a]};if(d>0){for(var A=_.map(t.columns.root.children,function(Ne){var fe={level:1};return Ne.levelSourceIndex&&(fe.levelSourceIndex=Ne.levelSourceIndex),fe}),P=0,F=D.root.children;P<F.length;P++)F[P].children=A;D.levels.push(t.columns.levels[0])}var J={root:{children:_.map(l,function(Ne){var fe=k(Ne);return fe.level=0,fe.children=void 0,fe.childIdentityFields=void 0,fe}),childIdentityFields:f},levels:[c]};if(d>0)for(var V=0;V<l.length;++V){var le=J.root.children[V],ce={};for(C=0;C<i.length;++C)for(var Y=E[V]&&E[V][C],Ve=0;Ve<d;++Ve)ce[C*d+Ve]=Y?Y[Ve]:0===Ve?{value:null}:{value:null,valueSourceIndex:Ve};le.values=ce}return{rows:J,columns:D,valueSources:t.valueSources}}(t.matrix);_.isEmpty(o.valueSources)||Io(o.columns)||(a.categorical=function(t,e){for(var r=t.columns.root.children.length,n=t.valueSources,i=n.length,a=function(t){u.assertValue(t,"unpivotedMatrix"),u.assert(function(){return t&&t.rows&&t.rows.levels&&1===t.rows.levels.length},"pre-condition: unpivotedMatrix should have exactly one level in row hierarchy");for(var e=_.map(t.rows.root.children,function(l){return l.identity}),r=t.rows.root.childIdentityFields,n=t.rows.levels[0].sources,i=[],a=0,o=n.length;a<o;a++){var s=_.map(t.rows.root.children,function(l){var c=l.levelValues;if(void 0!==c)return u.assert(function(){return c[a]&&c[a].levelSourceIndex===a},"pre-condition: DataViewMatrixNode.levelValues is expected to have one DataViewMatrixGroupValue node per level source column, sorted by levelSourceIndex."),c[a].value});i.push({source:n[a],values:s,identity:e,identityFields:r})}return i}(t),o=[],s=0;s<r;++s){var l=t.columns.root.children[s];o.push(c={values:[],identity:l.identity,name:null!=l.value?l.value:null});for(var f=0;f<i;++f){var p=ye({},n[f]);p.groupName=c.name,e.push(p);var h={source:p,values:[],identity:c.identity};c.values.push(h);for(var v=f+s*i,g=0,y=t.rows.root.children;g<y.length;g++)h.values.push(y[g].values[v].value)}}for(var b=[],E=0,C=o;E<C.length;E++){var c=C[E];for(f=0;f<i;++f)b.push(c.values[f])}return b.grouped=function(){return o},b.identityFields=t.columns.root.childIdentityFields,b.source=t.columns.levels[0].sources[0],{categories:a,values:b}}(o,a.metadata.columns))}return a}function Xg(){return new tF}var tF=function(){function t(){this.categories=[],this.staticMeasureColumns=[],this.dynamicMeasureColumns=[]}return t.prototype.withCategory=function(e){var r=e.values,n=e.identityFrom,i=e.source.type,a={source:e.source,identityFields:e.identityFrom.fields,identity:e.identityFrom.identities||[],values:r};if(!e.identityFrom.identities)for(var o=0,s=r.length;o<s;o++)a.identity.push(Zg(n,o,r[o],i));return this.categories||(this.categories=[]),this.categories.push(a),this},t.prototype.withCategories=function(e){return _.isEmpty(this.categories)?this.categories=e:Array.prototype.push.apply(this.categories,e),this},t.prototype.withValues=function(e){u.assertValue(e,"options");var r=e.columns;u.assertValue(r,"columns");for(var n=0,i=r;n<i.length;n++)this.staticMeasureColumns.push(i[n].source);return this.staticSeriesValues=r,this},t.prototype.withGroupedValues=function(e){u.assertValue(e,"options");var r=e.groupColumn;u.assertValue(r,"groupColumn"),this.dynamicSeriesMetadata={column:r.source,identityFrom:r.identityFrom,values:r.values};for(var i=0,a=e.valueColumns;i<a.length;i++)this.dynamicMeasureColumns.push(a[i].source);return this.dynamicSeriesValues=e.data,this},t.prototype.fillData=function(e){var r=this,n=_.head(this.categories),i=n&&n.values?n.values.length:0;if(this.hasDynamicSeries())for(var a=function(h,v){var g=o.dynamicSeriesValues[h];u.assert(function(){return g.length===r.dynamicMeasureColumns.length},"seriesMeasures.length === this.dynamicMeasureColumns.length");for(var y=0,m=o.dynamicMeasureColumns.length;y<m;y++)ey(e[h*m+y],g[y],i)},o=this,s=0,l=this.dynamicSeriesMetadata.values.length;s<l;s++)a(s);if(this.hasStaticSeries())for(var c=this.hasDynamicSeries()?this.dynamicSeriesValues.length*this.dynamicMeasureColumns.length:0,f=0,d=this.staticMeasureColumns.length;f<d;f++)ey(e[c+f],this.staticSeriesValues[f],i)},t.prototype.build=function(){for(var e,r,n=[],i={},o=this.dynamicSeriesMetadata,s=0,l=this.categories;s<l.length;s++)Ki(n,l[s].source);if(this.hasDynamicSeries()){Ki(n,o.column),i.values=Tr([],o.identityFrom.fields,o.column);for(var f=o.values,d=new Map,p=0,h=this.dynamicMeasureColumns;p<h.length;p++)null!==(e=(v=h[p]).formatSource)&&void 0!==e&&e.formatString&&d.set(v.formatSource.formatString,new Map);for(var g=0;g<f.length;g++)for(var y=f[g],m=Zg(o.identityFrom,g,y,o.column.type),S=0,b=this.dynamicMeasureColumns;S<b.length;S++){var v=b[S];(E=_.toPlainObject(v)).groupName=y,d.has(v)&&d.get(v).set(E.groupName,E),E.rolesIndex&&delete E.rolesIndex,Ki(n,E),i.values.push({source:E,values:[],identity:m})}if(d.size>0)for(var C=function(J){null!==(r=J.formatSource)&&void 0!==r&&r.formatString&&(u.assert(function(){return d.has(J.formatSource.formatString)},"formatString column must be in dynamicFormatStringMappings"),J.formatSource={formatString:d.get(J.formatSource.formatString).get(J.groupName)})},w=0,M=n;w<M.length;w++)C(E=M[w]);if(0===f.length)for(var V=0,D=this.dynamicMeasureColumns;V<D.length;V++){var E;v=D[V],Ki(n,E=_.toPlainObject(v)),i.values.push({source:E,values:[]})}if(this.hasStaticSeries()){var A=i.values.grouped();i.values.grouped=function(){return A},this.appendStaticMeasureColumns(n,i.values)}}else i.values=Tr(),this.appendStaticMeasureColumns(n,i.values);var P=this.categories;_.isEmpty(P)||(i.categories=P),this.fillData(i.values);var F={metadata:{columns:n},categorical:i};if(this.isLegalDataView(F))return F},t.prototype.appendStaticMeasureColumns=function(e,r){if(u.assertValue(e,"metadataColumns"),u.assertValue(r,"valueColumns"),!_.isEmpty(this.staticMeasureColumns))for(var n=0,i=this.staticMeasureColumns;n<i.length;n++){var a=i[n];Ki(e,a),r.push({source:a,values:[]})}},t.prototype.isLegalDataView=function(e){return!(this.hasDynamicSeries()&&this.hasStaticSeries()&&t.isVisualDataView(e.metadata.columns))},t.isVisualDataView=function(e){return!_.isEmpty(e)&&_.some(e,function(r){return!!r.queryName})},t.prototype.hasDynamicSeries=function(){return!!this.dynamicSeriesMetadata},t.prototype.hasStaticSeries=function(){return!!this.staticSeriesValues},t}();function Zg(t,e,r,n){var i=t.identities;return i?i[e]:(u.assert(function(){return t.fields&&1===t.fields.length},"Inferring identity, expect exactly one field."),Et(Nn(t.fields[0],on(r,n))))}function Ki(t,e){_.includes(t,e)||t.push(e)}function ey(t,e,r){u.assertValue(t,"target"),u.assertValue(e,"source"),u.assertValue(r,"categoryLength");var n=e.values;u.assert(function(){return r===n.length||0===r},"categoryLength === values.length || categoryLength === 0"),t.values=n;var i=e.highlights;i&&(u.assert(function(){return r===i.length},"categoryLength === highlights.length"),t.highlights=i);var o,a=e.objects;a&&(u.assert(function(){return r===a.length},"categoryLength === objects.length"),t.objects=a),void 0!==e.minLocal&&(o||(o={}),o.minLocal=e.minLocal),void 0!==e.maxLocal&&(o||(o={}),o.maxLocal=e.maxLocal),o&&(t.source.aggregates=o,_.extend(t,o))}var ty="RegressionX",ry="RegressionSeries",ny="RegressionY";function nF(t,e,r,n,i,a,o,s){return u.assertValue(e,"applicableDataViewMappings"),2===Bi(e)?function(){function t(s,l,c,f,d,p,h){u.assertValue(s,"sourceDataView"),u.assertValue(s.matrix,"sourceDataView.matrix"),u.assertValue(l,"dataRoles"),u.assertValue(f,"objectDescriptors"),u.assertValue(d,"objectDefinitions");var v=s.matrix;if(v&&v.rows&&v.rows.root&&0!==_.size(v.rows.root.children)&&!(_.size(v.rows.levels)>2)){var g=e(0,v,l),y=e(1,v,l);if(void 0!==g&&void 0!==y){var m=g.valuesCol,S=y.valuesCol,b=function(s,l,c){var f=s.matrix;if(f){var d=function(b,E){if(b.children)for(var C=0,w=b.children;C<w.length;C++){var M=w[C];M.isSubtotal||(E.xValues.push(l(M)),E.yValues.push(c(M)))}},p=[],h=f.rows;if(2===h.levels.length)for(var v=0,g=f.rows.root.children;v<g.length;v++){var y=g[v];y.isSubtotal||(p.push(m={xValues:[],yValues:[]}),d(y,m))}else if(1===h.levels.length){var m;p.push(m={xValues:[],yValues:[]}),d(h.root,m)}return p}}(s,g.getValues,y.getValues),E=!0,C=pn(c);if(C&&s.metadata.objects){var w=C.combineSeries;w&&(E=ir(s.metadata.objects,w,!0))}var M=b;E&&(M=function(s){for(var l,c,f=[],d=0,p=s;d<p.length;d++){var h=p[d];_.isEmpty(h.xValues)||_.isEmpty(h.yValues)||(f[0]||f.push({xValues:[],yValues:[]}),(l=f[0].xValues).push.apply(l,h.xValues||[]),(c=f[0].yValues).push.apply(c,h.yValues||[]))}return f}(b));var V=vc(M);if(gc(V)){for(var D=V.xMin,A=V.xMax,P=[],F=0,N=V.lineDefs;F<N.length;F++)P.push(yc(N[F],+D,+A));return function(s,l,c,f,d,p,h,v,g,y){var m,S,b;u.assertValue(s,"xColumnSource"),u.assertValue(l,"yColumnSource"),u.assertValue(f,"categories"),u.assertValue(d,"values"),u.assertValue(h,"objectDescriptors"),u.assertValue(v,"objectDefinitions");var P,C=p.matrix.rows.select[1].bind.to,w=p.matrix.values.select[0].for.in,M=((m={})[p.matrix.rows.select[0].bind.to]=!0,m),V=((S={})[w]=!0,S),D=((b={})[C]=!0,b),A={columns:[]},F={levels:[],root:{children:[]}},N={metadata:A,matrix:{rows:F,columns:P,valueSources:[]}},J=Yn(s,ty,!1,"",M),le=Yn(l,ry,l.isMeasure,"Regression",D),ce=Yn(l,ny,l.isMeasure,"",V);A.columns.push(le),A.columns.push(J),A.columns.push(ce),F.levels.push({sources:[le]}),F.levels.push({sources:[J]}),N.matrix.valueSources.push(ce);for(var Y=Re(je("s","RegressionEntity"),"RegressionSeries"),Ve=Re(je("s","RegressionEntity"),"RegressionCategories"),Te=0;Te<c.length;Te++){var xe=c[Te],Ne={level:0,value:xe,levelValues:[{levelSourceIndex:0,value:xe}],children:[],childIdentityFields:[Ve],identity:Et(st(Y,on(xe,le.type)))};_.isEmpty(F.root.childIdentityFields)&&(F.root.childIdentityFields=[Y]),F.root.children.push(Ne);for(var fe=0;fe<f.length;fe++){var Pe=f[fe],pt={level:1,value:Pe,levelValues:[{levelSourceIndex:1,value:Pe}],values:{},identity:Et(st(Ve,on(Pe,J.type)))};pt.values[0]={value:d[Te][fe]},Ne.children.push(pt)}}return Lo(N,1,h,v,[],g,y),N}(m,S,E?["combinedRegressionSeries"]:2===v.rows.levels.length?_.chain(v.rows.root.children).filter(function(Y){return!Y.isSubtotal}).map(function(Y){return Y.value}).value():["combinedRegressionSeries"],[D,A],P,c,f,d,p,h)}}}}function e(s,l,c){var d,p,f=l.valueSources,h=function(s,l,c){if(!_.isEmpty(l))return _.findIndex(l,function(f){var d=function(g){if(!f.roles[g])return"continue";var y=_.find(c,function(m){return m.name===g});return y&&y.cartesianKind===s?{value:!0}:void 0};for(var p in f.roles){var h=d(p);if("object"==typeof h)return h.value}})}(s,l.valueSources,c);if(h>=0&&void 0!==h)d=f[h],p=function(y){return y.values[h].value};else{var v=function(s,l,c){if(!_.isEmpty(l.root.children)){for(var f=-1,d=0,p=l.levels.length;d<p&&-1===(f=_.findIndex(l.levels[d].sources,function(v){var g=function(b){if(!v.roles[b])return"continue";var E=_.find(c,function(C){return C.name===b});return E&&E.cartesianKind===s?{value:!0}:void 0};for(var y in v.roles){var m=g(y);if("object"==typeof m)return m.value}}));d++);return{level:d,index:f}}}(s,l.rows,c);if(-1===(h=v?v.index:-1))return;d=l.rows.levels[v.level].sources[h],p=function(y){return y.levelValues[h].value}}return{valuesCol:d,getValues:p}}return{apply:function(l,c,f,d,p,h,v){return t(l,c,f,d,p,h,v)}}}().apply(t,r,n,i,a,o,s):function(){function t(l,c,f,d,p,h,v){if(u.assertValue(l,"sourceDataView"),u.assertValue(l.categorical,"sourceDataView.categorical"),u.assertValue(c,"dataRoles"),u.assertValue(d,"objectDescriptors"),u.assertValue(p,"objectDefinitions"),l.categorical){var g=e(0,l.categorical,c),y=e(1,l.categorical,c);if(!_.isEmpty(g)&&!_.isEmpty(y)){var m=g[0].source,S=y[0].source,b=!0,E=pn(f);if(E&&l.metadata.objects){var C=E.combineSeries;C&&(b=ir(l.metadata.objects,C,!0))}var M=vc(a(g,y,b,!1));if(gc(M)){var P,Y,xe,V=M.xMin,D=M.xMax,A=s(y)||s(g);A&&(gc(P=vc(a(g,y,b,!0)))?(V=_.min([V,P.xMin]),D=_.max([D,P.xMax])):A=!1);for(var N=[],J=0,le=M.lineDefs;J<le.length;J++)N.push(yc(le[J],+V,+D));if(A){Y=[];for(var Ve=0,Te=P.lineDefs;Ve<Te.length;Ve++)Y.push(yc(Te[Ve],+V,+D))}if(b)xe=["combinedRegressionSeries"];else if(l.categorical.values.source){var Ne=l.categorical.values.grouped();xe=_.map(Ne,function(Pe){return Pe.name})}else xe=_.map(y,function(Pe){return Pe.source.queryName});return function(l,c,f,d,p,h,v,g,y,m,S){var b,E,C;u.assertValue(l,"xColumnSource"),u.assertValue(c,"yColumnSource"),u.assertValue(d,"categories"),u.assertValue(p,"values"),u.assertValue(g,"objectDescriptors"),u.assertValue(y,"objectDefinitions"),u.assertAnyValue(h,"highlights"),u.assert(function(){return!h||h.length===p.length},"highlights should have the same length as values");var V,D,w=v.categorical.categories.for.in,M=v.categorical.values.group;if(M&&!_.isEmpty(M.select)&&(V=M.select[0].for?M.select[0].for.in:M.select[0].bind.to,D=M.by),V&&D){var A=((b={})[w]=!0,b),P=((E={})[V]=!0,E),F=((C={})[D]=!0,C),N=[];for(var J in p){var le={values:p[J]};h&&(le.highlights=h[J]),N.push([le])}var ce=Xg().withCategory({source:Yn(l,ty,!1,"",A),values:d,identityFrom:{fields:[Re(je("s","RegressionEntity"),"RegressionCategories")]}}).withGroupedValues({groupColumn:{source:Yn(c,ry,c.isMeasure,"Regression",F),values:f,identityFrom:{fields:[Re(je("s","RegressionEntity"),"RegressionSeries")]}},valueColumns:[{source:Yn(c,ny,c.isMeasure,"",P)}],data:N}).build();return Lo(ce,1,g,y,[],m,S),ce}}(m,S,xe,[V,D],N,Y,f,d,p,h,v)}}}}function e(l,c,f){u.assertValue(l,"roleKind"),u.assertValue(c,"categorical");var d=r(l,c.values,f);if(!_.isEmpty(d))return d;var p=c.categories;if(!_.isEmpty(p)){var h=p[0],v=r(l,[h],f);if(!_.isEmpty(v)&&(1===p.length||_.isEmpty(h.values)||!_.isEmpty(h.objects)&&void 0!==n(h.objects[0])))return v}}function r(l,c,f){if(!_.isEmpty(c))return _.filter(c,function(d){var p=function(y){if(!d.source.roles[y])return"continue";var m=_.find(f,function(S){return S.name===y});return m&&m.cartesianKind===l?{value:!0}:void 0};for(var h in d.source.roles){var v=p(h);if("object"==typeof v)return v.value}return!1})}function n(l){return ir(l,zg)}function i(l,c){var f=_.head(l.objects);return f&&n(f)?_.map(l.objects,function(p){return n(p)}):c&&l.highlights?l.highlights:l.values}function a(l,c,f,d){for(var p=[],h=_.map(l,function(b){return i(b,d)}),v=_.map(c,function(b){return i(b,d)}),g=l.length>1,y=0;y<v.length;y++){var m=g?h[y]:h[0],S=v[y];f&&p.length>0?(p[0].xValues=p[0].xValues.concat(m),p[0].yValues=p[0].yValues.concat(S)):p.push({xValues:m,yValues:S})}return p}function s(l){return _.some(l,function(c){return null!=c.highlights})}return{apply:function(c,f,d,p,h,v,g){return t(c,f,d,p,h,v,g)}}}().apply(t,r,n,i,a,o,s)}function Yn(t,e,r,n,i){return{displayName:t.displayName+n,queryName:e,type:t.type,isMeasure:r,roles:i}}function vc(t){for(var e,r,n=[],i=0,a=t;i<a.length;i++){var o=a[i],s=o.xValues,l=o.yValues;if(_.isEmpty(s)||_.isEmpty(l))n.push(null);else{var c=iy(s),f=iy(l);if(c&&f){var d=oF(s,l);if(!d||_.isEmpty(d.xValues)||_.isEmpty(d.yValues))n.push(null);else{var p=d.xValues[0],h=d.xValues[d.xValues.length-1],v=sF(d.xValues,d.yValues);e=_.min([e,p]),r=_.max([r,h]),n.push(v)}}else n.push(null)}}return{lineDefs:n,xMin:e,xMax:r}}function gc(t){return t&&!_.isEmpty(t.lineDefs)&&_.some(t.lineDefs,function(e){return e})}function iy(t){var e=_.find(t,function(n){return null!=n});if(null!=e){var r=typeof e;if(!_.some(t,function(n){return null!=n&&typeof n!==r}))return r}}function oF(t,e){u.assertValue(t,"unsortedXValues"),u.assertValue(e,"unsortedYValues");var r=_.zip(t,e),n=_.chain(r).filter(function(o){return null!=o[0]&&null!=o[1]}).sortBy(function(o){return o[0]}).unzip().value(),i=n[0],a=n[1];return{xValues:i=_.map(i,_.toNumber),yValues:a=_.map(a,_.toNumber)}}function sF(t,e,r){void 0===r&&(r=!1),u.assertValue(t,"xValues"),u.assertValue(e,"yValues");var n=_.sum(t),i=_.sum(e),a=n/t.length,o=i/e.length,s=_.chain(t).map(function(m){return Math.pow(m-a,2)}).sum().value();if(0!==s){var d,c=_.chain(t).map(function(m,S){return(m-a)*(e[S]-o)}).sum().value()/s,f=o-a*c;if(r){var p=_.size(t),h=_.chain(t).map(function(m,S){return m*e[S]}).sum().value(),v=_.chain(t).map(function(m){return m*m}).sum().value(),g=_.chain(e).map(function(m){return m*m}).sum().value(),y=Math.sqrt((p*v-Math.pow(n,2))*(p*g-Math.pow(i,2)));0!==y&&(d=Math.pow((p*h-n*i)/y,2))}return{incline:c,intercept:f,rSquared:d}}}function yc(t,e,r){return t?[e*t.incline+t.intercept,r*t.incline+t.intercept]:[null,null]}function ay(t,e,r){for(var n=ve(t),i=0,a=r;i<a.length;i++){var o=a[i];n[o]=e[o]}return n}var Pr=function(t){return t.conditionRangeTooLarge="conditionRangeTooLarge",t.conditionRangeTooSmall="conditionRangeTooSmall",t.conditionKindExpectedMeasure="conditionKindExpectedMeasure",t.conditionKindExpectedGrouping="conditionKindExpectedGrouping",t.conditionKindExpectedGroupingOrMeasure="conditionKindExpectedGroupingOrMeasure",t.conditionNotHierarchicallyRelated="conditionNotHierarchicallyRelated",t.conditionSchemaCapabilities_TupleFilters_InstanceFilters="conditionSchemaCapabilities_TupleFilters_InstanceFilters",t}({});function vF(t,e){u.assertValue(e,"dataViewMapping");var i,r=e.categorical,n=t.categorical;if(!n)return{isValid:!1};if(r.rowCount&&(i=r.rowCount.supported)&&i.max){var a=void 0,o=n.categories,s=i.max,l=void 0;if(o)for(var c=0,f=o.length;c<f;c++){var d=o[c];if(l=d.values.length,void 0!==s&&l>s){var p=wf(d.values,0,s-1);(a=a||{categories:[]}).categories.push({source:d.source,values:p})}}if(n.values&&n.values.length>0&&s&&(l||(l=n.values[0].values.length),void 0!==s&&l>s))for((a=a||{}).values=Tr(),c=0,f=n.values.length;c<f;c++){var h=n.values[c],v={source:h.source,values:wf(h.values,0,s-1)};void 0!==h.min&&(v.min=h.min),void 0!==h.max&&(v.max=h.max),void 0!==h.subtotal&&(v.subtotal=h.subtotal),a.values.push(v)}a&&(t={metadata:t.metadata,categorical:a})}return oy(t,e)?{dataView:t,isValid:!0}:null}function gF(t,e){return u.assertValue(t,"dataView"),u.assertValue(e,"singleRoleMapping"),t.single?{dataView:t,isValid:!0}:{isValid:!1}}function yF(t,e){return u.assertValue(t,"dataView"),u.assertValue(e,"treeRoleMapping"),sy(t,e)?{dataView:t,isValid:!0}:{isValid:!1}}function mF(t,e){return u.assertValue(t,"dataView"),u.assertValue(e,"tableRoleMapping"),t.table?{dataView:t,isValid:!0}:{isValid:!1}}function mc(t){for(var e=0,r=0,n=t.length;r<n;r++)t[r].isMeasure||++e;return e}function SF(t,e,r){return!(!e||!t||e.scriptResult&&!function(t,e){return u.assertValue(e,"scriptResultRoleMapping"),!(!t||!t.payloadBase64)}(t.scriptResult,e.scriptResult)||e.categorical&&!oy(t,e.categorical,r)||e.tree&&!sy(t,e.tree,r)||e.single&&!function(t,e){return u.assertValue(e,"singleRoleMapping"),!!t}(t.single,e.single)||e.table&&!function(t,e,r){if(u.assertValue(e,"tableRoleMapping"),!t)return!1;if(e.rowCount){var n=e.rowCount.supported;if(r&&e.rowCount.preferred&&(n=e.rowCount.preferred),n){var i=0;if(t.rows&&t.rows.length&&(i=t.rows.length),null!=Bo(i,n))return!1}}return!0}(t.table,e.table,r))}function oy(t,e,r){u.assertValue(e,"categoryRoleMapping");var n=t.categorical;if(!n)return!1;if(e.rowCount){var i=e.rowCount.supported;if(r&&e.rowCount.preferred&&(i=e.rowCount.preferred),i){var a=0;if(n.values&&n.values.length?a=n.values[0].values.length:n.categories&&n.categories.length&&(a=n.categories[0].values.length),null!=Bo(a,i))return!1}}return!0}function sy(t,e,r){u.assertValue(e,"treeRoleMapping");var i=e.depth,a=i&&r?i.preferred:i.supported;return null==Bo(mc(t.metadata.columns),a)}function Bo(t,e,r){if(u.assertValue(t,"value"),e){if(!r&&void 0!==e.min&&e.min>t)return Pr.conditionRangeTooSmall;if(void 0!==e.max&&e.max<t)return Pr.conditionRangeTooLarge}}function wF(t,e,r,n){if(t&&void 0!==t.kind){var i=t.kind,a=r[e];if(a)for(var s=0,l=a.all();s<l.length;s++)if(n[l[s].queryRef]!==i)switch(i){case at.Measure:return Pr.conditionKindExpectedMeasure;case at.Grouping:return Pr.conditionKindExpectedGrouping;case at.GroupingOrMeasure:return Pr.conditionKindExpectedGroupingOrMeasure}}}function VF(t,e,r,n){if(t&&t.areHierarchicallyRelated&&!_.isEmpty(e)&&!_.isEmpty(r)&&n){var a=uy(_.map(e,function(o){return o.queryRef}),r);if(!mt.areHierarchicallyRelated(n,a))return Pr.conditionNotHierarchicallyRelated}}function MF(t,e,r){if(u.assertAnyValue(t,"can be called with empty role"),u.assertNonEmpty(e,"must have selects"),u.assertValue(r,"must have Schema"),1!==_.chain(e).map(function(l){return l.name}).uniq().value().length){var a=uy(_.map(t,function(l){return l.queryRef}),e),o=_.chain(a).map(function(l){return r.schema(l.schema)}).uniq().value(),s=_.uniqWith(a,function(l,c){return j(l,c)});if(u.assertNonEmpty(s,"uniqueEntityExprs"),s.length<2)return _.some(o,function(l){return!l.capabilities||!l.capabilities.supportsInstanceFilters})?Pr.conditionSchemaCapabilities_TupleFilters_InstanceFilters:void 0;if(_.some(o,function(l){return!l.capabilities||!l.capabilities.supportsMultiTableTupleFilters||!l.capabilities.supportsInstanceFilters}))return Pr.conditionSchemaCapabilities_TupleFilters_InstanceFilters}}function uy(t,e){if(!_.isEmpty(t)&&!_.isEmpty(e)){var r={};t.forEach(function(s){r[s]=!0});for(var n=[],i=0,a=e;i<a.length;i++){var o=a[i];o.name&&r[o.name]&&o.expr&&n.push(o.expr.getTargetEntity())}return n}}function DF(t,e,r,n,i,a){u.assertValue(t,"projections"),u.assertValue(e,"condition");for(var o=Object.keys(e),s=[],l=0,c=o.length;l<c;l++){var f=o[l],d=t[f]&&!_.isEmpty(t[f].activeProjectionRefs),p=e[f],h=!p.suppressDrill,m=Bo(_F(f,t,h&&(null!=n?n:d)&&h),p);null!=m&&s.push({code:m,roleName:f}),null!=(m=wF(p,f,t,r))&&s.push({code:m,roleName:f});var S=t[f]&&t[f].projected(),b=void 0;_.isEmpty(i)||(b=_.map(S,function(E){return i.withName(E.queryRef)})),null!=(m=VF(p,S,b,a))&&s.push({code:m,roleName:f}),p.multiTableTupleFiltersSupported&&a&&!_.isEmpty(i)&&!_.isEmpty(b)&&null!=(m=MF(S,b,a))&&s.push({code:m,roleName:f})}return s}function AF(t,e,r,n){if(_.isEmpty(t))return!0;if(!e||!n)return!1;var i=function(t,e){void 0===t&&(t=new Tf);var r={foreground:{value:"#333333"},foregroundLight:{value:"#FFF"},foregroundDark:{value:"#000"},foregroundNeutralLight:{value:"#EAEAEA"},foregroundNeutralDark:{value:"#212121"},foregroundNeutralSecondary:{value:"#666666"},foregroundNeutralSecondaryAlt:{value:"#777777"},foregroundNeutralSecondaryAlt2:{value:"#888888"},foregroundNeutralTertiary:{value:"#A6A6A6"},foregroundNeutralTertiaryAlt:{value:"#C8C8C8"},foregroundSelected:{value:"#333333"},foregroundButton:{value:"#666666"},background:{value:"#FFF"},backgroundLight:{value:"#EAEAEA"},backgroundNeutral:{value:"#C8C8C8"},backgroundDark:{value:"#000"},tableAccent:{value:t.getColorByIndex(0).value},hyperlink:{value:"#1F3A93"},visitedHyperlink:{value:"#551A8B"},mapPushpin:{value:"#FF5F00"},shapeStroke:{value:"#01B8AA"},disabledText:{value:"#8C8C8C"},dataColors:t},n=function(t,e,r){var n,i,a,o;if(void 0===r&&(r=!1),function(t){if(!t)return!1;for(var r=["color","fontSize","fontFace"],n=0,i=["callout","header","label","title"];n<i.length;n++){var o=t[i[n]];if(!o)return!1;for(var s=0,l=r;s<l.length;s++)if(!o[l[s]])return!1}return!0}(e)){e.callout.fontFace=No(null!==(n=e.callout.fontFace)&&void 0!==n?n:""),e.label.fontFace=No(null!==(i=e.label.fontFace)&&void 0!==i?i:""),e.title.fontFace=No(null!==(a=e.title.fontFace)&&void 0!==a?a:""),e.header.fontFace=No(null!==(o=e.header.fontFace)&&void 0!==o?o:"");var f={callout:e.callout,label:e.label,title:e.title,header:e.header,largeTitle:Gt(e.largeTitle,e.title,void 0,7/6),dataTitle:Gt(e.dataTitle,e.title,t.dataColors.getColorByIndex(0)),boldLabel:Gt(e.boldLabel,e.label,void 0,void 0,"700"),largeLabel:Gt(e.largeLabel,e.label,void 0,1.2),largeLightLabel:Gt(e.largeLightLabel,e.label,t.foregroundNeutralSecondary,1.2),lightLabel:Gt(e.lightLabel,e.label,t.foregroundNeutralSecondary),semiboldLabel:Gt(e.semiboldLabel,e.label,void 0,void 0,"600"),smallLabel:Gt(e.smallLabel,e.label,void 0,.9),smallLightLabel:Gt(e.smallLightLabel,e.label,t.foregroundNeutralSecondary,.9),smallDataLabel:Gt(e.smallDataLabel,e.label,t.dataColors.getColorByIndex(0),.9)};if(r){var d=t.foreground.value,p=void 0;for(p in f){var h=f[p];h.color?h.color.value=d:h.color={value:d}}}return f}}(r,e);return{isHighContrast:!1,colorPalette:r,textClasses:n,icons:{SignLow:{svgId:"SignLow",description:{resourceKey:"Icon_SignLow"}},SignMedium:{svgId:"SignMedium",description:{resourceKey:"Icon_SignMedium"}},CircleGreenPatternFill:{svgId:"CircleGreenPatternFill",description:{resourceKey:"Icon_CircleGreenPatternFill"}},CircleYellowPatternFill:{svgId:"CircleYellowPatternFill",description:{resourceKey:"Icon_CircleYellowPatternFill"}},CircleRedPatternFill:{svgId:"CircleRedPatternFill",description:{resourceKey:"Icon_CircleRedPatternFill"}},CircleBlackFill:{svgId:"CircleBlackFill",description:{resourceKey:"Icon_4CircleLow"}},CircleGrayPatternFill:{svgId:"CircleGrayPatternFill",description:{resourceKey:"Icon_CircleGrayPatternFill"}},CirclePurplePatternFill:{svgId:"CirclePurplePatternFill",description:{resourceKey:"Icon_CirclePurplePatternFill"}},CircleHigh:{svgId:"CircleHigh",description:{resourceKey:"Icon_CircleHigh"}},CircleMedium:{svgId:"CircleMedium",description:{resourceKey:"Icon_CircleMedium"}},CircleLow:{svgId:"CircleLow",description:{resourceKey:"Icon_4CircleHigh"}},"4CircleLow":{svgId:"4CircleLow",description:{resourceKey:"Icon_4CircleLow"}},CircleMedium1:{svgId:"CircleMedium1",description:{resourceKey:"Icon_CircleMedium1"}},"4CircleMedium2":{svgId:"4CircleMedium2",description:{resourceKey:"Icon_4CircleMedium2"}},CircleEmpty:{svgId:"CircleEmpty",description:{resourceKey:"Icon_CircleEmpty"}},Circle25:{svgId:"Circle25",description:{resourceKey:"Icon_Circle25"}},CircleHalf:{svgId:"CircleHalf",description:{resourceKey:"Icon_CircleHalf"}},Circle75:{svgId:"Circle75",description:{resourceKey:"Icon_Circle75"}},CircleFilled:{svgId:"CircleFilled",description:{resourceKey:"Icon_CircleFilled"}},CircleGreenBlackBackgroundPatternFill:{svgId:"CircleGreenBlackBackgroundPatternFill",description:{resourceKey:"Icon_CircleGreenBlackBackgroundPatternFill"}},CircleYellowBlackBackgroundPatternFill:{svgId:"CircleYellowBlackBackgroundPatternFill",description:{resourceKey:"Icon_CircleYellowBlackBackgroundPatternFill"}},CircleRedBlackBackgroundPatternFill:{svgId:"CircleRedBlackBackgroundPatternFill",description:{resourceKey:"Icon_CircleRedBlackBackgroundPatternFill"}},TrafficLow:{svgId:"TrafficLow",description:{resourceKey:"Icon_TrafficLow"}},TrafficMedium:{svgId:"TrafficMedium",description:{resourceKey:"Icon_TrafficMedium"}},TrafficHigh:{svgId:"TrafficHigh",description:{resourceKey:"Icon_TrafficHigh"}},TrafficBlackRimmed:{svgId:"TrafficBlackRimmed",description:{resourceKey:"Icon_TrafficBlackRimmed"}},CircleRedBlackOutlinePatternFill:{svgId:"CircleRedBlackOutlinePatternFill",description:{resourceKey:"Icon_CircleRedBlackOutlinePatternFill"}},CircleYellowBlackOutlinePatternFill:{svgId:"CircleYellowBlackOutlinePatternFill",description:{resourceKey:"Icon_CircleYellowBlackOutlinePatternFill"}},CircleGreenBlackOutlinePatternFill:{svgId:"CircleGreenBlackOutlinePatternFill",description:{resourceKey:"Icon_CircleGreenBlackOutlinePatternFill"}},TrafficLowLight:{svgId:"TrafficLowLight",description:{resourceKey:"Icon_TrafficLowLight"}},TrafficMediumLight:{svgId:"TrafficMediumLight",description:{resourceKey:"Icon_TrafficMediumLight"}},TrafficHighLight:{svgId:"TrafficHighLight",description:{resourceKey:"Icon_TrafficHighLight"}},TrafficBlackRimmedLight:{svgId:"TrafficBlackRimmedLight",description:{resourceKey:"Icon_TrafficBlackRimmedLight"}},ColoredArrowDown:{svgId:"ColoredArrowDown",description:{resourceKey:"Icon_ColoredArrowDown"}},ColoredArrowDownRight:{svgId:"ColoredArrowDownRight",description:{resourceKey:"Icon_ColoredArrowDownRight"}},ColoredArrowRight:{svgId:"ColoredArrowRight",description:{resourceKey:"Icon_ColoredArrowRight"}},ColoredArrowUpRight:{svgId:"ColoredArrowUpRight",description:{resourceKey:"Icon_ColoredArrowUpRight"}},ColoredArrowUp:{svgId:"ColoredArrowUp",description:{resourceKey:"Icon_ColoredArrowUp"}},ColoredArrowUpRed:{svgId:"ColoredArrowUpRed",description:{resourceKey:"Icon_ColoredArrowUpRed"}},ColoredArrowDownGreen:{svgId:"ColoredArrowDownGreen",description:{resourceKey:"Icon_ColoredArrowDownGreen"}},GreyArrowDown:{svgId:"GreyArrowDown",description:{resourceKey:"Icon_GreyArrowDown"}},GreyArrowDownRight:{svgId:"GreyArrowDownRight",description:{resourceKey:"Icon_GreyArrowDownRight"}},GreyArrowRight:{svgId:"GreyArrowRight",description:{resourceKey:"Icon_GreyArrowRight"}},GreyArrowUpRight:{svgId:"GreyArrowUpRight",description:{resourceKey:"Icon_GreyArrowUpRight"}},GreyArrowUp:{svgId:"GreyArrowUp",description:{resourceKey:"Icon_GreyArrowUp"}},FlagRedPatternFill:{svgId:"FlagRedPatternFill",description:{resourceKey:"Icon_FlagLow"}},FlagYellowPatternFill:{svgId:"FlagYellowPatternFill",description:{resourceKey:"Icon_FlagMedium"}},FlagGreenPatternFill:{svgId:"FlagGreenPatternFill",description:{resourceKey:"Icon_FlagHigh"}},FlagLow:{svgId:"FlagLow",description:{resourceKey:"Icon_FlagLow"}},FlagMedium:{svgId:"FlagMedium",description:{resourceKey:"Icon_FlagMedium"}},FlagHigh:{svgId:"FlagHigh",description:{resourceKey:"Icon_FlagHigh"}},FlagBlack:{svgId:"FlagBlack",description:{resourceKey:"Icon_FlagBlack"}},SymbolLow:{svgId:"SymbolLow",description:{resourceKey:"Icon_SymbolLow"}},SymbolMedium:{svgId:"SymbolMedium",description:{resourceKey:"Icon_SymbolMedium"}},SymbolHigh:{svgId:"SymbolHigh",description:{resourceKey:"Icon_SymbolHigh"}},CircleSymbolLow:{svgId:"CircleSymbolLow",description:{resourceKey:"Icon_CircleSymbolLow"}},CircleSymbolMedium:{svgId:"CircleSymbolMedium",description:{resourceKey:"Icon_CircleSymbolMedium"}},CircleSymbolHigh:{svgId:"CircleSymbolHigh",description:{resourceKey:"Icon_CircleSymbolHigh"}},StarLow:{svgId:"StarLow",description:{resourceKey:"Icon_StarLow"}},StarMedium:{svgId:"StarMedium",description:{resourceKey:"Icon_StarMedium"}},StarHigh:{svgId:"StarHigh",description:{resourceKey:"Icon_StarHigh"}},StarMediumLight:{svgId:"StarMediumLight",description:{resourceKey:"Icon_StarMediumLight"}},StarHighLight:{svgId:"StarHighLight",description:{resourceKey:"Icon_StarHighLight"}},TriangleLow:{svgId:"TriangleLow",description:{resourceKey:"Icon_TriangleLow"}},TriangleMedium:{svgId:"TriangleMedium",description:{resourceKey:"Icon_TriangleMedium"}},TriangleHigh:{svgId:"TriangleHigh",description:{resourceKey:"Icon_TriangleHigh"}},SignalBarEmpty:{svgId:"SignalBarEmpty",description:{resourceKey:"Icon_SignalBarEmpty"}},SignalBarLow:{svgId:"SignalBarLow",description:{resourceKey:"Icon_SignalBarLow"}},SignalBarMedium:{svgId:"SignalBarMedium",description:{resourceKey:"Icon_SignalBarMedium"}},SignalBarMedium2:{svgId:"SignalBarMedium2",description:{resourceKey:"Icon_SignalBarMedium2"}},SignalBarFull:{svgId:"SignalBarFull",description:{resourceKey:"Icon_SignalBarFull"}},SignalBarLowColored:{svgId:"SignalBarLowColored",description:{resourceKey:"Icon_SignalBarLow"}},SignalBarMediumColored:{svgId:"SignalBarMediumColored",description:{resourceKey:"Icon_SignalBarMediumColored"}},SignalBarMedium2Colored:{svgId:"SignalBarMedium2Colored",description:{resourceKey:"Icon_SignalBarMedium2Colored"}},SignalBarFullColored:{svgId:"SignalBarFullColored",description:{resourceKey:"Icon_SignalBarFullColored"}},QuadrantEmpty:{svgId:"QuadrantEmpty",description:{resourceKey:"Icon_QuadrantEmpty"}},Quadrant25:{svgId:"Quadrant25",description:{resourceKey:"Icon_Quadrant25"}},Quadrant50:{svgId:"Quadrant50",description:{resourceKey:"Icon_Quadrant50"}},Quadrant75:{svgId:"Quadrant75",description:{resourceKey:"Icon_Quadrant75"}},QuadrantFull:{svgId:"QuadrantFull",description:{resourceKey:"Icon_QuadrantFull"}},Quadrant25Colored:{svgId:"Quadrant25Colored",description:{resourceKey:"Icon_Quadrant25Colored"}},Quadrant50Colored:{svgId:"Quadrant50Colored",description:{resourceKey:"Icon_Quadrant50Colored"}},Quadrant75Colored:{svgId:"Quadrant75Colored",description:{resourceKey:"Icon_Quadrant75Colored"}},QuadrantFullColored:{svgId:"QuadrantFullColored",description:{resourceKey:"Icon_QuadrantFullColored"}}}}}(),a=Ig(),o=new Kn(r,i);return _.every(t,function(s){var l=null,c=n[s.objectName];if(!c)return!1;var d,f=e[s.objectName];return f&&(l=f.properties[s.propertyName]),!_.isEmpty(c)&&c[0]&&(d=ic(n,s,c[0].selector)),!(!l||!d)&&o.evaluateProperty(a,l,d)})}function _F(t,e,r){u.assertValue(t,"roleName"),u.assertValue(e,"projections");var n=e[t];return n?r?1:n.projected().length:0}var TF=["Series","Category"],PF=["Series","X","Y"];function cy(t,e,r,n){u.assertValue(t,"groupingLevelSelectIndices"),u.assertValue(e,"selectTransforms"),u.assertAnyValue(r,"drillableRoles"),u.assertValue(n,"rolesToMatch");for(var i=0,a=t.length,o=0,s=n;o<s.length;o++){var l=s[o];if(a<=i)return!1;var c=kF(t,e,l);if(0===c)return!1;if(c>=2&&!_.includes(r,l))return!1;i+=c}return!(i<a)}function kF(t,e,r){u.assertValue(t,"selectIndices"),u.assertValue(e,"selectTransforms"),u.assertValue(r,"roleToMatch");for(var n=0,i=0,a=t;i<a.length;i++){var o=a[i];if(J_(e[o]&&e[o].roles,r))n++;else if(n>0)break}return n}var fy_quarterPrefix="Qtr {0}";function Sc(t){u.assertValue(t,"options");var e=t.prototype,r=t.objectDescriptors,n=t.transforms,i=t.visualStyle,a=t.withWarnings?[]:void 0;if(!e)return{dataViews:zF(r,n,i,t.featureSwitches)};if(!n)return{dataViews:[e]};var o=function(t,e,r,n,i,a,o,s,l,c){u.assertValue(t,"queryDataViewMetadata"),u.assertAnyValue(e,"objectDescriptors"),u.assertAnyValue(r,"dataViewMappings"),u.assertAnyValue(n,"dataRoles"),u.assertAnyValue(i,"drillCapabilities"),u.assertValue(o,"transforms"),u.assertValue(s,"DataViewTransformContext.create - visualStyle");var f=o.selects,d=o.roles&&o.roles.activeItems,p=_.isEmpty(f)?{}:function(t,e){for(var r={},n=0,i=e.columns;n<i.length;n++){var a=i[n];if(!(!a.index&&0!==a.index||a.index<0||a.index>=t.length)){var o=t[a.index];if(o){var s=o.queryName;s&&void 0===r[s]&&(r[s]=a.isMeasure?at.Measure:at.Grouping)}}}return r}(f,t),h=function(t,e){if(u.assertAnyValue(t,"selects"),u.assertAnyValue(e,"projectionActiveItems"),_.isEmpty(t))return{};for(var r={},n=0,i=t;n<i.length;n++){var a=i[n];if(a){var o=a.roles;if(o)for(var s in o)if(o[s]){var l=r[s];l||(l=r[s]=new Fg([])),l.addProjection({queryRef:a.queryName}),e&&e[s]&&(l.activeProjectionRefs=_.map(e[s],function(c){return c.queryRef}))}}}return r}(f,d),v=function(t,e,r,n,i,a,o,s){u.assertValue(t,"projections"),u.assertAnyValue(e,"mappings"),u.assert(function(){return _.every(e,function(P){return _.isPlainObject(P)})},"precondition: prototypal inheritance on DataViewMapping is not supported by DataViewAnalysis");var l=[],c=[];if(!_.isEmpty(e))for(var f=0,d=e.length;f<d;f++){var p=e[f],h=p.conditions,g=AF(p.requiredProperties,i,n,a),y=[];if(_.isEmpty(h))y.push({});else for(var m=0,S=h.length;m<S;m++){var b=h[m],E=DF(t,b,r,void 0,void 0,void 0);if(_.isEmpty(E))y.push(b);else for(var C=0,w=E;C<w.length;C++){var M=w[C];M.mappingIndex=f,M.conditionIndex=m,c.push(M)}}if(!_.isEmpty(y)&&g){var V=_.cloneDeep(p);V.single&&(V={table:{rows:{for:{in:V.single.role}}}});var A=_.filter(y,function(P){return Object.keys(P).length>0});_.isEmpty(A)||(V.conditions=A),l.push(V)}}return{supportedMappings:Lr(l),mappingErrors:Lr(c)}}(h,r,p,c,e,o.objects),g=v.supportedMappings;return{queryDataViewMetadata:t,objectDescriptors:e,dataRoles:n,drillCapabilities:i,expandCollapseCapabilities:a,transforms:o,selectTransforms:f,projectionOrdering:o.roles&&o.roles.ordering,projectionActiveItems:d,roleKindByQueryRef:p,queryProjectionsByRole:h,visualCapabilitiesRoleMappings:r,visualCapabilitiesDataViewKinds:Bi(r),applicableRoleMappings:g,applicableDataViewKinds:Bi(g),visualStyle:s,visualCapabilitiesKeepAllMetadataColumns:l}}(e.metadata,r,t.dataViewMappings,t.dataRoles,t.drillCapabilities,t.expandCollapseCapabilties,n,i,t.keepAllMetadataColumnsCapability,t.featureSwitches),s=function(t,e){var r,n;u.assertValue(t,"prototype"),u.assertValue(e,"transformContext");var i=e.transforms,a=e.applicableRoleMappings,o=jP(t,e.selectTransforms,e.roleKindByQueryRef,e.queryProjectionsByRole,a),s=null===(n=null===(r=e.transforms)||void 0===r?void 0:r.roles)||void 0===n?void 0:n.isDrillDisabled;return function(t,e,r,n){if(!function(t,e,r,n){if(_.isEmpty(e)||!t||_.isEmpty(r))return!1;var i=t.matrix;if(!i||!i.rows||_.isEmpty(i.rows.levels)||!i.columns||_.isEmpty(i.columns.levels))return!1;for(var a=[],o=0,s=i.columns.levels;o<s.length;o++)for(var c=0,f=s[o].sources;c<f.length;c++)(d=f[c]).isMeasure||a.push(d);for(var p=[],h=0,v=i.rows.levels;h<v.length;h++)for(var g=0,y=v[h].sources;g<y.length;g++)(d=y[g]).isMeasure||p.push(d);for(var m=[],S=0,b=i.rows.levels;S<b.length;S++)for(var E=0,C=b[S].sources;E<C.length;E++){var d;(d=C[E]).isMeasure&&m.push(d)}if(!_.isEmpty(m)||1!==a.length||p.length<1)return!1;var w=_.filter(r,function(N){return!pn(N)});if(1!==w.length)return!1;if(2!==Bi(w))return!1;var V=w[0].matrix;if(!V)return!1;var D=hn.fromMatrixRows(V.rows),A=hn.fromMatrixColumns(V.columns);if(_.size(D)<2||0!==_.size(A))return!1;var P=_.uniq([].concat.apply([],_.map(p,function(N){return Object.keys(e[N.index].roles)}))),F=_.uniq([].concat.apply([],_.map(a,function(N){return Object.keys(e[N.index].roles)})));return _.isEqual(D,[].concat(F,P))&&_.isEqual(n,P)}(t,e,n,r))return t;var i={metadata:{columns:Ee([],t.metadata.columns||[],!0)}};if(t.single&&(i.single=t.single),t.table&&(i.table=t.table),t.matrix){var a=function(t){var e=t.rows,r=t.columns,n=e.root,i=n.children;u.assert(function(){return 1===e.levels.length},"oldRows.levels.length ===1"),u.assert(function(){return r.levels.length>=1},"oldColumns.levels.length >=1"),u.assert(function(){return 1===r.levels[0].sources.length},"oldColumns.levels[0].sources.length === 1");var a={levels:[],root:{children:[]}},s={rows:a,columns:{levels:[],root:{children:[]}},valueSources:t.valueSources},l=a.root.children;a.levels.push(r.levels[0]),a.root.childIdentityFields=r.root.childIdentityFields;for(var c=0,f=r.root.children;c<f.length;c++){var d=f[c];void 0!==d.levelValues&&void 0!==d.value&&l.push({children:[],value:d.value,levelValues:d.levelValues,identity:d.identity,level:0})}var p=_.size(t.valueSources);if(a.levels.push(e.levels[0]),_.isEmpty(l))return s;for(var h in i){var v=i[h];for(var g in v.values){var m=l[Math.floor(g/p)];m.childIdentityFields||(m.childIdentityFields=n.childIdentityFields);var S=v.values[g];if(null!=S){var b=m.children[h];b||m.children.push(b={level:m.level+1,value:v.value,levelValues:v.levelValues,values:{},identity:v.identity}),b.values[g%p]=S}}}return s}(t.matrix);_.isEmpty(a.valueSources)||Io(a.columns)||(i.matrix=a)}return i}(o=function(t,e,r,n){if(u.assertValue(t,"prototype"),u.assertValue(e,"transformActions"),u.assertAnyValue(r,"applicableRoleMappings"),u.assertAnyValue(n,"drillableRoles"),!_.isEmpty(e.splits))return t;var i=t.matrix;if(!i)return t;var a=_.chain(r).map(function(c){return function(t){u.assertValue(t,"dataViewMapping");var e=t.matrix;if(e&&e.rows&&!e.columns&&!e.values){var r=hn.fromMatrixRows(e.rows);if(Ae(r,TF,function(i,a){return i===a})||Ae(r,PF,function(i,a){return i===a}))return{primaryAxisRoles:r.slice(1),secondaryAxisRole:r[0]}}}(c)}).filter(function(c){return!!c}).value();if(1!==a.length)return t;var o=function(t){u.assertValue(t,"matrix");var e=t.rows&&t.rows.levels,r=t.columns&&t.columns.levels,n=t.valueSources;return{primaryAxis:!_.isEmpty(e)&&lg(e),secondaryAxis:!_.isEmpty(r)&&lg(r),intersection:!_.isEmpty(n)&&_.map(n,function(a){return a.index})}}(i);if(!function(t,e,r,n){u.assertValue(t,"dataViewSelectIndices"),u.assertValue(e,"transformActions"),u.assertAnyValue(r,"drillableRoles"),u.assertValue(n,"matchingUpgradeSourceRolesStructure");var i=t.primaryAxis,a=t.secondaryAxis;if(!_.isEmpty(t.intersection)||1!==_.size(i)||1!==_.size(a))return!1;var o=e.selects;return!(!cy(i[0].selectIndices,o,r,n.primaryAxisRoles)||!cy(a[0].selectIndices,o,r,[n.secondaryAxisRole]))}(o,e,n,a[0]))return t;var s=function(t){u.assertValue(t,"dataViewMatrix"),u.assert(function(){return 1===t.columns.levels.length},"dataViewMatrix.columns.levels.length === 1"),u.assert(function(){return 1===t.rows.levels.length},"dataViewMatrix.rows.levels.length === 1"),u.assert(function(){return _.isEmpty(t.valueSources)},"_.isEmpty(dataViewMatrix.valueSources)");var e=k(t),r=e.rows=k(t.rows),n=e.columns=k(t.columns),a=(n.levels=k(n.levels)).splice(0,1)[0];(r.levels=k(r.levels)).splice(0,0,a);var s=t.rows.root,l=r.root=k(n.root);n.root={children:[]};var c=zt(l.children,function(f){var d=k(f);return d.childIdentityFields=s.childIdentityFields,d.children=function(t){if(u.assertAnyValue(t,"nodes"),!t)return t;var e=zt(t,function(r){var n=ve(r);return n.level+=1,n});return e||ve(t)}(s.children),d});return c&&(l.children=c),e}(i),l=k(t);return l.matrix=s,l}(o,i,a,Cc(e.drillCapabilities,s)),e.selectTransforms,Cc(e.drillCapabilities,s),a)}(e,o),l=function(t,e,r,n,i,a){u.assertValue(e,"transformContext");var o=[],s=e.transforms.splits;if(_.isEmpty(s))o.push(dy(t,e,r,n,null,i,a));else for(var l=0,c=s;l<c.length;l++){var d=dy(t,e,r,n,c[l].selects,null,a);o.push(d)}return o}(s,o,t.featureSwitches,a,t.bypassConcatenation,t.orderIndependentSelectorMatching);return l=function(t){u.assertValue(t,"options");var e=t.visualDataViews,r=t.dataRoles,n=t.objectDescriptors,i=t.objectDefinitions,a=t.transformSelects,o=t.applicableDataViewMappings,s=t.roleKindByQueryRef,l=t.queryProjectionsByRole,c=t.visualStyle,f=t.featureSwitches;if(!_.isEmpty(e)&&a){if(!s||!l||_.isEmpty(o)||!n||!i)return e;var d=_.find(o,function(m){return!!pn(m)});if(d){for(var p=[],h=0,v=e;h<v.length;h++){var y=nF(v[h],o,r,d,n,i,c,f);y&&p.push(y)}_.isEmpty(p)||e.push.apply(e,p||[])}}return e}({visualDataViews:l,dataRoles:o.dataRoles,objectDescriptors:r,objectDefinitions:n.objects,transformSelects:n.selects,applicableDataViewMappings:o.applicableRoleMappings,roleKindByQueryRef:o.roleKindByQueryRef,queryProjectionsByRole:o.queryProjectionsByRole,visualStyle:o.visualStyle,featureSwitches:t.featureSwitches}),{dataViews:l,warnings:a}}function zF(t,e,r,n){if(e&&e.objects){var i={metadata:{columns:[]}};return Lo(i,0,t,e.objects,e.selects,r,n),[i]}return[]}function dy(t,e,r,n,i,a,o){var s,l;u.assertValue(t,"prototype"),u.assertValue(e,"transformContext"),u.assert(function(){return!i||_.every(i,function(E,C){var w;return!E||(null===(w=e.selectTransforms)||void 0===w?void 0:w[C])})},"If selectsToInclude is specified, every included Select must have a corresponding Select Transform.");var c=ve(t);c.metadata=ve(t.metadata),c=function(t,e){if(u.assertValue(t,"prototype"),u.assertValue(e,"transformContext"),pd(e.visualCapabilitiesDataViewKinds)<=1)return t;var n=e.applicableDataViewKinds;if(0===pd(n))return t;var a=k(t);return a.categorical&&!ie(n,1)&&(a.categorical=void 0),a.matrix&&!ie(n,2)&&(a.matrix=void 0),a.table&&!ie(n,8)&&(a.table=void 0),a.tree&&!ie(n,16)&&(a.tree=void 0),a.single&&!ie(n,4)&&(a.single=void 0),a}(c,e);var f=e.visualCapabilitiesDataViewKinds,d=e.visualCapabilitiesRoleMappings,p=e.selectTransforms,h=e.expandCollapseCapabilities,v=e.objectDescriptors,g=e.visualStyle,y=null===(s=e.transforms)||void 0===s?void 0:s.roles,m=null==y?void 0:y.isDrillDisabled,S={rowHierarchyRewritten:!1,columnHierarchyRewritten:!1,hierarchyTreesRewritten:!1},b=[];return c=function(t,e,r,n,i,a,o,s,l){u.assertValue(t,"prototype"),u.assertValue(e,"targetDataViewKinds"),u.assert(function(){return 0===e||!_.isEmpty(r)},"if targetDataViewKinds !== None, then roleMappings must be non-empty"),u.assertAnyValue(n,"selectTransforms"),u.assertValue(i,"columnRewrites"),u.assertValue(a,"matrixTransformationContext"),u.assertValue(o,"DataViewTransform.transformSelects - visualStyle");var c=new Kn(l,o);return i.length=0,n&&(t.metadata.columns=function(t,e,r,n){if(u.assertValue(t,"columns"),!e)return t;for(var i=ve(t),a={},o=function(y,m){var S=t[y],b=e[S.index];a[S.index]=!0;var E=S;if(b)E=i[y]=py(S,b);else if(!_.some(t,function(C){return C.formatSource&&C.formatSource.formatString===S}))return"continue";r.push({from:S,to:E})},s=0,l=t.length;s<l;s++)o(s);if(n)for(s=0;s<e.length;s++)if(!a[s]){var c=e[s];f=hy(c,f={displayName:c.displayName,index:s,identityExprs:c.identityExprs}),i.push(f)}for(var d={},p=0,h=i;p<h.length;p++){var f;if((f=h[p]).roles&&!f.groupName&&f.index)for(var v in f.rolesIndex||(f.rolesIndex={}),f.roles)void 0===d[v]&&(d[v]=0),f.roles[v]&&(f.rolesIndex[v]=[d[v]++])}return u.assert(function(){return _.every(r,function(g){return g.from.index===g.to.index})},"post-condition: DataViewMetadataColumn.index is not expected to be rewritten by select transforms."),i}(t.metadata.columns,n,i,s),function(t,e,r){if(u.assertValue(t,"dataView"),u.assertAnyValue(r,"selects"),r)for(var i,n=t.metadata.columns,a=0,o=r.length;a<o;a++){var s=r[a],l=s&&s.aggregateSources;if(l){i||(i=ko(t,r));var c=YF(n,a,s),f=c.aggregates={},d=L.fromDescriptor(c.type),p=vy(e,i,r,d,l.min);void 0!==p&&(f.min=p),void 0!==(p=vy(e,i,r,d,l.max))&&(f.max=p)}}}(t,c,n)),t.categorical&&ie(e,1)&&(t.categorical=function(t,e){u.assertValue(t,"prototype"),u.assertValue(e,"columnRewrites");var r=ve(t);function n(s){var l=function(t,e){for(var r={},n=t.source,i=t.source.rootSource,a=0,o=e;a<o.length;a++){var s=o[a];s.from===n&&(r.source=s.to),s.from===i&&(r.rootSource=s.to)}return r}(s,e),c=l.source,f=l.rootSource;if(c){var d=ve(s);return d.source=c,f&&(d.source.rootSource=f),d}}var i=zt(t.categories,n);if(i&&(r.categories=i),t.values){var a=zt(t.values,n)||k(t.values);if(r.values=a,a.source){var o=Uo(a.source,e);o&&(a.source=o)}}return Lg(r),r}(t.categorical,i),t=function(t,e){u.assertValue(t,"dataView");var r,n=function(t,e){if(t&&!_.isEmpty(e)){var r=t.categories;if(!_.isEmpty(r)){var n=t.values;if(!_.isEmpty(n)&&!n.grouped().some(function(l){return!!l.identity}))for(var i=function(c,f){var d=e[c].categorical;if(!d)return"continue";u.assert(function(){return _.filter(r,function(S){return my(S.source.roles,d.values)}).length<=1},"There should never be more than one column with the secondary axis group role in a DataViewCategorical, let alone columns in DataViewCategorical.categories.");for(var p=0,h=r;p<h.length;p++){var v=h[p],g=v.source.roles;if(my(g,d.values)){var y=d.categories;if(dR(g,y)||Ec(g,y))return{value:{type:2,selfCrossJoinCategory:v}};if(1===r.length)return{value:{type:1}}}}},a=0,o=e.length;a<o;a++){var s=i(a);if("object"==typeof s)return s.value}}}}(t.categorical,e);if(n)switch(n.type){case 1:r=function(t){var e;u.assertValue(t,"dataView");var r=t.categorical;if(!r)return null;var n=r.categories;if(!n||1!==n.length)return null;var i=r.values;if(_.isEmpty(i)||i.source)return null;for(var a=n[0],o=a.identity,s=a.values,l=[],c=[],f=new QP,d=0,p=s.length;d<p;d++)for(var h=s[d],v=o[d],g=0,y=i.length;g<y;g++){var m=i[g],S=f.getPivotedDynamicFormatColumn(m.source,d);if(void 0===S&&(S=ve(m.source)),m.identity)return null;if(S.groupName=h,S.rootSource=m.source,null!==(e=S.formatSource)&&void 0!==e&&e.formatString){var b=S.formatSource.formatString;f.trackOriginalDynamicFormatColumn(g,b);var E=ve(b);S.formatSource={formatString:E},f.addPivotedDynamicFormatColumn(g,d,E)}var C={source:S,values:[m.values[d]],identity:v,min:m.min,max:m.max,subtotal:m.subtotal},w=m.highlights;w&&(C.highlights=[w[d]]),l.push(S),c.push(C)}var M=ve(t.metadata);return M.columns=l,{metadata:M,categorical:{values:i=Tr(c,a.identityFields,a.source)},matrix:t.matrix}}(t);break;case 2:u.assertValue(n.selfCrossJoinCategory,"selfCrossJoinCategory is expected to be defined when type is SelfCrossJoin"),r=function(t,e){if(u.assertValue(t,"dataView"),u.assert(function(){return!e||_.includes(t.categorical.categories,e)},"!selfCrossJoinCategory || _.includes(dataView.categorical.categories, selfCrossJoinCategory)"),t.categorical&&e){var r=t.categorical;if(!(_.isEmpty(r.categories)||r.values&&r.values.source)){var n=function(t,e){return u.assertValue(t,"dataViewCategorical"),u.assertValue(e,"selfCrossJoinCategory"),u.assert(function(){return _.includes(t.categories,e)},"_.includes(dataViewCategorical.categories, selfCrossJoinCategory)"),e.source.identityExprs||(1===t.categories.length?e.identityFields:void 0)}(r,e);if(!_.isEmpty(n))return function(t,e,r,n){u.assertValue(t,"dataViewMetadata"),u.assertValue(e,"dataViewCategorical"),u.assertValue(e.categories,"dataViewCategorical.categories"),u.assertValue(r,"selfCrossJoinCategory"),u.assert(function(){return _.size(r.values)===_.size(r.identity)},"_.size(selfCrossJoinCategory.values) === _.size(selfCrossJoinCategory.identity)"),u.assertValue(n,"seriesGroupIdentityFields");var a=r.values.length;if(0!==a){var o=e.values?e.values.grouped()[0].values:[],s=function(t,e,r,n){u.assertValue(t,"category"),u.assertValue(e,"categoryLength"),u.assertValue(r,"measures"),u.assertValue(n,"seriesGroupIdentityFields");var i=function(t){u.assertValue(t,"length");for(var e=new Array(t),r=0;r<t;r++)e[r]=null;return e}(e),a=function(t,e){u.assertValue(t,"category"),u.assert(function(){return _.size(t.values)===_.size(t.identity)},"_.size(category.values) === _.size(category.identity)"),u.assertValue(!_.isEmpty(e),"!_.isEmpty(seriesGroupIdentityFields)");for(var r=t.identity,n=t.values,i=[],a={},o=0,s=_.size(r);o<s;o++){var c=sw(r[o].expr,e),f=c&&Et(c),d=f&&f.key,p=a[d],h=void 0;void 0===p?(i.push(h={identity:f,groupValue:n[o],groupIndex:i.length,valueRowIndices:[]}),a[d]=h.groupIndex):h=i[p],h.valueRowIndices.push(o)}return u.assert(function(){return Mf(i,function(v,g){return v.groupIndex-g.groupIndex})},"post-condition: seriesGroups is sorted by group index"),i}(t,n);if(!_.isEmpty(a)){var o=_.map(a,function(s){var l=s.valueRowIndices;return _.map(r,function(f){var d={values:ay(i,f.values,l)};return f.highlights&&(d.highlights=ay(i,f.highlights,l)),d})});return{groupColumn:{source:t.source,identityFrom:{fields:n,identities:_.map(a,function(s){return s.identity})},values:_.map(a,function(s){return s.groupValue})},valueColumns:_.map(r,function(s){return{source:s.source}}),data:o}}}(r,a,o,n);if(s){var l=Xg().withCategories(e.categories).withGroupedValues(s).build();return(t=ve(t)).columns=l.metadata.columns,{metadata:t,categorical:l.categorical}}}}(t.metadata,r,e,n)}}}(t,n.selfCrossJoinCategory)}return r||t}(t,r)),t.matrix&&ie(e,2)&&(t.matrix=function(t,e,r){u.assertValue(t,"prototype"),u.assertValue(e,"columnRewrites");var n=ve(t),i=function(f){return Uo(f,e)};function a(c){var f=null,d=zt(c.levels,function(p){var h=null,v=zt(p.sources,i);if(v&&(h=bc(h,p,function(y){return y.sources=v})),p.valueSources){u.assert(function(){return _.isEqual(_.keys(p.valueSources),["0"])},"Scoped Measures with column groupings are not supported"),u.assertValue(p.valueSources[0],"Empty Scoped measures metadata");var g=zt(p.valueSources[0],i);g&&(h=bc(h,p,function(y){return y.valueSources={0:g}}))}return h});return d&&(f=bc(f,c,function(p){return p.levels=d})),f}var o=a(n.rows);o&&(n.rows=o,r.rowHierarchyRewritten=!0);var s=a(n.columns);s&&(n.columns=s,r.columnHierarchyRewritten=!0);var l=zt(n.valueSources,i);return l&&(n.valueSources=l),n}(t.matrix,i,a)),t.table&&ie(e,8)&&(t.table=function(t,e){u.assertValue(t,"prototype"),u.assertValue(e,"columnRewrites");var r=ve(t),i=zt(t.columns,function(o){return Uo(o,e)});return i&&(r.columns=i),r}(t.table,i)),t.single&&ie(e,4)&&(t.single=function(t,e){var r=Uo(t.column,e);return r&&((t=k(t)).column=r),t}(t.single,i)),t}(c,f,d,p,b,S,g,e.visualCapabilitiesKeepAllMetadataColumns,r),Lo(c,e.visualCapabilitiesDataViewKinds,v,e.transforms.objects,p,g,r,n,o),c=function(t,e,r,n,i){u.assertValue(t,"prototype"),u.assertValue(e,"transformContext"),u.assertValue(n,"matrixTransformationContext"),u.assertAnyValue(i,"selectsToInclude");var a=e.projectionOrdering,o=e.applicableRoleMappings,s=k(t);if(function(t,e,r){if(e){for(var n=new Array(r.length),i=0,a=t;i<a.length;i++)if(void 0!==(o=a[i]).index&&void 0!==o.roles&&null==o.groupName)for(var s in n[o.index]=o,o.rolesIndex=o.rolesIndex||{},o.roles)o.roles[s]&&(o.rolesIndex[s]=[]);for(var s in e)for(var l=e[s],c=0;c<l.length;c++){var o;(o=n[l[c]])&&o.rolesIndex[s].push(c)}}}(s.metadata.columns,a,r),s.table&&ie(e.applicableDataViewKinds,8)&&function(t,e,r){if(!e)return t;var n=function(t,e){var r=Object.keys(t);if(1===r.length){var n=r[0],i=_.map(e,function(o){return o.from.index});return function(t,e){if(!Ae(t,e,function(o,s){return o===s})){for(var r=[],n=0,i=e.length;n<i;++n)r[n]=t.indexOf(e[n]);return r}}(i,t[n])}}(e,r);if(!n)return t;var i=function(s){for(var l=n.length,c=new Array(l),f=0;f<l;f++)c[f]=s[n[f]];return c};if((t=k(t)).columns=i(t.columns),_.isEmpty(t.rows)||(t.rows=zt(t.rows,function(o){var s=i(o);return o.objects&&(s.objects=i(o.objects)),s})),t.totals){var a=i(t.totals);t.totals.objects&&(a.objects=i(t.totals.objects)),t.totals=a}}(s.table,a,r),s.matrix&&ie(e.applicableDataViewKinds,2)){var l=_.filter(o,function(c){return!!c.matrix});u.assertValue(0!==l.length,"transformContext.applicableDataViewKinds should not have included Matrix if none of the applicableRoleMappings targets matrix."),u.assertValue(l.length<2,"This logic needs to be enhanced if there is more than one applicable DataViewMapping that targets matrix."),s.matrix=function(t,e,r,n){var i;u.assertValue(t,"prototype"),u.assertValue(e,"matrixMapping"),u.assertAnyValue(r,"projectionOrdering"),u.assertValue(n,"context");var a=t;if(r){a=function(t,e,r,n){u.assertValue(t,"prototype"),u.assertValue(e,"matrixRoleMapping"),u.assertValue(r,"projectionOrdering"),u.assertValue(n,"context");var i=t.valueSources,a=Hg(r,e.values,i);if(Gg(i,a))return t;u.assert(function(){return a.length>0||!_.isEmpty(i)},"Nothing to re-order!");var o=k(t),s=o.columns.levels,l=[];s.length>0&&(l=s[0].sources.filter(function(f){return f.isMeasure&&null!=f.index&&!_.isEmpty(f.roles)&&!_.find(a,function(d){return d.metadataColumn===f})})),o.rows=Qg(o.rows,o.valueSources,a,l);var c=_.map(a,function(f){return f.metadataColumn});return o.valueSources=c,o.valueSources=o.valueSources.concat(l),o.columns=function(t,e,r,n){u.assertValue(t,"prototypeColumnHierarchy"),u.assertValue(e,"newValueSources");var l,i=t.levels,a=Qi(i),s=(a?_.size(i)>=2:_.size(i)>=1)?e.length>=2:e.length>=1;return l=a?s?function(t,e,r,n){u.assert(function(){return t&&Qi(t.levels)},"prototypeColumnHierarchy && hasExistingMeasureHeadersLevel(prototypeColumnHierarchy.levels)"),u.assertValue(e,"newValueSources");var i=k(t),a=i.levels=k(i.levels),o=a.length-1,s=a[o]=k(a[o]);return s.sources=e,i.root=Gi(i.root,o,!0),_o(i.root,function(l){var c;if(jg(l,o)){var f=Kg(o,e.length,l,n);if(0===o&&r.length>0){for(var d=s.sources.length,p=0;p<r.length;p++)f.push({level:0,levelSourceIndex:d+p});l.children=f,(c=s.sources).push.apply(c,r||[])}else l.children=f;return 2}return 1}),i}(t,e,r,n):function(t){u.assert(function(){return t&&Qi(t.levels)},"prototypeColumnHierarchy && hasExistingMeasureHeadersLevel(prototypeColumnHierarchy.levels)");var e=k(t),r=e.levels=k(e.levels),n=r.length-1;return r.splice(n,1),e.root=Gi(e.root,n,!0),_o(e.root,function(i){return jg(i,n)?(i.children=void 0,2):1}),e}(t):s?function(t,e){u.assert(function(){return t&&!Qi(t.levels)},"prototypeColumnHierarchy && !hasExistingMeasureHeadersLevel(prototypeColumnHierarchy.levels)"),u.assertValue(e,"newValueSources");var r=k(t),n=r.levels=k(r.levels);n.push({sources:e});var a=n.length-1;return r.root=Gi(r.root,a,!0),_o(r.root,function(o){return $l(o)?(o.children=Kg(a,e.length,o),2):1}),r}(t,e):t,l}(o.columns,Ee([],c||[],!0),l,a),n.hierarchyTreesRewritten=!0,o}(a,e,r,n),a=function(t,e,r){u.assertValue(t,"prototype"),u.assertValue(e,"applicableDataViewMapping"),u.assertValue(r,"projectionOrdering");var c,i=hc(r,hn.fromMatrixRows(e.rows)),a=Wg(t.rows,i),s=hc(r,hn.fromMatrixColumns(e.columns)),l=Wg(t.columns,s);return(a||l)&&((c=k(t)).rows=a||c.rows,c.columns=l||c.columns),c||t}(a,e,r);var o=null===(i=e.rows)||void 0===i?void 0:i.values;_.isEmpty(o)||(a=function(t,e,r,n){u.assertValue(t,"prototype"),u.assertValue(e,"scopedMeasuresRoleMapping"),u.assertValue(r,"projectionOrdering"),u.assertValue(n,"context");for(var i=t,a=0;a<t.rows.levels.length;a++){var s=To(t.rows.levels[a]);if(!_.isEmpty(s)){var l=[];a===t.rows.levels.length-1&&(u.assert(function(){return cg(t.columns)>0},"Scoped measures at last row level aren't expected without Column grouping"),l=Hg(r,e,s)),Gg(s,l)||((i=k(i)).rows=Qg(i.rows,s,l,[],a),i.rows.levels=k(i.rows.levels),(i.rows.levels[a]=k(i.rows.levels[a])).valueSources=l.length>0?{0:_.map(l,function(f){return f.metadataColumn})}:void 0,n.hierarchyTreesRewritten=!0)}}return i}(a,o,r,n))}return a}(s.matrix,l[0].matrix,a,n),function(t,e){if(t&&!_.isEmpty(e)){var r=t.rows.levels;if(!(r.length<1)){var n=t.rows.root.children;if(n&&0!==n.length)for(var i=r[0].sources[0].roles,a=0,o=e.length;a<o;a++){var s=e[a].matrix;if(s&&!Ec(i,s.rows)&&Ec(i,s.columns))return!0}}}}(s.matrix,o)&&SP(s.matrix,n)}return function(t,e,r,n,i){u.assertValue(t,"prototype"),u.assertAnyValue(e,"applicableRoleMappings"),u.assertAnyValue(r,"dataRoles"),u.assertAnyValue(n,"projectionOrdering"),u.assertAnyValue(i,"splitSelects");var a,o=_.chain(e).filter(function(c){return c.categorical&&!pn(c)}).map(function(c){return c.categorical}).value();if(t.categorical&&o.length>=1){var s=t.categorical,l=function(t,e,r,n){if(u.assertValue(t,"prototypeCategorical"),u.assertValue(e,"categoricalRoleMappingsWithoutRegression"),u.assert(function(){return _.every(e,function(o){return!!o})},"categoricalRoleMappingsWithoutRegression must not contain falsy elements"),u.assertAnyValue(r,"projectionOrdering"),u.assertAnyValue(n,"splitSelects"),!_.isEmpty(t.categories)){var i=Tv(e,Pv);if(i){var a=function(t,e,r){if(u.assertValue(t,"roles"),u.assertAnyValue(e,"projectionOrdering"),u.assertAnyValue(r,"splitSelects"),e){var n=_.reduce(t,function(i,a){var o=_.filter(e[a],function(s){return!r||r[s]});return i.push.apply(i,o||[]),i},[]);return n}}(i,r,n);if(a)return function(t,e,r){u.assertValue(t,"prototypeCategorical"),u.assertValue(e,"projectionOrder"),u.assertValue(r,"categoryRoles");var n=t.categories;if(_.isEmpty(n))u.assert(function(){return _.isEmpty(e)},"If DataViewCategory.categories is empty but projectionOrder of primary axis is non-empty, then something went wrong when projectionOrder was getting deserialized or reconstructed.  If projectionOrder for primary axis is truly non-empty, then the DSR and DataView should have some data there.");else if(!function(t,e){return u.assertValue(t,"categories"),u.assertValue(e,"selectIndexOrder"),t.length===e.length&&_.every(e,function(r,n){return t[n].source.index===r})}(n,e)){var a=xo(_.map(n,function(f){return f.source}),e,r),o=_.chain(a).filter(function(f){return void 0!==f.projectionOrderIndex}).sortBy(function(f){return f.projectionOrderIndex}).value(),s=_.map(o,function(f){return n[f.sourceIndex]}),l=k(t);if(_.isEmpty(s))l.categories=void 0;else{var c=kg(n);c&&(s=function(t,e){if(u.assertValue(t,"prototypeCategories"),u.assertValue(e,"objects"),!_.isEmpty(t)){var r=k(t);return(r[0]=k(r[0])).objects=e,r}}(s,c)||s),l.categories=s}return l}}(t,a,i)}}}(s,o,n,i);l=function(t,e,r,n){u.assertValue(t,"prototypeCategorical"),u.assertAnyValue(e,"dataRoles"),u.assertAnyValue(r,"projectionOrdering"),u.assertAnyValue(n,"splitSelects");var i=t.values;if(i){var a=function(t){if(cc(t)){var e=Tr(t.filter(function(r){return!lc(r)}),void 0,t.source);return e.grouped=t.grouped.bind(e),e}}(i),o=function(t){u.assertValue(t,"values"),u.assert(function(){return!cc(t)},"Dynamic format values should have already been removed");var r,n,i,a,e=t.source,o=t.grouped();if(e){n=Ug(o);var l=(r=o.length)*_.size(n),c=t.length-l;c>0&&(i=l,a=_.chain(t).takeRight(c).map(function(f){return f.source}).value())}else i=0,a=Ug(o);return{secondaryAxisSource:e,dynamicSeriesGroupCount:r,dynamicSeriesMeasureSources:n,staticSeriesMeasureStartingIndex:i,staticSeriesMeasureSources:a}}(a||i),s=function(t,e,r,n){if(u.assertValue(t,"valueColumnsInfo"),u.assertAnyValue(e,"dataRoles"),u.assertAnyValue(r,"projectionOrdering"),u.assertAnyValue(n,"splitSelects"),!r)return function(t,e){u.assertValue(t,"valueColumnsInfo"),u.assertAnyValue(e,"splitSelects");var i=(t.dynamicSeriesMeasureSources||[]).concat(t.staticSeriesMeasureSources||[]),a=_.chain(i).filter(function(o){return!e||!!e[o.index]}).map(function(o){return o.index}).uniq().value();return a}(t,n);var i=_.reduce(e,function(f,d,p){var h=d.name;return void 0===f[h]&&(f[h]=p),f},{}),s=(t.dynamicSeriesMeasureSources||[]).concat(t.staticSeriesMeasureSources||[]),l=_.chain(s).filter(function(f){return!n||!!n[f.index]}).uniqBy(function(f){return f.index}).map(function(f){var d=f.roles;return d?_.filter(Object.keys(d),function(p){return d[p]}):[]}).flatten().uniq().sortBy(function(f){return i[f]}).value(),c=_.chain(l).map(function(f){return r[f]||[]}).flatten().filter(function(f){return!n||!!n[f]}).uniq().value();return c}(o,e,r,n);if(a=function(t,e,r){u.assertValue(t,"prototypeValues"),u.assertValue(e,"prototypeValueColumnsInfo"),u.assertValue(r,"measureRolesProjectionOrder"),u.assert(function(){return!cc(t)},"Dynamic format values should have already been removed");var n=function(t,e,r){if(u.assertValue(t,"prototypeValues"),u.assertValue(e,"prototypeValueColumnsInfo"),u.assertValue(r,"measureRolesProjectionOrder"),e.dynamicSeriesGroupCount&&!_.isEmpty(e.dynamicSeriesMeasureSources)){var n=Bg(e.dynamicSeriesMeasureSources,r);if(n){var i=n.length;if(0===i)return[];for(var a=e.dynamicSeriesMeasureSources.length,o=e.dynamicSeriesGroupCount,s=[],l=0;l<o;l++)for(var c=l*a,f=0;f<i;f++)s.push(t[c+n[f].sourceIndex]);return s}}}(t,e,r),i=function(t,e,r){if(u.assertValue(t,"prototypeValues"),u.assertValue(e,"prototypeValueColumnsInfo"),u.assertValue(r,"measureRolesProjectionOrder"),!_.isEmpty(e.staticSeriesMeasureSources)){var n=Bg(e.staticSeriesMeasureSources,r);if(n){var i=n.length;if(0===i)return[];for(var a=e.staticSeriesMeasureStartingIndex,o=[],s=0;s<i;s++)o.push(t[a+n[s].sourceIndex]);return o}}}(t,e,r);if(n||i){var a=k(t);return n?i?(u.assert(function(){return _.isEmpty(n)||_.isEmpty(i)},"At least one of the two arrays should be empty, because visual DataView should not have a mix of dynamic and static measures."),a.splice(0,a.length),a.push.apply(a,n||[]),a.push.apply(a,i||[])):(u.assertValue(e.dynamicSeriesGroupCount,"prototypeValueColumnsInfo.dynamicSeriesInstanceCount should have been populated if dynamic series measures got transformed"),u.assertValue(e.dynamicSeriesMeasureSources,"prototypeValueColumnsInfo.dynamicSeriesMeasureSources should have been populated if dynamic series measures got transformed"),a.splice.apply(a,Ee([0,e.dynamicSeriesMeasureSources.length*e.dynamicSeriesGroupCount],n||[],!1))):i&&(u.assertValue(e.staticSeriesMeasureSources,"prototypeValueColumnsInfo.staticSeriesMeasureSources should have been populated if static series measures got transformed"),u.assertValue(e.staticSeriesMeasureStartingIndex,"prototypeValueColumnsInfo.staticSeriesMeasureStartingIndex should have been populated if static series measures got transformed"),a.splice.apply(a,Ee([e.staticSeriesMeasureStartingIndex,e.staticSeriesMeasureSources.length],i||[],!1))),a}}(a||i,o,s)||a,a=function(t,e){if(u.assertValue(t,"prototypeValues"),u.assertAnyValue(e,"splitSelects"),e&&t.source&&!e[t.source.index]){var n=k(t);return n.source=void 0,n.identityFields=void 0,n}}(a||i,n)||a,a){var l=!!a.source,c=a.length>0,f=k(t);return l||c?(f.values=a,Lg(f)):f.values=void 0,f}}}(l||s,r,n,i),l&&((a=k(t)).categorical=l)}return a||t}(s,o,e.dataRoles,a,i)}(c,e,b,S,i),c=function(t,e,r,n,i,a,o){if(_.isEmpty(r)||!i)return t;var s=i&&i.roles;if(_.isEmpty(s)||o)return t;u.assertValue(t,"dataView"),u.assertValue(e,"targetDataViewKinds"),u.assertNonEmpty(n,"selectTransforms"),u.assertAnyValue(a,"expansionStates");var l=i.addDataViewFlags;if(u.assertValue(l,"addDataViewFlags"),!0!==(l.propertyIdentifier?ir(t.metadata.objects,l.propertyIdentifier,l.defaultValue):l.defaultValue))return t;var f=_.find(r,function(h){return h.matrix}),d=f&&f.matrix;if(d&&t.matrix&&ie(e,2)){var p=function(t,e,r,n,i,a,o){u.assertNonEmpty(n,"Expand/Collapse is not supported");var s=hn.fromMatrixRows(e.rows),l=i&&function(t,e){return u.assertValue(t,"ExpansionStates"),u.assertNonEmpty(e,"Empty roles"),_.find(t,function(r){return _.isEqual(r.roles,e)})}(i,s),c=function(t,e,r,n,i,a,o){if(u.assertAnyValue(i,"dataViewTransform.applyExpansionStatesToHierarchy - expansionState may not exist"),!_.some(e,function(v){return!_.includes(n,v)})){for(var s=0,l=function(g){_.some(e,function(y){return g.roles[y]})&&s++},c=0,f=r;c<f.length;c++)l(f[c]);if(s>0){(t=k(t)).levels=k(t.levels),u.assertValue(t.levels,"hierarchy.levels");for(var p=0;p<t.levels.length;p++)p<s-1&&(t.levels[p]=k(t.levels[p]),t.levels[p].canBeExpanded=!0);var h=gy(t.root,t.levels,i&&i.root,i&&i.levels,s);return h&&(t.root=h),o&&i&&function(t,e,r){u.assertValue(t,"hierarchy"),u.assertValue(e,"metadataColumns"),u.assertValue(r,"expansionState");var n=r.levels;if(!_.isEmpty(n)){for(var i={},a=0,o=e;a<o.length;a++){var s=o[a];i[s.queryName]=s}for(var l=new Array(n.length),c=t.levels,f=0,d=function(m){var S=m.queryRefs;if(!_.isEmpty(S)&&!_.isEmpty(c)&&c[f])for(var b=c[f].sources,E=function(D){u.assert(function(){return _.some(b,function(A){return A.queryName===D})},"ExpansionState levels should match matrix levels.")},C=0,w=S;C<w.length;C++)E(w[C]);l[f++]={isCollapsed:m.isCollapsed,isPinned:m.isPinned,isLocked:m.isLocked,AIInformation:_.cloneDeep(m.AIInformation),sources:_.map(S,function(V){return i[V]})}},p=0,h=n;p<h.length;p++)d(h[p]);var g=yy(r.root,l,void 0,mt.getPrimitiveValuesFromSQConstantExpr);t.expansionStates=[{levels:l,root:g}]}}(t,a,i),t}}}(t.rows,s,r,n,l,a,o);if(c)return(t=k(t)).rows=c,t}(t.matrix,d,n,s,a,t.metadata.columns,i.addDataViewExpansionState);p&&((t=k(t)).matrix=p)}return t}(c,f,d,p,h,e.transforms.expansionStates,!!m),c=function(t){var e=t.table;if(e&&1===e.columns.length&&e.columns[0].isMeasure&&1===e.rows.length&&1===e.rows[0].length){var n=e.rows[0];return t.single={column:e.columns[0],value:n[0]},n.objects&&(t.single.objects=n.objects[0]),t}return t}(c=function(t,e){u.assertValue(t,"prototype"),u.assertValue(e,"quarterPrefix");var r=t.categorical;if(!r||_.isEmpty(r.categories))return t;var n=r.categories,i=function(t,e){var r;if(t&&(r=t.objects),!_.isEmpty(r)){for(var n=void 0,i=r.length,a=0;a<i;a++){var s=ir(r[a],e);void 0!==s&&(n||(n={values:new Array(i)}),n.values[a]={min:s})}return n}}(n[0],zg);if(!i||_.isEmpty(i.values))return t;for(var a,o,s,c,l=[],f=0,d=n.length;f<d;f++)for(var p=n[f],h=p.source.type,v=p.values,g=void 0,y=void 0,m=0,S=_.size(v);m<S;m++){var E=i.values[m];if(null==v[m]&&null!=E){a||(o=(a=k(t)).categorical=k(r),s=o.categories=k(n)),g||(y=(g=s[f]=k(p)).values=k(v));var C=hP(E.min,h,e);y[m]=C,l[m]||(c||(c=m),l[m]=[]),l[m][f]=on(C,h)}}var w=function(V,D){for(var A=s[V],P=function(le,ce){var Y=l[le];Y&&(u.assert(function(){return Y.length===A.identityFields.length},"category values must match category identities"),A.identity[le]=Et(Ci(A.identityFields,Y)))},F=c,N=_.size(A.identity);F<N;F++)P(F)};for(f=0,d=_.size(s);f<d;f++)w(f);return a||t}(c,fy_quarterPrefix)),a||(c=rP(c,v,e.applicableRoleMappings,e.projectionActiveItems,Cc(e.drillCapabilities,m))),PP({dataview:c,dataViewMappings:d,dataRoles:e.dataRoles}),c.metadata&&!(null===(l=null==e?void 0:e.transforms)||void 0===l)&&l.isDataFilterApplied&&(c.metadata.isDataFilterApplied=!0),y&&c.metadata&&(y.drillableRoles&&(c.metadata.dataRoles||(c.metadata.dataRoles={}),c.metadata.dataRoles.drillableRoles=y.drillableRoles),void 0!==m&&(c.metadata.dataRoles||(c.metadata.dataRoles={}),c.metadata.dataRoles.isDrillDisabled=m)),c}function py(t,e){return u.assertValue(t,"prototypeColumn"),u.assertValue(e,"select"),hy(e,ve(t))}function hy(t,e){return t.roles&&(e.roles=t.roles),t.type&&(e.type=t.type),e.format=function(t,e){return t.format||e.format}(t,e),t.displayName&&(e.displayName=t.displayName),t.queryName&&(e.queryName=t.queryName),t.expr&&(e.expr=t.expr),t.sourceFieldParameters&&(e.sourceFieldParameters=t.sourceFieldParameters),t.kpi&&t.kpi.graphic&&(e.kpi=t.kpi),t.sort&&(e.sort=t.sort),null!=t.sortOrder&&(e.sortOrder=t.sortOrder),t.discourageAggregationAcrossGroups&&(e.discourageAggregationAcrossGroups=t.discourageAggregationAcrossGroups),t.parameter&&(e.parameter=t.parameter),t.relatedObjects&&(e.relatedObjects=t.relatedObjects),e}function YF(t,e,r){u.assertValue(t,"columns"),u.assertValue(e,"selectIdx"),u.assertValue(r,"select");for(var n=0,i=t;n<i.length;n++){var a=i[n];if(a.index===e&&void 0===a.groupName)return a}var o=py({displayName:r.displayName},r);return t.push(o),o}function vy(t,e,r,n,i){u.assertValue(e,"evalContext"),u.assertValue(r,"selects"),u.assertValue(n,"type"),u.assertValue(i,"source");var a=r[i.index];if(a)return t.evaluateValue(e,a.expr,n)}function Uo(t,e){var r=_.find(e,function(n){return n.from===t});if(r)return r.to}function bc(t,e,r){return t||(t=ve(e)),r&&r(t),t}function gy(t,e,r,n,i){if(!t.isSubtotal&&t.level!==i-1){var a=!1;if(void 0!==t.level){if(t=k(t),n){var s=n[t.level];t.isCollapsed=!!(+!(!s||!s.isCollapsed)^+!(!r||!r.isToggled))}else t.isCollapsed=_.isEmpty(t.children)||1===t.children.length&&!!t.children[0].isSubtotal;a=!0}if(!_.isEmpty(t.children))for(var c=function(p){var h=t.children[p],v=h.identity,g=v&&to(v.expr),y=g&&_.find(r&&r.children,function(S){return Ae(S.identityValues,g,j)}),m=gy(h,e,y,n,i);m&&((t=k(t)).children=k(t.children),t.children[p]=m,a=!0)},f=0;f<t.children.length;f++)c(f);return a?t:void 0}u.assert(function(){return _.isEmpty(t.children)},"Leaf node with children")}function yy(t,e,r,n){if(t){var a,o,i=t.identityValues;if(_.isEmpty(i)||(a=_.map(i,n)),!_.isEmpty(t.children)){var s=t.children;o=new Array(s.length);for(var l=0,c=0,f=s;c<f.length;c++){var p=yy(f[c],e,void 0===r?0:r+1,n);o[l++]=p}}return{isExpanded:void 0===r?void 0:!!e[r].isCollapsed==!!t.isToggled,values:a,children:o}}}function dR(t,e){if(t&&e&&e.bind)return t[e.bind.to]}function Ec(t,e){if(t&&e&&e.for)return t[e.for.in]}function my(t,e){if(t&&e&&e.group)return t[e.group.by]}function Cc(t,e){var r;return e?[]:null!==(r=null==t?void 0:t.roles)&&void 0!==r?r:[]}function Mc(){return"undefined"!=typeof moment}function Oo(t){var e=function(t){if(t){var e=t.length;if(!(e<=18||e>28)){var r=t[10];if("-"===t[4]&&"-"===t[7]&&("T"===r||" "===r)&&":"===t[13]&&":"===t[16]){var n=Ut(t,0,4),i=Ut(t,5,2),a=Ut(t,8,2),o=Ut(t,11,2),s=Ut(t,14,2),l=Ut(t,17,2),c="Z"===t.charAt(e-1);c&&e--;var f=0;if(e>19){if("."!==t[19])return;var d=e-20,p=Ut(t,20,d);if(null===p)return;f=p*vr(3-d)}if(null!==n&&null!==i&&null!==a&&null!==o&&null!==s&&null!==l&&null!==f)return c?new Date(Date.UTC(n,i-1,a,o,s,l,f)):function(t,e,r,n,i,a,o){void 0===e&&(e=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0);var s=new Date(t,e,r,n,i,a,o);return s.epochTimeStamp=Date.UTC(t,e,r,n,i,a,o),s}(n,i-1,a,o,s,l,f)}}}}(t);if(e)return e;u.assert(function(){return Mc()},"Moment.js should be loaded for non-fast parseIsoDate.");var r=moment(t);return r.isValid()?r.toDate():null}var yR=/''/g,Sy="base64'",mR=/\.000'$/;function by(t){return zo(t)}function xc(t){return zo(t,!0)}function Dc(t,e){if(u.assert(function(){return void 0!==t},"Undefined dsrValue indicates a DSR parsing bug"),null===t)return null;switch(e){case 4:return u.assert(function(){return"string"==typeof t||"number"==typeof t},"Expected only string or number values for type ".concat(e)),"number"==typeof t?t:parseInt(t,10);case 2:case 3:return u.assert(function(){return"string"==typeof t||"number"==typeof t},"Expected only string or number values for type ".concat(e)),"number"==typeof t?t:_c(t);case 7:case 6:if(u.assert(function(){return"string"==typeof t||"number"==typeof t},"Expected only string or number values for type ".concat(e)),"number"==typeof t){u.assert(function(){return t>=0},"Expected positive miliseconds since UNIX epoch for type ".concat(e));var r=new Date(t),n=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds()),i=new Date(r.getTime()+6e4*n.getTimezoneOffset());return i.epochTimeStamp=t,i}var a=Oo(t);return a&&Gs(a);case 1:return u.assert(function(){return"string"==typeof t},"Expected only string values for type ".concat(e)),t;case 5:return u.assert(function(){return"number"==typeof t||"boolean"==typeof t},"Expected number or boolean values for type ".concat(e)),"number"==typeof t?1===t:t;case 13:return u.assert(function(){return"string"==typeof t||"boolean"==typeof t},"Expected only string or boolean values for type ".concat(e)),zo(t);default:u.assertFail("unsupported dsrValue for type ".concat(e))}}function Ac(t,e,r){if(null===t)return Lt();switch(r){case 4:return"number"==typeof e?kn(+t):Ai(260,+t,e.toString());case 2:return"number"==typeof e?eo(+t):Ai(258,+t,e.toString());case 3:return"number"==typeof e?an(+t):Ai(259,+t,e.toString());case 7:case 6:return"number"==typeof e?new Fe(L.fromExtendedType(519),t):Ai(519,t,e.toString());case 1:return Ce(t.toString());case 5:return Zt(!!t);case 13:return zo(e,!0);default:u.assertFail("unsupported dsrValue for type ".concat(r))}}function zo(t,e){var r=typeof t;if("string"===r){if(_.endsWith(t,"L")){var n=parseInt(t,10);return e?kn(n,t):n}if(_.endsWith(t,"D")){var i=_c(t);return e?an(i,t):i}if(_.endsWith(t,"M")){var a=_c(t);return e?eo(a,t):a}if(_.endsWith(t,"'")){if("'"===t.charAt(0)){var o=t.substring(1,t.length-1).replace(yR,"'");return e?Ce(o,t):o}if(0===t.indexOf("datetime'")){var s=t.replace(mR,"'"),c=Oo(t.substring(9,s.length-1));return e?er(c,s):c}}if("null"===t)return e?Lt():null;if("true"===t)return!e||Zt(!0);if("false"===t)return!!e&&Zt(!1)}return"boolean"===r?e?Zt(t):t:null===t?e?Lt():null:t}function _c(t){var e=parseFloat(t);return isNaN(e)?parseFloat(t.replace("INF","Infinity")):e}var Ey=function(){function t(e){u.assertValue(e,"from"),this.clauses={from:e,select:[]}}return t.prototype.addWhere=function(e){u.assertValue(e,"filter");var r=this.clauses;r.where||(r.where=[]),r.where.push(e)},t.prototype.addWheres=function(e){u.assertValue(e,"filters");var r=this.clauses;r.where||(r.where=[]);for(var n=0,i=e;n<i.length;n++)r.where.push(i[n])},t.prototype.addOrderBy=function(e){u.assertValue(e,"sort");var r=this.clauses;r.orderBy||(r.orderBy=[]),r.orderBy.push(e)},t.prototype.addSelect=function(e){u.assertValue(e,"select"),this.clauses.select.push(e)},t.prototype.addGroupBy=function(e){u.assertValue(e,"groupBy");var r=this.clauses;r.groupBy||(r.groupBy=[]),r.groupBy.push(e)},t.prototype.addTransform=function(e){u.assertValue(e,"transformItem");var r=this.clauses;r.transforms||(r.transforms=[]),r.transforms.push(e)},t.prototype.setTop=function(e){this.clauses.top=e},t.prototype.toQuery=function(){return Vd.createWith(this.clauses,!0)},t.prototype.toFilter=function(){var e=this.clauses;if(u.assert(function(){return!e.orderBy&&0===e.select.length},"toFilter must not have orderBy/select specified."),e.from&&e.where)return new Qe(e.from,e.where)},t}(),yn=function(t){return t[t.Version0=0]="Version0",t[t.Version1=1]="Version1",t[t.Version2=2]="Version2",t}({}),Q=function(){function t(){}return t.serializeQuery=function(e,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1),u.assertValue(e,"query");var i=[],a=e.from();this.serializeFrom(a,i);var s,o=this.serializeQueryFilters(e.where(),ur.create,!1),l=e.transforms();if(!_.isEmpty(l)){s=[];for(var c=0,f=l;c<f.length;c++){var d=f[c],p=_.map(d.input.parameters,function(V){return ur.createNamed(V,r)}),h={Name:d.name,Algorithm:d.algorithm,Input:{Parameters:p},Output:void 0};if(d.input.table){var v=this.serializeTransformTableColumns(d.input.table.columns);h.Input.Table={Name:d.input.table.name,Columns:v}}if(d.output&&d.output.table){var g=this.serializeTransformTableColumns(d.output.table.columns);h.Output={Table:{Name:d.output.table.name,Columns:g}}}s.push(h)}}for(var y=this.serializeSortDefinitions(e.orderBy(),r),m=[],S=e.select(),b=0,E=S.length;b<E;b++)m.push(ur.createNamed(S[b],r,n));var C,w=e.groupBy();if(w&&w.length)for(C=[],b=0,E=w.length;b<E;b++)C.push(ur.createNamed(w[b],r));var M={Version:yn.Version2,From:i,Select:m};return o&&(M.Where=o),s&&(M.Transform=s),y&&(M.OrderBy=y),C&&(M.GroupBy=C),e.top()&&(M.Top=e.top()),M},t.serializeSortDefinitions=function(e,r){var n;if(e&&e.length){n=[];for(var i=0,a=e.length;i<a;i++){var o=e[i];n.push({Direction:o.direction,Expression:ur.create(o.expr,r)})}}return n},t.tryDeserializeQuery=function(e){var r;try{r=this.deserializeQuery(e)}catch(n){}if(r&&!this.isMalformed(r))return r},t.isMalformed=function(e){for(var r=0,n=e.select();r<n.length;r++)if(!n[r].expr)return!0;return!1},t.serializeQueryFilters=function(e,r,n){var i;if(!_.isEmpty(e)){i=[];for(var a=0,o=e;a<o.length;a++){var s=o[a],l={Condition:r(s.condition,n)};if(!_.isEmpty(s.target)){l.Target=[];for(var c=0,f=s.target;c<f.length;c++)l.Target.push(r(f[c],n))}s.annotations&&(l.Annotations=s.annotations),i.push(l)}}return i},t.deserializeQuery=function(e){u.assertValue(e,"contract");var r=e.Version?e.Version:yn.Version0,n=r<yn.Version1,i=Ft.from(e.From),a=new Ey(i),o=e.Where;if(o)for(var s=0,l=o.length;s<l;s++){var c=Ft.filter(o[s],i);c&&(n&&(c=Cy.Upgrade(r,c)),a.addWhere(c))}var f=e.Transform,d=i;if(!_.isEmpty(f)){for(var p={},v=0,g=i.keys();v<g.length;v++){var y=g[v];p[y]=i.source(y)}for(s=0,l=f.length;s<l;s++){var m;f[s].Input&&f[s].Input.Table&&(p[m=f[s].Input.Table.Name]=new Ei(void 0,m)),f[s].Output&&f[s].Output.Table&&(p[m=f[s].Output.Table.Name]=new Ei(void 0,m))}for(d=new $r(p),s=0,l=f.length;s<l;s++)a.addTransform(Ft.transform(f[s],d))}var S=e.OrderBy;if(S)for(s=0,l=S.length;s<l;s++)a.addOrderBy(Ft.sort(S[s],i));var b=e.Select,E={};for(s=0,l=b.length;s<l;s++)a.addSelect(Ft.select(b[s],E,d));var C=e.GroupBy;if(C){var w={};for(s=0,l=C.length;s<l;s++)a.addGroupBy(Ft.groupBy(C[s],w,i))}return e.Top&&a.setTop(e.Top),a.toQuery()},t.deserializeSortDefinitions=function(e,r){return _.isEmpty(e)?[]:_.map(e,function(n){return Ft.sort(n,r)})},t.serializeFilter=function(e){var r=[],n=e.from();this.serializeFrom(n,r);var i=this.serializeQueryFilters(e.where(),ur.create,!1);return{Version:yn.Version2,From:r,Where:i}},t.serializeFrom=function(e,r){for(var n=e.keys(),i=new bR(e),a=0,o=n.length;a<o;a++)r.push(e.source(n[a]).accept(i,a))},t.deserializeFrom=function(e){return Ft.from(e)},t.deserializeFilter=function(e,r){u.assertValue(e,"contract");var n=e.Version?e.Version:yn.Version0,i=n<yn.Version1,a=Ft.from(e.From),o=new Ey(a),s=e.Where;if(s)for(var l=0,c=s.length;l<c;l++){var f=Ft.filter(s[l],a);f?(i&&(f=Cy.Upgrade(n,f)),o.addWhere(f)):r&&(_.isEmpty(r.RemovedIndexes)&&(r.RemovedIndexes=[]),r.RemovedIndexes.push(l))}return o.toFilter()},t.serializeExpr=function(e,r){return void 0===r&&(r=!1),u.assertValue(e,"contract"),u.assertValue(r,"serializeAnnotations"),ur.create(e,!0,r)},t.serializeExprWithRef=function(e,r){return void 0===r&&(r=!1),u.assertValue(e,"contract"),u.assertValue(r,"serializeAnnotations"),ur.create(e,!1,r)},t.deserializeExpr=function(e){return u.assertValue(e,"input"),qo(e)},t.deserializeExprWithRef=function(e,r){return u.assertValue(e,"input"),G(e,r)},t.serializeTransformTableColumns=function(e){return u.assertValue(e,"columns"),_.map(e,function(r){var n={Expression:ur.createNamed(r.expression)};return r.role&&(n.Role=r.role),n})},t}(),Ft=function(){function t(){}return t.from=function(e){u.assertValue(e,"contract");var r={};if(e)for(var n=0,i=e.length;n<i;n++){var a=e[n];switch(a.Type){case 2:r[a.Name]=a.Expression.Subquery?new Er(Q.deserializeQuery(a.Expression.Subquery.Query)):new fu(CR(a.Expression));break;case 1:r[a.Name]=new bd(a.Schema,a.Entity);break;default:r[a.Name]=new Ei(a.Schema,a.Entity)}}return new $r(r)},t.filter=function(e,r){u.assertValue(e,"contract");var n=r?G(e.Condition,r):qo(e.Condition);if(n){var i={condition:n};if(e.Target){i.target=[];for(var a=0,o=e.Target;a<o.length;a++){var s=o[a],l=r?G(s,r):qo(s);if(!l)return;i.target.push(l)}}return e.Annotations&&(i.annotations=e.Annotations),i}},t.sort=function(e,r){return u.assertValue(e,"contract"),{direction:e.Direction,expr:G(e.Expression,r)}},t.select=function(e,r,n){return t.toNamedQueryExpression(e,r,n)},t.groupBy=function(e,r,n){return t.toNamedQueryExpression(e,r,n)},t.transform=function(e,r){var n=_.map(e.Input.Parameters,function(s){return t.toNamedQueryExpression(s,{},r)}),i={name:e.Name,algorithm:e.Algorithm,input:{parameters:n},output:{}};if(e.Input.Table){var a=this.deserializeTransformTableColumns(e.Input.Table.Columns,r);i.input.table={name:e.Input.Table.Name,columns:a}}if(e.Output&&e.Output.Table){var o=this.deserializeTransformTableColumns(e.Output.Table.Columns,r);i.output.table={name:e.Output.Table.Name,columns:o}}return i},t.toNamedQueryExpression=function(e,r,n){u.assertValue(e,"contract"),u.assertValue(n,"from");var i=G(e,n),a=e.Name||xa(r,wd(i));r[a]=!0;var o={name:a,expr:i};return e.NativeReferenceName&&(o.nativeReferenceName=e.NativeReferenceName),o},t.deserializeTransformTableColumns=function(e,r){u.assertValue(e,"columns");var n={};return _.map(e,function(i){return{role:i.Role,expression:t.toNamedQueryExpression(i.Expression,n,r)}})},t}(),bR=function(){function t(e){this.from=e}return t.prototype.visitEntity=function(e,r){return{Name:this.from.keys()[r],Entity:e.entity,Schema:e.schema,Type:0}},t.prototype.visitPod=function(e,r){return{Name:this.from.keys()[r],Entity:e.pod,Schema:e.schema,Type:1}},t.prototype.visitSubquery=function(e,r){return{Name:this.from.keys()[r],Expression:{Subquery:{Query:Q.serializeQuery(e.subquery)}},Type:2}},t.prototype.visitExpr=function(e,r){return{Name:this.from.keys()[r],Expression:Q.serializeExpr(e.expr),Type:2}},t}(),ur=function(){function t(e,r){this.standalone=e,this.serializeAnnotations=r}return t.getInstance=function(e,r){e||(e=!1),r||(r=!1);var n=[+e,+r].reduce(function(a,o){return a<<1|o}),i=t.instances[n];return i||(i=new t(e,r)),i},t.create=function(e,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!1),e.accept(t.getInstance(r,n))},t.createNamed=function(e,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1);var i=t.getInstance(r,n),a=e.expr.accept(i);return e.name&&(a.Name=e.name),e.nativeReferenceName&&(a.NativeReferenceName=e.nativeReferenceName),a},t.prototype.visitColumnRef=function(e){return this.addAnnotations(e,{Column:{Expression:e.source.accept(this),Property:e.ref}})},t.prototype.visitMeasureRef=function(e){return this.addAnnotations(e,{Measure:{Expression:e.source.accept(this),Property:e.ref}})},t.prototype.visitNativeMeasure=function(e){var r={Language:e.language,Expression:e.expression,DataType:e.dataType};e.proposedName&&(r.ProposedName=e.proposedName),e.format&&(r.Format=e.format);var n=e.expressionContentCache;return!n||!n.dependencies&&null==n.unrecognizedIdentifiers?{NativeMeasure:r}:(r.ExpressionContentCache={},n.dependencies&&(r.ExpressionContentCache.Dependencies=this.serializeAll(n.dependencies)),null!=n.unrecognizedIdentifiers&&(r.ExpressionContentCache.UnrecognizedIdentifiers=n.unrecognizedIdentifiers),this.addAnnotations(e,{NativeMeasure:r}))},t.prototype.visitNativeColumn=function(e){var r={Language:e.language,Expression:e.expression,DataType:e.dataType,Source:e.source.accept(this)};e.proposedName&&(r.ProposedName=e.proposedName),e.format&&(r.Format=e.format);var n=e.expressionContentCache;return!n||!n.dependencies&&null==n.unrecognizedIdentifiers||(r.ExpressionContentCache={},n.dependencies&&(r.ExpressionContentCache.Dependencies=this.serializeAll(n.dependencies)),null!=n.unrecognizedIdentifiers&&(r.ExpressionContentCache.UnrecognizedIdentifiers=n.unrecognizedIdentifiers)),this.addAnnotations(e,{NativeColumn:r})},t.prototype.visitAggr=function(e){if(!_.isNil(e.includeAllTypes))switch(e.func){case 3:return this.addAnnotations(e,{Min:{Expression:e.arg.accept(this),IncludeAllTypes:e.includeAllTypes}});case 4:return this.addAnnotations(e,{Max:{Expression:e.arg.accept(this),IncludeAllTypes:e.includeAllTypes}})}return this.addAnnotations(e,{Aggregation:{Expression:e.arg.accept(this),Function:e.func}})},t.prototype.visitPercentile=function(e){var r=this.addAnnotations(e,{Percentile:{Expression:e.arg.accept(this),K:e.k}});return e.exclusive&&(r.Percentile.Exclusive=e.exclusive),r},t.prototype.visitRangePercent=function(e){return this.addAnnotations(e,{RangePercent:{Min:e.min.accept(this),Max:e.max.accept(this),Percent:e.percent}})},t.prototype.visitHierarchy=function(e){return this.addAnnotations(e,{Hierarchy:{Expression:e.arg.accept(this),Hierarchy:e.hierarchy}})},t.prototype.visitPropertyVariationSource=function(e){var r=e.arg.accept(this);return this.addAnnotations(e,{PropertyVariationSource:{Expression:{SourceRef:r.SourceRef},Name:e.name,Property:e.property}})},t.prototype.visitHierarchyLevel=function(e){return this.addAnnotations(e,{HierarchyLevel:{Expression:e.arg.accept(this),Level:e.level}})},t.prototype.visitSelectRef=function(e){return u.assert(function(){return void 0===e.attributeKind||null==e.attributeKind},"Serialization of expr.attributeKind is not supported."),this.addAnnotations(e,{SelectRef:{ExpressionName:e.expressionName}})},t.prototype.visitBetween=function(e){return this.addAnnotations(e,{Between:{Expression:e.arg.accept(this),LowerBound:e.lower.accept(this),UpperBound:e.upper.accept(this)}})},t.prototype.visitIn=function(e){var r=this.serializeAll(e.args),n=e.values;if(n){for(var i=[],a=0,o=n.length;a<o;a++)i.push(this.serializeAll(n[a]));return this.addAnnotations(e,{In:{Expressions:r,Values:i}})}return this.addAnnotations(e,{In:{Expressions:this.serializeAll(e.args),Table:e.table.accept(this)}})},t.prototype.visitEntity=function(e){var r;return u.assertValue(e,"expr"),this.standalone?r={Schema:e.schema,Entity:e.entity}:(u.assertValue(e.variable,"expr.variable"),r={Source:e.variable}),this.addAnnotations(e,{SourceRef:r})},t.prototype.visitSubqueryRef=function(e){return u.assertValue(e,"expr"),e.variable&&!e.query?this.addAnnotations(e,{SourceRef:{Source:e.variable}}):this.standalone?this.addAnnotations(e,{Subquery:{Query:Q.serializeQuery(e.query,!1,this.serializeAnnotations)}}):void u.assertFail("The inlined subquery is only expected to be there in standalone mode.")},t.prototype.visitNamedQueryRef=function(e){return this.standalone?this.addAnnotations(e,{NamedQueryReference:{Name:e.queryName}}):(u.assertValue(e.variable,"expr.variable"),this.addAnnotations(e,{SourceRef:{Source:e.variable}}))},t.prototype.visitAnd=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{And:{Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitOr=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Or:{Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitCompare=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Comparison:{ComparisonKind:e.comparison,Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitConditional=function(e){var r=this;u.assertValue(e,"expr");var n=this.addAnnotations(e,{Conditional:{Cases:_.map(e.cases,function(a){return r.visitCase(a)})}}),i=e.defaultValue;return i&&(n.Conditional.DefaultValue=i.accept(this)),n},t.prototype.visitCase=function(e){return{Condition:e.condition.accept(this),Value:e.value.accept(this)}},t.prototype.visitContains=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Contains:{Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitDateAdd=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{DateAdd:{Expression:e.arg.accept(this),Amount:e.amount,TimeUnit:e.unit}})},t.prototype.visitDateSpan=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{DateSpan:{Expression:e.arg.accept(this),TimeUnit:e.unit}})},t.prototype.visitExists=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Exists:{Expression:e.arg.accept(this)}})},t.prototype.visitNot=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Not:{Expression:e.arg.accept(this)}})},t.prototype.visitNow=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Now:{}})},t.prototype.visitDefaultValue=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{DefaultValue:{}})},t.prototype.visitAnyValue=function(e){u.assertValue(e,"expr");var r={};return null!=e.defaultValueOverridesAncestors&&(r.DefaultValueOverridesAncestors=e.defaultValueOverridesAncestors),this.addAnnotations(e,{AnyValue:r})},t.prototype.visitFillRule=function(e){u.assertValue(e,"expr");var r={},n=e.rule;return n.linearGradient2&&(r.linearGradient2=this.visitLinearGradient2(n.linearGradient2)),n.linearGradient3&&(r.linearGradient3=this.visitLinearGradient3(n.linearGradient3)),this.addAnnotations(e,{FillRule:{Input:e.input.accept(this),FillRule:r}})},t.prototype.visitLinearGradient2=function(e){u.assertValue(e,"visitLinearGradient2 - gradient");var r={min:this.visitRuleStop(e.min),max:this.visitRuleStop(e.max)},n=this.visitNullColoringStrategy(e.nullColoringStrategy);return n&&(r.nullColoringStrategy=n),r},t.prototype.visitLinearGradient3=function(e){u.assertValue(e,"visitLinearGradient3 - gradient");var r={min:this.visitRuleStop(e.min),mid:this.visitRuleStop(e.mid),max:this.visitRuleStop(e.max)},n=this.visitNullColoringStrategy(e.nullColoringStrategy);return n&&(r.nullColoringStrategy=n),r},t.prototype.visitRuleStop=function(e){u.assertValue(e,"stop");var r={color:e.color.accept(this)};return e.value&&(r.value=e.value.accept(this)),r},t.prototype.visitNullColoringStrategy=function(e){if(e){u.assertValue(e.strategy,"visitNullColoringStrategy - input.strategy");var r={strategy:e.strategy.accept(this)};return e.color&&(r.color=e.color.accept(this)),r}},t.prototype.visitThemeDataColor=function(e){return this.addAnnotations(e,{ThemeDataColor:{ColorId:e.colorId,Percent:e.percent}})},t.prototype.visitStartsWith=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{StartsWith:{Left:e.left.accept(this),Right:e.right.accept(this)}})},t.prototype.visitGroupRef=function(e){var r=this;return u.assertValue(e,"expr"),this.addAnnotations(e,{GroupRef:{Expression:e.source.accept(this),Property:e.ref,GroupedColumns:_.map(e.groupedExprs,function(n){return n.accept(r)})}})},t.prototype.visitConstant=function(e){switch(u.assertValue(e,"expr"),e.type.primitiveType){case 5:case 7:case 2:case 4:case 3:case 0:case 1:return this.addAnnotations(e,{Literal:{Value:e.valueEncoded}});default:u.assertFail("Unrecognized kind: "+e.type.primitiveType)}},t.prototype.visitArithmetic=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{Arithmetic:{Left:e.left.accept(this),Right:e.right.accept(this),Operator:e.operator}})},t.prototype.visitFloor=function(e){u.assertValue(e,"expr");var r=this.addAnnotations(e,{Floor:{Expression:e.arg.accept(this),Size:e.size}});return null!=e.timeUnit&&(r.Floor.TimeUnit=e.timeUnit),r},t.prototype.visitResourcePackageItem=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{ResourcePackageItem:{PackageName:e.packageName,PackageType:e.packageType,ItemName:e.itemName}})},t.prototype.visitScopedEval=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{ScopedEval:{Expression:e.expression.accept(this),Scope:this.serializeAll(e.scope)}})},t.prototype.visitFilteredEval=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{FilteredEval:{Expression:e.expression.accept(this),Filters:Q.serializeQueryFilters(e.filters,t.create,this.standalone)}})},t.prototype.visitWithRef=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{WithRef:{ExpressionName:e.expressionName}})},t.prototype.visitTransformTableRef=function(e){return this.addAnnotations(e,{TransformTableRef:{Source:e.source}})},t.prototype.visitTransformOutputRoleRef=function(e){return this.addAnnotations(e,{TransformOutputRoleRef:{Role:e.role,Transform:e.transform}})},t.prototype.visitRoleRef=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{RoleRef:{Role:e.role}})},t.prototype.visitSummaryValueRef=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{SummaryValueRef:{Name:e.name}})},t.prototype.visitAllRolesRef=function(e){return u.assertValue(e,"expr"),this.addAnnotations(e,{AllRolesRef:{}})},t.prototype.visitDiscretize=function(e){return this.addAnnotations(e,{Discretize:{Expression:e.source.accept(this),Count:e.count}})},t.prototype.visitMember=function(e){return this.addAnnotations(e,{Member:{Expression:e.source.accept(this),Member:e.member}})},t.prototype.visitSparklineData=function(e){var r={SparklineData:{Measure:e.measure.accept(this),Groupings:this.serializeAll(e.grouping),PointsPerSparkline:e.pointsPerSparkline}};return e.scalarKey&&(r.SparklineData.ScalarKey=e.scalarKey.accept(this)),e.includeMinGroupingInterval&&(r.SparklineData.IncludeMinGroupingInterval=e.includeMinGroupingInterval),r},t.prototype.serializeAll=function(e){for(var r=[],n=0,i=e.length;n<i;n++)r.push(e[n].accept(this));return r},t.prototype.visitNativeVisualCalc=function(e,r){return this.addAnnotations(e,{NativeVisualCalculation:{Language:e.language,Expression:e.expression,Name:e.name}})},t.prototype.addAnnotations=function(e,r){if(this.serializeAnnotations){var n=e.getAnnotations();n&&(r.Annotations=n)}return r},t.instances=[],t}(),Cy=function(){function t(){}return t.Upgrade=function(e,r){if(!r||!r.condition)return null;var n=lu(r.condition);return e===yn.Version0&&2!==n?{condition:r.condition}:r},t}();function G(t,e){return u.assertValue(t,"contract"),function(t,e){if(t.Column){var r=G(t.Column.Expression,e);if(r)return Re(r,t.Column.Property,t.Annotations)}}(t,e)||function(t,e){if(t.Measure){var r=G(t.Measure.Expression,e);if(r)return mu(r,t.Measure.Property,t.Annotations)}}(t,e)||function(t,e){if(t.NativeMeasure){var r=void 0;return t.NativeMeasure.ExpressionContentCache&&(r={unrecognizedIdentifiers:t.NativeMeasure.ExpressionContentCache.UnrecognizedIdentifiers,dependencies:mn(t.NativeMeasure.ExpressionContentCache.Dependencies)}),"dax"!==t.NativeMeasure.Language&&u.assertFail("QueryNativeMeasure is using unexpected language: "+t.NativeMeasure.Language),cp(t.NativeMeasure.Language,t.NativeMeasure.Expression,t.NativeMeasure.DataType,t.NativeMeasure.ProposedName,r,t.NativeMeasure.Format,t.Annotations)}}(t)||function(t,e){if(t.NativeColumn){var r=void 0;if(t.NativeColumn.ExpressionContentCache&&(r={unrecognizedIdentifiers:t.NativeColumn.ExpressionContentCache.UnrecognizedIdentifiers,dependencies:mn(t.NativeColumn.ExpressionContentCache.Dependencies)}),"dax"!==t.NativeColumn.Language)return void u.assertFail("QueryNativeColumn is using unexpected language: "+t.NativeColumn.Language);if(!t.NativeColumn.Source)return void u.assertFail("QueryNativeColumn should have a source");var n=G(t.NativeColumn.Source,e);return fp(t.NativeColumn.Language,t.NativeColumn.Expression,t.NativeColumn.DataType,n,t.NativeColumn.ProposedName,r,t.NativeColumn.Format,t.Annotations)}}(t,e)||function(t,e){if(t.SourceRef){if(!e){var a=t.SourceRef;return je(a.Schema,a.Entity,void 0,t.Annotations)}var n=t.SourceRef.Source,i=e.source(n);if(i)return ka(i)?je(i.schema,i.entity,n,t.Annotations):du(i)?je(i.schema,i.pod,n):Yr(i)?rn(n,t.Annotations):(u.assert(function(){return La(i)},"Expected an ExpressionSource"),i.expr.as(n))}}(t,e)||function(t,e){if(t.Aggregation){var r=G(t.Aggregation.Expression,e);if(r)return Xt(r,t.Aggregation.Function,void 0,t.Annotations)}}(t,e)||function(t,e){if(t.Min){var r=G(t.Min.Expression,e);if(r)return Xt(r,3,t.Min.IncludeAllTypes,t.Annotations)}}(t,e)||function(t,e){if(t.Max){var r=G(t.Max.Expression,e);if(r)return Xt(r,4,t.Max.IncludeAllTypes,t.Annotations)}}(t,e)||function(t,e){if(t.SelectRef)return wi(t.SelectRef.ExpressionName,void 0,t.Annotations)}(t)||function(t,e){if(t.Percentile){var r=G(t.Percentile.Expression,e);if(r)return Su(r,t.Percentile.K,t.Percentile.Exclusive||!1,t.Annotations)}}(t,e)||function(t,e){if(t.RangePercent){var r=G(t.RangePercent.Min,e),n=G(t.RangePercent.Max,e);if(r&&n)return dp(r,n,t.RangePercent.Percent,t.Annotations)}}(t,e)||function(t,e){if(t.Arithmetic){var r=G(t.Arithmetic.Left,e),n=G(t.Arithmetic.Right,e);if(r&&n)return Vi(r,n,t.Arithmetic.Operator,t.Annotations)}}(t,e)||function(t,e){if(t.Floor){var r=G(t.Floor.Expression,e);if(r)return pp(r,t.Floor.Size,t.Floor.TimeUnit,t.Annotations)}}(t,e)||function(t,e){if(t.Discretize){var r=G(t.Discretize.Expression,e);if(r)return Cp(r,t.Discretize.Count,t.Annotations)}}(t,e)||function(t,e){if(t.Member){var r=G(t.Member.Expression,e);if(r)return wp(r,t.Member.Member,t.Annotations)}}(t,e)||function(t,e){if(t.Hierarchy){var r=G(t.Hierarchy.Expression,e);if(r)return Mi(r,t.Hierarchy.Hierarchy,t.Annotations)}}(t,e)||function(t,e){if(t.HierarchyLevel){var r=G(t.HierarchyLevel.Expression,e);if(r)return $a(r,t.HierarchyLevel.Level,t.Annotations)}}(t,e)||function(t,e){if(t.PropertyVariationSource){var r=G(t.PropertyVariationSource.Expression,e);if(r)return Ya(r,t.PropertyVariationSource.Name,t.PropertyVariationSource.Property,t.Annotations)}}(t,e)||function(t,e){if(t.And){var r=G(t.And.Left,e),n=G(t.And.Right,e);if(r&&n)return st(r,n,t.Annotations)}}(t,e)||function(t,e){if(t.Between){var r=G(t.Between.Expression,e),n=G(t.Between.LowerBound,e),i=G(t.Between.UpperBound,e);if(r&&n&&i)return wr(r,n,i,t.Annotations)}}(t,e)||function(t,e){if(t.In){if(t.In.Values)return nn(mn(t.In.Expressions,e),_.map(t.In.Values,function(n){return mn(n,e)}));var r=G(t.In.Table,e);if(r)return Vu(mn(t.In.Expressions,e),r,t.Annotations)}}(t,e)||function(t,e){if(t.Or){var r=G(t.Or.Left,e),n=G(t.Or.Right,e);if(r&&n)return xi(r,n,t.Annotations)}}(t,e)||function(t,e){if(t.Contains){var r=G(t.Contains.Left,e),n=G(t.Contains.Right,e);if(r&&n)return yp(r,n,t.Annotations)}}(t,e)||function(t,e){if(t.Comparison){var r=G(t.Comparison.Left,e),n=G(t.Comparison.Right,e);if(r&&n)return Rn(t.Comparison.ComparisonKind,r,n,t.Annotations)}}(t,e)||function(t,e){if(t.Conditional){for(var r=t.Conditional.Cases,n=r.length,i=new Array(n),a=0;a<n;a++){var o=KR(r[a]);if(!o){i=void 0;break}i[a]=o}if(t.Conditional.DefaultValue){var s=G(t.Conditional.DefaultValue);if(i&&s)return Mu(i,s,t.Annotations)}else if(i)return Mu(i,void 0,t.Annotations)}}(t)||function(t,e){if(t.DateAdd){var r=G(t.DateAdd.Expression,e);if(r)return St(t.DateAdd.TimeUnit,t.DateAdd.Amount,r,t.Annotations)}}(t,e)||function(t,e){if(t.DateSpan){var r=G(t.DateSpan.Expression,e);if(r)return bt(t.DateSpan.TimeUnit,r,t.Annotations)}}(t,e)||function(t,e){if(t.Exists){var r=G(t.Exists.Expression,e);if(r)return mp(r,t.Annotations)}}(t,e)||function(t,e){if(t.Not){var r=G(t.Not.Expression,e);if(r)return Xa(r,t.Annotations)}}(t,e)||function(t){if(t.Now)return xu(t.Annotations)}(t)||function(t){if(t.DefaultValue)return Za(t.Annotations)}(t)||function(t){if(t.AnyValue)return Di(t.AnyValue.DefaultValueOverridesAncestors,t.Annotations)}(t)||function(t,e){if(t.StartsWith){var r=G(t.StartsWith.Left,e),n=G(t.StartsWith.Right,e);if(r&&n)return Sp(r,n,t.Annotations)}}(t,e)||function(t,e){if(t.FillRule){var r=G(t.FillRule.Input,e),n=t.FillRule,i={},a=n.FillRule.linearGradient2,o=n.FillRule.linearGradient3;if(a)i.linearGradient2={min:Ji(a.min,e),max:Ji(a.max,e)},(s=wy(a.nullColoringStrategy,e))&&(i.linearGradient2.nullColoringStrategy=s);else if(o){var s;i.linearGradient3={min:Ji(o.min,e),mid:Ji(o.mid,e),max:Ji(o.max,e)},(s=wy(o.nullColoringStrategy,e))&&(i.linearGradient3.nullColoringStrategy=s)}return bp(r,i,t.Annotations)}}(t,e)||function(t){if(t.ThemeDataColor)return Au(t.ThemeDataColor.ColorId,t.ThemeDataColor.Percent,t.Annotations)}(t)||function(t,e){if(t.ResourcePackageItem)return Ep(t.ResourcePackageItem.PackageName,t.ResourcePackageItem.PackageType,t.ResourcePackageItem.ItemName,t.Annotations)}(t)||function(t,e){if(t.ScopedEval){var r=G(t.ScopedEval.Expression,e);if(r)return Ka(r,mn(t.ScopedEval.Scope,e),t.Annotations)}}(t,e)||function(t,e){if(t.FilteredEval)return bu(G(t.FilteredEval.Expression,e),_.map(t.FilteredEval.Filters,function(n){return Ft.filter(n,e)}),t.Annotations)}(t,e)||function(t,e){if(t.WithRef)return hp(t.WithRef.ExpressionName,t.Annotations)}(t)||function(t,e){if(t.TransformTableRef)return Eu(t.TransformTableRef.Source,t.Annotations)}(t)||function(t,e){if(t.TransformOutputRoleRef)return Cu(t.TransformOutputRoleRef.Role,t.TransformOutputRoleRef.Transform,t.Annotations)}(t)||function(t){if(t.Literal)return xc(t.Literal.Value)}(t)||function(t,e){if(t.GroupRef){var r=G(t.GroupRef.Expression,e),n=_.map(t.GroupRef.GroupedColumns,function(i){return G(i,e)});if(r&&!_.isEmpty(n))return Ja(t.GroupRef.Property,r,n,t.Annotations)}}(t,e)||function(t){if(t.RoleRef)return wu(t.RoleRef.Role,t.Annotations)}(t)||function(t){if(t.AllRolesRef)return gp(t.Annotations)}(t)||function(t){if(t.NamedQueryReference)return lp(t.NamedQueryReference.Name,void 0,t.Annotations)}(t)||function(t){if(t.Subquery)return rn(Q.deserializeQuery(t.Subquery.Query),t.Annotations)}(t)||function(t){return function(t){if(t.Boolean)return Zt(t.Boolean.Value,t.Annotations)}(t)||Vy(t)||function(t){if(t.DateTimeSecond)return bt(5,er(My(t.DateTimeSecond)),t.Annotations)}(t)||Vy(t)||function(t){if(t.Decimal)return eo(t.Decimal.Value,void 0,t.Annotations)}(t)||function(t){if(t.Integer)return kn(t.Integer.Value,void 0,t.Annotations)}(t)||function(t){if(t.Null)return Lt()}(t)||function(t){if(t.Number)return xc(t.Number.Value)}(t)||function(t){if(t.String)return Ce(t.String.Value,void 0,t.Annotations)}(t)}(t)||function(t){if(t.SummaryValueRef)return vp(t.SummaryValueRef.Name,t.Annotations)}(t)||function(t,e){var r=t.SparklineData;if(r)return Du(G(r.Measure,e),mn(r.Groupings,e),r.ScalarKey?G(t.SparklineData.ScalarKey,e):void 0,r.PointsPerSparkline,r.IncludeMinGroupingInterval)}(t,e)||function(t,e){var r=t.NativeVisualCalculation;if(r)return _u(r.Name,r.Expression,t.Annotations)}(t)}function qo(t){return G(t,null)}function mn(t,e){for(var r=[],n=0,i=t.length;n<i;n++)r.push(G(t[n],e));return r}function CR(t){return qo(t)}function KR(t){if(t){var e=G(t.Condition),r=G(t.Value);if(e&&r)return{condition:e,value:r}}}function Ji(t,e){if(t){var r={color:G(t.color,e)};return t.value&&(r.value=G(t.value,e)),r}}function wy(t,e){if(t){var r={strategy:G(t.strategy,e)};return t.color&&(r.color=G(t.color,e)),r}}function Vy(t){var e=t.DateTime||t.Date;if(e){var r=My(e);if(r)return er(r,void 0,t.Annotations)}}function My(t){return u.assertValue(t,"contract"),function(t){try{return function(t){if(yt.throwIfNullOrEmptyString(t,null,"deserializeDate","Cannot deserialize empty string"),Ba(0===t.indexOf("/Date(")&&_.endsWith(t,")/"),"Cannot deserialize empty string"),Mc()){var e=moment(t);return Ba(e.isValid(),"parsedValue.isValid must be true"),e.toDate()}var r=t.substring("/Date(".length,t.length-")/".length);Ba(/^\-?\d+$/.test(r),"Cannot deserialize invalid date");var n=parseInt(r,10);return Ba(!isNaN(n),"Cannot deserialize invalid date"),new Date(n)}(t)}catch(e){}}(t.Value)}function Ic(t){return{scopeId:Q.serializeExpr(t.expr)}}function xy(t){if(t.scopeId){var e=Q.deserializeExpr(t.scopeId);if(e)return Et(e)}}function Ho(t,e,r){xn(t)?(Dy(r),Ho(t.left,e,r.left),Ho(t.right,e,r.right)):Dn(t)?(u.assert(function(){return Vn(t.left)||Mn(t.left)||kt(t.left)||et(t.left)},"expression.left should be fieldRef: entity/measure/column/aggregate"),Dy(r,t.left),u.assert(function(){return Le(t.right)},"expression.right should be constant"),e.push(t.right)):u.assertFail("identities should consists of COMPARE, AND, and should not reach to fieldRef(ENTITY/MEASURE/COLUMN/AGGREGATE) and CONSTANT exprs")}function Dy(t,e){e?t.value=e:(t.left={},t.right={})}function Go(t,e){return!(!t||!e)&&(t.left&&t.right?!(!e.left||!e.right)&&Go(t.left,e.left)&&Go(t.right,e.right):t.value?!!e.value&&j(t.value,e.value):(u.assertFail("CompareTreeNode failed, invalid tree structure"),!1))}function Ay(t){if(Bt(t))return t.expr;u.assertFail("selectors should be scoped identities")}function Qo(t,e,r){if(e.left&&e.right)return st(Qo(t,e.left,r),Qo(t,e.right,r));if(e.value){var a=e.value,o=t[r.index++];return u.assert(function(){return Vn(a)||Mn(a)||kt(a)||et(a)},"expression.left should be fieldRef: entity/measure/column/aggregate"),u.assert(function(){return Le(o)},"expression.right should be constant"),Rn(0,a,o)}u.assertFail("DecomposedTree should either have left and right Tree, or a valid value")}function _1(t){for(var e=[],n=0,i=t.values;n<i.length;n++){for(var o=[],s=0,l=i[n];s<l.length;s++){var f=_.mapValues(l[s],function(d){return _.map(d,function(p){return Q.deserializeExpr(p)})});o.push(f)}e.push(o)}return{values:e,columns:_.map(t.columns,function(d){return Tc(d)})}}function Tc(t){var e={};if(t.left&&t.right)return e.left=Tc(t.left),e.right=Tc(t.right),e;if(t.value){var r=Q.deserializeExpr(t.value);return Vn(r)||Mn(r)||kt(r)||et(r)?e.value=r:u.assertFail("Value should be fieldRef: entity/measure/column/aggregate"),e}u.assertFail("DecomposedTree should either have left and right Tree, or a valid value")}function T1(t){if(u.assertAnyValue(t,"contract"),t){var e={expressions:_.map(t.expressions,function(r){return Q.serializeExpr(r)})};return t.decomposedIdentities&&(e.decomposedIdentities=function(t){if(u.assertAnyValue(t,"contract"),t){for(var e=[],n=0,i=t.values;n<i.length;n++){for(var o=[],s=0,l=i[n];s<l.length;s++){var f=_.mapValues(l[s],function(d){return _.map(d,function(p){return Q.serializeExpr(p)})});o.push(f)}e.push(o)}return{values:e,columns:_.map(t.columns,function(d){return Pc(d)})}}}(t.decomposedIdentities)),t.valueMap&&(e.valueMap=t.valueMap),t.jsonFilter&&(e.jsonFilter=t.jsonFilter),e}}function Pc(t){var e={};return t.left&&t.right?(e.left=Pc(t.left),e.right=Pc(t.right),e):t.value?(e.value=Q.serializeExpr(t.value),e):void u.assertFail("DecomposedTree should either have left and right Tree, or a valid value")}function N1(t,e){var r;if(u.assertValue(t,"input"),!_.isEmpty(t.expressions)){if(e){var n=function(t){if(u.assertValue(t,"filterExpressionMetadata"),t){var e={expressions:t.expressions},r=[],n=[],i=[];if(t.cachedValueItems){for(var a=0,o=t.cachedValueItems;a<o.length;a++){var s=o[a];i.push(s.valueMap);for(var l=[],c=0,f=s.identities;c<f.length;c++){var p={},h=[],v={};Ho(Ay(f[c]),h,p);for(var g=-1,y=0;y<n.length;y++)if(Go(p,n[y])){g=y;break}g<0&&(n.push(p),g=n.length-1),v[g]=h,l.push(v)}r.push(l)}e.decomposedIdentities={values:r,columns:n},e.valueMap=i}return e}}(t);r=T1(n)}else r=function(t){if(u.assertValue(t,"input"),!_.isEmpty(t.expressions)){var e={expressions:_.map(t.expressions,function(r){return Q.serializeExpr(r)})};return _.isEmpty(t.cachedValueItems)||(e.cachedValueItems=function(t){if(t&&!(t.length<1)){for(var e=[],r=0,n=t;r<n.length;r++){var i=n[r];if(!_.isEmpty(i.identities)){var a=_.map(i.identities,function(o){return Ic(o)});a&&e.push({identities:a,valueMap:i.valueMap})}}return e}}(t.cachedValueItems)),t.jsonFilter&&(e.jsonFilter=t.jsonFilter),e}}(t);return r}}function k1(t){if(u.assertValue(t,"input"),!_.isEmpty(t.expressions)){if(function(t){return!!t.decomposedIdentities}(t)){var e=function(t){if(u.assertAnyValue(t,"input"),t){var e={expressions:_.map(t.expressions,function(r){return Q.deserializeExpr(r)})};return t.decomposedIdentities&&(e.decomposedIdentities=_1(t.decomposedIdentities)),t.valueMap&&(e.valueMap=t.valueMap),t.jsonFilter&&(e.jsonFilter=t.jsonFilter),e}}(t);return function(t){if(u.assertValue(t,"decomposedSelectors"),t){var e={expressions:t.expressions},r=t.decomposedIdentities&&t.decomposedIdentities.values,n=t.decomposedIdentities&&t.decomposedIdentities.columns,i=[];if(r&&n){for(var a=0;a<r.length;a++){for(var s=[],l=0,c=r[a];l<c.length;l++){var f=c[l];for(var d in f){var g=Et(Qo(f[d],n[d],{index:0}));s.push(g)}}i.push({identities:s,valueMap:t.valueMap[a]})}_.isEmpty(i)||(e.cachedValueItems=i),t.jsonFilter&&(e.jsonFilter=t.jsonFilter)}return e}}(e)}return function(t){if(u.assertValue(t,"input"),!_.isEmpty(t.expressions)){var e={expressions:_.map(t.expressions,function(r){return Q.deserializeExpr(r)})};return _.isEmpty(t.cachedValueItems)||(e.cachedValueItems=function(t){if(t&&!(t.length<1)){for(var e=[],r=0,n=t;r<n.length;r++){var i=n[r];if(!_.isEmpty(i.identities)){var a=_.map(i.identities,function(o){return xy(o)});a&&e.push({identities:a,valueMap:i.valueMap})}}return e}}(t.cachedValueItems)),t.jsonFilter&&(e.jsonFilter=t.jsonFilter),e}}(t)}}var Fc,Sn=L.fromDescriptor({bool:!0}),dt=L.fromDescriptor({numeric:!0}),_y=L.fromDescriptor({integer:!0}),Se=L.fromDescriptor({text:!0}),Fr={fill:{solid:{color:!0}}};function Iy(t){return t&&"ExprContext"===t.propertyDefinitionKind}function Ty(t){if(t)return _.map(t,$n)}function q1(t){if(t)return{category:t.categoryString,underlyingType:t.extendedType}}function H1(t){if(t)return new L(t.underlyingType,t.category)}function G1(t,e,r){if(u.assertAnyValue(t,"input"),u.assertAnyValue(e,"descriptor"),t){var n={properties:W1(t.properties,e?e.properties:null,r)},i=function(t){if(u.assertAnyValue(t,"input"),null===t)return null;if(t){var e={};return t.data&&(e.data=_.chain(t.data).map(function(r){return Ry(r)}).filter(function(r){return null!=r}).value()),t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),void 0!==t.highlightMatching&&(e.highlightMatching=t.highlightMatching),null!=t.order&&(e.order=t.order),e}}(t.selector);return i&&(n.selector=i),n}}function Ry(t){return u.assertValue(t,"input"),t.scopeId?xy(t):t.wildcard?_p(_.map(t.wildcard,Q.deserializeExpr)):t.roles?Pf(t.roles):t.total?function(t){return new Ap(t)}(_.map(t.total,Q.deserializeExpr)):t.dataViewWildcard?Fu(t.dataViewWildcard.matchingOption):void 0}function W1(t,e,r){if(u.assertAnyValue(t,"input"),u.assertAnyValue(e,"propertyDescriptors"),t){var n={};for(var i in t){var a=j1(t[i],e?e[i]:null,r);void 0!==a&&(n[i]=a)}return n}}function j1(t,e,r){if(u.assertAnyValue(t,"input"),u.assertAnyValue(e,"propertyDescriptor"),e){var n=By(e.type);return Iy(t)?{propertyDefinitionKind:"ExprWithContext",value:Me(t.value,n.value),context:Ny(t.context)}:function(t,e){return!!e.value}(0,n)?Me(t,n.value):Yi(t,n.structural)}if(r&&t){if(Iy(t))return{propertyDefinitionKind:"ExprWithContext",value:Q.deserializeExpr(t.value.expr),context:Ny(t.context)};if(t.expr)return Q.deserializeExpr(t.expr);if(t.solid)return Yi(t,Fr);if(t.filter)return Q.deserializeFilter(t.filter)}}function Me(t,e){if(u.assertValue(e,"type"),void 0!==e.primitiveType&&null!=t&&t.expr)return Q.deserializeExpr(t.expr)}function Yi(t,e){if(u.assertValue(e,"type"),e.fill&&e.fill.solid&&e.fill.solid.color&&t)return t.solid&&t.solid.color?{solid:{color:Me(t.solid.color,L.fromPrimitiveTypeAndCategory(1))}}:void 0;if(e.fillRule){var i=Uy(t,Me);if(i)return i}var a=t;return e.filter&&a&&a.filter?Q.deserializeFilter(a.filter):e.image&&a&&a.image?function(t){u.assertValue(t,"input");var e={name:Me(t.name,Se),url:Me(t.url,L.fromDescriptor(sc))};return t.scaling&&(e.scaling=Me(t.scaling,Se)),e}(a.image):e.geoJson&&a&&a.geoJson?function(t){return u.assertValue(t,"input"),{type:Me(t.type,Se),name:Me(t.name,Se),content:Me(t.content,Se)}}(a.geoJson):e.paragraphs&&t?function(t){return u.assertValue(t,"input"),_.map(t,function(e){var r={textRuns:_.map(e.textRuns,function(n){return Sg(n)?kc(n):bg(n)?function(t){var e={cases:_.map(t.cases,function(r){var n={pattern:Me(r.pattern,Se),textRuns:_.map(r.textRuns,function(i){return kc(i)})};return n}),defaultCase:{textRuns:_.map(t.defaultCase.textRuns,function(r){return kc(r)})},expression:Z1(t.expression)};return e}(n):void 0})};return e.horizontalTextAlignment&&(r.horizontalTextAlignment=e.horizontalTextAlignment),e.listType&&(r.listType=e.listType),e.indent&&(r.indent=e.indent),r})}(t):e.queryTransform&&t?function(t){return u.assertValue(t,"input"),{algorithm:t.algorithm,parameters:_.map(t.parameters,function(r){return{name:r.Name,expr:Q.deserializeExpr(r)}})}}(t):e.dataBars&&t?function(t){return u.assertValue(t,"input"),{minValue:t.minValue?Me(t.minValue,dt):void 0,maxValue:t.maxValue?Me(t.maxValue,dt):void 0,positiveColor:Yi(t.positiveColor,Fr),negativeColor:Yi(t.negativeColor,Fr),axisColor:Yi(t.axisColor,Fr),reverseDirection:Me(t.reverseDirection,Sn),hideText:Me(t.hideText,Sn),totalMatchingOption:t.totalMatchingOption?Me(t.totalMatchingOption,_y):void 0}}(t):e.icon&&t&&"Icon"===t.kind?function(t){u.assertValue(t,"input");var e={kind:"Icon"};return t.layout&&(e.layout=Me(t.layout,Se)),t.verticalAlignment&&(e.verticalAlignment=Me(t.verticalAlignment,Sn)),t.value&&(e.value=Me(t.value,Se)),e}(t):e.exprList&&t&&"ExprList"===t.kind?function(t){u.assertValue(t,"input");var e={exprs:[],kind:"ExprList"};return e.exprs=_.map(t.exprs,function(r){return Q.deserializeExpr(r.expr)}),e}(t):e.errorRange&&t&&"ErrorRange"===t.kind?function(t){u.assertValue(t,"input");var e={kind:"ErrorRange"};if(t.explicit)e.explicit={isRelative:Q.deserializeExpr((r=t.explicit).isRelative.expr)},r.lowerBound&&(e.explicit.lowerBound=Q.deserializeExpr(r.lowerBound.expr)),r.upperBound&&(e.explicit.upperBound=Q.deserializeExpr(r.upperBound.expr));else if(t.symmetricalExplicit)e.symmetricalExplicit={delta:Q.deserializeExpr((r=t.symmetricalExplicit).delta.expr)};else if(t.standardDeviation)e.standardDeviation={value:Q.deserializeExpr((r=t.standardDeviation).value.expr),multiplier:Q.deserializeExpr(r.multiplier.expr)};else if(t.percentage)e.percentage={lowerBoundDelta:Q.deserializeExpr((r=t.percentage).lowerBoundDelta.expr),upperBoundDelta:Q.deserializeExpr(r.upperBoundDelta.expr)};else if(t.percentile){var r;u.assertValue((r=t.percentile).lowerBound.expr.Percentile,"Percentile lowerBound must be a Percentile expression"),u.assertValue(r.upperBound.expr.Percentile,"Percentile lowerBound must be a Percentile expression"),e.percentile={lowerBound:Q.deserializeExpr(r.lowerBound.expr),upperBound:Q.deserializeExpr(r.upperBound.expr)}}return e}(t):e.qnaVisualLink&&t?function(t){u.assertValue(t,"input");var e={};return t.suggestedUtterances&&(e.suggestedUtterances=_.map(t.suggestedUtterances,function(r){return{utterance:r.Utterance}})),_.isEmpty(e)?void 0:e}(t):e.itemLocation&&t&&"ItemLocation"===t.kind?function(t){if(u.assertValue(t,"input"),t.byReference){var e={kind:"ItemLocation",byReference:{itemId:Me(t.byReference.itemId,Se)}};return null!=t.byReference.workspaceId&&(e.byReference.workspaceId=Me(t.byReference.workspaceId,Se)),null!=t.byReference.folderId&&(e.byReference.folderId=Me(t.byReference.folderId,Se)),e}}(t):void u.assertFail("Deserializing a structural type failed")}function Ny(t){u.assertValue(t,"input");var e={};return _.isEmpty(t.filterContext)||(e.filterContext=_.map(t.filterContext,function(r){return{filter:Q.deserializeFilter(r.filter),metadata:r.metadata?k1(r.metadata):void 0}})),e}function kc(t){var e={value:$1(t.value)};return t.textStyle&&(e.textStyle=t.textStyle),t.url&&(e.url=t.url),t.mentionEmail&&(e.mentionEmail=t.mentionEmail),e}function $1(t){var e;if(_.isString(t))e=t;else if(!(e=Me(t,Se))){var r=t;Pt(r)&&(e=r)}return e}function Z1(t){var e;if(!(e=Me(t,Se))){var r=t;Pt(r)&&(e=r)}return e}function uN(t,e,r,n,i){if(u.assertAnyValue(t,"contract"),u.assertAnyValue(e,"descriptor"),t){var a=function(t,e,r,n,i){if(u.assertAnyValue(t,"contract"),u.assertAnyValue(e,"descriptors"),t){var a={};for(var o in t){var s=e?e[o]:null;if(!(i&&null!=s&&s.transient||!r&&!s)){var l=pN(t[o],s,r,n);void 0===l?u.assertFail("DataViewObjectSerializer: failed to serialize property: "+o+" due to malformed property value."):a[o]=l}}return a}}(t.properties,e?e.properties:null,r,n,i);if(a){var o={properties:a},s=$n(t.selector);return s&&(o.selector=s),o}}}function $n(t){if(u.assertAnyValue(t,"contract"),null===t)return null;if(t){var e={};return t.data&&(e.data=_.chain(t.data).map(function(r){return ky(r)}).filter(function(r){return null!=r}).value()),t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),void 0!==t.highlightMatching&&(e.highlightMatching=t.highlightMatching),null!=t.order&&(e.order=t.order),e}}function Wo(t){if(u.assertAnyValue(t,"contract"),t){var e={};if(t.dataMap)for(var r in e.dataMap={},t.dataMap){var n=hr(t.dataMap[r]);e.dataMap[r]=_.chain(n).map(function(i){return ky(i)}).filter(function(i){return null!=i}).value()}return t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),e}}function cN(t){if(t)return _.map(t,function(e){return{objectName:e.objectName,selectorsByColumn:Wo(e.selectorsByColumn)}})}function ky(t){return u.assertValue(t,"contract"),Bt(t)&&t.expr?Ic(t):Mr(t)&&t.exprs?{wildcard:_.map(t.exprs,function(e){return Q.serializeExpr(e)})}:rr(t)&&t.roles?{roles:t.roles}:tr(t)&&t.exprs?{total:_.map(t.exprs,function(e){return Q.serializeExpr(e)})}:xr(t)?{dataViewWildcard:fN(t)}:void u.assertFail("serializeDataRepetitionSelector - Selector did not match type and constraints.")}function fN(t){return{matchingOption:t.matchingOption}}function pN(t,e,r,n){if(u.assertAnyValue(t,"contract"),u.assertAnyValue(e,"descriptor"),e){var i=By(e.type);return Ro(t)?{propertyDefinitionKind:"ExprContext",value:ue(t.value,i.value),context:Ly(t.context,n)}:i.value?ue(t,i.value):$i(t,i.structural)}if(r&&t){if(Ro(t))return{propertyDefinitionKind:"ExprContext",value:{expr:Q.serializeExpr(t.value)},context:Ly(t.context,n)};if(t instanceof U)return{expr:Q.serializeExpr(t)};if(t instanceof Qe)return{filter:Q.serializeFilter(t)};if(t.solid)return $i(t,Fr)}}function ue(t,e){if(u.assertValue(e,"type"),void 0!==e.primitiveType&&t instanceof U)return{expr:Q.serializeExpr(t,!0)}}function $i(t,e){if(u.assertValue(e,"type"),t){if(e.fill&&e.fill.solid&&e.fill.solid.color)return{solid:{color:ue(t.solid.color,Se)}};if(e.fillRule){var i=Uy(t,ue);if(i)return i}if(e.filter)return{filter:Q.serializeFilter(t)};if(e.image)return{image:hN(t)};if(e.geoJson)return{geoJson:vN(t)};if(e.paragraphs)return function(t){return u.assertValue(t,"definition"),_.map(t,function(e){var r={textRuns:_.map(e.textRuns,function(n){return Zl(n)?Lc(n):ec(n)?{cases:_.map(n.cases,function(a){return{pattern:ue(a.pattern,Se),textRuns:_.map(a.textRuns,function(s){return Lc(s)})}}),defaultCase:{textRuns:_.map(n.defaultCase.textRuns,function(a){return Lc(a)})},expression:mN(n.expression)}:void 0})};return e.horizontalTextAlignment&&(r.horizontalTextAlignment=e.horizontalTextAlignment),e.listType&&(r.listType=e.listType),e.indent&&(r.indent=e.indent),r})}(t);if(e.queryTransform)return function(t){return{algorithm:t.algorithm,parameters:_.map(t.parameters,function(e){var r=Q.serializeExpr(e.expr);return r.Name=e.name,r})}}(t);if(e.dataBars)return function(t){return{minValue:ue(t.minValue,dt),maxValue:ue(t.maxValue,dt),positiveColor:$i(t.positiveColor,Fr),negativeColor:$i(t.negativeColor,Fr),axisColor:$i(t.axisColor,Fr),reverseDirection:ue(t.reverseDirection,Sn),hideText:ue(t.hideText,Sn),totalMatchingOption:ue(t.totalMatchingOption,_y)}}(t);if(e.icon&&"Icon"===t.kind)return function(t){var e={kind:"Icon"};return t.layout&&(e.layout=ue(t.layout,Se)),t.verticalAlignment&&(e.verticalAlignment=ue(t.verticalAlignment,Sn)),t.value&&(e.value=ue(t.value,Se)),e}(t);if(e.exprList&&"ExprList"===t.kind)return function(t){u.assertValue(t,"input");var e={exprs:[],kind:"ExprList"};return e.exprs=_.map(t.exprs,function(r){return ue(r,Se)}),e}(t);if(e.errorRange&&"ErrorRange"===t.kind)return function(t){u.assertValue(t,"input");var e={kind:"ErrorRange"};if(t.explicit)e.explicit={isRelative:ue((r=t.explicit).isRelative,Sn)},r.lowerBound&&(e.explicit.lowerBound=ue(r.lowerBound,dt)),r.upperBound&&(e.explicit.upperBound=ue(r.upperBound,dt));else if(t.symmetricalExplicit)e.symmetricalExplicit={delta:ue((r=t.symmetricalExplicit).delta,dt)};else if(t.standardDeviation)e.standardDeviation={value:ue((r=t.standardDeviation).value,dt),multiplier:ue(r.multiplier,dt)};else if(t.percentage)e.percentage={lowerBoundDelta:ue((r=t.percentage).lowerBoundDelta,dt),upperBoundDelta:ue(r.upperBoundDelta,dt)};else if(t.percentile){var r;e.percentile={lowerBound:ue((r=t.percentile).lowerBound,dt),upperBound:ue(r.upperBound,dt)}}return e}(t);if(e.qnaVisualLink)return function(t){u.assertValue(t,"input");var e={};if(t.suggestedUtterances){e.suggestedUtterances=_.map(t.suggestedUtterances,function(n){return{Version:"1.0",Utterance:n.utterance}})}return _.isEmpty(e)?void 0:e}(t);if(e.itemLocation)return function(t){if(u.assertValue(t,"input"),t.byReference){var e=t.byReference,r={kind:"ItemLocation",byReference:{itemId:ue(e.itemId,Se)}};return null!=e.workspaceId&&(r.byReference.workspaceId=ue(e.workspaceId,Se)),null!=e.folderId&&(r.byReference.folderId=ue(e.folderId,Se)),r}}(t);u.assertFail("Serializing a structural type failed")}}function Ly(t,e){u.assertValue(t,"contract");var r={};return _.isEmpty(t.filterContext)||(r.filterContext=_.map(t.filterContext,function(n){return{filter:Q.serializeFilter(n.filter),metadata:n.metadata?N1(n.metadata,e):void 0}})),r}function hN(t){u.assertValue(t,"definition");var e={name:ue(t.name,Se),url:ue(t.url,L.fromDescriptor(sc))};return t.scaling&&(e.scaling=ue(t.scaling,Se)),e}function vN(t){return u.assertValue(t,"definition"),{type:ue(t.type,Se),name:ue(t.name,Se),content:ue(t.content,Se)}}function Lc(t){var e={value:yN(t.value)};return t.textStyle&&(e.textStyle=t.textStyle),t.url&&(e.url=t.url),t.mentionEmail&&(e.mentionEmail=t.mentionEmail),e}function yN(t){var e;return t instanceof U?e=ue(t,Se):_.isString(t)||Pt(t)?e=t:u.assertNever(t),e}function mN(t){var e;return t instanceof U?e=ue(t,Se):Pt(t)?e=t:u.assertNever(t),e}function By(t){u.assertValue(t,"typeDescriptor");var e=L.fromDescriptor(t);return 0!==e.primitiveType?{value:e}:{structural:t}}function Uy(t,e){if(t.linearGradient2){var n={min:{color:e((r=t.linearGradient2).min.color,L.fromPrimitiveTypeAndCategory(1))},max:{color:e(r.max.color,L.fromPrimitiveTypeAndCategory(1))}};return r.min.value&&(n.min.value=e(r.min.value,L.fromPrimitiveTypeAndCategory(3))),r.max.value&&(n.max.value=e(r.max.value,L.fromPrimitiveTypeAndCategory(3))),r.nullColoringStrategy&&(n.nullColoringStrategy={strategy:e(r.nullColoringStrategy.strategy,L.fromPrimitiveTypeAndCategory(1))},r.nullColoringStrategy.color&&(n.nullColoringStrategy.color=e(r.nullColoringStrategy.color,L.fromPrimitiveTypeAndCategory(1)))),{linearGradient2:n}}var r;return t.linearGradient3?(n={min:{color:e((r=t.linearGradient3).min.color,L.fromPrimitiveTypeAndCategory(1))},mid:{color:e(r.mid.color,L.fromPrimitiveTypeAndCategory(1))},max:{color:e(r.max.color,L.fromPrimitiveTypeAndCategory(1))}},r.min.value&&(n.min.value=e(r.min.value,L.fromPrimitiveTypeAndCategory(3))),r.mid.value&&(n.mid.value=e(r.mid.value,L.fromPrimitiveTypeAndCategory(3))),r.max.value&&(n.max.value=e(r.max.value,L.fromPrimitiveTypeAndCategory(3))),r.nullColoringStrategy&&(n.nullColoringStrategy={strategy:e(r.nullColoringStrategy.strategy,L.fromPrimitiveTypeAndCategory(1))},r.nullColoringStrategy.color&&(n.nullColoringStrategy.color=e(r.nullColoringStrategy.color,L.fromPrimitiveTypeAndCategory(1)))),{linearGradient3:n}):null}function DN(t){return _.filter(_.map(t,function(e){return function(t){if(u.assertValue(t,"expansionState"),u.assertValue(!_.isEmpty(t.roles),"expansionState.roles"),function(t){return!_.isEmpty(t.root.children)||!_.isEmpty(t.root.identityValues)}(t)||function(t){return _.findIndex(t.levels,function(e){return e.isPinned})>=0}(t)){var e={roles:t.roles};return _.isEmpty(t.levels)||(u.assertValue(t.root,"expansionState.root"),e.levels=_.map(t.levels,function(r){return function(t){if(u.assertAnyValue(t,"level"),t){u.assertNonEmpty(t.queryRefs,"level.queryRefs");var e={queryRefs:_.clone(t.queryRefs)};return t.isCollapsed&&(e.isCollapsed=!0),t.identityKeys&&(e.identityKeys=_.map(t.identityKeys,function(r){return Q.serializeExpr(r)})),t.isPinned&&(e.isPinned=t.isPinned),t.isLocked&&(e.isLocked=t.isLocked),t.AIInformation&&(e.AIInformation=_.cloneDeep(t.AIInformation)),e}}(r)}),e.root=Oy(t.root)),e}}(e)}),function(e){return e})}function Oy(t){u.assertValue(t,"node");var e={identityValues:t.identityValues?_.map(t.identityValues,function(o){return Q.serializeExpr(o)}):null};if(t.isToggled&&(e.isToggled=!0),!_.isEmpty(t.children)){e.children=[];for(var r=function(s){u.assert(function(){return!_.isEmpty(s.identityValues)},"child.identityValues");var l=Oy(s);e.children.push(l)},n=0,i=t.children;n<i.length;n++)r(i[n])}return e}function IN(t,e){if(t){for(var r=[],n=function(l){if(!l)return"continue";u.assert(function(){return!_.isEmpty(l.roles)},"serializedHierarchy.roles");var c=new D_(l.roles,e);_.isEmpty(l.levels)||(u.assertValue(l.root,"serializedHierarchy.root"),c.levels=_.map(l.levels,function(f){return function(t){var e={queryRefs:_.clone(t.queryRefs),isCollapsed:!!t.isCollapsed,toggledNodes:[],isPinned:t.isPinned,isLocked:t.isLocked,AIInformation:_.cloneDeep(t.AIInformation)};return t.identityKeys&&(e.identityKeys=_.map(t.identityKeys,function(r){return Q.deserializeExpr(r)})),e}(f)}),c.root=zy(l.root,-1,null,c.levels,!!e.canCollapseRoot)),r.push(c)},i=0,a=t;i<a.length;i++)n(a[i]);return r}}function zy(t,e,r,n,i){u.assertValue(t,"serializedNode");var a={identityValues:t.identityValues?_.map(t.identityValues,function(s){return Q.deserializeExpr(s)}):null,parent:r,children:[]};if(t.isToggled&&(a.isToggled=!0,e>=0?n[e].toggledNodes.push(a):u.assert(function(){return i},"Collapse to root capability not enabled")),!_.isEmpty(t.children)){var o=e+1;a.children=_.map(t.children,function(s){return zy(s,o,a,n,i)})}return a}var qy=function(){function t(){}return t.deserializeDataViewSelectTransforms=function(e){return u.assertValue(e,"input"),function(t){if(t)for(var e=0,r=t;e<r.length;e++){var n=r[e];n.kpiStatusGraphic&&(n.kpi={graphic:n.kpiStatusGraphic})}}(e),_.map(e,function(r){var n={displayName:r.displayName,format:r.format,kpi:r.kpi,queryName:r.queryName,roles:r.roles,sort:r.sort,sortOrder:r.sortOrder,type:H1(r.type)};return r.expr&&(n.expr=Q.deserializeExpr(r.expr)),r.aggregateSources&&(n.aggregateSources=r.aggregateSources),r.relatedSelects&&(n.relatedSelects=r.relatedSelects),r.relatedObjects&&(n.relatedObjects=r.relatedObjects),n})},t.serializeDataViewSelectTransforms=function(e){return u.assertValue(e,"input"),_.map(e,function(r){var n={displayName:r.displayName,format:r.format,kpi:r.kpi,queryName:r.queryName,roles:r.roles,sort:r.sort,sortOrder:r.sortOrder,type:q1(r.type)};return r.expr&&(n.expr=Q.serializeExpr(r.expr)),r.aggregateSources&&(n.aggregateSources=r.aggregateSources),r.relatedSelects&&(n.relatedSelects=r.relatedSelects),r.relatedObjects&&(n.relatedObjects=r.relatedObjects),r.sourceFieldParameters&&(n.sourceFieldParameters=r.sourceFieldParameters),n})},t.serializeDataViewTransformActions=function(e,r){u.assertAnyValue(r,"objectDescriptors");var n={objects:(e=e||{}).objects,projectionOrdering:e.roles&&e.roles.ordering,projectionActiveItems:e.roles&&e.roles.activeItems,splits:e.splits,queryMetadata:null,visualElements:null};return e&&e.objects&&(n.objects=function(t,e,r,n){if(u.assertAnyValue(t,"contract"),u.assertAnyValue(e,"descriptors"),t){var i={};for(var a in t){var o=void 0;if(!e||(o=e[a]))for(var s=t[a],l=i[a]=[],c=0,f=s.length;c<f;c++)l.push(uN(s[c],o,!e,undefined,false))}return i}}(e.objects,r)),e&&e.selects&&(n.selects=t.serializeDataViewSelectTransforms(e.selects)),e&&!_.isEmpty(e.expansionStates)&&(n.expansionStates=DN(e.expansionStates)),n},t.deserializeDataViewTransformActions=function(e,r){var n=r&&r.objects;u.assertValue(e,"actions"),u.assertAnyValue(n,"objectDescriptors");var i=e.objects?function(t,e){if(u.assertAnyValue(t,"input"),u.assertAnyValue(e,"descriptors"),t){!Fc&&!e&&(Fc=!0,ot.error("deserializeObjects called with no descriptors - ",!0));var r={};for(var n in t){var i=void 0;if(!e||(i=e[n]))for(var a=t[n],o=r[n]=[],s=0,l=a.length;s<l;s++)o.push(G1(a[s],i,!e))}return r}}(e.objects,n):null,a=t.createTransformActions(e.queryMetadata,e.visualElements,n,i)||{},o=e&&e.projectionActiveItems;return _.isEmpty(o)||this.upgradeActiveItemsIfNeeded(o),a.roles={ordering:e.projectionOrdering,activeItems:o},a.splits=e.splits,e.selects&&(a.selects=t.deserializeDataViewSelectTransforms(e.selects)),e.expansionStates&&(a.expansionStates=IN(e.expansionStates,{supportsMerge:r&&r.expandCollapse&&r.expandCollapse.supportsMerge,canCollapseRoot:r&&r.noDefaultProjections,collapseParentAfterRemovingChildLevel:r&&r.expandCollapse&&r.expandCollapse.collapseParentAfterRemovingChildLevel})),this.upgradeComboChartFromCY16SU04AndPrior(a),a},t.isStringArray=function(e){return _.isString(e[0])},t.upgradeActiveItemsIfNeeded=function(e){for(var r in e){var n=e[r],i=void 0;!_.isEmpty(n)&&this.isStringArray(n)&&(i=_.map(n,function(o){return{queryRef:o}})),e[r]=i||n}},t.upgradeComboChartFromCY16SU04AndPrior=function(e){var r;u.assertValue(e,"transformActions");var a=e.roles&&e.roles.ordering;if(a){var o=a.Y&&1===a.Y.length&&_.includes(a.Y2,a.Y[0])?a.Y[0]:void 0;if(void 0!==o){var s=e.splits&&2===e.splits.length&&!e.splits[0].selects[o]&&e.splits[1].selects[o]?e.splits[0]:void 0;if(s){var l=_.chain(Object.keys(s.selects)).filter(function(h){return s.selects[h]}).map(function(h){return parseInt(h,10)}).maxBy(function(h){return h}).value();if(l!==Number.NEGATIVE_INFINITY&&e.selects&&e.selects.length===l){var f=e.selects[o];if(f&&f.roles.Y&&f.roles.Y2){delete f.roles.Y;var p=ye({},f);p.roles=((r={}).Y=!0,r),p.queryName=f.queryName,e.selects[l]=p,e.roles.ordering.Y=[l]}}}}}},t.serializeTransformActions=function(e){return JSON.stringify(e)},t.createTransformActions=function(e,r,n,i){if(u.assertAnyValue(e,"queryMetadata"),u.assertAnyValue(r,"visualElements"),u.assertAnyValue(n,"objectDescs"),u.assertAnyValue(i,"objectDefns"),e&&!_.isEmpty(e.Select)||!_.isEmpty(r)||i){var a={};if(e){var o=e.Select;if(o)for(var s=a.selects=[],l=function(g,y){var m=o[g];if(!m)return s.push(null),"continue";var S=c.toTransformSelect(m,g);if(s.push(S),S.format&&n){u.assert(function(){return!!S.queryName},"selectTransform.queryName should be defined (or defaulted).");var b=po(n);b&&(i||(i={}),Wi(i,b,{metadata:S.queryName},Ce(S.format)))}},c=this,f=0,d=o.length;f<d;f++)l(f)}if(r){var p=(r=_.unionBy(r,function(v){return JSON.stringify(v)})).length;for(p>1&&(a.splits=[]),f=0;f<p;f++){var h=r[f];h.Settings&&0===f&&(i=this.upgradeSettingsToObjects(h.Settings,i)),h.DataRoles&&(a.selects||(a.selects=[]),a.roles||(a.roles={ordering:{}}),this.populateDataRoles(h.DataRoles,a.selects,a.roles.ordering)),a.splits&&a.splits.push(this.populateSplit(h.DataRoles))}}return i&&(a.objects=i),a}},t.toTransformSelect=function(e,r){u.assertValue(e,"select");var n={};return e.Restatement&&(n.displayName=e.Restatement),e.Name?n.queryName=e.Name:n.queryName||(n.queryName="$select"+r),e.Format&&(n.format=e.Format),e.Type&&(n.type=this.describeDataType(e.Type,function(t){switch(t){case 0:return"None";case 1:return"Address";case 2:return"City";case 3:return"Company";case 4:return"Continent";case 5:return"Country";case 6:return"County";case 7:return"Date";case 8:return"Image";case 9:return"ImageUrl";case 10:return"Latitude";case 11:return"Longitude";case 12:return"Organization";case 13:return"Place";case 14:return"PostalCode";case 15:return"Product";case 16:return"StateOrProvince";case 17:return"WebUrl"}}(e.DataCategory))),e.kpi&&(n.kpi=e.kpi),e.kpiStatusGraphic&&(n.kpi={graphic:e.kpiStatusGraphic}),n},t.describeDataType=function(e,r){var n=0;switch(e=e||0){case 2048:n=1;break;case 1:n=3;break;case 3:n=4;break;case 4096:n=5;break;case 20:n=6;break;case 4:n=7;break;case 8:n=9;break;case 67:n=4,u.assert(function(){return!r||"Year"===r},"Unexpected category for Year type."),r="Year";break;case 35:n=4,u.assert(function(){return!r||"Month"===r},"Unexpected category for Month type."),r="Month"}return L.fromPrimitiveTypeAndCategory(n,r)},t.populateDataRoles=function(e,r,n){u.assertValue(e,"roles"),u.assertValue(r,"selects"),u.assertValue(n,"projectionOrdering");for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.Projection,l=o.Name,c=r[s];void 0===c&&(this.fillArray(r,s),c=r[s]={});var f=c.roles;void 0===c.roles&&(f=c.roles={}),f[l]=!0;var d=n[l];void 0===d&&(d=n[l]=[]),d.push(s)}},t.fillArray=function(e,r){u.assertValue(e,"selects"),u.assertValue(r,"length");for(var n=e.length;n<r;n++)e[n]={}},t.populateSplit=function(e){u.assertAnyValue(e,"roles");var r={},n={selects:r};if(e)for(var i=0,a=e.length;i<a;i++)r[e[i].Projection]=!0;return n},t.upgradeSettingsToObjects=function(e,r){if(e){var n;for(n in r||(r={}),e){var i=e[n],a=n,o=i,s="general";switch(n){case"hasScalarCategoryAxis":s="categoryAxis",a="axisType",o=Ce(i?"Scalar":"Categorical");break;case"Totals":a="totals",o=Zt(!!i);break;case"textboxSettings":a="paragraphs",i&&i.paragraphs&&(o=i.paragraphs);break;case"VisualType1":a="visualType1",o=Ce(i);break;case"VisualType2":a="visualType2",o=Ce(i);break;case"imageVisualSettings":a="imageUrl",i&&i.imageUrl&&(o=Ce(i.imageUrl));break;default:continue}this.setObjectDefinition(r,s,a,o)}return r}},t.setObjectDefinition=function(e,r,n,i){u.assertValue(e,"objects"),u.assertValue(r,"objectName"),u.assertValue(n,"propertyName");var a=e[r];void 0===a&&(a=e[r]=[]);var o=a[0];void 0===o&&(o=a[0]={properties:{}}),o.properties[n]=i},t}();function RN(t){return{dataColors:kN(t.dataColors),foreground:t.foreground,foregroundLight:t.foregroundLight,foregroundDark:t.foregroundDark,foregroundNeutralLight:t.foregroundNeutralLight,foregroundNeutralDark:t.foregroundNeutralDark,foregroundNeutralSecondary:t.foregroundNeutralSecondary,foregroundNeutralSecondaryAlt:t.foregroundNeutralSecondaryAlt,foregroundNeutralSecondaryAlt2:t.foregroundNeutralSecondaryAlt2,foregroundNeutralTertiary:t.foregroundNeutralTertiary,foregroundNeutralTertiaryAlt:t.foregroundNeutralTertiaryAlt,foregroundSelected:t.foregroundSelected,foregroundButton:t.foregroundButton,background:t.background,backgroundLight:t.backgroundLight,backgroundNeutral:t.backgroundNeutral,backgroundDark:t.backgroundDark,hyperlink:t.hyperlink,visitedHyperlink:t.visitedHyperlink,mapPushpin:t.mapPushpin,shapeStroke:t.shapeStroke,disabledText:t.disabledText,tableAccent:t.tableAccent,selection:t.selection,separator:t.separator}}function kN(t){return new Tf(t.colors,t.sentimentColors,t.gradientColors)}function Bc(t,e){u.assertValue(t,"collection"),u.assertValue(e,"toRemove");var r=t.indexOf(e);u.assert(function(){return r>=0},"the metadata column to be removed should exist in the collection before the removal"),r>=0&&t.splice(r,1)}function Hy(t,e){u.assertValue(e,"dataViewCategorical");var r=e.categories;if(r)for(var n=0,i=r;n<i.length;n++){var a=i[n];a.values.splice(0),a.identity.splice(0)}var o=e.values;if(o){var s=o.grouped();if(!_.isEmpty(s)){for(var l=s[0],c=t.columns,f=function(D){var A=D.source;if(A.groupName){var P=_.find(c,function(F){return!F.groupName&&F.index===A.index&&F.isMeasure===A.isMeasure});P?(D.source=P,Bc(c,A)):delete A.groupName}},d=0,p=l.values;d<p.length;d++)f(p[d]);var v=[{values:l.values,objects:l.objects}];if(o.grouped=function(){return v},s.length>=2){var g=l.values.length;if(g>0){for(var m=g*(s.length-1),S=g,b=g+m;S<b;S++)Bc(c,o[S].source);o.splice(g,m)}}}for(var C=0,w=o;C<w.length;C++){var M=w[C];M.values.splice(0),delete M.identity}}u.assert(function(){return!r||_.every(r,function(V){return _.isEmpty(V.values)&&_.isEmpty(V.identity)})},"values and identity should be cleared in all category columns"),u.assert(function(){return!o||_.every(o.grouped(),function(V){return!V.name&&!V.identity})},"name and identity should be cleared in all series instances"),u.assert(function(){return!o||_.every(o,function(V){return _.isEmpty(V.values)})},"All values in measure columns should be removed")}function jo(t,e){if(u.assertValue(t,"values"),u.assertValue(e,"indicesToRemove"),u.assert(function(){return Cs(e,!0)},"indicesToRemove is expected to be in descending order"),u.assert(function(){return _.uniq(e).length===e.length},"indicesToRemove is not expected to contain any duplicate"),!_.isEmpty(e)){if(u.assert(function(){return 0<=_.last(e)&&_.head(e)<t.length},"elements in indicesToRemove must be valid indices to the values array."),t.length===e.length)return void t.splice(0);for(var r,n=0,i=0,a=e;i<a.length;i++){var o=a[i];void 0===r||r===o+1?(r=o,n++):(t.splice(r,n),r=o,n=1)}u.assertValue(r,"nextSpliceStart must be defined because this function returns early if indicesToRemove is empty."),t.splice(r,n)}}function Gy(t,e){if(u.assertValue(t,"queryDataView"),u.assertAnyValue(e,"clientSideFilters"),!_.isEmpty(e)&&!_.isEmpty(t.metadata.columns)){u.assert(function(){return _.every(e,function(a){return _.some(t.metadata.columns,function(o){return!o.isMeasure&&o.index===Qy(a)})})},"Client-side filtering on measure columns is not yet implemented; only attribute filters are supported at the moment.");var r=t.categorical;if(r){var n=function(t,e){if(u.assertAnyValue(t,"seriesMetadataColumn"),u.assertValue(e,"clientSideFilters"),t){var r=Wy(e,[t]);if(!_.isEmpty(r))return function(a){if(a.identity)for(var s=a.name,l=0,c=r;l<c.length;l++)if(jy(c[l],s))return!0;return!1}}}(r.values&&r.values.source,e),i=function(t,e){u.assertValue(t,"categories"),u.assertValue(e,"clientSideFilters");var r=Wy(e,_.map(t,function(i){return i.source}));if(!_.isEmpty(r))return function(a,o){for(var s=function(h){if(_.every(o,function(g){return jy(h,g.values[a])}))return{value:!0}},l=0,c=r;l<c.length;l++){var d=s(c[l]);if("object"==typeof d)return d.value}return!1}}(r.categories,e);!function(t,e,r,n){u.assertValue(e,"dataViewCategorical"),u.assertAnyValue(r,"categoryRemovalPredicate"),u.assertAnyValue(n,"seriesRemovalPredicate"),n&&function(t,e,r){u.assertValue(e,"dataViewCategorical"),u.assertValue(r,"removalPredicate");var n=e.values&&e.values.grouped();if(!_.isEmpty(n)){var a=function(t,e,r){u.assertAnyValue(t,"seriesMetadataColumn"),u.assertValue(e,"seriesInstances"),u.assertValue(r,"removalPredicate");for(var n=[],i=e.length-1;i>=0;i--)r(e[i],t)&&n.push(i);return n}(e.values&&e.values.source,n,r);!function(t,e,r){if(u.assertValue(e&&e.values&&!_.isEmpty(e.values.grouped()),"dataViewCategorical must be defined and the grouped() function must return non-empty result"),u.assertValue(r,"seriesIndicesToRemove"),u.assert(function(){return Cs(r,!0)},"seriesIndicesToRemove is expected to be in descending order"),u.assert(function(){return _.uniq(r).length===r.length},"seriesIndicesToRemove must not contain duplicate values"),!_.isEmpty(r)){var n=e.values,i=n.grouped();if(i.length===r.length)return void Hy(t,e);var a=i[0].values.length;if(u.assert(function(){return _.every(i,function(d){return d.values.length===a})},"all series instances returned by grouped() are expected to have the same number of measure columns"),a>0)for(var o=t.columns,s=function(p){var h=p*a;u.assert(function(){return h+a-1<n.length},"Verifying that the index of the last column in this series instance is a valid index to the seriesAndMeasures array.");for(var v=h,g=h+a;v<g;v++)Bc(o,n[v].source);n.splice(h,a)},l=0,c=r;l<c.length;l++)s(c[l]);jo(i,r),n.grouped=function(){return i}}}(t,e,a)}}(t,e,n),r&&function(t,e,r){u.assertValue(e,"dataViewCategorical"),u.assertValue(r,"removalPredicate");var n=e.categories;if(!_.isEmpty(n)){var i=function(t,e){u.assertNonEmpty(t,"categories"),u.assertValue(e,"removalPredicate");var r=t[0].values.length;u.assert(function(){return _.every(t,function(a){return a.values.length===r})},"Expecting all category columns to have the same number of values.");for(var n=[],i=r-1;i>=0;i--)e(i,t)&&n.push(i);return n}(n,r);!function(t,e,r){if(u.assertValue(e,"dataViewCategorical"),u.assertValue(r,"rowIndicesToRemove"),u.assert(function(){return Cs(r,!0)},"rowIndicesToRemove is expected to be in descending order"),u.assert(function(){return _.uniq(r).length===r.length},"rowIndicesToRemove must not contain duplicate values"),!_.isEmpty(r)){if(fc(e)===r.length)return void Hy(t,e);u.assert(function(){return fc(e)>0},"If rowIndicesToRemove is non-empty, then the categorical must have at least 1 row.");var n=e.categories;if(!_.isEmpty(n))for(var i=0,a=n;i<a.length;i++){var o=a[i];jo(o.values,r),jo(o.identity,r)}var s=e.values;if(!_.isEmpty(s))for(var l=0,c=s;l<c.length;l++)jo(c[l].values,r)}}(t,e,i)}}(t,e,r)}(t.metadata,r,i,n)}return t}}function Qy(t){u.assertValue(t,"clientSideFilter");var e=t.Condition;if(e.Contains)return e.Contains.SelectIndex;u.assertFail("Unknown filter condition type: "+JSON.stringify(e))}function Wy(t,e){if(u.assertValue(t,"clientSideFilters"),u.assertValue(e,"metadataColumns"),_.isEmpty(t)||_.isEmpty(e))return[];for(var r={},n=0,i=e;n<i.length;n++)r[i[n].index]=!0;return _.filter(t,function(o){var s=Qy(o);return!!r[s]})}function jy(t,e){u.assertValue(t,"filter");var r=!1,n=t.Condition;return n.Contains?(u.assert(function(){return n.Contains.LiteralValue===Xi(n.Contains.LiteralValue)},"condition.Contains.LiteralValue is expected to have been normalized."),r=!_.isString(e)||!Ma(Xi(e),n.Contains.LiteralValue)):u.assertFail("ClientSideFilter condition type not implemented: "+JSON.stringify(n)),r}function Xi(t){return t&&Wr(t)}var JN=function(t){function e(r){var n=t.call(this)||this;return u.assertNonEmpty(r,"selects"),n.clientSideFilters=[],n.selects=r,n}return T(e,t),e.prototype.visitContains=function(r){if(!this.hasUnsupportedFilter()){var n=!1,i=Uc(r);if(i){var a=i.constantValue,o=Cd(this.selects,i.otherSide);if(o>=0&&a){var s={Condition:{Contains:{SelectIndex:o,LiteralValue:Xi(a)}}};this.clientSideFilters.push(s),n=!0}}n||this.setUnsupportedFilter()}},e.prototype.visitAnd=function(r){this.hasUnsupportedFilter()||(r.left.accept(this),r.right.accept(this))},e.prototype.visitDefault=function(r){this.setUnsupportedFilter()},e.prototype.getClientSideFiltersIfAllSupported=function(){if(!this.hasUnsupportedFilter())return this.clientSideFilters},e.prototype.hasUnsupportedFilter=function(){return void 0===this.clientSideFilters},e.prototype.setUnsupportedFilter=function(){this.clientSideFilters=void 0},e}(Ye);function Uc(t){if(t){var e=Iu(t.left);return e?{constantValue:e,otherSide:t.right}:{constantValue:e=Iu(t.right),otherSide:t.left}}}var X=function(){function t(){}return t.findAndParseCalculation=function(e,r){var n=this.findCalculation(e,r);if(n)return by(n.Value)},t.findAndParseCalculationToSQExpr=function(e,r){var n=this.findCalculation(e,r);if(n)return xc(n.Value)},t.findCalculation=function(e,r){u.assertValue(e,"calcs");for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a.Id===r)return a}},t.describeDataType=function(e,r){var n=0;switch(e=e||0){case 2048:n=1;break;case 1:n=3;break;case 3:n=4;break;case 4096:n=5;break;case 20:n=6;break;case 4:n=7;break;case 8:n=9;break;case 67:n=4,u.assert(function(){return!r||"Years"===r},"Unexpected category for Year type."),r="Years";break;case 35:n=4,u.assert(function(){return!r||"Months"===r},"Unexpected category for Month type."),r="Months"}return L.fromPrimitiveTypeAndCategory(n,r)},t.getTopLevelSecondaryDynamicMember=function(e,r){u.assertValue(e,"DsrV1.DataShape");var n=e.SecondaryHierarchy;return n?r&&r.Secondary?t.getDynamicMember(n,r.Secondary.Groupings,0):t.getDynamicMemberFallback(n):null},t.getTopLevelPrimaryDynamicMember=function(e,r,n){u.assertValue(e,"DsrV1.DataShape");var a,i=e.PrimaryHierarchy;return i?(n&&(a=void 0!==e.Calculations),r&&r.Primary?t.getDynamicMember(i,r.Primary.Groupings,0,a):t.getDynamicMemberFallback(i,a)):null},t.getDynamicMember=function(e,r,n,i){if(u.assertValue(e,"dataShapeMembers"),0===e.length)return null;if(!r||0===r.length)return t.getDynamicMemberFallback(e,i);var a=r[n].Member;if(!a)return t.getDynamicMemberFallback(e,i);for(var o=0,s=e;o<s.length;o++){var l=s[o];if(l.Id===a)return l}return null},t.getDynamicMemberFallback=function(e,r){return 2===e.length?e[1]:void 0===r||!0===r?e[0]:null},t.fillMetadataColumnAggregate=function(e,r,n){void 0===n&&(n=!0),u.assertValue(r,"aggregateMetdata");var i=r.source.aggregates;switch(i||(r.source.aggregates=i={}),r.aggregateKind){case 1:return void(i.subtotal=e);case 2:return void(i.max=e);case 3:return void(i.min=e);case 4:return void(n||(i.single=e));case 5:return u.assert(function(){return"number"==typeof e},"unexpected count calc value"),void(i.count=e);case 6:return void(i.average=e);case 8:return void(i.median=e);case 7:var a=r.aggregate.Percentile,o=i.percentiles;o||(o=i.percentiles=[]);var s={k:a.K,value:e};return null!=a.Exclusive&&(s.exclusive=a.Exclusive),void o.push(s);default:u.assertFail("unknown AggregateKind")}},t.copyAggregates=function(e,r){u.assertValue(e,"source Aggregates"),u.assertValue(r,"target Aggregates"),void 0!==e.subtotal&&(r.subtotal=e.subtotal),void 0!==e.min&&(r.min=e.min),void 0!==e.max&&(r.max=e.max),void 0!==e.minLocal&&(r.minLocal=e.minLocal),void 0!==e.maxLocal&&(r.maxLocal=e.maxLocal),void 0!==e.count&&(r.count=e.count)},t.computeAggIdx=function(e,r,n,i){return e+(i-r)*(n+1)},t}(),Oc=function(){function t(){}return Object.defineProperty(t.prototype,"name",{get:function(){return"maxLocal"},enumerable:!1,configurable:!0}),t.prototype.update=function(e){if("number"==typeof e&&!isNaN(e)){var r=this.current;this.current=void 0===r?e:Math.max(r,e)}},t.prototype.value=function(){return this.current},t}(),zc=function(){function t(){}return Object.defineProperty(t.prototype,"name",{get:function(){return"minLocal"},enumerable:!1,configurable:!0}),t.prototype.update=function(e){if("number"==typeof e&&!isNaN(e)){var r=this.current;this.current=void 0===r?e:Math.min(r||0,e)}},t.prototype.value=function(){return this.current},t}(),Zi=function(){function t(e){this.context=e,this.measureValueAggregatorsBySelectIdx=[]}return t.prototype.read=function(e,r){void 0===r&&(r=!0);for(var n=this.context,i=n.selects,a=new Array(i.length),o=new Array(i.length);e.nextCalc();){var s=n.aggregateCalcMetadata[e.calcId()];s&&s.aggregateKind&&(X.fillMetadataColumnAggregate(e.calcValue(),s,!1),3===s.aggregateKind&&(a[s.selectIdx]=!0),2===s.aggregateKind&&(o[s.selectIdx]=!0))}r&&this.addLocalAggregators(a,o)},t.prototype.addLocalAggregators=function(e,r){for(var n=this.measureValueAggregatorsBySelectIdx,i=this.context.measureSelectIndices,a=i.length,o=!1,s=0;s<a;s++){var l=i[s];e[l]||(o=!0,n[l]||(n[l]=[]),n[l].push(new zc)),r[l]||(o=!0,n[l]||(n[l]=[]),n[l].push(new Oc))}this.hasLocalAggregators=o},t.prototype.update=function(e,r){if(this.hasLocalAggregators){var n=this.measureValueAggregatorsBySelectIdx[r];if(n)for(var i=0,a=n;i<a.length;i++)a[i].update(e)}},t.prototype.copyToColumns=function(){for(var e=this.context.measureSelectIndices,r=e.length,n=0;n<r;n++){var i=e[n],a=this.context.selectIndexToColumn[i],o=this.measureValueAggregatorsBySelectIdx[i];if(o&&o)for(var s=0,l=o;s<l.length;s++){var c=l[s],f=c.value();void 0!==f&&(a.aggregates||(a.aggregates={}),a.aggregates[c.name]=f)}}},t}(),ea=function(){function t(e,r){this.context=e,this.calcIdToGroupingKeysIndex={},this.initialize(r)}return t.prototype.initialize=function(e){var n,r=this,i=this.context,a=i.selects,o=i.dataMemberIdToMetadata[e];this.identityFields=o.identityFields,this.identityFieldsCount=this.identityFields.length;var l=o.axisGrouping.Keys;u.assert(function(){return l.length===r.identityFieldsCount},"Mismatch in Identity Keys count");for(var c=0;c<this.identityFieldsCount;c++){var f=l[c],d=void 0;f.Calc?d=f.Calc:null!=f.Select&&f.Select>=0?d=o.forSynchronization?null===(n=a[f.Select].Synchronized)||void 0===n?void 0:n.Value:a[f.Select].Value:u.assertFail("unexpected grouping key value"),this.calcIdToGroupingKeysIndex[d]=c}},t.prototype.reset=function(){this.identityParts=new Array(this.identityFieldsCount)},t.prototype.addExpr=function(e,r){var n=this.calcIdToGroupingKeysIndex[e],i=this.identityFields[n];i&&(this.identityParts[n]=Nn(i,r))},t.prototype.getIdentity=function(){for(var n,e=this.identityParts,r=this.identityFieldsCount,i=0;i<r;i++)n=st(n,e[i]);var a=Et(n);return u.assertValue(a,"identity"),a},t.prototype.getIdentityFields=function(){return this.identityFields},t}();function Ky(t){return t.Schema||void 0}var ne=function(t){return t[t.None=0]="None",t[t.Group=1]="Group",t[t.Measure=2]="Measure",t}({}),Jy=function(){function t(){}return t.prototype.run=function(e,r,n){this.metadata=n,this.context=e,this.dsrParser=r,this.selectIndexToCategoryColumn={},this.selectIndexToPrimaryValueColumn={},this.selectIndexToDynamicFormatColumn={},this.intersectionValueColumnsMap=[],this.intersectionDynamicFormatColumnsMap=[],this.primaryMeasureCount=0,this.intersectionMeasureCount=0,this.seriesSelectIndex=-1,this.primaryMeasureSelectIndexMap=[],this.intersectionMeasuresSelectIndexMap=[],this.selectIndexToValueColumnsMap=[],r.reset(),this.aggregator=new Zi(e);var i=this.dsrParser.dataShapes();i.next();var a={};if(0===e.maxPrimaryDepth){this.readSelectsAndCreateCategoryColumns(void 0,void 0);var o=a.values=Tr();this.readMeasuresWithNoGrouping(i,o)}else{var s=[],l=[];a.categories=s,this.readSelectsAndCreateCategoryColumns(s,l),o=void 0,(this.intersectionMeasureCount>0||this.primaryMeasureCount>0||this.seriesSelectIndex>=0)&&(a.values=o=Tr()),this.readSecondaryAndCreateValueColumns(o);var c={};this.readData(i,o,l,c),void 0!==c.value&&(a.lastMergeIndex=c.value)}return a},t.isCompatible=function(e){return e.maxPrimaryDepth<=1&&e.maxSecondaryDepth<=1&&!(0===e.maxPrimaryDepth&&e.maxSecondaryDepth>0)&&_.size(e.selects)>0},t.prototype.readSelectsAndCreateCategoryColumns=function(e,r){var n=this.context,i=n.selectIndexToColumn,a=n.selects,o=a.length,s=this.dsrParser.dataShapes().secondaryHierarchy();this.primaryMeasureSelectIndexMap=new Array(a.length),this.intersectionMeasuresSelectIndexMap=new Array(a.length);for(var l=!!s,c=0;c<o;c++){var f=a[c];if(f&&f.Value)if(f.Kind===ne.Group){if(null!=f.SecondaryDepth){this.seriesSelectIndex=c;continue}if(null!=f.Depth){u.assert(function(){return null!=r},"Expected truthy value for identities"),u.assert(function(){return null!=e},"Expected truthy value for categories");var p={source:i[c],values:[],identity:r};e.push(p),this.selectIndexToCategoryColumn[c]=p}}else f.Kind===ne.Measure&&(l&&null==f.Depth?this.intersectionMeasuresSelectIndexMap[this.intersectionMeasureCount++]=c:this.primaryMeasureSelectIndexMap[this.primaryMeasureCount++]=c)}},t.prototype.readSecondaryAndCreateValueColumns=function(e){var r=this.dsrParser.dataShapes().secondaryHierarchy();r?(this.addIntersectionValueColumns(e,r),this.primaryMeasureCount>0&&this.addPrimaryValueColumns(e)):this.addPrimaryValueColumns(e,!0)},t.prototype.addIntersectionValueColumns=function(e,r){for(var i,n=new Array,a=this.context,o=function(){var c=r.id(),f=r.instances();if(2===a.dataMemberIdToMetadata[c].kind){for(;f.next(););return"continue"}var d=a.dataMemberIdToIdentityBuilder[c];d||(d=new ea(a,c),a.dataMemberIdToIdentityBuilder[c]=d),i=d.getIdentityFields();for(var p=-1;f.next();){p++,d.reset();for(var h=void 0,v=void 0;f.nextCalc();){v=f.calcId();var g=s.context.calcInfo[v];g.isGroupKeyButNotSelect||(h=f.calcValue()),g.forIdentity&&d.addExpr(v,f.calcValueAsExpr())}s.addIntersectionValueColumnsCore(e,n,v,h,p,d.getIdentity()),u.assert(function(){return null==f.intersections()},"unexpected secondary intersections"),u.assert(function(){return null==f.members()},"unexpected secondary nested members")}0===e.length&&0===n.length&&s.addIntersectionValueColumnsCore(e,n,void 0,void 0,0,void 0),e.grouped=function(){return n},e.source=s.context.selectIndexToColumn[s.seriesSelectIndex],e.identityFields=i},s=this;r.next();)o()},t.prototype.addIntersectionValueColumnsCore=function(e,r,n,i,a,o){for(var s,l,c,f=this.context,d=f.selects,p=this.intersectionMeasureCount,h=new Array(p),v=this.metadata.columns,g=function(E){var C=void 0,w=y.intersectionMeasuresSelectIndexMap[E];void 0!==i?((C=f.createColumns(v,w).column).groupName=i,C.rootSource=f.selectIndexToColumn[w]):C=_.find(v,function(J){return J.index===w});var M=y.createValueColumn(C,o,w,!!d[w].Highlight,!1);e.push(M),h[E]=M;var V=d[w],D=y.intersectionValueColumnsMap[a];D||(D=y.intersectionValueColumnsMap[a]={}),D[V.Value]=M;var A=V.Highlight&&V.Highlight.Value;if(A&&(D[A]=M),C.formatSource&&C.formatSource.formatString){u.assertValue(null===(s=V.DynamicFormat)||void 0===s?void 0:s.Format,"select.DynamicFormat.Format");var P=y.createValueColumn(C.formatSource.formatString,void 0,w,!!d[w].Highlight,!0),F=y.intersectionDynamicFormatColumnsMap[a];F||(F=y.intersectionDynamicFormatColumnsMap[a]={}),F[V.DynamicFormat.Format]=P,e.push(P);var N=null===(c=null===(l=V.Highlight)||void 0===l?void 0:l.DynamicFormat)||void 0===c?void 0:c.Format;N&&(F[N]=P)}},y=this,m=0;m<p;m++)g(m);var S={values:h};void 0!==i&&(S.name=i),void 0!==o&&(S.identity=o),r.push(S)},t.prototype.addPrimaryValueColumns=function(e,r){for(var n=new Array,i=this.context,a=i.selects,o=0;o<this.primaryMeasureCount;o++){var s=this.primaryMeasureSelectIndexMap[o],l=i.selectIndexToColumn[s],c=this.createValueColumn(l,void 0,s,!!a[s].Highlight,!1);if(this.selectIndexToPrimaryValueColumn[s]=c,n.push(c),e.push(c),l.formatSource&&l.formatSource.formatString){var f=this.createValueColumn(l.formatSource.formatString,void 0,s,!!a[s].Highlight,!0);this.selectIndexToDynamicFormatColumn[s]=f,e.push(f),n.push(f)}}if(r&&e){var d=[{values:n}];e.grouped=function(){return d}}},t.prototype.createValueColumn=function(e,r,n,i,a){var o={source:e,values:[]};if(i&&(o.highlights=[]),r&&(o.identity=r),!a){var s=this.selectIndexToValueColumnsMap[n];s||(s=this.selectIndexToValueColumnsMap[n]=[]),s.push(o)}return o},t.prototype.readData=function(e,r,n,i){var a=this.context,o=e.primaryHierarchy();this.aggregator.read(e,0===this.intersectionMeasureCount);for(var s=function(){var f=o.id(),d=a.dataMemberIdToMetadata[f];if(d){var p=1===d.kind,h=a.dataMemberIdToIdentityBuilder[f];!h&&p&&(h=new ea(a,f),a.dataMemberIdToIdentityBuilder[f]=h);for(var v=o.instances();v.next();){for(h&&h.reset(),1===v.restartFlagKind()&&(i.value=v.currentIndex());v.nextCalc();)l.readPrimaryHierarchyCalc(v,h);h&&n.push(h.getIdentity()),l.parseIntersections(v),u.assert(function(){return null==v.members()},"unexpected nested members to parse")}if(p)for(var g=h.getIdentityFields(),y=0;y<a.selects.length;y++){var m=l.selectIndexToCategoryColumn[y];m&&(m.identityFields=g)}}},l=this;o.next();)s();this.aggregator.copyToColumns(),this.copyAggregatesToValueColumns()},t.prototype.copyAggregatesToValueColumns=function(){for(var e=this.context.measureSelectIndices,r=this.context.selectIndexToColumn,n=e.length,i=0;i<n;i++){var a=e[i],o=r[a].aggregates;if(o){var s=this.selectIndexToPrimaryValueColumn[a];s&&X.copyAggregates(o,s);var l=this.selectIndexToValueColumnsMap[a];if(l)for(var c=0,f=l;c<f.length;c++)X.copyAggregates(o,f[c])}}},t.prototype.readPrimaryHierarchyCalc=function(e,r){var n=e.calcId(),i=this.context.aggregateCalcMetadata[n];if(i&&1===i.aggregateKind)X.fillMetadataColumnAggregate(e.calcValue(),i);else{var a=this.context.calcInfo[n];if(a){var o=e.calcValue();if(a.kind===ne.Group)u.assert(function(){return!!r},"Must have an identity builder when parsing grouping values"),a.isGroupKeyButNotSelect||this.selectIndexToCategoryColumn[a.selectIdx].values.push(o),a.forIdentity&&r.addExpr(n,e.calcValueAsExpr());else if(a.kind===ne.Measure){var s=a.calcKind;1===s?(this.selectIndexToPrimaryValueColumn[a.selectIdx].values.push(o),this.aggregator.update(o,a.selectIdx)):4===s?this.selectIndexToDynamicFormatColumn[a.selectIdx].values.push(o):3===s?this.selectIndexToPrimaryValueColumn[a.selectIdx].highlights.push(o):6===s&&this.selectIndexToDynamicFormatColumn[a.selectIdx].highlights.push(o)}}}},t.prototype.parseIntersections=function(e){var r=e.intersections();if(r)for(var n=this.context.calcInfo,i=0;r.next();){var a=this.intersectionValueColumnsMap[i],o=this.intersectionDynamicFormatColumnsMap[i];if(r.nextCalc()){if(!this.parseIntersectionCalc(r,a,o,n))continue;for(i++;r.nextCalc();)this.parseIntersectionCalc(r,a,o,n)}}},t.prototype.parseIntersectionCalc=function(e,r,n,i){var a=e.calcId(),o=i[a];if(o)switch(u.assert(function(){return o.kind===ne.Measure},"unexpected select kind found in intersection"),o.calcKind){case 1:return r[a].values.push(e.calcValue()),!0;case 3:return r[a].highlights.push(e.calcValue()),!0;case 4:return n[a].values.push(e.calcValue()),!0;case 6:return n[a].highlights.push(e.calcValue()),!0;case 2:case 5:return!1}},t.prototype.readMeasuresWithNoGrouping=function(e,r){this.aggregator.read(e),this.aggregator.copyToColumns();var n=e.primaryHierarchy();if(n.next()){this.addPrimaryValueColumns(r,!0);for(var i=this.context.calcInfo,a=n.instances();a.next();)for(var o=function(){var c=a.calcId(),f=i[c];f&&(u.assert(function(){return null!=f.selectIdx},"expect a selectIdx for all measures when there is no grouping"),1===f.calcKind?s.selectIndexToPrimaryValueColumn[f.selectIdx].values.push(a.calcValue()):3===f.calcKind?s.selectIndexToPrimaryValueColumn[f.selectIdx].highlights.push(a.calcValue()):4===f.calcKind?s.selectIndexToDynamicFormatColumn[f.selectIdx].values.push(a.calcValue()):6===f.calcKind&&s.selectIndexToDynamicFormatColumn[f.selectIdx].highlights.push(a.calcValue()))},s=this;a.nextCalc();)o()}},t}(),XN=function(){function t(e){u.assertValue(e,"Null RestartIdentities list"),u.assertNonEmpty(e,"Empty RestartIdentities list"),this.restartValuesCount=e.length,this.calcIdToRestartIdentityIndex={};for(var r=0;r<this.restartValuesCount;r++)this.calcIdToRestartIdentityIndex[e[r]]=r}return t.prototype.getRestartValues=function(e){u.assertValue(e,"getRestartValues called with undefined instanceParser");var r=new Array(this.restartValuesCount);for(e.restartCalcs();e.nextCalc();){var n=this.calcIdToRestartIdentityIndex[e.calcId()];void 0!==n&&(r[n]=e.calcValueAsExpr())}return u.assert(function(){return _.every(r,function(i){return!!i})},"Missing calcs for RestartValues"),r},t}(),ZN=function(){function t(e){this.values=e,this.parsedValues=new Array(e.length),this.parsedValueExprs=new Array(e.length)}return t.prototype.getCalcValue=function(e,r){if(!(e>=this.parsedValues.length)){var n=this.parsedValues[e];return void 0===n&&(n=Dc(this.values[e],r),this.parsedValues[e]=n),n}},t.prototype.getCalcValueExpr=function(e,r,n){if(!(r>=this.parsedValues.length)){var i=this.parsedValueExprs[r];return void 0===i&&(i=Ac(e,this.values[r],n),this.parsedValueExprs[r]=i),i}},t}(),ek=function(){function t(e){if(e)for(var r in this.resolvedValueDictionaries={},e)this.resolvedValueDictionaries[r]=new ZN(e[r])}return t.prototype.getCalcValue=function(e,r,n){if(r&&"number"==typeof e){u.assertValue(this.resolvedValueDictionaries,"this.context.resolvedValueDictionaries");var i=this.resolvedValueDictionaries[r];return u.assertValue(i,"dictionary"),i.getCalcValue(e,n)}},t.prototype.getCalcValueExpr=function(e,r,n,i){if(n&&"number"==typeof r){u.assertValue(this.resolvedValueDictionaries,"this.resolvedValueDictionaries");var a=this.resolvedValueDictionaries[n];return u.assertValue(a,"dictionary"),a.getCalcValueExpr(e,r,i)}},t}();function rk(t,e){u.assertValue(t.Expressions.Primary,"No primary groupings."),u.assertValue(t,"synchronizedGroup");for(var r=t.Expressions.Primary.Groupings,n=t.Select,i={},a=[],o=e.Groupings,s=0;s<o.length;s++)qc(i,r[o[s]].SynchronizedGroup,s,a,n,!0);return{dataMemberIdToMetadata:i,selects:n,maxPrimaryDepth:_.size(o),primaryDataMemberIdCache:a,memberInstanceCalcMetadataCache:{},calcIdToCalcMetadata:{},locked:!1,intersectionCalcMetadataCache:{},maxSecondaryDepth:0,secondaryDataMemberIdCache:void 0,instancesCalcCache:{},lastIntersectionCalcCache:{},intersectionMeasureToSelectIndex:[],secondaryLeafDataMemberId:void 0}}function qc(t,e,r,n,i,a){var o=n[r]=[],s=function(t,e){for(var r=t.length,n=new Array(r),i=0;i<r;i++)n[i]=Yy(t[i],t[i].Select,e);return n}(e.Keys,i),l=e.Member;if(l){o.push(l);var c=t[l]={identityFields:s,axisGrouping:e,kind:1,depth:r+1};a?c.forSynchronization=!0:e.SynchronizedGroup&&(c.isSynchronized=!0),e.RestartIdentities&&(c.restartValuesBuilder=new XN(e.RestartIdentities))}var f=e.SubtotalMember;f&&(o.push(f),c={identityFields:s,kind:2,depth:r},a?c.forSynchronization=!0:e.SynchronizedGroup&&(c.isSynchronized=!0),t[f]=c)}function Yy(t,e,r){u.assertValue(t,"key"),u.assertAnyValue(e,"selectIndex"),u.assertValue(r,"selectBindings");var n=t.Source;if(!n){u.assert(function(){return e>=0&&e<_.size(r)},"selectIndex should be within range");var i=r[e].Name;return i?wi(i):void u.assertFail("selectName should be defined")}return Re(je(Ky(n),n.Entity||n.EntitySet),n.Property)}var Hc=function(){function t(e,r,n,i,a){u.assertValue(e,"targets"),u.assert(function(){return null!=r.Select||null!=r.ScriptVisualBinding},"descriptor"),this.targets=e,this.descriptor=r,this.selects=r.Select,this.selectIndexToColumn={},this.aggregateCalcMetadata={},this._calcInfo={},this.calcIdToColumnIndices={},this.dataMemberIdToIdentityBuilder={};var o=r.Expressions;this._primaryAxisGroupings=o&&o.Primary&&o.Primary.Groupings,this._secondaryAxisGroupings=o&&o.Secondary&&o.Secondary.Groupings,this.measureSelectIndices=[],this.dataMemberIdToMetadata=n.dataMemberIdToMetadata,this.maxPrimaryDepth=n.maxPrimaryDepth,this.maxSecondaryDepth=n.maxSecondaryDepth,this.primarySynchronizedGroups=n.primarySynchronizedGroups,this.scopedAggregatesEnabled=i,this.dataShapeParser=a}return Object.defineProperty(t.prototype,"primaryAxisGroupings",{get:function(){return this._primaryAxisGroupings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"secondaryAxisGroupings",{get:function(){return this._secondaryAxisGroupings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"calcInfo",{get:function(){return this._calcInfo},enumerable:!1,configurable:!0}),t.prototype.createContextForPrimarySynchronizedGroup=function(e,r){var n=this,i=new t(this.targets,this.descriptor,e.context,this.scopedAggregatesEnabled,r);return i._primaryAxisGroupings=_.map(e.groupings,function(a){return n.primaryAxisGroupings[a].SynchronizedGroup}),i._secondaryAxisGroupings=void 0,i._calcInfo=this._calcInfo,i},t.prototype.includes=function(e){return u.assertValue(e,"kind"),ie(this.targets,e)},t.prototype.createDataViewMetadataColumns=function(){var e=this,r=this.selects;if(!_.isEmpty(r)){var n=[],i=r.length;this.selectIndexToColumnIndex=new Array(i);for(var a=function(h,v){var g=r[h];if(!g)return"continue";u.assert(function(){return g.Kind!==ne.None},"Expecting every select never to be of SelectKind.None");var y=o.createColumns(n,h),m=y.column,S=y.columnIdx,b=y.dynamicFormatColumn;o.selectIndexToColumn[h]=m,o.selectIndexToColumnIndex[h]=S,g.Kind===ne.Measure&&o.measureSelectIndices.push(h);var E=g.Aggregates;if(E)for(var C=0,w=E;C<w.length;C++){var M=w[C],V=o.getAggregateKind(M.Aggregate);o.createAggregateCalcMetadata(M.Ids,V,m,h,M.Aggregate)}var D=g.Value;D&&(o.calcIdToColumnIndices[D]||(o.calcIdToColumnIndices[D]=[]),o.calcIdToColumnIndices[D].push(S),(null==g.Depth||null==g.SecondaryDepth)&&(o.aggregateCalcMetadata[D]={source:m,aggregateKind:4,selectIdx:h})),g.Kind===ne.Measure&&(g.Subtotal&&o.createAggregateCalcMetadata(g.Subtotal,1,m,h),g.SubtotalDynamicFormat&&o.createAggregateCalcMetadata(_.map(g.SubtotalDynamicFormat,function(A){return A&&A.Format}),1,b,h),g.Count&&(u.assert(function(){return _.size(g.Count)<=1},"dataView cannot represent aggregates other than subtotal at different scopes yet"),o.createAggregateCalcMetadata(g.Count,5,m,h)),g.Max&&o.createAggregateCalcMetadata(g.Max,2,m,h),g.Min&&o.createAggregateCalcMetadata(g.Min,3,m,h))},o=this,s=0,l=i;s<l;s++)a(s);this.parseAxisGroupings(this.primaryAxisGroupings),this.parseAxisGroupings(this.secondaryAxisGroupings);var c=function(h){_.size(f.calcIdToColumnIndices[h])>1&&(f.calcInfo[h].hasDuplicateColumnIndices=!0,u.assert(function(){return!e.calcInfo[h].isGroupKeyButNotSelect},"calcs which represent group keys cannot have duplicate column indices"))},f=this;for(var d in this.calcIdToColumnIndices)c(d);return this.scopedAggregatesEnabled&&(this.createScopedAggregateMetadata(),this.fillDataShapeScopeAggregateValues()),n}},t.prototype.parseAxisGroupings=function(e){if(e)for(var r=0,n=e;r<n.length;r++){var i=n[r],a=i.SynchronizedGroup;if(a){this.parseGroupingKeys(a.Keys,!0);var o=i.SynchronizationIndex;o&&(this.calcInfo[o]={kind:ne.Measure,calcKind:10})}this.parseGroupingKeys(i.Keys,!1)}},t.prototype.parseGroupingKeys=function(e,r){for(var n,i,a=this.calcInfo,o=this.selects,s=0,l=e;s<l.length;s++){var c=l[s],f=o[c.Select];null!=f?r?(u.assertValue(null===(n=f.Synchronized)||void 0===n?void 0:n.Value,"Key of a Synchronized AxisGrouping should refer to Select with Synchronization"),a[null===(i=f.Synchronized)||void 0===i?void 0:i.Value].forIdentity=!0):a[f.Value].forIdentity=!0:c.Calc?a[c.Calc]={kind:ne.Group,forIdentity:!0,isGroupKeyButNotSelect:!0}:u.assertFail("Unexpected DataShapeExpressionAxisGroupingKey without select or calc")}},t.prototype.createAggregateCalcMetadata=function(e,r,n,i,a){for(var o=0,s=e;o<s.length;o++){var c=this.aggregateCalcMetadata[s[o]]={source:n,aggregateKind:r,selectIdx:i};a&&(c.aggregate=a)}},t.prototype.getAggregateKind=function(e){return e.Average?6:e.Max?2:e.Min?3:e.Median?8:e.Percentile?7:void 0},t.prototype.createColumns=function(e,r){var n=e.length,i=this.createMetadataColumn(r);e.push(i);var a=this.selects[r],o=a.Kind,s=this.calcInfo;s[a.Value]={kind:o,columnIndex:n,selectIdx:r,calcKind:1};var l=a.Synchronized;if(l&&(u.assert(function(){return o===ne.Group},"Synchronization Auxiliary Select is expected only for Grouping Selects"),u.assertValue(l.Value,"Synchronization Auxiliary Select must have a Value"),u.assertValue(l.GroupKeys,"Synchronization Auxiliary Select must have GroupKeys"),s[l.Value]={kind:o,columnIndex:n,selectIdx:r,calcKind:1},s[a.Value].isSynchronized=!0),a.Subtotal){u.assert(function(){return o===ne.Measure},"Subtotal SelectKind");for(var c=0,f=a.Subtotal;c<f.length;c++)s[d=f[c]]={columnIndex:n,kind:o,selectIdx:r,calcKind:2}}if(a.Highlight){u.assert(function(){return o===ne.Measure},"Highlight SelectKind");var p=a.Highlight.Value;p&&(s[p]={columnIndex:n,kind:o,selectIdx:r,calcKind:3});var h=a.Highlight.Subtotal;if(h)for(var v=0,g=h;v<g.length;v++)s[d=g[v]]={columnIndex:n,kind:o,selectIdx:r,calcKind:9}}if(this.scopedAggregatesEnabled){if(!_.isEmpty(a.Aggregates))for(var y=0,m=a.Aggregates;y<m.length;y++)if((S=m[y]).Aggregate.Scope)for(var b=0,E=S.Ids;b<E.length;b++)s[E[b]]={columnIndex:n,kind:o,selectIdx:r,calcKind:7};var w=a.Highlight;if(w&&!_.isEmpty(w.Aggregates))for(var V=0,D=w.Aggregates;V<D.length;V++){var S;if((S=D[V]).Aggregate.Scope)for(var A=0,P=S.Ids;A<P.length;A++)s[P[A]]={columnIndex:n,kind:o,selectIdx:r,calcKind:8}}}var F=this.tryCreateDynamicFormatColumnMetadata(r,i);if(F){u.assert(function(){return o===ne.Measure},"Dynamic Format SelectKind");var N=n+1;if(e.push(F),s[a.DynamicFormat.Format]={columnIndex:N,kind:ne.Measure,selectIdx:r,calcKind:4},a.SubtotalDynamicFormat)for(var J=0,le=a.SubtotalDynamicFormat;J<le.length;J++){var d,ce=(d=le[J])&&d.Format;ce&&(s[ce]={columnIndex:N,kind:ne.Measure,selectIdx:r,calcKind:5})}var Y=a.Highlight&&a.Highlight.DynamicFormat&&a.Highlight.DynamicFormat.Format;Y&&(s[Y]={columnIndex:N,kind:ne.Measure,selectIdx:r,calcKind:6})}return{column:i,columnIdx:n,dynamicFormatColumn:F}},t.prototype.createMetadataColumn=function(e){var r=this.selects[e],n={displayName:"",index:e};r.Format&&(n.format=r.Format),n.type=X.describeDataType(r.Type,r.DataCategory),r.Kind===ne.Measure&&(n.isMeasure=!0);var i=r.GroupKeys;if(i)for(var a=n.identityExprs=new Array(i.length),o=0;o<i.length;o++)a[o]=Yy(i[o],e,this.selects);return n},t.prototype.tryCreateDynamicFormatColumnMetadata=function(e,r){var n=this.selects[e];if(n.DynamicFormat&&n.DynamicFormat.Format){var i={displayName:"",isMeasure:!0};return r.formatSource={formatString:i},i}},t.prototype.createScopedAggregateMetadata=function(){for(var e=this.selects,n=this.selectIndexToColumn,i=0,a=e.length;i<a;i++){var o=e[i];if(o){var s=o.Aggregates,l=n[i];if(!_.isEmpty(s))for(var c=0,f=s;c<f.length;c++)this.createScopedAggregateCalcMetadata(f[c],l);var p=o.Highlight;if(p&&!_.isEmpty(p.Aggregates))for(var v=0,g=p.Aggregates;v<g.length;v++)this.createScopedAggregateCalcMetadata(g[v],l)}}},t.prototype.createScopedAggregateCalcMetadata=function(e,r){var n=e.Aggregate,i=n.Scope;if(i){var a=this.selectIndexToColumn,o=i.PrimaryDepth;u.assert(function(){return void 0===i.SecondaryDepth},"Scoped Aggregates not supports secondary depth for now.");for(var s=new Array(o),l=this.primaryAxisGroupings,c=0,f=0;f<o;f++)for(var p=0,h=l[f].Keys;p<h.length;p++){var g=h[p].Select;u.assertValue(g,"select");var y=a[g];u.assertValue(y,"inputScopeColumn"),s[c++]=y}for(var m={column:r,inputScope:s,respectInstanceFilters:n.RespectInstanceFilters},b=this.calcInfo,E=0,C=e.Ids;E<C.length;E++){var M=b[C[E]];u.assertValue(M,"aggregateCalcInfo"),M.scopedAggregateCalcMetadata={metadata:m,aggregateKind:this.getAggregateKind(n)}}}},t.prototype.fillDataShapeScopeAggregateValues=function(){var e=this.dataShapeParser;if(e){var r=this.calcInfo;e.reset();var n=e.next();u.assert(function(){return n},"There must be a DataShape");for(var i=function(){var o=r[e.calcId()];if(!o||!o.scopedAggregateCalcMetadata)return"continue";var s=o.scopedAggregateCalcMetadata,l=s.metadata,c=l.column,f=l.inputScope,d=l.respectInstanceFilters,p={inputScope:f,respectInstanceFilters:d,values:{},highlight:{}};if(c.scopedAggregates){var h=_.find(c.scopedAggregates,function(y){return t.sameScopedAggregatesInputScope(y.inputScope,f)&&y.respectInstanceFilters===d});h?p=h:c.scopedAggregates.push(p)}else c.scopedAggregates=[p];var v=void 0;switch(o.calcKind){case 7:v=p.values;break;case 8:v=p.highlight;break;default:u.assertFail("Invalid CalcKind.")}var g=e.calcValue();switch(s.aggregateKind){case 3:v.min=g;break;case 2:v.max=g;break;case 6:v.avg=g;break;default:u.assertFail("Invalid scoped aggregate function.")}};e.nextCalc();)i()}},t.sameScopedAggregatesInputScope=function(e,r){if(e===r)return!0;if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==r[n])return!1;return!0},t}(),ak=function(){function t(e,r,n,i){this.context=e,this.dsrParser=r,this.metadata=n,u.assertValue(e,"context"),u.assertValue(r,"dsrParser"),u.assertValue(n,"metadata"),u.assertNonEmpty(n.columns,"metadata.columns"),this.aggregator=new Zi(e),this.scopedAggregatesEnabled=i}return t.prototype.run=function(){var e=this,r=this.aggregator,n=this.dsrParser;n.reset();var i=n.dataShapes();this.calcInfoCache={};var a=i.next();u.assert(function(){return a},"There must be a DataShape"),this.createHierarchiesLevels(),this.readValueSources(i),u.assert(function(){return e.context.maxPrimaryDepth>0||!_.isEmpty(e.context.measureSelectIndices)},"DSR is not compatible with Matrix"),r.read(i,1===this.context.maxPrimaryDepth&&0===this.context.maxSecondaryDepth);var o=i.secondaryHierarchy(),s=this.readHierarchy(1,o,i),l=i.primaryHierarchy(),c=this.readHierarchy(0,l,i);return r.copyToColumns(),{rows:c,columns:s,valueSources:this.valueSources}},t.prototype.createHierarchiesLevels=function(){var e=this.context.selects,r=this.context.maxPrimaryDepth,n=this.context.maxSecondaryDepth;this.primaryHierarchyLevels=new Array(r),this.secondaryHierarchyLevels=new Array(n);for(var i=0;i<r;i++)this.primaryHierarchyLevels[i]={sources:[]};for(i=0;i<n;i++)this.secondaryHierarchyLevels[i]={sources:[]};var a=this.metadata.columns,o=a.length,s=this.columnIndexToZoneIndex=new Array(o);for(i=0;i<o;i++){var l=a[i],c=l.index;if(null!=c){var f=e[c],d=void 0;f.Kind===ne.Group&&(null!=f.Depth?d=this.primaryHierarchyLevels[f.Depth].sources:null!=f.SecondaryDepth&&(d=this.secondaryHierarchyLevels[f.SecondaryDepth].sources),u.assertValue(d,"Grouping Select not belonging to either Hierarchy"),s[i]=d.length,d.push(l))}}},t.prototype.readHierarchy=function(e,r,n){var i,a,o=this.valueSources.length;switch(e){case 0:if(a=this.context.maxPrimaryDepth,!(i=this.context.primaryAxisGroupings))return u.assert(function(){return 0===a},"No primary groupings"),u.assert(function(){return o>0},"Matrix without groups needs at least a measure"),this.createRowHierarchyForNoGroupings(r);break;case 1:if(a=this.context.maxSecondaryDepth,!(i=this.context.secondaryAxisGroupings))return u.assert(function(){return 0===a},"No secondary groupings"),0===o?{levels:[],root:{children:[]}}:this.createColumnHierarchyForNoGroupings();break;default:u.assertFail("Unexpected DataShapeHierarchy")}u.assert(function(){return a===_.size(i)},"Groupings-Hierarchy mismatch");var s={levels:0===e?this.primaryHierarchyLevels:this.secondaryHierarchyLevels,root:{}};1===e&&o>1&&s.levels.push(this.createColumnHierarchyMeasuresLevel());var l=this.context.primarySynchronizedGroups;0===e&&l&&this.readRowsSynchronizedGroups(l,s,n);var c=this.context;return this.readNodeChildren(c,c.calcInfo,this.columnIndexToZoneIndex,c.dataMemberIdToIdentityBuilder,c.dataMemberIdToMetadata,s.root,r,0,e,o,this.context.maxSecondaryDepth,s.levels),!_.isEmpty(s.root.children)&&!_.isEmpty(s.synchronizedGroups)&&this.ensureRowNodeSynchronization(s.root,0),s},t.prototype.readRowsSynchronizedGroups=function(e,r,n){u.assertNonEmpty(e,"No Primary Synchronized Groups"),u.assertValue(r,"hierarchy");var i=e.length;r.synchronizedGroups=new Array(i),this.primarySynchronizedGroupByLevel=new Array(r.levels.length);for(var a=n.nestedDataShapes(),o=function(f){var d=e[f],p=d.groupings;u.assert(function(){return!_.isEmpty(p)},"Empty synchronized group");var h=a[d.dataShapeId];u.assertValue(h,"no dataShapeParser for a SynchronizedGroup");var v=h.next();u.assert(function(){return v},"Nested DataShape not found");var g=h.primaryHierarchy();u.assertValue(g,"Nested DataShape of a Synchronized Group has no Primary Hierarchy");for(var y=r.synchronizedGroups[f]={levels:new Array,root:{}},m=0;m<p.length;m++){var S=p[m],b=y.levels[m]=r.levels[S];b.valueSources&&((r.levels[S]=ve(b)).valueSources=b.valueSources,delete b.valueSources)}s.primarySynchronizedGroupByLevel[p[0]]=y;for(var C=s.metadata.columns,w=new Array(C.length),M=function(P){for(var F=C[P],N=0,J=y.levels;N<J.length;N++){var ce=_.findIndex(J[N].sources,function(Y){return Y===F});if(ce>-1){w[P]=ce;break}}},V=0;V<C.length;V++)M(V);var D=s.context.createContextForPrimarySynchronizedGroup(d,h);s.readNodeChildren(D,D.calcInfo,w,D.dataMemberIdToIdentityBuilder,D.dataMemberIdToMetadata,y.root,g,0,0,0,D.maxSecondaryDepth,y.levels,{currentIndex:0})},s=this,l=0;l<i;l++)o(l)},t.prototype.readNodeChildren=function(e,r,n,i,a,o,s,l,c,f,d,p,h){if(s&&0!==s.count())for(var v;s.next();){var g=s.id(),y=a[g];if(y){var m=2===y.kind,S=m&&0===l,b=void 0,E=void 0;m||((b=i[g])||(b=i[g]=new ea(e,g)),E=b.getIdentityFields());var C=s.instances();if(!C||0===C.count())continue;E&&(o.childIdentityFields=E),v||(v=o.children=[]);var w=this.calcInfoCache[g];for(null==w&&(w=this.calcInfoCache[g]=[]);C.next();){var M=this.readNode(e,y,i,a,r,n,C,l,m,S,w,c,f,d,b,y.restartValuesBuilder,p,h);v.push(M),h&&h.currentIndex++}}}},t.prototype.readNode=function(e,r,n,i,a,o,s,l,c,f,d,p,h,v,g,y,m,S){u.assert(function(){return!!g==!c},"Unexpected IdentityBuilder"),u.assert(function(){return!(c&&y)},"Subtotal nodes should not have RestartValues");var b=e.aggregateCalcMetadata,E={level:l};r.forSynchronization&&(u.assertValue(S,"undefined synchronizedGroupLeafIndex while parsing Master List"),E.synchronizationIndex=S.currentIndex),1===s.restartFlagKind()&&(E.isMerge=!0),c?E.isSubtotal=!0:g.reset();for(var C=[],w=r.isSynchronized,M=function(le){var ce=s.calcId(),Y=d[le];if(!Y){if(!(Y=a[ce]))return"continue";d[le]=Y}if(10===Y.calcKind){var Ve=s.calcValue();return u.assert(function(){return"number"==typeof Ve},"Synchronization Index is expected to be a number"),E.synchronizationIndex=Ve,"continue"}var Te=Y.columnIndex;u.assert(function(){return!0===Y.isGroupKeyButNotSelect==(null==Te)},"Unexpected columnIndex");var xe=o[Te];u.assert(function(){return!0===Y.isGroupKeyButNotSelect==(null==xe)},"Unexpected zoneIndex");var Ne=Y.kind,fe=void 0;if(Ne===ne.Group){if(!w){var Pe=s.calcValueAsExpr();fe=Pe.value,Y.isGroupKeyButNotSelect||(C[xe]={value:fe,levelSourceIndex:xe}),g.addExpr(ce,Pe)}}else if(Ne===ne.Measure){u.assertValue(Y.selectIdx,"Measure Calc ".concat(ce," on DataMember instances must be related to a Select"));var pt=V.measuresGroupingScopeBySelectIndex[Y.selectIdx];u.assertValue(pt,"Calc ".concat(ce," has an undefined grouping scope")),u.assert(function(){return 0===pt.secondary},"Calc ".concat(ce," is grouped by Secondary while appearing on DataMember")),u.assert(function(){return 0===p},"Measure Calcs cannot appear on Secondary Hierarchy DataMembers");var ni,kr=void 0;0===v&&pt.primary===m.length?(ni=h,null==E.values&&(kr=E.values={}),kr=E.values):(ni=m[l].valueSources[0].length,E.nodeValues||(E.nodeValues={0:{}}),kr=E.nodeValues[0]),u.assert(function(){return xe<ni},"Measure index out-of-bound");var ii=kr[xe];ii||(ii=kr[xe]={},xe>0&&(ii.valueSourceIndex=xe)),fe=s.calcValue(),V.readNodeValueCalc(ii,fe,Y),V.scopedAggregatesEnabled&&Y.scopedAggregateCalcMetadata&&V.setScopeAggregateValue(E,fe,Y,m[l-1]),f&&(2===Y.calcKind||5===Y.calcKind)&&(u.assertValue(e.aggregateCalcMetadata[ce],"Grand Total AggregateMetadata is undefined"),X.fillMetadataColumnAggregate(fe,b[ce]))}else u.assertFail("Unexpected SelectKind");if(!w&&Y.hasDuplicateColumnIndices)for(var ai=0,ha=e.calcIdToColumnIndices[ce];ai<ha.length;ai++){var ht=o[ha[ai]];C[ht]||(C[ht]={value:fe,levelSourceIndex:ht})}},V=this,D=0;s.nextCalc();D++)M(D);if(!c&&!w){E.levelValues=C,E.value=C[0].value,E.identity=g.getIdentity();var A=s.restartKind();A&&(1===A?E.restartKind=1:2===A?E.restartKind=2:3===A&&(E.restartKind=3),E.restartKind&&(u.assertValue(y,"An instance with RestartKind must belong to a DataMember with RestartIdentity"),E.restartValues=y.getRestartValues(s)))}var P=s.intersections(),F=s.members();if(P)u.assert(function(){return null==F},"non-leaf node with intersections"),this.readIntersectionsValues(a,o,h,E,P);else if(F){if(u.assert(function(){return null==P},"non-leaf node with intersections"),this.readNodeChildren(e,a,o,n,i,E,F,l+1,p,h,v,m,S),r.isSynchronized&&!_.isEmpty(E.children)){var N=E.children[0].synchronizationIndex;void 0!==N&&(E.synchronizationIndex=N)}}else 1===p&&h>1&&(l===v-1||E.isSubtotal)&&this.createColumnHierarchyMeasuresNodes(E);return E},t.prototype.setScopeAggregateValue=function(e,r,n,i){u.assertValue(e,"node"),u.assert(function(){return void 0!==r},"calcValue"),u.assertValue(n,"calcInfo");var s,a=n.scopedAggregateCalcMetadata,o=this.findDataViewNodeAggregates(e,a.metadata);switch(n.calcKind){case 7:s=o.values;break;case 8:s=o.highlight;break;default:u.assertFail("Invalid Aggregate CalcInfo.")}switch(a.aggregateKind){case 2:s.max=r;break;case 3:s.min=r;break;case 6:s.avg=r;break;default:u.assertFail("Unexpected DataViewAggregateKind.")}var l=a.metadata,c=i.aggregates;c?_.some(c,function(d){return d.column===l.column&&Hc.sameScopedAggregatesInputScope(d.inputScope,l.inputScope)&&d.respectInstanceFilters===l.respectInstanceFilters})||c.push(l):i.aggregates=[l]},t.prototype.findDataViewNodeAggregates=function(e,r){var i,n=e.aggregateValues;return n?(i=_.find(n,function(a){var o=a.metadata;return o.column===r.column&&Hc.sameScopedAggregatesInputScope(o.inputScope,r.inputScope)&&o.respectInstanceFilters===r.respectInstanceFilters}))||n.push(i={metadata:r,values:{},highlight:{}}):e.aggregateValues=[i={metadata:r,values:{},highlight:{}}],i},t.prototype.readIntersectionsValues=function(e,r,n,i,a){if(0!==n)for(var o=i.values={},s=0;a.next();){for(var l=0;l<n;l++){var c=o[n*s+l]={};l>0&&(c.valueSourceIndex=l)}for(;a.nextCalc();){var f=e[a.calcId()];if(f){var d=r[f.columnIndex];u.assertValue(d,"Intersection calculation has no matching column index"),u.assertValue(c=o[n*s+d],"nodeValue not found"),this.readNodeValueCalc(c,a.calcValue(),f)}}s++}},t.prototype.readNodeValueCalc=function(e,r,n){switch(u.assertValue(e,"nodeValue"),u.assert(function(){return void 0!==r},"calcValue"),u.assertValue(n,"calcInfo"),n.calcKind){case 1:case 4:e.value=r,this.aggregator.update(r,n.selectIdx);break;case 2:case 5:e.value=r;break;case 3:case 6:case 9:e.highlight=r;break;case 7:case 8:case 10:break;default:u.assertNever(n.calcKind)}},t.prototype.createRowHierarchyForNoGroupings=function(e){var r={level:0,values:{}},n={levels:[],root:{children:[r]}};u.assert(function(){return 1===e.count()},"DSR with no groupings should have one DataMember"),e.next();var i=e.instances();return u.assertValue(i,"instancesParser"),this.readNodeForNoGroupings(r,i),n},t.prototype.readNodeForNoGroupings=function(e,r){u.assert(function(){return 1===r.count()},"DSR with no groupings should have one Instance");var n=this.context.calcInfo,i=this.columnIndexToZoneIndex;r.next();for(var a=e.values={};r.nextCalc();){var s=n[r.calcId()];if(s){var l=i[s.columnIndex],c=a[l];c||(c=a[l]={},l>0&&(c.valueSourceIndex=l)),this.readNodeValueCalc(c,r.calcValue(),s)}}},t.prototype.createColumnHierarchyForNoGroupings=function(){var e=[],r={};return this.valueSources.length>0&&(e=[this.createColumnHierarchyMeasuresLevel()],this.createColumnHierarchyMeasuresNodes(r)),{levels:e,root:r}},t.prototype.createColumnHierarchyMeasuresLevel=function(){for(var e=this.valueSources.length,r=new Array(e),n=0;n<e;n++)r[n]=this.valueSources[n];return{sources:r}},t.prototype.createColumnHierarchyMeasuresNodes=function(e){for(var r=null==e.level?0:this.context.maxSecondaryDepth,n=this.valueSources.length,i=e.children=new Array(n),a=e.isSubtotal,o=0;o<n;o++){var s=i[o]={level:r};o>0&&(s.levelSourceIndex=o),a&&(s.isSubtotal=!0)}},t.prototype.readValueSources=function(e){var r=this,n=this.context,i=n.selects,a=n.measureSelectIndices,o=a.length,s=n.selectIndexToColumn,l=n.selectIndexToColumnIndex,c=this.columnIndexToZoneIndex;u.assertValue(a,"measureSelectIndices"),this.valueSources=[],this.measuresGroupingScopeBySelectIndex={};var f={};if(e.calcCount()>0){for(;e.nextCalc();)f[e.calcId()]=!0;e.restartCalcs()}for(var d=function(g){var y=a[g],m=i[y];u.assert(function(){return m.Kind===ne.Measure},"Expected a Measure Select"),u.assertValue(m.Value,"Every Measure Select must have a Calc Id");var S=l[y],b=p.measuresGroupingScopeBySelectIndex[y]=p.getMeasureGroupingScope(m,f[m.Value]);if(!b)return"continue";var E=b.primary,C=b.secondary,w=void 0;if(E===p.context.maxPrimaryDepth&&C===p.context.maxSecondaryDepth)w=p.valueSources;else{u.assert(function(){return 0===C},"Currently, Arbitrary-scoping of measures only supports suppresing projections on all Secondary"),u.assert(function(){return E<=r.primaryHierarchyLevels.length},"Arbitrary-scope cannot be more specific than inner-most scope");var M=p.primaryHierarchyLevels[E-1];M.valueSources||(M.valueSources={0:[]}),w=M.valueSources[0]}var V=s[y];if(u.assertValue(V,"Measure column not found"),c[S]=w.length,w.push(V),m.DynamicFormat&&m.DynamicFormat.Format){var D=V.formatSource&&V.formatSource.formatString;u.assertValue(D,"DynamicFormat column not found"),c[S+1]=w.length,w.push(D)}},p=this,h=0;h<o;h++)d(h)},t.prototype.getMeasureGroupingScope=function(e,r){return null==e.Depth&&null==e.SecondaryDepth?r?null:{primary:this.context.maxPrimaryDepth,secondary:this.context.maxSecondaryDepth}:{primary:null!=e.Depth?e.Depth+1:0,secondary:null!=e.SecondaryDepth?e.SecondaryDepth+1:0}},t.prototype.ensureRowNodeSynchronization=function(e,r){var n=this;if(u.assert(function(){return!n.isRowLeaf(e)},"Attempting to traverse Hierarchy beyond leaves"),!this.isRowLeaf(e)){var i=this.primarySynchronizedGroupByLevel[r];if(i)return void this.synchronizeNodeChildren(e,i.root);var a=e.children;u.assertNonEmpty(a,"Jagged hierarcy found!");for(var o=r+1,s=0,l=a;s<l.length;s++)this.ensureRowNodeSynchronization(l[s],o)}},t.prototype.synchronizeNodeChildren=function(e,r){if(!this.isRowLeaf(e)){var n=e.level+1,i=r.children;if(_.isEmpty(i))return void this.ensureRowNodeSynchronization(e,n);var a=i.length,o=e.children||[],s=new Array(a);e.children=s;var c,f,l=0;f=null==(c=l<o.length?o[l]:void 0)?void 0:c.synchronizationIndex;for(var d=0;d<a;d++){var p=i[d],h=p.synchronizationIndex,v=this.copyFromMasterNode(p);v.level=n,s[d]=v,c&&f===h?(u.assert(function(){return c.level===n},"A child node's level must come immediately after its parents level"),this.copyFromExistingNode(c,v),this.synchronizeNodeChildren(v,p),l++,f=null==(c=l<o.length?o[l]:void 0)?void 0:c.synchronizationIndex):void 0===f||h<f?this.isRowLeaf(v)||(v.children=[],this.synchronizeNodeChildren(v,p)):u.assertFail("Unsynchronized nodes should be a subset of master list nodes.")}}},t.prototype.copyFromMasterNode=function(e){var r={};if(r.synchronizationIndex=e.synchronizationIndex,e.identity&&(r.identity=e.identity),void 0!==e.value&&(r.value=e.value),void 0!==e.isSubtotal&&(r.isSubtotal=e.isSubtotal),e.levelValues){var n=e.levelValues.length;r.levelValues=new Array(n);for(var i=0;i<n;i++){var a=e.levelValues[i];r.levelValues[i]={value:a.value,levelSourceIndex:a.levelSourceIndex}}}return void 0!==e.restartKind&&(r.restartKind=e.restartKind),void 0!==e.restartValues&&(r.restartValues=e.restartValues),r},t.prototype.copyFromExistingNode=function(e,r){e.aggregateValues&&(r.aggregateValues=e.aggregateValues),e.values&&(r.values=e.values),e.nodeValues&&(r.nodeValues=e.nodeValues),u.assert(function(){return!(_.isEmpty(e.children)&&!_.isEmpty(r.children))},"A non-leaf master node matches a leaf node"),e.children&&(r.children=e.children),e.childIdentityFields&&!r.childIdentityFields&&(r.childIdentityFields=e.childIdentityFields)},t.prototype.isRowLeaf=function(e){return!(e.level!==this.context.maxPrimaryDepth-1&&!e.isSubtotal||(u.assert(function(){return _.isEmpty(e.children)},"A leaf node should not have children"),0))},t}(),$y=function(){function t(e,r){this.context=e,this.dsrParser=r,this.aggregator=new Zi(e)}return t.prototype.run=function(){return this.parseSingle()},t.prototype.parseSingle=function(){var e=this.dsrParser;e.reset();var r=e.dataShapes(),n=r.next();return u.assert(function(){return n},"There must be a DataShape"),this.aggregator.read(r,!1),this.aggregator.copyToColumns(),0===this.context.maxPrimaryDepth?this.parseMeasureValue(r.primaryHierarchy()):this.parseSubtotal(r.primaryHierarchy())},t.prototype.parseMeasureValue=function(e){for(u.assert(function(){return 1===e.count()},"call parseMeasureValue only when there's one datamember with no grouping");e.next();)return this.parseInstance(e.instances())},t.prototype.parseSubtotal=function(e){for(;e.next();)if(2===this.context.dataMemberIdToMetadata[e.id()].kind)return this.parseInstance(e.instances())},t.prototype.parseInstance=function(e){for(var i,a,r=this.context,n=r.calcInfo;e.next();)for(;e.nextCalc();){var o=e.calcId(),s=n[o];if(s){var l=s.calcKind,c=2===l;(1===l||c)&&(i=e.calcValue(),a=s.selectIdx,c&&(u.assertValue(r.aggregateCalcMetadata[o],"AggregateCalcMetadata for calc must exist."),X.fillMetadataColumnAggregate(i,r.aggregateCalcMetadata[o])))}}if(void 0!==i)return{column:r.selectIndexToColumn[a],value:i}},t.isCompatible=function(e){return 0===e.maxSecondaryDepth&&1===e.measureSelectIndices.length},t}(),uk=function(){function t(e,r,n){this.context=e,this.dsrParser=r,this.metadata=n,u.assertValue(e,"context"),u.assertValue(r,"dsrParser"),u.assertValue(n,"metadata"),this.aggregator=new Zi(e)}return t.prototype.run=function(){if(this.isCompatible()){var r={columns:this.metadata.columns},n=this.dsrParser;n.reset();var i=n.dataShapes(),a=i.next();u.assert(function(){return a},"There must be a DataShape");var o=this.aggregator;o.read(i);var s=i.primaryHierarchy();return 1===this.context.maxPrimaryDepth?this.readRows(r,s):0===this.context.maxPrimaryDepth?this.readRowWithoutGrouping(r,s):u.assert(function(){return!1},"Upsupported maxPrimaryDepth value"),o.copyToColumns(),r}},t.prototype.readRows=function(e,r){var i,o,n=this.context,a=this.getRowCellsCount(r);for(r.reset();r.next();){var s=r.id(),l=n.dataMemberIdToMetadata[s];if(l){var c=l.kind,f=r.instances(),d=[];if(1===c){var p=n.dataMemberIdToIdentityBuilder[s];p||(p=n.dataMemberIdToIdentityBuilder[s]=new ea(n,s));var h=l.axisGrouping,v=f.count();i=new Array(v);for(var g=new Array(v),y=0;f.next();y++)1===f.restartFlagKind()&&(o=y),p.reset(),i[y]=this.readRow(f,h,d,a,p,!1),g[y]=p.getIdentity();_.isEmpty(g)||(e.identity=g),e.identityFields=p.getIdentityFields()}else if(2===c){if(0===a)continue;for(;f.next();){u.assert(function(){return null==e.totals},"Totals can only be assigned once.");var m=this.readRow(f,null,d,a,null,!0),S=m.length;for(y=0;y<S;y++)void 0===m[y]&&(m[y]=null);e.totals=m}}else u.assert(function(){return!1},"Unsupported DataMemberKind");e.rows=i,void 0!==o&&(e.lastMergeIndex=o)}}},t.prototype.readRow=function(e,r,n,i,a,o){var c,s=this.aggregator,l=new Array(i),f=0===n.length;f&&r&&(u.assert(function(){return e.calcCount()>0},"No DataShape with a single primary DataMember should ever have a DataMember instance with no calculations."),c=this.createCalcIdToGroupingIdentityIndexMap(r),n.length=e.calcCount());for(var d=this.context,p=d.aggregateCalcMetadata,h=0;e.nextCalc();h++){var v=e.calcId();if(f){var g=c&&c[v],y=d.calcInfo[v],m=y&&y.columnIndex;y&&(3===y.calcKind||6===y.calcKind||9===y.calcKind)&&(m=null),n[h]={axisGroupingIndex:g,columnIndex:m,hasDuplicateColumnIndices:y&&y.hasDuplicateColumnIndices,isGroupKeyOnly:null!=g&&null==m,selectIndex:y&&y.selectIdx,aggregateMetadata:p[v]}}var b=n[h];if(null!=b.columnIndex){var E=e.calcValue();if(l[b.columnIndex]=E,o?X.fillMetadataColumnAggregate(E,b.aggregateMetadata):s.update(E,b.selectIndex),b.hasDuplicateColumnIndices)for(var C=0,w=d.calcIdToColumnIndices[v];C<w.length;C++){var M=w[C];void 0===l[M]&&(l[M]=E)}}a&&a.addExpr(v,e.calcValueAsExpr())}return l},t.prototype.readRowWithoutGrouping=function(e,r){if(u.assert(function(){return r.count()<=1},"There must be maximum one DataMember, because SubTotalMember are not supported without grouping."),r.next()){var n=r.instances(),i=[];if(u.assert(function(){return n.count()<=1},"There must be maximum one DataMemberInstance since there is no grouping."),n.next()){for(var a=[];n.nextCalc();){var o=n.calcId(),s=this.context.calcInfo[o];s&&3!==s.calcKind&&(a[s.columnIndex]=n.calcValue())}i.push(a)}e.rows=i}},t.prototype.getRowCellsCount=function(e){for(e.reset();e.next();){var r=e.id(),n=this.context.dataMemberIdToMetadata[r];if(n&&1===n.kind){var i=e.instances();if(i.next()){for(var a=0;i.nextCalc();){var o=i.calcId(),s=this.context.calcInfo[o];s&&(1===s.calcKind||2===s.calcKind)&&(s.hasDuplicateColumnIndices?a+=_.size(this.context.calcIdToColumnIndices[o]):a++)}return a}}}return 0},t.prototype.createCalcIdToGroupingIdentityIndexMap=function(e){for(var r={},n=e.Keys,i=this.context.selects,a=n.length,o=0;o<a;o++){var s=n[o];r[s.Calc||i[s.Select].Value]=o}return r},t.prototype.isCompatible=function(){var e=this.context;return 0===e.maxSecondaryDepth&&e.maxPrimaryDepth<=1},t}(),ck=function(){function t(e,r){this.context=e,this.dsrParser=r,this.calcIndexToCalcMetadataDictionary={},this.aggregator=new Zi(e)}return t.prototype.run=function(){if(this.isCompatible()){var e={};return this.parseTree(e),{root:e}}},t.prototype.parseTree=function(e){var r=this.dsrParser;r.reset();var n=r.dataShapes(),i=n.next();u.assert(function(){return i},"There must be a DataShape");var a=this.context.maxPrimaryDepth;this.aggregator.read(n,1===a),0===a?this.parseDataMembersWithNoGrouping(e,n.primaryHierarchy()):this.parseDataMembers(e,n.primaryHierarchy(),0),this.parseAggregates(e)},t.prototype.parseDataMembers=function(e,r,n){for(;r.next();){var i=this.context,a=r.id(),o=i.dataMemberIdToMetadata[a];if(o){var s=r.instances(),l=this.calcIndexToCalcMetadataDictionary[a];switch(l||(this.calcIndexToCalcMetadataDictionary[a]=l=[]),o.kind){case 1:var c=i.dataMemberIdToIdentityBuilder[a];c||(c=new ea(i,a),i.dataMemberIdToIdentityBuilder[a]=c);var f=c.getIdentityFields();f&&(e.childIdentityFields=f),this.parseInstances(e,s,l,c,!1,n);break;case 2:this.parseInstances(e,s,l,null,!0,n);break;default:u.assert(function(){return!1},"Unsupported DataMemberKind")}}}},t.prototype.parseInstances=function(e,r,n,i,a,o){var s=this.context,l=this.aggregator,c=s.aggregateCalcMetadata,f=e.children;for(a||(u.assertValue(i,"identityBuilder"),!f&&r.count()>0&&(f=e.children=new Array(r.count())));r.next();){var d=void 0,p=void 0,h=void 0;a||i.reset();var v=0===n.length;v&&(n.length=r.calcCount());for(var g=function(C){a&&(d=e.values),d||(d={});var w=r.calcId();v&&(n[C]=s.calcInfo[w]);var V=n[C];if(!V)return"continue";var D=r.calcValue(),A=V.calcKind,P=V.kind,F=V.selectIdx;if(a)u.assert(function(){return P!==ne.Group},"subtotal cannot be of grouping kind."),y.addTreeNodeMeasureValues(d,F,A,D),0===o&&X.fillMetadataColumnAggregate(D,c[w]);else{var N=V.isGroupKeyButNotSelect;N||y.addTreeNodeMeasureValues(d,F,A,D),P===ne.Group?(N||(h=D),i.addExpr(w,r.calcValueAsExpr())):P===ne.Measure&&1===A&&(p=D,u.assertValue(F,"selectIndex"),l.update(D,F))}},y=this,m=0;r.nextCalc();m++)g(m);if(a)e.values=d,1===r.restartFlagKind()&&(e.isMerge=!0);else{var S={values:d,identity:i.getIdentity()};void 0!==h&&(S.name=h),void 0!==p&&(S.value=p),1===r.restartFlagKind()&&(S.isMerge=!0);var b=r.members();b&&this.parseDataMembers(S,b,o+1),f[r.currentIndex()]=S}}},t.prototype.addTreeNodeMeasureValues=function(e,r,n,i){u.assertValue(r,"selectIndex");var a=e[r];switch(!a&&this.isSupportedMeasureType(n)&&(a=e[r]={}),n){case 1:a.value=i;break;case 2:a.subtotal=i;break;case 3:a.highlight=i}},t.prototype.isSupportedMeasureType=function(e){return 1===e||2===e||3===e},t.prototype.parseDataMembersWithNoGrouping=function(e,r){u.assert(function(){return 1===r.count()},"There can only be one datamember with no grouping"),r.next();var n=r.instances();u.assert(function(){return 1===n.count()},"There can only be one instance for datamember with no grouping"),n.next();for(var i,a=this.context.calcInfo;n.nextCalc();){e.values||(e.values=i={});var o=a[n.calcId()];if(o){var s=o.calcKind,l=n.calcValue();this.addTreeNodeMeasureValues(i,o.selectIdx,s,l),1===s&&(e.value=l)}}},t.prototype.isCompatible=function(){return 0===_.size(this.context.secondaryAxisGroupings)},t.prototype.parseAggregates=function(e){var r=this.context;this.aggregator.copyToColumns();for(var n=r.measureSelectIndices,i=n.length,a=0;a<i;a++){var o=n[a],s=r.selectIndexToColumn[o].aggregates,l=e.values;if(s){l||(l=e.values={});var c=l[o];c||(c=l[o]={}),X.copyAggregates(s,c)}}},t}(),Xy=function(){function t(e,r,n){u.assertValue(e,"queryBindingDescriptor"),u.assert(function(){return r&&r.length>0},"Expected a non-empty array of exceeded limits."),this.computeMetadata(e,n,r)}return Object.defineProperty(t.prototype,"code",{get:function(){return"DsrLimitsWarning"},enumerable:!1,configurable:!0}),t.prototype.computeMetadata=function(e,r,n){if(this.limits={},e.Limits){var i=t.getExceededLimitsDetails(e,n),a=e.Limits,o=!!i.Primary,s=!!i.Secondary,l=!!i.Intersection;if(e.ScriptVisualBinding)return void(this.hasScriptVisualBinding=!0);var c=e.Expressions&&e.Expressions.Primary&&e.Expressions.Primary.Groupings?e.Expressions.Primary.Groupings:[],f=e.Expressions&&e.Expressions.Secondary&&e.Expressions.Secondary.Groupings?e.Expressions.Secondary.Groupings:[];o&&s?(this.groupings=c.concat(f),this.limits.Primary=t.getLimitMetadata(a.Primary,r),this.limits.Secondary=t.getLimitMetadata(a.Secondary,r)):o?(this.groupings=c,this.limits.Primary=t.getLimitMetadata(a.Primary,r)):s&&(this.groupings=f,this.limits.Secondary=t.getLimitMetadata(a.Secondary,r)),l&&(this.limits.Intersection=t.getLimitMetadata(a.Intersection,r))}},t.prototype.getDetails=function(e){var r=!!this.limits.Primary,n=!!this.limits.Secondary,i=null,a=-1;return this.hasScriptVisualBinding?i=e.get("DsrLimitWarning_TooMuchDataValMultipleColumns"):r||n?r&&n?(a=this.limits.Primary.Type,i=this.getErrorInfoValue(this.groupings,e.get("DsrLimitsWarning_MultipleColumnsWithIssuesFormat"),e)):i=this.getErrorInfoValue(this.groupings,t.getDetailedMessageFormatForOneColumn(a=r?this.limits.Primary.Type:this.limits.Secondary.Type,e),e):this.limits.Intersection&&(i=t.getDetailedMessageFormatForOneColumn(a=this.limits.Intersection.Type,e)),i||(i=e.get("DsrLimitWarning_TooMuchDataValMultipleColumns")),{message:t.getMessage(a,e),displayableErrorInfo:[{errorInfoKey:t.getKey(a,e),errorInfoValue:i}],helpLink:t.getHelpLink(a)}},t.getExceededLimitsDetails=function(e,r){for(var n=e.Limits,i={},a=0,o=r;a<o.length;a++){var s=o[a];n.Primary&&s.Id===n.Primary.Id?i.Primary=n.Primary:n.Secondary&&s.Id===n.Secondary.Id?i.Secondary=n.Secondary:n.Intersection&&s.Id===n.Intersection.Id&&(i.Intersection=n.Intersection)}return i},t.prototype.getErrorInfoValue=function(e,r,n){if(!e||0===e.length)return null;for(var i=[],a=0,o=e.length;a<o;a++){var l=this.getGroupingNameFromGroupingKeys(e[a]);l&&i.push(l)}var f=i.length;return 0===f?null:Be(r,1===f?i[0]:i.join(n.get("ListJoin_Separator")))},t.prototype.getGroupingNameFromGroupingKeys=function(e){for(var r=e.Keys,n=0,i=r.length;n<i;n++){var a=r[n];if(null!=a.Select)return this.columnNameFromIndex?this.columnNameFromIndex(a.Select):void 0}},t.getMessage=function(e,r){switch(e){case 2:return r.get("DsrLimitWarning_RepresentativeSampleMessage");case 3:case 4:return r.get("DsrLimitWarning_HighDensitySampleMessage");default:return r.get("DsrLimitWarning_TooMuchDataMessage")}},t.getKey=function(e,r){switch(e){case 2:return r.get("DsrLimitWarning_RepresentativeSampleKey");case 3:case 4:return r.get("DsrLimitWarning_HighDensitySampleKey");default:return r.get("DsrLimitWarning_TooMuchDataKey")}},t.getDetailedMessageFormatForOneColumn=function(e,r){switch(e){case 2:return r.get("DsrLimitWarning_RepresentativeSampleVal");case 3:return r.get("DsrLimitWarning_HighDensitySampleVal");case 4:return r.get("DsrLimitWarning_OverlappingPointsDetails");default:return r.get("DsrLimitWarning_TooMuchDataVal")}},t.getHelpLink=function(e){switch(e){case 3:return"https://go.microsoft.com/fwlink/?linkid=848757";case 4:return"https://go.microsoft.com/fwlink/?linkid=853820"}},t.getLimitMetadata=function(e,r){return e.Top?{Type:0,Count:t.getLimitCount(e.Top,r)}:e.Bottom?{Type:1,Count:t.getLimitCount(e.Bottom,r)}:e.Sample?{Type:2,Count:t.getLimitCount(e.Sample,r)}:e.BinnedLineSample?{Type:3,Count:t.getBinnedLineSampleCount(e.BinnedLineSample)}:e.OverlappingPointsSample?{Type:4,Count:t.getLimitCount(e.OverlappingPointsSample,r)}:{Type:-1,Count:null}},t.getLimitCount=function(e,r){if(e.Calc&&r){var n=X.findCalculation(r,e.Calc);if(n){var i=by(n.Value);if(_.isNumber(i))return i}}return e.Count},t.getBinnedLineSampleCount=function(e){return e.MaxTargetPointCount},t}();function Zy(t){if(0===t)return"Warning"}var Ko={"ForecastErrorType.DataIsTooSmall":{localizedMessage:"DsrMessage_NotEnoughDataMessage",localizedTitle:"DsrMessage_NotEnoughDataTitle",localizedContent:"DsrMessage_NotEnoughDataContent",isTransformMessage:!0},"ForecastErrorType.TooManyMissingValues":{localizedMessage:"DsrMessage_DataIsTooRandomOrMissingValuesMessage",localizedTitle:"DsrMessage_DataIsTooRandomOrMissingValuesTitle",localizedContent:"DsrMessage_DataIsTooRandomOrMissingValuesContent",isTransformMessage:!0},"ForecastErrorType.NoDominantStepDetected":{localizedMessage:"DsrMessage_DataIsTooRandomOrMissingValuesMessage",localizedTitle:"DsrMessage_DataIsTooRandomOrMissingValuesTitle",localizedContent:"DsrMessage_DataIsTooRandomOrMissingValuesContent",isTransformMessage:!0},"ForecastErrorType.InputTimeStampsNotSorted":{localizedMessage:"DsrMessage_UnsortedDataMessage",localizedTitle:"DsrMessage_UnsortedDataTitle",localizedContent:"DsrMessage_UnsortedDataContent",isTransformMessage:!0},"ForecastErrorType.XAxisIsNull":{localizedMessage:"DsrMessage_ForecastXValueNullMessage",localizedTitle:"DsrMessage_ForecastXValueNullTitle",localizedContent:"DsrMessage_ForecastXValueNullContent",isTransformMessage:!0},"ForecastErrorType.InvalidSeasonality":{localizedMessage:"DsrMessage_ForecastInvalidSeasonalityMessage",localizedTitle:"DsrMessage_ForecastInvalidSeasonalityTitle",localizedContent:"DsrMessage_ForecastInvalidSeasonalityContent",isTransformMessage:!0},"ForecastErrorType.InvalidDataType":{localizedMessage:"DsrMessage_ForecastVariantDataTypeMessage",localizedTitle:"DsrMessage_ForecastVariantDataTypeTitle",localizedContent:"DsrMessage_ForecastVariantDataTypeContent",isTransformMessage:!0},"ForecastErrorType.Unexpected":{localizedMessage:"DsrMessage_ForecastErrorMessage",localizedTitle:"DsrMessage_ForecastErrorTitle",localizedContent:"DsrMessage_ForecastErrorContent",isTransformMessage:!0},ForecastTransformUnsupported:{localizedMessage:"DsrMessage_ForecastNotSupportedMessage",localizedTitle:"DsrMessage_ForecastNotSupportedTitle",localizedContent:"DsrMessage_ForecastNotSupportedContent",isTransformMessage:!0},"ClusteringErrorType.LessThanKDataPoints":{localizedMessage:"DsrMessage_ClusterTooManyClustersTitle",localizedTitle:"DsrMessage_ClusterTooManyClustersTitle",localizedContent:"DsrMessage_ClusterTooManyClustersContent",isTransformMessage:!0},"ClusteringErrorType.TooManyDataPoints":{localizedMessage:"DsrMessage_ClusterExceedsLimitTitle",localizedTitle:"DsrMessage_ClusterExceedsLimitTitle",localizedContent:"DsrMessage_ClusterExceedsLimitContent",isTransformMessage:!0},"ClusteringErrorType.InvalidDataType":{localizedMessage:"DsrMessage_ClusterVariantDataTypeTitle",localizedTitle:"DsrMessage_ClusterVariantDataTypeTitle",localizedContent:"DsrMessage_ClusterVariantDataTypeContent",isTransformMessage:!0}},em=function(){function t(e){this.dataShapeMessage=e}return Object.defineProperty(t.prototype,"code",{get:function(){return this.dataShapeMessage.Code},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){var r=Ko[this.dataShapeMessage.Code];return u.assertValue(r,"message to show should be a known message"),{message:e.get(r.localizedMessage),displayableErrorInfo:[{errorInfoKey:e.get(r.localizedTitle),errorInfoValue:e.get(r.localizedContent)}]}},t.prototype.isTransformMessage=function(){var e=Ko[this.code];return e&&e.isTransformMessage},t}();function hk(t,e){for(var r=[],n={},i=0,a=t;i<a.length;i++){var o=a[i],s={id:o.Id,name:o.Name,component:o.Component,pageHidden:void 0,start:Oo(o.Start).valueOf(),end:o.End?Oo(o.End).valueOf():void 0,metrics:o.Metrics,status:1,rootId:e,parentId:o.ParentId};o.ParentId?(n[o.ParentId]||(n[o.ParentId]=[]),n[o.ParentId].push(s)):r.push(s)}return tm(r,n),r}function tm(t,e){for(var r=0,n=t;r<n.length;r++){var i=n[r];e[i.id]&&(i.children=e[i.id],tm(i.children,e))}}var lr=function(){function t(e){this.elements=e,this.currentIndex=-1}return t.prototype.reset=function(e){var r=this;this.currentIndex=-1,e&&(u.assert(function(){return r.elements!==e},"Resetting with same elements"),this.elements=e)},t.prototype.count=function(){return _.size(this.elements)},t.prototype.current=function(){var e=this;return u.assert(function(){return e.currentIndex>=0},"Invalid Iterator index"),this.elements[this.currentIndex]},t.prototype.done=function(){return this.currentIndex===_.size(this.elements)-1},t.prototype.next=function(){return!this.done()&&(this.currentIndex++,!0)},t.prototype.index=function(){return this.currentIndex},t}();function rm(t,e){return new vk(t,e)}var vk=function(){function t(e,r){this.dsrParserContext=r,u.assertValue(e,"dsr"),u.assertAnyValue(r,"dsrParserContext"),this.parser=new gk(e.DS,this.dsrParserContext)}return t.prototype.dataShapes=function(){return this.parser},t.prototype.reset=function(){this.parser.reset()},t.prototype.lockCache=function(){this.dsrParserContext.locked||(this.dsrParserContext.locked=!0)},t}(),nm=function(){function t(e){this.calculationContainerKind=e,this.nullValuesHandler=new Ek,this.repeatedValuesHandler=new Ck}return t.prototype.initialize=function(e,r){this.lastContainerCalculations=r,this.repeatedValuesHandler.initialize(e&&e.R,r),this.nullValuesHandler.initialize(e&&e.\u00d8)},t.prototype.getCurrentCalc=function(e,r,n,i){var o,a=this;return u.assert(function(){return e>=0},"unexpected position input"),n?void 0!==(o=this.repeatedValuesHandler.tryRead(e))?o:void 0!==(o=this.nullValuesHandler.tryRead(e))?(this.lastContainerCalculations[e]=null,o):(r?r.next()&&(o=r.current(),this.lastContainerCalculations[e]=o):(u.assert(function(){return!!i},"Unexpected calcId"),void 0===(o=n[i])&&(o=null),this.lastContainerCalculations[e]=o),o):(u.assert(function(){return 3===a.calculationContainerKind},"Unexpected Empty DataShape/DataMemberInstance as calc container"),null)},t}(),im=function(){function t(e,r,n){this.context=e,this.calcMetadataCacheKey=n,this.baseCalculationParser=new nm(r)}return t.prototype.setCalculations=function(e){u.assertAnyValue(e,"calculationContainerParser:setCalculation calculationContainer can be any value"),this.calculationContainer=e;var r=this.context;if(r){var n=this.calcMetadataCacheKey,i=e.S;i&&(this.metadata=i,n&&!r.locked&&(r.memberInstanceCalcMetadataCache[n]=i),this.lastContainerCalculations||(this.lastContainerCalculations=new Array(i.length))),r.instancesCalcCache[n]&&(this.lastContainerCalculations=r.instancesCalcCache[n]),this.baseCalculationParser.initialize(e,this.lastContainerCalculations);var a=e.C;(i=this.getCalcMetadata())?this.calcMetadataIt=new lr(i):this.calcMetadataIt&&this.calcMetadataIt.reset(),this.calcIt=_.size(a)>0?new lr(a):void 0}},t.prototype.restartCalcs=function(){u.assertValue(this.calcMetadataIt,"restartCalcs called before setCalculations"),u.assertAnyValue(this.calcIt,"CalcIt is created only if Calcs are not included as properties"),this.calcIt&&this.calcIt.reset(),this.calcMetadataIt.reset(),delete this.dsrCalcValue},t.prototype.nextCalc=function(){var e=!1,r=this.calcMetadataIt;return r&&((e=r.next()||e)&&(this.dsrCalcValue=this.baseCalculationParser.getCurrentCalc(r.index(),this.calcIt,this.calculationContainer,this.calcId())),r.done()&&(this.context.instancesCalcCache[this.calcMetadataCacheKey]=this.lastContainerCalculations)),e||!1},t.prototype.calcId=function(){return this.metadata[this.calcMetadataIt.index()].N},t.prototype.getCalcMetadata=function(){var e=this.metadata;return e||(e=this.metadata=this.context.memberInstanceCalcMetadataCache[this.calcMetadataCacheKey]),e},t.prototype.calcValue=function(){var e=this.metadata[this.calcMetadataIt.index()],r=this.context.valueDictionaryHandler.getCalcValue(this.dsrCalcValue,e.DN,e.T);return void 0===r&&(r=Dc(this.dsrCalcValue,e.T)),r},t.prototype.calcValueAsExpr=function(){var e=this;u.assert(function(){return void 0!==e.dsrCalcValue},"Unexpected parsedCalcValue");var r=this.calcMetadataIt.current(),n=this.calcValue(),i=this.context.valueDictionaryHandler.getCalcValueExpr(n,this.dsrCalcValue,r.DN,r.T);return i||(i=Ac(n,this.dsrCalcValue,r.T)),i},t.prototype.calcCount=function(){return this.calcMetadataIt?this.calcMetadataIt.count():this.calcIt?this.calcIt.count():0},t}(),gk=function(t){function e(r,n,i){var a=t.call(this,n,1)||this;return a.parserContext=n,a.rootDataShape=i,u.assertValue(r,"dataShapes"),u.assertAnyValue(n,"parserContext"),a.it=new lr(r),a}return T(e,t),e.prototype.reset=function(){this.it.reset()},e.prototype.index=function(){return this.it.index()},e.prototype.count=function(){return this.it.count()},e.prototype.next=function(){var r;this.primaryHierarchyParser=this.secondaryHierarchyParser=this.messageParser=void 0;var n=this.it.next();if(n){var i=this.it.current();this.setCalculations(i),this.context&&(this.context.valueDictionaryHandler=new ek(i.ValueDicts||(null===(r=this.rootDataShape)||void 0===r?void 0:r.ValueDicts)))}return n},e.prototype.id=function(){return this.it.current().N},e.prototype.nestedDataShapes=function(){u.assertValue(this.context.primarySynchronizedGroups,"Reading Nested DataShapes other than Synchronized Groups ones is currently unsupported");var r=this.it.current(),n=r.DS;if(!_.isArray(n)||n.length<1)return{};for(var i={},a=function(d){var p=_.find(n,function(h){return h.N===d.dataShapeId});u.assertValue(p,"No DataShape with ID "+d.dataShapeId),p&&(i[p.N]=new e([p],d.context,o.rootDataShape||r))},o=this,s=0,l=this.context.primarySynchronizedGroups;s<l.length;s++)a(l[s]);return i},e.prototype.primaryHierarchy=function(){var r=this;if(u.assert(function(){return null!=r.parserContext},"Parser Context is needed to parse DataShape Hierarchy"),!this.primaryHierarchyParser&&this.parserContext){var n=this.it.current().PH;this.primaryHierarchyParser=n&&new Gc(n,this.parserContext,0,0)}return this.primaryHierarchyParser},e.prototype.secondaryHierarchy=function(){var r=this;if(u.assert(function(){return null!=r.parserContext},"Parser Context is needed to parse DataShape Hierarchy"),!this.secondaryHierarchyParser&&this.parserContext){var n=this.it.current().SH;this.secondaryHierarchyParser=n&&new Gc(n,this.parserContext,1,0)}return this.secondaryHierarchyParser},e.prototype.messages=function(){return!this.messageParser&&_.size(this.it.current().Msg)>0&&(this.messageParser=new mk(this.it.current().Msg)),this.messageParser},e.prototype.hasRestartTokens=function(){return _.size(this.restartTokens())>0},e.prototype.restartTokens=function(){var r=this.it.current(),n=r.DW;return _.isEmpty(n)?r.RT:(u.assert(function(){return 1===n.length},"Multiple data windows are not yet handled"),n[0].RT)},e.prototype.complete=function(){var r=this.it.current(),n=r.DW;return _.isEmpty(n)?r.IC:(u.assert(function(){return 1===n.length},"Multiple data windows are not yet handled"),n[0].IC)},e.prototype.hasAllData=function(){return this.it.current().HAD},e.prototype.limitsExceeded=function(){return _.size(this.it.current().DLEx)>0},e.prototype.limits=function(){return this.limitsParser||(this.limitsParser=new yk(this.it.current().DLEx)),this.limitsParser},e}(im),yk=function(){function t(e){u.assertValue(e,"limits"),this.it=new lr(e)}return t.prototype.next=function(){return this.it.next()},t.prototype.id=function(){return this.it.current().N},t.prototype.count=function(){return this.it.count()},t}(),mk=function(){function t(e){u.assertValue(e,"dataShapeMessage"),this.it=new lr(e)}return t.prototype.next=function(){return this.it.next()},t.prototype.code=function(){return this.it.current().Code},t.prototype.severity=function(){return this.it.current().Severity},t.prototype.dsrMessage=function(){return new em(this.it.current())},t}(),Gc=function(){function t(e,r,n,i){this.context=r,this.hierarchy=n,this.depth=i,u.assertValue(e,"dataMembers"),this.it=new lr(e)}return t.prototype.count=function(){return this.it.count()},t.prototype.reset=function(){this.it.reset(),this.dataMemberId=void 0},t.prototype.next=function(){this.instancesParser&&(this.instancesParser=void 0),this.dataMemberId&&(this.dataMemberId=void 0);var e=this.it.next();if(e){var r=this.dataMemberIdCache();if(_.size(r)>0)for(var n=this.it.current(),i=0,a=r[this.depth];i<a.length;i++){var o=a[i];n[o]&&(this.dataMemberId=o)}if(void 0===this.dataMemberId){var s=Object.keys(this.it.current());1===_.size(s)?this.dataMemberId=s[0]:u.assertFail("Unexpected DataMember with multiple properties. Cannot infer DataMemberId")}}return e},t.prototype.id=function(){return this.dataMemberId},t.prototype.dataMemberIdCache=function(){return 0===this.hierarchy?this.context.primaryDataMemberIdCache:this.context.secondaryDataMemberIdCache},t.prototype.instances=function(){if(!this.instancesParser){var e=this.it.current()[this.dataMemberId];this.instancesParser=e&&new Sk(e,this.context,this.id(),this.hierarchy,this.depth)}return this.instancesParser},t}(),Sk=function(t){function e(r,n,i,a,o){var s=t.call(this,n,2,i)||this;return s.parentDataMemberId=i,s.hierarchy=a,s.depth=o,u.assertValue(r,"instances"),s.it=new lr(r),s}return T(e,t),e.prototype.next=function(){var r=this,n=this.it.next();if(n){var i=this.it.current();!this.context.locked&&!i.M&&1===this.hierarchy&&this.context.secondaryLeafDataMemberId.push(this.parentDataMemberId),this.setCalculations(i),this.dataMemberIt=void 0,this.intersectionParserDirty=!0,u.assert(function(){return 1!==r.hierarchy||!i.Intersections},"secondary hierarchy should not have any intersections")}return n},e.prototype.count=function(){return this.it.count()},e.prototype.currentIndex=function(){return this.it.index()},e.prototype.intersections=function(){if(!this.intersectionParser){this.intersectionParserDirty=!1;var r=this.it.current().X;return this.intersectionParser=r&&new bk(r,this.context,this.parentDataMemberId)}return this.intersectionParserDirty?(this.intersectionParserDirty=!1,this.intersectionParser.reset(this.it.current().X),this.intersectionParser):this.intersectionParser},e.prototype.restartFlagKind=function(){return this.it.current().RF},e.prototype.restartKind=function(){return this.it.current().RK},e.prototype.members=function(){if(!this.dataMemberIt){var r=this.it.current().M;this.dataMemberIt=r&&new Gc(r,this.context,this.hierarchy,this.depth+1)}return this.dataMemberIt},e}(im),bk=function(){function t(e,r,n){this.context=r,this.parentDataMemberId=n,u.assertValue(e,"intersections"),this.it=new lr(null),this.reset(e),this.baseCalculationParser=new nm(3),this.intersectionMeasureCount=_.size(this.context.intersectionMeasureToSelectIndex),this.expectedIntersectionCount=_.size(this.context.secondaryLeafDataMemberId);var i=r.dataMemberIdToMetadata[n];this.primaryMemberIsGroupMember=1===i.kind,this.primaryDataMemberDepth=i.depth,u.assertValue(r.intersectionCalcMetadataCache,"context.intersectionCalcMetadataCache"),this.calcMetadataCache=r.intersectionCalcMetadataCache[n],!this.calcMetadataCache&&!r.locked&&(this.calcMetadataCache=r.intersectionCalcMetadataCache[n]=new Array(this.expectedIntersectionCount))}return t.prototype.reset=function(e){this.it.reset(e),this.logicalIntersectionIndex=-1,this.physicalIntersectionIndex=-1,this.hasIntersectionElements=e.length>0},t.prototype.next=function(){if(this.resetCalcIt(),this.logicalIntersectionIndex++,this.logicalIntersectionIndex>=this.expectedIntersectionCount)return!1;if(this.setIntersectionId(),this.it.count()===this.expectedIntersectionCount){var e=this.it.next();return e&&this.initialize(this.it.current()),e}if(this.hasIntersectionElements){var r=void 0;if((0===this.logicalIntersectionIndex||this.physicalIntersectionIndex<this.logicalIntersectionIndex)&&this.it.next()&&((r=this.it.current()).I||0===this.logicalIntersectionIndex?this.physicalIntersectionIndex=r.I||0:this.physicalIntersectionIndex++),this.physicalIntersectionIndex===this.logicalIntersectionIndex)return r||(r=this.it.current()),this.initialize(r),!0}return this.initialize(),!0},t.prototype.setIntersectionId=function(){this.intersectionId=this.parentDataMemberId+this.context.secondaryLeafDataMemberId[this.logicalIntersectionIndex]},t.prototype.resetCalcIt=function(e){var r=e&&e.C;this.currentCalcIndex=-1,this.currentCalc=void 0,this.calcIt=r?new lr(r):void 0},t.prototype.initialize=function(e){var r=this;if(u.assert(function(){return r.logicalIntersectionIndex>=0},"Unexpected call to initialize IntersectionParser"),this.resetCalcIt(e),e){var n=e.S;if(n&&!this.context.locked){void 0===this.intersectionCalcCount&&(this.intersectionCalcCount=n.length),u.assert(function(){return null==r.calcMetadataCache[r.logicalIntersectionIndex]},"unexpected schema present for current logical intersection"),this.calcMetadataCache[this.logicalIntersectionIndex]=n;for(var i=this.context.calcIdToCalcMetadata,a=0,o=n;a<o.length;a++)i[o[a].N]=n}}this.calculationContainer=e;var l=this.context.lastIntersectionCalcCache[this.intersectionId];!l&&this.intersectionId&&(l=this.context.lastIntersectionCalcCache[this.intersectionId]=new Array(this.intersectionCalcCount)),this.baseCalculationParser.initialize(e,l);var c=this.getCalcMetadata();c&&(this.currentCalcMetadata=c,void 0===this.intersectionCalcCount&&(this.intersectionCalcCount=this.intersectionMeasureCount>0?this.currentCalcMetadata.length:0))},t.prototype.restartCalcs=function(){this.calcIt&&this.calcIt.reset(),this.currentCalcIndex=-1,delete this.currentCalc},t.prototype.nextCalc=function(){var e=++this.currentCalcIndex;return e<this.intersectionCalcCount?(this.currentCalc=this.baseCalculationParser.getCurrentCalc(e,this.calcIt,this.calculationContainer,this.calcId()),!0):(this.currentCalc=void 0,!1)},t.prototype.calcId=function(){return this.currentCalcMetadata[this.currentCalcIndex].N},t.prototype.getCalcMetadata=function(){var e=this;u.assert(function(){return e.logicalIntersectionIndex>=0},"getCalcMetadata can return metadata only for valid logical intersection");var r=this.calcMetadataCache[this.logicalIntersectionIndex];if(!r&&!this.context.locked){var n=this.getExpectedCalcId();n&&(r=this.calcMetadataCache[this.logicalIntersectionIndex]=this.context.calcIdToCalcMetadata[n])}return r},t.prototype.getExpectedCalcId=function(){if(0!==this.intersectionMeasureCount){var e=this.context,r=e.dataMemberIdToMetadata[e.secondaryLeafDataMemberId[this.logicalIntersectionIndex]],a=e.selects[this.currentCalcIndex<0?e.intersectionMeasureToSelectIndex[0]:e.intersectionMeasureToSelectIndex[this.currentCalcIndex]];if(1===r.kind&&this.primaryMemberIsGroupMember)return a.Value;if(a.Subtotal){var o=X.computeAggIdx(this.primaryDataMemberDepth,r.depth,e.maxPrimaryDepth,e.maxSecondaryDepth);return a.Subtotal.length>o&&a.Subtotal[o]}}},t.prototype.calcValue=function(){return null!=this.currentCalc?this.parseCalcValue(this.currentCalc):null},t.prototype.parseCalcValue=function(e){var r=this.calcMetadataCache[this.logicalIntersectionIndex][this.currentCalcIndex],n=this.context.valueDictionaryHandler.getCalcValue(e,r.DN,r.T);return void 0===n&&(n=Dc(e,r.T)),n},t.prototype.calcValueAsExpr=function(){if(void 0!==this.currentCalc)return this.parseCalcValueExpr(this.currentCalc,this.calcValue());if(this.it.index()===this.logicalIntersectionIndex){var e=this.calcValue();return null===e?Lt():this.parseCalcValueExpr(this.it.current()[this.calcId()],e)}return Lt()},t.prototype.parseCalcValueExpr=function(e,r){var n=this.calcMetadataCache[this.logicalIntersectionIndex][this.currentCalcIndex],i=this.context.valueDictionaryHandler.getCalcValueExpr(r,e,n.DN,n.T);return void 0===i&&(i=Ac(r,e,n.T)),i},t.prototype.calcCount=function(){return this.calcIt?this.calcIt.count():0},t}(),am=function(){function t(){}return t.prototype.initialize=function(e){this.value=e,this.overflowValue=e>t.MaxSignedNumberFor32Bits?function(t){var e=t.toString(2),r=e.substr(0,e.length-31);return parseInt(r,2)}(e):0},t.prototype.hasBitAtPosition=function(e){if(u.assert(function(){return e>=0},"expected positive integer for position"),e>52)return!1;if(this.value>0){var r=0,n=this.value;return e<31?r=1<<e:(r=1<<e-31,n=this.overflowValue),(n&r)>0}},t.MaxSignedNumberFor32Bits=Math.pow(2,31)-1,t}(),Ek=function(){function t(){this.bitSequenceHandler=new am}return t.prototype.initialize=function(e){this.bitSequenceHandler.initialize(e)},t.prototype.tryRead=function(e){if(this.bitSequenceHandler.hasBitAtPosition(e))return null},t}(),Ck=function(){function t(){this.bitSequenceHandler=new am}return t.prototype.initialize=function(e,r){this.bitSequenceHandler.initialize(e),this.lastContainerCalculations=r},t.prototype.tryRead=function(e){if(this.bitSequenceHandler.hasBitAtPosition(e))return this.lastContainerCalculations[e]},t}();location.search.indexOf("renderAsModalDialog"),'<input type="button" class='.concat("pbi-fluent-button","></input>"),location.origin||(location,location);var z,Jo="azure:values",I=function(t){return t.ComplexSlicerNotAllowedWithMeasures="ComplexSlicerNotAllowedWithMeasures",t.ComplexHighlightsNotAllowed="ComplexHighlightsNotAllowed",t.ExclusivePercentileOutOfRange="ExclusivePercentileOutOfRange",t.InvalidDataShapeNoOutputData="InvalidDataShapeNoOutputData",t.InvalidFilterComparisonIncompatibleExpressions="InvalidFilterComparisonIncompatibleExpressions",t.InvalidFilterConditionIncompatibleDataType="InvalidFilterConditionIncompatibleDataType",t.InvalidUnconstrainedJoin="InvalidUnconstrainedJoin",t.ModelUnavailable="ModelUnavailable",t.OverlappingKeysOnOppositeHierarchies="OverlappingKeysOnOppositeHierarchies",t.rsQueryMemoryLimitExceeded="rsQueryMemoryLimitExceeded",t.rsQueryTimeoutExceeded="rsQueryTimeoutExceeded",t.CouldNotResolveModelReferencesInSemanticQuery="CouldNotResolveModelReferencesInSemanticQuery",t.QueryExtensionMeasureUnexpectedEndOfUserInput="QueryExtensionMeasureUnexpectedEndOfUserInput",t.NativeVisualCalculationUnexpectedEndOfUserInput="NativeVisualCalculationUnexpectedEndOfUserInput",t.rsAccessDenied="rsAccessDenied",t.NoUniqueKeyForDetailTable="NoUniqueKeyForDetailTable",t.IsRelatedToManyNotSupportedForDetailTable="IsRelatedToManyNotSupportedForDetailTable",t.ModelMeasuresNotSupportedForDetailTable="ModelMeasuresNotSupportedForDetailTable",t.UnsupportedDateTimeLiteral="UnsupportedDateTimeLiteral",t.InvalidExtensionDax_UnclosedBracketIdentifier="InvalidExtensionDax_UnclosedBracketIdentifier",t.InvalidExtensionDax_UnexpectedCloseParenthesis="InvalidExtensionDax_UnexpectedCloseParenthesis",t.ExtensionMeasureEmptyExpression="ExtensionMeasureEmptyExpression",t.ExtensionMeasureNameNotUniqueModel="ExtensionMeasureNameNotUniqueModel",t.ExtensionMeasureNameNotUnique="ExtensionMeasureNameNotUnique",t.CouldNotResolveModelReferencesInQueryExtensionSchema="CouldNotResolveModelReferencesInQueryExtensionSchema",t.QueryExtensionMeasureError="QueryExtensionMeasureError",t.NativeVisualCalculationError="NativeVisualCalculationError",t.UnsupportedDataSourceVariables="UnsupportedDataSourceVariables",t.DataExtensionMissingResultSet="DataExtensionMissingResultSet",t.ProxyModelChainLimitExceeded="ProxyModelChainLimitExceeded",t.FabricThrottled="FabricThrottled",t.AA_PowerBIScriptPayloadTooLargeError="AA_PowerBIScriptPayloadTooLargeError",t.AA_PowerBIScriptResultTooLargeError="AA_PowerBIScriptResultTooLargeError",t.AA_PowerBIScriptReturnedNoImageError="AA_PowerBIScriptReturnedNoImageError",t.AA_PowerBIScriptRuntimeErrorError="AA_PowerBIScriptRuntimeErrorError",t.AA_PowerBIScriptTimeoutError="AA_PowerBIScriptTimeoutError",t.AA_PowerBIRequestsQueueOverflowError="AA_PowerBIRequestsQueueOverflowError",t.AA_PowerBIScriptRuntimeMaxMemoryError="AA_PowerBIScriptRuntimeMaxMemoryError",t.AA_PowerBIScriptRuntimeMaxDiskIOError="AA_PowerBIScriptRuntimeMaxDiskIOError",t.AA_PowerBIScriptMissingDependencyError="AA_PowerBIScriptMissingDependencyError",t.AA_PowerBIScriptSpecificPackageWithMissingDependencyError="AA_PowerBIScriptSpecificPackageWithMissingDependencyError",t.AA_PowerBIScriptSpecificPackageMissingSpecificDependencyError="AA_PowerBIScriptSpecificPackageMissingSpecificDependencyError",t.AA_PowerBIScriptMissingSpecificPackageError="AA_PowerBIScriptMissingSpecificPackageError",t.InvalidExtensionDax_UnclosedMultiLineComment="InvalidExtensionDax_UnclosedMultiLineComment",t.InvalidExtensionDax_UnclosedParenthesis="InvalidExtensionDax_UnclosedParenthesis",t.InvalidExtensionDax_UnclosedQuoteIdentifier="InvalidExtensionDax_UnclosedQuoteIdentifier",t.InvalidExtensionDax_UnclosedStringLiteral="InvalidExtensionDax_UnclosedStringLiteral",t.CannotUseMultiColumnFilteringWithMappedColumns="CannotUseMultiColumnFilteringWithMappedColumns",t.DifferentMappingsWithinSubqueries="DifferentMappingsWithinSubqueries",t.FilterIncompatibleWithParameter="FilterIncompatibleWithParameter",t.FoundMultipleTargetsWithAtLeastOneMapping="FoundMultipleTargetsWithAtLeastOneMapping",t.FoundParameterMappingOnUnsupportedFilter="FoundParameterMappingOnUnsupportedFilter",t.InTableConditionNotSupportedWithMappedParameters="InTableConditionNotSupportedWithMappedParameters",t.InvalidMappedParameterValueExpression="InvalidMappedParameterValueExpression",t.MappedTargetMustMatchMappedCondition="MappedTargetMustMatchMappedCondition",t.MixOfAssignedAndUnassignedColumnsWithinORExpression="MixOfAssignedAndUnassignedColumnsWithinORExpression",t.MultipleParameterAssignmentsWithinORUnsupported="MultipleParameterAssignmentsWithinORUnsupported",t.MultipleParameterMappingsUnsupported="MultipleParameterMappingsUnsupported",t.ParameterMappingFilterConflict="ParameterMappingFilterConflict",t.ParameterMappingsFoundWithinFilteredEvalExpressionFilter="ParameterMappingsFoundWithinFilteredEvalExpressionFilter",t.ParameterMappingsNotSupportedOnHighlights="ParameterMappingsNotSupportedOnHighlights",t.SingleValueParameterWithMultipleValues="SingleValueParameterWithMultipleValues",t}({}),Ik=((z={})[I.ComplexSlicerNotAllowedWithMeasures]={localizedContent:"DsrError_ComplexSlicerNotAllowedWithMeasuresValue"},z[I.ComplexHighlightsNotAllowed]={localizedContent:"DsrError_ComplexHighlightsNotAllowed_Details",localizedMessage:"DsrError_ComplexHighlightsNotAllowed_ShortMessage"},z[I.CouldNotResolveModelReferencesInSemanticQuery]={localizedMessage:"DsrError_CouldNotResolveModelRefErrorMessage",localizedTitle:"DsrError_CouldNotResolveModelRefErrorKey",localizedContent:"DsrError_CouldNotResolveModelRefErrorValNoItems",localizedContentWithAffectedItems:"DsrError_CouldNotResolveModelRefErrorValFormat",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690865"},z[I.ExclusivePercentileOutOfRange]={localizedMessage:"DsrError_ExclusivePercentileOutOfRangeMessage",localizedTitle:"DsrError_ExclusivePercentileOutOfRangeKey",localizedContent:"DsrError_ExclusivePercentileOutOfRangeValue"},z[I.InvalidDataShapeNoOutputData]={localizedContent:"DsrError_InvalidDataShapeValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690860"},z[I.InvalidUnconstrainedJoin]={localizedMessage:"DsrError_InvalidUnconstrainedJoinKey",localizedTitle:"DsrError_InvalidUnconstrainedJoinKey",localizedContent:"DsrError_InvalidUnconstrainedJoinValue",helpLink:"https://go.microsoft.com/fwlink/?linkid=2186131"},z[I.IsRelatedToManyNotSupportedForDetailTable]={localizedMessage:"DsrError_IsRelatedToManyNotSupportedForDetailTableMessage",localizedTitle:"DsrError_IsRelatedToManyNotSupportedForDetailTableKey",localizedContent:"DsrError_IsRelatedToManyNotSupportedForDetailTableValueNoItems",localizedContentWithAffectedItems:"DsrError_IsRelatedToManyNotSupportedForDetailTableValueFormat"},z[I.AA_PowerBIScriptPayloadTooLargeError]={localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=746290"},z[I.AA_PowerBIScriptResultTooLargeError]={localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=746291"},z[I.AA_PowerBIScriptReturnedNoImageError]={localizedMessage:"DsrError_ScriptReturnedNoImageMessage",localizedTitle:"DsrError_ScriptReturnedNoImageKey",localizedContent:"DsrError_ScriptReturnedNoImageContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=733479"},z[I.AA_PowerBIScriptRuntimeErrorError]={localizedTitle:"DsrError_ScriptRuntimeErrorKey",localizedMessage:"DsrError_ScriptRuntimeErrorMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=733477"},z[I.AA_PowerBIScriptTimeoutError]={localizedMessage:"DsrError_ScriptTimeoutMessage",localizedTitle:"DsrError_ScriptTimeoutKey",localizedContent:"DsrError_ScriptTimeoutContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=733478"},z[I.AA_PowerBIRequestsQueueOverflowError]={localizedTitle:"DsrError_RequestsQueueOverflowKey",localizedMessage:"DsrError_RequestsQueueOverflowMessage",localizedContent:"DsrError_RequestsQueueOverflowContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799576"},z[I.AA_PowerBIScriptRuntimeMaxMemoryError]={localizedTitle:"DsrError_ScriptRuntimeMaxMemoryKey",localizedMessage:"DsrError_ScriptRuntimeMaxMemoryMessage",localizedContent:"DsrError_ScriptRuntimeMaxMemoryContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799578"},z[I.AA_PowerBIScriptRuntimeMaxDiskIOError]={localizedTitle:"DsrError_ScriptRuntimeMaxDiskIOKey",localizedMessage:"DsrError_ScriptRuntimeMaxDiskIOMessage",localizedContent:"DsrError_ScriptRuntimeMaxDiskIOContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799579"},z[I.AA_PowerBIScriptMissingDependencyError]={localizedTitle:"DsrError_ScriptRuntimeMissingDependencyKey",localizedMessage:"DsrError_ScriptRuntimeMissingDependencyMessage",localizedContent:"DsrError_ScriptRuntimeMissingDependencyContent",helpLink:"https://go.microsoft.com/fwlink/?LinkId=799857"},z[I.AA_PowerBIScriptSpecificPackageWithMissingDependencyError]={localizedTitle:"DsrError_ScriptRuntimeSpecificPackageWithMissingDependencyKey",localizedMessage:"DsrError_ScriptRuntimeSpecificPackageWithMissingDependencyMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799858"},z[I.AA_PowerBIScriptSpecificPackageMissingSpecificDependencyError]={localizedTitle:"DsrError_ScriptRuntimeSpecificPackageMissingSpecificDependencyKey",localizedMessage:"DsrError_ScriptRuntimeSpecificPackageMissingSpecificDependencyMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799859"},z[I.AA_PowerBIScriptMissingSpecificPackageError]={localizedTitle:"DsrError_ScriptRuntimeMissingSpecificPackageKey",localizedMessage:"DsrError_ScriptRuntimeMissingSpecificPackageMessage",useODataErrorMessageAsContent:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=800225"},z[I.ModelMeasuresNotSupportedForDetailTable]={localizedMessage:"DsrError_ModelMeasuresNotSupportedForDetailTableMessage",localizedTitle:"DsrError_ModelMeasuresNotSupportedForDetailTableKey",localizedContent:"DsrError_ModelMeasuresNotSupportedForDetailTableValueNoItems",localizedContentWithAffectedItems:"DsrError_ModelMeasuresNotSupportedForDetailTableValueFormat"},z[I.ModelUnavailable]={localizedContent:"DsrError_ModelUnavailableValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690862"},z[I.NoUniqueKeyForDetailTable]={localizedContent:"DsrError_NoUniqueKeyForDetailTableValue"},z[I.OverlappingKeysOnOppositeHierarchies]={localizedTitle:"DsrError_OverlappingKeysKey",localizedContent:"DsrError_OverlappingKeysValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690863"},z[I.rsQueryMemoryLimitExceeded]={localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690864"},z[I.rsQueryTimeoutExceeded]={localizedMessage:"DsrError_ResourcesExceededMessage",localizedTitle:"DsrError_ResourcesExceededKey",localizedContent:"DsrError_ResourcesExceededValue",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690864"},z[I.rsAccessDenied]={localizedMessage:"DsrError_NoPermissionMessage",localizedTitle:"DsrError_NoPermissionKey",localizedContent:"DsrError_NoAccessForVisual",helpLink:"https://go.microsoft.com/fwlink/?LinkID=690862"},z[I.UnsupportedDateTimeLiteral]={localizedMessage:"DsrError_UnsupportedDateTimeMessage",localizedTitle:"DsrError_UnsupportedDateTimeKey",localizedContent:"DsrError_UnsupportedDateTimeValueNoItems",localizedContentWithAffectedItems:"DsrError_UnsupportedDateTimeValueFormat"},z[I.InvalidExtensionDax_UnclosedBracketIdentifier]={localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnclosedBracketIdentifier"},z[I.InvalidExtensionDax_UnexpectedCloseParenthesis]={localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnexpectedCloseParenthesis"},z[I.InvalidExtensionDax_UnclosedParenthesis]={localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnclosedParenthesis"},z[I.InvalidExtensionDax_UnclosedQuoteIdentifier]={localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnclosedQuoteIdentifier"},z[I.InvalidExtensionDax_UnclosedStringLiteral]={localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnclosedStringLiteral"},z[I.InvalidExtensionDax_UnclosedMultiLineComment]={localizedContentWithAffectedItemsAndPosition:"DsrError_InvalidExtensionDax_UnclosedMultiLineComment"},z[I.InvalidFilterComparisonIncompatibleExpressions]={localizedContent:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpression",localizedContentWithAffectedItems:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpressionWithAffectedItems"},z[I.InvalidFilterConditionIncompatibleDataType]={localizedContent:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpression",localizedContentWithAffectedItems:"DsrError_InvalidFilterConditionIncompatibleDataTypeOrExpressionWithAffectedItems"},z[I.ExtensionMeasureEmptyExpression]={localizedContentWithAffectedItems:"DsrError_ExtensionMeasureEmptyExpression"},z[I.ExtensionMeasureNameNotUniqueModel]={localizedContentWithAffectedItems:"DsrError_ExtensionMeasureNameNotUniqueModel"},z[I.ExtensionMeasureNameNotUnique]={localizedContentWithAffectedItems:"DsrError_ExtensionMeasureNameNotUnique"},z[I.CouldNotResolveModelReferencesInQueryExtensionSchema]={localizedMessage:"DsrError_CouldNotResolveModelRefErrorMessage",localizedTitle:"DsrError_CouldNotResolveModelRefErrorKey",localizedContentWithAffectedItems:"DsrError_CouldNotResolveModelReferencesInQueryExtensionSchema"},z[I.QueryExtensionMeasureError]={localizedContentWithAffectedItemsAndPosition:"DsrError_QueryExtensionMeasureError",localizedContentWithAffectedItemsAndPositionAndDetails:"DsrError_QueryExtensionMeasureErrorWithDetails"},z[I.QueryExtensionMeasureUnexpectedEndOfUserInput]={localizedContentWithAffectedItems:"DsrError_QueryExtensionMeasureUnexpectedEndOfUserInput"},z[I.NativeVisualCalculationError]={localizedContentWithAffectedItemsAndPosition:"DsrError_NativeVisualCalculationError",localizedContentWithAffectedItemsAndPositionAndDetails:"DsrError_NativeVisualCalculationErrorWithDetails"},z[I.NativeVisualCalculationUnexpectedEndOfUserInput]={localizedContentWithAffectedItems:"DsrError_NativeVisualCalculationUnexpectedEndOfUserInput"},z[I.UnsupportedDataSourceVariables]={localizedMessage:"DsrError_UnsupportedDataSourceVariablesMessage",localizedTitle:"DsrError_UnsupportedDataSourceVariablesKey",localizedContent:"DsrError_UnsupportedDataSourceVariablesContent"},z[I.DataExtensionMissingResultSet]={localizedMessage:"DsrError_DataExtensionMissingResultSetMessage",localizedTitle:"DsrError_DataExtensionMissingResultSetKey",localizedContent:"DsrError_DataExtensionMissingResultSetContent"},z[I.ProxyModelChainLimitExceeded]={localizedTitle:"DsrError_ProxyModelChainLimitExceededErrorKey",localizedContent:"DsrError_ProxyModelChainLimitExceededErrorContent",helpLink:"https://go.microsoft.com/fwlink/?LinkID=2225640"},z[I.CannotUseMultiColumnFilteringWithMappedColumns]={localizedContent:"DsrError_DQP_CannotUseMultiColumnFilteringWithMappedColumns",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.DifferentMappingsWithinSubqueries]={localizedContent:"DsrError_DQP_DifferentMappingsWithinSubqueries",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.FilterIncompatibleWithParameter]={localizedContent:"DsrError_DQP_FilterIncompatibleWithParameter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.FoundMultipleTargetsWithAtLeastOneMapping]={localizedContent:"DsrError_DQP_FoundMultipleTargetsWithAtLeastOneMapping",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.FoundParameterMappingOnUnsupportedFilter]={localizedContent:"DsrError_DQP_FoundParameterMappingOnUnsupportedFilter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.InTableConditionNotSupportedWithMappedParameters]={localizedContent:"DsrError_DQP_InTableConditionNotSupportedWithMappedParameters",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.InvalidMappedParameterValueExpression]={localizedContent:"DsrError_DQP_InvalidMappedParameterValueExpression",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.MappedTargetMustMatchMappedCondition]={localizedContent:"DsrError_DQP_MappedTargetMustMatchMappedCondition",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.MixOfAssignedAndUnassignedColumnsWithinORExpression]={localizedContent:"DsrError_DQP_MixOfAssignedAndUnassignedColumnsWithinORExpression",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.MultipleParameterAssignmentsWithinORUnsupported]={localizedContent:"DsrError_DQP_MultipleParameterAssignmentsWithinORUnsupported",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.MultipleParameterMappingsUnsupported]={localizedContent:"DsrError_DQP_MultipleParameterMappingsUnsupported",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.ParameterMappingFilterConflict]={localizedContent:"DsrError_DQP_ParameterMappingFilterConflict",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.ParameterMappingsFoundWithinFilteredEvalExpressionFilter]={localizedContent:"DsrError_DQP_ParameterMappingsFoundWithinFilteredEvalExpressionFilter",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.ParameterMappingsNotSupportedOnHighlights]={localizedContent:"DsrError_DQP_ParameterMappingsNotSupportedOnHighlights",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.SingleValueParameterWithMultipleValues]={localizedContent:"DsrError_DQP_SingleValueParameterWithMultipleValues",helpLink:"https://go.microsoft.com/fwlink/?linkid=2139315"},z[I.FabricThrottled]={localizedContent:"FabricCapacityThrottledErrorContent",helpLink:"https://aka.ms/capacitymessages"},z.OnPremiseServiceException={localizedMessage:"DsrError_OnPremiseServiceExceptionMessage"},z),Tk=function(){function t(e){this.oDataError=e,this.oDataCode=this.parseCode()}return Object.defineProperty(t,"maxNumberOfCommaValues",{get:function(){return 9},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.oDataCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oDataErrorMessage",{get:function(){if(this.oDataError&&this.oDataError.message&&this.oDataError.message.value)return this.oDataError.message.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){switch(this.oDataError.source){case"PowerBI":return"PowerBI";case"External":return"External";case"Unknown":return;case"User":return t.isCodeKnown(this.code)?"User":void 0}u.assertFail("unknown DsrClientError source: ".concat(this.oDataError.source))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AdditionalErrorMessages",{get:function(){if(this.oDataError){var r=this.oDataError[Jo];if(!_.isEmpty(r))for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!_.isEmpty(a.additionalMessages))return a.additionalMessages}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"powerBiErrorDetails",{get:function(){if(this.oDataError){var r=this.oDataError[Jo];if(!_.isEmpty(r))for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!_.isEmpty(a.powerBiErrorDetails))return a.powerBiErrorDetails}}},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){var r=this.oDataError[Jo],n=null;if(r)for(var i=0,a=r;i<a.length;i++){var o=a[i];if(o.details){n=o.details;break}}var s=t.getErrorDetailsFromStatusCode(this.code,this.oDataErrorMessage,n,this.AdditionalErrorMessages,e),l=s.displayableErrorInfo[0].errorInfoKey;if(!t.isCodeKnown(this.code)&&n&&(s.displayableErrorInfo=[]),n){var c=0===s.displayableErrorInfo.length?l:e.get("DsrError_MoreInfo");s.displayableErrorInfo.push({errorInfoKey:c,errorInfoValue:n})}return t.isDynamicQueryParameterErrorCode(this.code)&&(s.hideDebugInfo=!0),s},t.getErrorDetailsFromStatusCode=function(e,r,n,i,a){var o=a.get("DsrError_Key"),s=a.get("DsrError_UnknownErrorValue"),l=a.get("DsrError_Key"),c="https://support.powerbi.com",f=Ik[e];f&&(o=f.localizedTitle?a.get(f.localizedTitle):o,s=t.getContent(e,n,i,f,a)||s,l=f.localizedMessage?a.get(f.localizedMessage):l,c=f.helpLink||c,f.useODataErrorMessageAsContent&&(s=r||l));var p={message:l,displayableErrorInfo:[{errorInfoKey:o,errorInfoValue:s}],helpLink:c,debugErrorInfo:[]};return!f&&e&&p.debugErrorInfo.push({errorInfoKey:Jv,errorInfoValue:e}),(!f||!f.useODataErrorMessageAsContent)&&r&&p.debugErrorInfo.push({errorInfoKey:"OData Error Message",errorInfoValue:r}),p},t.getContent=function(e,r,n,i,a){if(i.localizedContentWithAffectedItemsAndPosition||i.localizedContentWithAffectedItemsAndPositionAndDetails){var o=t.findAdditionalMessageWithAffectedItemsAndPosition(e,n);if(i.localizedContentWithAffectedItemsAndPositionAndDetails&&r&&o)return Be(a.get(i.localizedContentWithAffectedItemsAndPositionAndDetails),Os(o.AffectedItems,a,t.maxNumberOfCommaValues),Ge.formatValue(o.Line),Ge.formatValue(o.Position),r);if(i.localizedContentWithAffectedItemsAndPosition&&o)return Be(a.get(i.localizedContentWithAffectedItemsAndPosition),Os(o.AffectedItems,a,t.maxNumberOfCommaValues),Ge.formatValue(o.Line),Ge.formatValue(o.Position))}if(i.localizedContentWithAffectedItems){var s=t.getAffectedItemsFromStatusCode(e,n);if(s.length>0)return Be(a.get(i.localizedContentWithAffectedItems),Os(s,a,t.maxNumberOfCommaValues))}if(i.localizedContent)return a.get(i.localizedContent)},t.findAdditionalMessageWithAffectedItemsAndPosition=function(e,r){return _.find(r,function(n){return n.Code===e&&!_.isEmpty(n.AffectedItems)&&null!=n.Position&&null!=n.Line})},t.getAffectedItemsFromStatusCode=function(e,r){for(var n=0,i=r;n<i.length;n++){var a=i[n];if(a.Code===e)return a.AffectedItems||[]}return[]},t.prototype.parseCode=function(){var e=this.oDataError.code,r=this.oDataError[Jo],n=[];if(r)for(var i=0,a=r;i<a.length;i++){var o=a[i];o.additionalMessages&&(n=o.additionalMessages)}if(n.length>0)for(var s=0,l=n;s<l.length;s++){var c=l[s];if(t.isCodeKnown(c.Code)){e=c.Code;break}}return e},t.isCodeKnown=function(e){return t.isGeneralKnownErrorCode(e)||t.isDynamicQueryParameterErrorCode(e)},t.isGeneralKnownErrorCode=function(e){switch(e){case I.ComplexSlicerNotAllowedWithMeasures:case I.ComplexHighlightsNotAllowed:case I.ExclusivePercentileOutOfRange:case I.InvalidDataShapeNoOutputData:case I.InvalidFilterComparisonIncompatibleExpressions:case I.InvalidFilterConditionIncompatibleDataType:case I.InvalidUnconstrainedJoin:case I.ModelUnavailable:case I.OverlappingKeysOnOppositeHierarchies:case I.rsQueryMemoryLimitExceeded:case I.rsQueryTimeoutExceeded:case I.CouldNotResolveModelReferencesInSemanticQuery:case I.QueryExtensionMeasureUnexpectedEndOfUserInput:case I.NativeVisualCalculationUnexpectedEndOfUserInput:case I.rsAccessDenied:case I.NoUniqueKeyForDetailTable:case I.IsRelatedToManyNotSupportedForDetailTable:case I.ModelMeasuresNotSupportedForDetailTable:case I.UnsupportedDateTimeLiteral:case I.InvalidExtensionDax_UnclosedBracketIdentifier:case I.InvalidExtensionDax_UnexpectedCloseParenthesis:case I.InvalidExtensionDax_UnclosedQuoteIdentifier:case I.InvalidExtensionDax_UnclosedParenthesis:case I.InvalidExtensionDax_UnclosedStringLiteral:case I.InvalidExtensionDax_UnclosedMultiLineComment:case I.ExtensionMeasureEmptyExpression:case I.ExtensionMeasureNameNotUniqueModel:case I.ExtensionMeasureNameNotUnique:case I.CouldNotResolveModelReferencesInQueryExtensionSchema:case I.QueryExtensionMeasureError:case I.NativeVisualCalculationError:case I.UnsupportedDataSourceVariables:case I.DataExtensionMissingResultSet:case I.ProxyModelChainLimitExceeded:case I.FabricThrottled:return!0;default:return!1}},t.isDynamicQueryParameterErrorCode=function(e){switch(e){case I.CannotUseMultiColumnFilteringWithMappedColumns:case I.DifferentMappingsWithinSubqueries:case I.FilterIncompatibleWithParameter:case I.FoundMultipleTargetsWithAtLeastOneMapping:case I.FoundParameterMappingOnUnsupportedFilter:case I.InTableConditionNotSupportedWithMappedParameters:case I.InvalidMappedParameterValueExpression:case I.MappedTargetMustMatchMappedCondition:case I.MixOfAssignedAndUnassignedColumnsWithinORExpression:case I.MultipleParameterAssignmentsWithinORUnsupported:case I.MultipleParameterMappingsUnsupported:case I.ParameterMappingFilterConflict:case I.ParameterMappingsFoundWithinFilteredEvalExpressionFilter:case I.ParameterMappingsNotSupportedOnHighlights:case I.SingleValueParameterWithMultipleValues:return!0;default:return!1}},t}();function om(t,e){if(t.metadata.dataReduction={},t.categorical){var r=t.metadata.dataReduction.categorical={};e.Primary&&(r.categories=Yo(e.Primary)),e.Secondary&&(r.values=Yo(e.Secondary)),e.Intersection&&(r.metadata=Yo(e.Intersection))}t.matrix&&(r=t.metadata.dataReduction.matrix={},e.Primary&&(r.rows=Yo(e.Primary)))}function Yo(t){switch(t.Type){case 3:return{binnedLineSample:{}};case 4:return{overlappingPointsSample:{}};default:return{}}}function bn(t,e){u.assertValue(t,"node");var r=t.values;r||(r=t.values={});var n=r[e];return n||(n=r[e]={}),n}function sm(t,e,r,n){u.assertValue(t,"context"),u.assertValue(r,"dataShape"),u.assertValue(n,"metadata"),u.assert(function(){return t.includes(2)},"context.includes(StandardDataViewKinds.Matrix)");var i=pi("DSR.matrix(".concat(t.perfId,")")),a=[],o=[],s=[];!function(t,e,r,n,i){u.assertValue(i,"metadataColumns");for(var a=t.selects,o=0,s=a.length;o<s;o++){var l=a[o];if(l){var c=Nk(t,i,o);if(l.Kind===ne.Measure)n.push(c);else if(null!=l.Depth){var f=e[l.Depth];null!=f?f.sources.push(c):e[l.Depth]=Qc([c])}else if(null!=l.SecondaryDepth){var d=r[l.SecondaryDepth];null!=d?d.sources.push(c):r[l.SecondaryDepth]=Qc([c])}l.DynamicFormat&&l.DynamicFormat.Format&&(u.assertValue(c.formatSource&&c.formatSource.formatString,"metadataColumn.formatSource.formatString"),n.push(c.formatSource.formatString))}}var p=n.length;(p>1||p>0&&(0===e.length||0===r.length))&&r.push(Qc(n))}(t,a,o,s,n.columns);var l=[],c=function(t,e,r,n,i,a){if(!i.SecondaryHierarchy||0===i.SecondaryHierarchy.length){var o={};return Wc(o,r,0,!1),o}var s;n&&n.Secondary&&(s=n.Secondary.Groupings);var l=cm(t,e,i.SecondaryHierarchy,s,function(c,f,d,p,h){if(h<e.length)if(p.isSubtotal){var v=e.length-1,g=e[v].sources.length;g>1&&Wc(p,g,v,!0)}else u.assert(function(){return h===e.length-1},"We only support one extra level in the column hierarchy (for measures)"),Wc(p,e[h].sources.length,h,!1);a.push(um(p)),t.stats.secondary++});return l}(t,o,s.length,e,r,l),f=function(t,e,r,n,i){if(n.PrimaryHierarchy&&0!==n.PrimaryHierarchy.length){var a;r&&r.Primary&&(a=r.Primary.Groupings);var o=0,s=0;r&&(o=lm(r.Primary),s=lm(r.Secondary));var l=_.filter(t.selects,function(f){return f&&f.Kind===ne.Measure}),c=cm(t,e,n.PrimaryHierarchy,a,function(f,d,p,h,v){(function(t,e,r,n,i,a,o){u.assertValue(r,"instance"),u.assertValue(n,"node"),u.assertValue(i,"intersectionToSecondaryAggIdx");var s=r.Intersections,l={index:0};if(s)for(var c=0,f=s.length;c<f;c++)s[c].Calculations&&dm(t,e,s[c].Calculations,n,l,i[c],a,o);else dm(t,e,r.Calculations,n,l,0,a,o)})(d,l,p,h,i,o,s),f.stats.primary++});return c}}(t,a,e,r,l),h={rows:{root:f,levels:a},columns:{root:c,levels:o},valueSources:s};return i(),h}function Qc(t){u.assertValue(t,"metadataColumns");for(var e={sources:[]},r=0,n=t.length;r<n;r++)e.sources.push(t[r]);return e}function Nk(t,e,r){u.assertValue(e,"metadataColumns");for(var n=0,i=e.length;n<i;n++){var a=e[n];if(a&&a.index===r&&void 0===a.groupName)return a}return t.createColumns(e,r)}function um(t){return u.assertValue(t,"node"),t.isSubtotal?t.level:t.level+1}function lm(t){return u.assertAnyValue(t,"axis"),t&&t.Groupings?t.Groupings.length:0}function Wc(t,e,r,n){t.children=[];for(var i=0;i<e;i++){var a={level:r};i>0&&(a.levelSourceIndex=i),t.children.push(a),n&&(a.isSubtotal=!0)}}function cm(t,e,r,n,i){u.assertValue(t,"context");var a={};return fm(t,e,a,r,n,0,i),a}function fm(t,e,r,n,i,a,o){if(u.assertValue(t,"context"),u.assertValue(r,"node"),u.assertValue(a,"depth"),n)for(var s=t.selects,l=function(t,e){u.assertAnyValue(t,"levelSources"),u.assertValue(e,"depth");var r=[],n=t&&t[e]&&t[e].sources;if(!_.isEmpty(n))for(var i=0,a=n.length;i<a;i++){var o=n[i];u.assertValue(o.index,"pre-condition: sourceMetadataColumn.index is defined"),r[o.index]=i}return r}(e,a),c=0,f=n.length;c<f;c++)for(var d=n[c],p=0,h=0,v=d.Instances.length;h<v;h++){var g=d.Instances[h];if(0===p&&4===(p=zk(s,i,a,d,g)))break;var y={level:a};if(r.children||(r.children=[]),r.children.push(y),1===p){var m=Ok(s,g.Calculations,l);if(!_.isEmpty(m)){y.levelValues=m;var S=_.last(m);y.value=S.value,S.levelSourceIndex>0&&(y.levelSourceIndex=S.levelSourceIndex)}}else 3===p&&(y.isSubtotal=!0);g.RestartFlag&&1===g.RestartFlag&&(y.isMerge=!0),i&&1===p&&(r.childIdentityFields=t.readKeys(i,a),y.identity=t.readIdentity(i,g,a));var b=g.Members;b&&b.length>0?fm(t,e,y,b,i,a+1,o):o&&o(t,p,g,y,a+1)}}function Ok(t,e,r){u.assertValue(t,"selects"),u.assertValue(e,"calculations"),u.assertNonEmpty(r,"selectIndexToLevelSourceIndexMapping should be non-empty for dynamic groups");for(var n,i=0,a=t.length;i<a;i++){var o=t[i];if(o&&o.Value&&o.Kind===ne.Group){var s=X.findAndParseCalculation(e,o.Value);void 0!==s&&(n||(n=[]),n.push({levelSourceIndex:r[i],value:s}))}}return n}function zk(t,e,r,n,i){if(u.assertValue(t,"selects"),u.assertValue(n,"member"),e&&e.length>r&&null!=n.Id){var a=e[r];if(n.Id===a.Member)return 1;if(n.Id===a.SubtotalMember)return 3}var o=i.Calculations;if(o){for(var s=!1,l=0,c=t.length;l<c;l++){var f=t[l];if(f&&X.findCalculation(o,f.Value)){if(f.Kind===ne.Group)return 1;!s&&f.Kind===ne.Measure&&(s=!0)}}if(s)return 2}return 4}function dm(t,e,r,n,i,a,o,s){if(u.assertValue(e,"selects"),u.assertValue(n,"node"),r)for(var l={index:0},c=function(h,v){var g=e[h];u.assert(function(){return g.Kind===ne.Measure},"measureSelects is expected to have measure select bindings only");var y=g.Highlight,S=y&&y.DynamicFormat&&y.DynamicFormat.Format;if(pm(t,r,n,i,l,a,o,s,0,g.Value,y&&y.Value,g.Subtotal),g.DynamicFormat&&g.DynamicFormat.Format){var b=_.map(g.SubtotalDynamicFormat,function(E){return E&&E.Format});pm(t,r,n,i,l,a,o,s,0,g.DynamicFormat.Format,S,b)}},f=0,d=e.length;f<d;f++)c(f)}function pm(t,e,r,n,i,a,o,s,l,c,f,d){u.assertValue(i,"measureIndex");var p=bn(r,n.index),h=null;if(3!==t&&(h=X.findAndParseCalculation(e,c)),null==h){var g=function(t,e,r,n,i,a){if(e){var o=X.computeAggIdx(r,n,i,a);if(o<e.length)return X.findAndParseCalculation(t,e[o])}}(e,d,um(r),a,o,s);void 0!==g&&(h=g)}f&&(p.highlight=X.findAndParseCalculation(e,f)),p.value=h,i.index>0&&(p.valueSourceIndex=i.index),n.index++,i.index++}var Gk=function(){function t(e){u.assertValue(e,"context"),this._context=e}return t.prototype.read=function(e,r,n){var i=this;u.assertValue(r,"dataShape");var a={metadata:{columns:[]}};return n.script=Je(function(){if(r.PrimaryHierarchy&&r.PrimaryHierarchy.length>0){var o=r.PrimaryHierarchy[0];if(o&&o.Instances.length>0){var f=X.findCalculation(o.Instances[0].Calculations,i._context.scriptVisualBinding.PayloadCalculationId||i._context.scriptVisualBinding.ImageCalculationId);if(f){var p=function(t){return t&&_.startsWith(t,Sy)?t.substring(Sy.length,t.length-1):null}(f.Value);p&&(a.scriptResult={payloadBase64:p})}}}}),a},t}(),hm=function(){function t(e){u.assertValue(e,"context"),this.context=e}return t.prototype.read=function(e,r,n){var i=this;u.assertValue(r,"dataShape");var a=this.context,o=this.readMetadata(r.IsComplete),s={metadata:o},l=a.includes(16),c=a.includes(1),f=a.includes(4),d=a.includes(8);if(l||c||f||d){var p,h=Je(function(){p=i.parseTree(o.columns,e,r),u.assertValue(p,"root")});l&&(n.tree=h+Je(function(){var v=i.createTree(o,p);v&&(s.tree=v)})),c&&(n.categorical=h+Je(function(){var v=i.categorize(o,p);v&&(s.categorical=v)})),f&&(n.single=h+Je(function(){var v=i.createSingleValue(o,p);v&&(s.single=v)})),d&&(n.table=h+Je(function(){var v=i.createTable(o,p);v&&(s.table=v)}))}return a.includes(2)&&(n.matrix=Je(function(){var v=sm(i.context,e,r,s.metadata);v&&(s.matrix=v)})),s},t.prototype.readMetadata=function(e){for(var r={columns:[]},n=this.context,i=n.selects,a=0,o=i.length;a<o;a++)i[a]?n.createColumns(r.columns,a):n.actionHistory|=1;return e||(r.segment={}),r},t.prototype.parseTree=function(e,r,n){var i=pi("DSR.tree(".concat(this.context.perfId,")")),a={},o=this.context.selects;this.parseRootAggregates(e,a);var s=X.getTopLevelPrimaryDynamicMember(n,r,!0);if(s){var l=n.PrimaryHierarchy[0];s!==l&&this.parseValues(o,a,t.getFirstInstanceCalcs(l));var c=void 0;r&&r.Primary&&(c=r.Primary.Groupings),this.parseRecursive(a,s,c,0,e)}else _.isEmpty(n.PrimaryHierarchy)||this.parseValues(o,a,t.getFirstInstanceCalcs(n.PrimaryHierarchy[0]));return i(),a},t.prototype.parseRecursive=function(e,r,n,i,a){u.assertValue(e,"node"),u.assertValue(r,"dynamicMember"),u.assertValue(i,"depth"),u.assertAnyValue(a,"columns");var c,o=this.context,s=r.Instances,l=s.length;l&&(e.children=[],0===i&&(c=Kk.create(e,o))),n&&(e.childIdentityFields=o.readKeys(n,i));for(var f=0;f<l;f++){var d=s[f],p={};e.children.push(p),d.RestartFlag&&1===d.RestartFlag&&(p.isMerge=!0),this.parseValues(o.selects,p,d.Calculations,c),n&&(p.identity=o.readIdentity(n,d,i));var h=d.Members;if(this.parseAggregates(o.selects,p,d.Calculations,h,i+1),!_.isEmpty(h)){var v=X.getDynamicMember(h,n,i+1);v&&this.parseRecursive(p,v,n,i+1)}}c&&c.complete(a)},t.getFirstInstanceCalcs=function(e){u.assertValue(e,"member");var r=e.Instances;return r.length>0?r[0].Calculations:null},t.prototype.parseRootAggregates=function(e,r){u.assertValue(e,"columns"),u.assertValue(r,"node");for(var n=0,i=e.length;n<i;n++){var o=e[n].aggregates;o&&X.copyAggregates(o,bn(r,n))}},t.prototype.parseAggregates=function(e,r,n,i,a){u.assertValue(e,"selects"),u.assertValue(r,"node"),u.assertAnyValue(n,"calculations"),u.assertAnyValue(i,"allMembers");for(var o=0,s=e.length;o<s;o++){var l=e[o];if(l){var c=vm(l,n,i,a);c&&X.copyAggregates(c,bn(r,this.context.selectIndexToColumnIndexMap[o]))}}},t.prototype.parseValues=function(e,r,n,i){if(u.assertValue(e,"selects"),u.assertValue(r,"node"),u.assertAnyValue(n,"calculations"),!_.isEmpty(n))for(var a=0,o=0,s=e.length;a<s;a++){var l=e[a];if(l){if(l.Value&&void 0!==(c=X.findAndParseCalculation(n,l.Value))&&(l.Kind===ne.Group?r.name=c:(r.value=c,i&&i.add(o,c)),bn(r,o).value=c),l.Highlight){var f=X.findAndParseCalculation(n,l.Highlight.Value);void 0!==f&&(bn(r,o).highlight=f)}if(o++,l.DynamicFormat&&l.DynamicFormat.Format){var c=X.findAndParseCalculation(n,l.DynamicFormat.Format);bn(r,o).value=c,o++}}}},t.prototype.categorize=function(e,r){if(u.assertValue(e,"metadata"),!this.canCategorize())return null;for(var a,n=pi("DSR.categorical(".concat(this.context.perfId,")")),i={},o=0,s=e.columns.length;o<s;o++){var l=e.columns[o];if(void 0!==l.index){if(!l.isMeasure){a||(a=[]),a.push({columnIndex:o,metadataColumn:l});continue}var c={source:l,values:[]},f=l.aggregates;f&&X.copyAggregates(f,c),i.values||(i.values=Tr()),i.values.push(c)}}if(a){i.categories=[];for(var d=void 0,p=0,h=a.length;p<h;p++){var v=a[p],g=r.children,y={source:v.metadataColumn,values:[]};if(g)for(var m=0,S=g.length;m<S;m++){var b=g[m];y.values.push(b.values[v.columnIndex].value),0===p&&(this.writeCategoricalValues(e,b,i.values),b.identity&&(d||(d=[]),d.push(b.identity))),b.isMerge&&(i.lastMergeIndex=m)}d&&(y.identity=d),r.childIdentityFields&&(y.identityFields=r.childIdentityFields),i.categories.push(y)}}else this.writeCategoricalValues(e,r,i.values);return n(),i},t.prototype.canCategorize=function(){for(var r=this.context.selects,n=0,i=r.length;n<i;n++){var a=r[n];if(a&&a.Depth>0)return!1}return!0},t.prototype.createTree=function(e,r){var n=this.context;if(!(2&n.actionHistory||1&n.actionHistory))return{root:r};var i=ve(r),a=e.columns,o=r.values;if(o){for(var s={},l=0;l<a.length;l++){var c=a[l];void 0!==c.index&&void 0!==o[l]&&(s[c.index]=o[l])}i.values=s}var f=r.children;return f&&(i.children=this.removeFormatSourceFromTreeChildren(a,f)),{root:i}},t.prototype.removeFormatSourceFromTreeChildren=function(e,r){for(var n=r.length,i=_.map(r,function(d){return d}),a=0;a<n;a++){var o=ve(i[a]);i[a]=o;for(var s={},l=0;l<e.length;l++){var c=e[l];void 0!==c.index&&void 0!==i[a].values[l]&&(s[c.index]=i[a].values[l])}i[a].values=s;var f=i[a].children;f&&(i[a].children=this.removeFormatSourceFromTreeChildren(e,f))}return i},t.prototype.createTable=function(e,r){u.assertValue(e,"metadata");for(var n,i=this.context.selects,a=0,o=i.length;a<o;a++)if(i[a]){var l=i[a].Depth;l>=0&&(n=Math.max(l,n||0))}if(n>0)return null;var f,h,c=pi("DSR.table(".concat(this.context.perfId,")")),d=[],p=e.columns.length;if(n>=0){var v=r.children;if(v){a=0;for(var g=v.length;a<g;a++){var y=v[a];this.toTableRow(y,p,d),y.isMerge&&(f=a),y.identity&&(h||(h=[]),h.push(y.identity))}}}else u.assert(function(){return 0===mc(e.columns)},"groups.length=0"),this.toTableRow(r,p,d);var m=this.toTotals(r,p),S={rows:d,columns:e.columns};return h&&(S.identity=h),r.childIdentityFields&&(S.identityFields=r.childIdentityFields),m&&(S.totals=m),f>=0&&(S.lastMergeIndex=f),c(),S},t.prototype.toTableRow=function(e,r,n){for(var i=[],a=0;a<r;a++){var o=e.values[a];o&&i.push(o.value)}n.push(i)},t.prototype.toTotals=function(e,r){var n=[],i=e.values,a=!1;if(i)for(var o=0;o<r;o++){var s=i[o],l=s?s.subtotal:null;a=a||null!=l,n.push(l)}return a?n:null},t.prototype.writeCategoricalValues=function(e,r,n){for(var i=e.columns,a=0,o=0,s=i.length;o<s;o++){var l=i[o];if(l.isMeasure&&void 0!==l.index){var c=r.values[o];if(c){var f=n[a++];f.values.push(c.value),void 0!==c.highlight&&(f.highlights||(f.highlights=[]),f.highlights.push(c.highlight))}}}},t.prototype.createSingleValue=function(e,r){if(u.assertValue(e,"metadata"),u.assertValue(r,"root"),r.values){for(var n=e.columns,i=null,a=void 0,o=0,s=n.length;o<s;o++)if(n[o].isMeasure&&null!=n[o].index){if(i)return null;i=n[o],a=o}if(!i)return null;var l=r.values[a];if(!l)return null;var c=0===mc(e.columns)?l.value:l.subtotal;return void 0===c?null:{column:i,value:c}}return null},t}(),Qk=function(){function t(e){u.assertValue(e,"context"),this._context=e,this._categoriesMetadata=[],this._primaryMeasureSelects=[],this._measureSelects=[],this._secondarySelects=[],this._seriesColumn=null}return t.prototype.read=function(e,r,n){var i=this;u.assertValue(r,"dataShape");var a=this._context,o={metadata:this.readMetadata(r.IsComplete)};return a.includes(1)&&(n.categorical=Je(function(){var s=i.categorize(r,o.metadata,e);s&&(o.categorical=s)})),a.includes(2)&&(n.matrix=Je(function(){var s=sm(i._context,e,r,o.metadata);s&&(o.matrix=s)})),o},t.prototype.readMetadata=function(e){for(var r={columns:[]},n=this._context,i=n.selects,a=function(f,d){var p=i[f];if(!p)return"continue";if(p.Kind===ne.Measure)return 0===p.Depth?o._primaryMeasureSelects.push(p):o._measureSelects.push(p),"continue";u.assert(function(){return p.Kind===ne.Group},"Unexpected Select.Kind");var h=n.createColumns(r.columns,f);p.SecondaryDepth>=0?(o._secondarySelects.push(p),o._secondaryDepth=Math.max(o._secondaryDepth||0,p.SecondaryDepth),o._seriesColumn=h):0===p.Depth&&o._categoriesMetadata.push({select:p,column:h})},o=this,s=0,l=i.length;s<l;s++)a(s);return e||(r.segment={}),r},t.prototype.categorize=function(e,r,n){if(u.assertValue(e,"dataShape"),u.assertValue(r,"metadata"),0!==this._secondaryDepth||0===this._categoriesMetadata.length)return null;var a,o,i=pi("DSR.categorical(".concat(this._context.perfId,", secondary)"));n&&(n.Primary&&(a=n.Primary.Groupings),n.Secondary&&(o=n.Secondary.Groupings));var s=X.getTopLevelSecondaryDynamicMember(e,n),l=this.readColumnsFromSecondary(s,r,o,e.Calculations),c=X.getTopLevelPrimaryDynamicMember(e,n),f=this.readCategoriesAndValues(c,r,l,a),d={categories:f.categories,values:l};return void 0!==f.lastMergeIndex&&(d.lastMergeIndex=f.lastMergeIndex),i(),d},t.prototype.readColumnsFromSecondary=function(e,r,n,i){u.assertValue(e,"secondaryMember"),u.assertValue(r,"metadata");var a,o=this._context;n&&(a=o.readKeys(n,0));var s=[],l=o.selects,c=this._measureSelects.length,f=[],d=e.Instances,p=d.length;if(p)for(var h=0;h<p;h++){var v=d[h],g=v.Calculations,y=void 0;n&&(y=o.readIdentity(n,v,0));for(var m=0,S=this._secondarySelects.length;m<S;m++){for(var E=X.findAndParseCalculation(g,this._secondarySelects[m].Value),C=[],w=0;w<c;w++){var V=l.indexOf(M=this._measureSelects[w]),D=o.createColumns(r.columns,V,!0);void 0!==E&&(D.groupName=E);var A={source:D,values:[]};y&&(A.identity=y),this.addColumnAggregates(i,M,A),s.push(A),C.push(A)}f.push({identity:y,name:E,values:C})}}else{for(w=0;w<c;w++){var M;V=l.indexOf(M=this._measureSelects[w]),D=o.createColumns(r.columns,V),this.addColumnAggregates(i,M,A={source:D,values:[]}),s.push(A)}f.push({values:Ee([],s||[],!0)})}w=0;for(var P=this._primaryMeasureSelects.length;w<P;w++)V=l.indexOf(this._primaryMeasureSelects[w]),D=o.createColumns(r.columns,V),s.push(A={source:D,values:[]});a&&(s.identityFields=a);var N=this._seriesColumn;return N&&(s.source=N),s.grouped=function(){return f},s},t.prototype.addColumnAggregates=function(e,r,n){e&&(r.Max&&(n.max=X.findAndParseCalculation(e,r.Max[0])),r.Min&&(n.min=X.findAndParseCalculation(e,r.Min[0])))},t.prototype.readCategoriesAndValues=function(e,r,n,i){u.assertValue(e,"primaryMember"),u.assertValue(n,"values");for(var l,a=[],o=this._categoriesMetadata,s=o.length,c=this._context,f=0;f<s;f++)a.push(d={source:o[f].column,values:[]}),i&&(l||(l=[]),d.identity=l,d.identityFields=c.readKeys(i,0));for(var v,p=e.Instances,h=this._primaryMeasureSelects,g=(f=0,p.length);f<g;f++){var y=p[f];1===y.RestartFlag&&(v=f);for(var m=0;m<s;m++){var d;(d=a[m]).values.push(X.findAndParseCalculation(y.Calculations,o[m].select.Value))}l&&l.push(c.readIdentity(i,y,0));for(var S=y.Intersections,b=0,E=0,C=S.length;E<C;E++)for(var w=S[E].Calculations,M=0,V=this._measureSelects.length;M<V;M++)if(void 0!==(A=X.findAndParseCalculation(w,(D=this._measureSelects[M]).Value))&&((P=n[b++]).values.push(A),D.Highlight)){P.highlights||(P.highlights=[]);var F=X.findAndParseCalculation(w,D.Highlight.Value);P.highlights.push(F)}for(E=0,C=h.length;E<C;E++){var D,P,A=X.findAndParseCalculation(w=y.Calculations,(D=h[E]).Value);if((P=n[b++]).values.push(A),D.Highlight){P.highlights||(P.highlights=[]);var N=X.findAndParseCalculation(w,D.Highlight.Value);P.highlights.push(N)}}}return{categories:a,lastMergeIndex:v}},t}(),Wk=function(){function t(e,r,n,i){u.assertValue(e,"targets"),u.assert(function(){return null!=r.Select||null!=r.ScriptVisualBinding},"descriptor"),u.assertAnyValue(n,"perfId"),u.assertValue(i,"aggregateReader"),this.targets=e,this.selects=r.Select,this.scriptVisualBinding=r.ScriptVisualBinding,this.perfId=n||"",this.stats={id:n||void 0,primary:0,secondary:0},this.aggregateReader=i,this.cacheItems=[],this.selectIndexToColumnIndexMap={}}return t.prototype.createColumns=function(e,r,n){var a=this.columnMetadata(r,e.length,n);e.push(a);var s=this.tryCreatingDynamicFormatColumnMetadata(r,e.length,a);return s&&e.push(s),a},t.prototype.columnMetadata=function(e,r,n){u.assertValue(e,"selectIndex"),u.assertAnyValue(n,"suppressAggregates");var i=this.selects[e];u.assertValue(i,"select");var a={displayName:"",index:e};if(i.Format&&(a.format=i.Format),a.type=X.describeDataType(i.Type,i.DataCategory),i.Kind===ne.Measure&&(a.isMeasure=!0),!n){var o=this.aggregateReader.compute(i,r);o&&(a.aggregates=o)}var s=i.GroupKeys;if(s)for(var l=a.identityExprs=[],c=0,f=s;c<f.length;c++){var p=this.convertKey(f[c]);l.push(p)}return this.selectIndexToColumnIndexMap[e]=r,a},t.prototype.tryCreatingDynamicFormatColumnMetadata=function(e,r,n,i){var a=this.selects[e];if(a.DynamicFormat&&a.DynamicFormat.Format){var o={displayName:"",isMeasure:!0};n.formatSource={formatString:o};var s={Kind:ne.Measure,Subtotal:_.map(a.SubtotalDynamicFormat,function(c){return c&&c.Format})};if(!i){var l=this.aggregateReader.compute(s,r);l&&(o.aggregates=l)}return this.actionHistory|=2,o}},t.prototype.readIdentity=function(e,r,n){u.assertValue(e,"axisGroupings"),u.assertValue(n,"depth");for(var a,i=this.readKeys(e,n),o=e[n].Keys,s=0,l=o.length;s<l;s++){var c=o[s],d=X.findAndParseCalculationToSQExpr(r.Calculations,c.Calc||this.selects[c.Select].Value);a=st(a,Nn(i[s],d))}return Et(a)},t.prototype.readKeys=function(e,r){u.assertValue(e,"axisGroupings"),u.assertValue(r,"depth");var n=this.getAxisCache(e),i=n.exprs[r];if(void 0===i){i=n.exprs[r]=[];for(var a=e[r].Keys,o=0,s=a.length;o<s;o++)i.push(this.convertKey(a[o]))}return i},t.prototype.includes=function(e){return u.assertValue(e,"kind"),ie(this.targets,e)},t.prototype.getAxisCache=function(e){u.assertValue(e,"axisGroupings");for(var r=this.cacheItems,n=0,i=r.length;n<i;n++){var a=r[n];if(a.axisGroupings===e)return a}var o={axisGroupings:e,exprs:[]};return r.push(o),o},t.prototype.convertKey=function(e){u.assertValue(e,"key");var r=e.Source;return Re(je(Ky(r),r.Entity||r.EntitySet),r.Property)},t}(),jk=function(){function t(e,r){u.assert(function(){return null!=e.Select||null!=e.ScriptVisualBinding},"descriptor"),u.assertValue(r,"dataShape"),this.dataShape=r}return t.prototype.compute=function(e,r,n){u.assertValue(r,"columnIndex");var i=this.cache;if(i){var a=i[r];if(a)return a}if(e){i||(this.cache=i={});var o=this.dataShape,s=vm(e,o.Calculations,o.PrimaryHierarchy,0);return n&&!s&&(s={}),i[r]=s,s}},t.prototype.updateAggregates=function(e,r,n,i){u.assertValue(e,"select"),u.assertValue(r,"columnIndex"),u.assertValue(n,"name"),u.assertAnyValue(i,"value");var a=this.compute(e,r,!0);if(a)return a[n]=i,a},t}();function vm(t,e,r,n){u.assertValue(t,"select"),u.assertAnyValue(e,"calculations"),u.assertAnyValue(r,"allMembers"),u.assertValue(n,"depth");var i=!_.isEmpty(r)&&hm.getFirstInstanceCalcs(r[0]);if(!_.isEmpty(e)||!_.isEmpty(i)){var a;if(!_.isEmpty(i)&&t.Subtotal&&(o=t.Subtotal[n])&&void 0!==(s=X.findAndParseCalculation(i,o))&&(a||(a={}),a.subtotal=s),!_.isEmpty(e)){t.Max&&(o=t.Max[n])&&void 0!==(s=X.findAndParseCalculation(e,o))&&(a||(a={}),a.max=s),t.Min&&(o=t.Min[n])&&void 0!==(s=X.findAndParseCalculation(e,o))&&(a||(a={}),a.min=s),t.Count&&(o=t.Count[n])&&void 0!==(s=X.findAndParseCalculation(e,o))&&(a||(a={}),a.count=s);var l=t.Aggregates;if(l)for(var c=0,f=l;c<f.length;c++){var o,s,d=f[c],p=d.Aggregate;if((o=d.Ids[n])&&void 0!==(s=X.findAndParseCalculation(e,o))){var h=p.Percentile;if(h){var v={k:h.K,value:s};h.Exclusive&&(v.exclusive=h.Exclusive),a||(a={});var g=a.percentiles;g||(g=a.percentiles=[]),g.push(v)}else p.Average?(a||(a={}),a.average=s):p.Median&&(a||(a={}),a.median=s)}}0===n&&(o=t.Value)&&void 0!==(s=X.findAndParseCalculation(e,o))&&(a||(a={}),a.single=s)}return a}}var Kk=function(){function t(e,r,n,i){u.assertValue(e,"node"),u.assertValue(r,"aggregateReader"),u.assertValue(i,"aggregators"),this.node=e,this.aggregateReader=r,this.selects=n,this.aggregators=i}return t.create=function(e,r){for(var n=e.values,i=r.selects,a=!1,o={},s=0,l=0,c=i.length;s<c;s++){var f=i[s];if(f){if(f.Kind!==ne.Measure){l++;continue}var p=void 0,h=void 0;if(n&&(h=n[l])){if(p=[],void 0===h.min&&p.push(new zc),void 0===h.max&&p.push(new Oc),0===p.length){l++;continue}}else p=[new zc,new Oc];o[l]=p,a=!0,l++,f.DynamicFormat&&f.DynamicFormat.Format&&l++}}if(a)return new t(e,r.aggregateReader,r.selects,o)},t.prototype.add=function(e,r){var n=this.aggregators[e];if(n)for(var i=0,a=n.length;i<a;i++)n[i].update(r)},t.prototype.complete=function(e){u.assertValue(e,"columns");for(var r=this.aggregators,n=this.node,i=this.aggregateReader,a=0,o=0,s=this.selects.length;a<s;a++){var l=this.selects[a];if(l){var c=r[o];if(!c){o++;continue}for(var f=0,d=c.length;f<d;f++){var p=c[f],h=p.value();if(void 0!==h){var v=p.name;bn(n,o)[v]=h,e[o].aggregates=i.updateAggregates(l,o,v,h)}}o++,l&&l.DynamicFormat&&l.DynamicFormat.Format&&o++}}},t}();function jc(t){if(u.assertAnyValue(t,"dsr"),2===t.Version)return!0}function Yk(t,e,r,n,i,a){if(u.assertValue(e,"arg"),!e)return null;var o;e.data&&(e=e.data),a&&a.isRunning()&&(o=a.createChildActivity({name:"Parse Query Result"}));var s={},l=e,c=It();_.isString(e)&&(s.dsrLength=e.length,s.jsonParse=Je(function(){l=JSON.parse(e)}),o&&o.setProperty("metrics",{jsonParse:s.jsonParse}));var f=function(t,e,r,n,i,a,o,s,l,c,f,d,p,h,v){if(!r)return null;var g,y;if(s||(s={}),4&t&&(t|=8),jc(r)){if(y="dsr2-read",performance&&performance.mark&&performance.mark(y+"-start"),s.mode="V2",1!==_.size(r.DS))return null;var m=function(t){var e=t.Select,r=t.Expressions,n=r&&r.Primary,i=n&&n.Groupings,a=n&&n.Synchronization,o=r&&r.Secondary&&r.Secondary.Groupings,s={},l=i&&[],c=o&&[];if(i)for(var f=0,d=i.length;f<d;f++)qc(s,i[f],f,l,e);if(o)for(f=0,d=o.length;f<d;f++)c[f]=[],qc(s,o[f],f,c,e);var p=0,h=[];if(e&&o)for(f=0;f<e.length;f++){var v=e[f];v&&v.Kind===ne.Measure&&null==v.Depth&&null==v.SecondaryDepth&&(h[p++]=f)}var g={intersectionMeasureToSelectIndex:h,secondaryLeafDataMemberId:o&&[],dataMemberIdToMetadata:s,selects:e,maxPrimaryDepth:_.size(i),maxSecondaryDepth:_.size(o),memberInstanceCalcMetadataCache:{},calcIdToCalcMetadata:{},intersectionCalcMetadataCache:{},primaryDataMemberIdCache:l,secondaryDataMemberIdCache:c,instancesCalcCache:{},lastIntersectionCalcCache:{},locked:!1};if(a){var y=a.length;for(g.primarySynchronizedGroups=new Array(y),f=0;f<y;f++){var m=a[f],S=_.last(m.Groupings);g.primarySynchronizedGroups[f]={groupings:m.Groupings,dataShapeId:m.DataShape,synchronizationIndexCalcId:i[S].SynchronizationIndex,context:rk(t,m)}}}return g}(e),S=rm(r,m);g=function(t,e,r,n,i){var a={columns:t.createDataViewMetadataColumns()},o={dataView:{metadata:a}};if(function(t,e){t.reset();var r=t.dataShapes();u.assert(function(){return 1===r.count()},"DSR has multiple DataShapes"),r.next(),r.complete()||(e.dataView.metadata.segment={},e.restartToken=r.restartTokens())}(e,o),t.includes(2)){var s,l=Je(function(){s=function(t,e,r,n){return new ak(t,e,r,n).run()}(t,e,a,i),s&&(o.dataView.matrix=s,e.lockCache())});s&&(r.matrix=l)}if(t.includes(1)){var c,f=Je(function(){c=function(t,e,r,n){if(Jy.isCompatible(t))return(new Jy).run(t,e,r)}(t,e,a),c&&(o.dataView.categorical=c,e.lockCache())});c&&(r.categorical=f)}if(t.includes(8)){var d,p=Je(function(){d=function(t,e,r){return new uk(t,e,r).run()}(t,e,a),d&&(o.dataView.table=d,e.lockCache())});d&&(r.table=p)}if(t.includes(16)){var h,v=Je(function(){h=function(t,e){return new ck(t,e).run()}(t,e),h&&(o.dataView.tree=h,e.lockCache())});h&&(r.tree=v)}if(t.includes(4)){var g,y=Je(function(){g=function(t,e){if($y.isCompatible(t))return new $y(t,e).run()}(t,e),g&&(o.dataView.single=g)});g&&(r.single=y)}return o}(new Hc(t,e,m,h,S.dataShapes()),S,s,0,h),S.reset();var E=S.dataShapes(),C=E.next();if(u.assert(function(){return C},"There must be a DataShape"),E.limitsExceeded()){g.warnings||(g.warnings=[]);var w=new Xy(e,function(t){for(var e=t.limits(),r=e.count(),n=new Array(r),i=0;i<r;i++)e.next(),n[i]={Id:e.id()};return n}(E),function(t){for(var e=new Array(t.calcCount()),r=0;t.nextCalc();r++)e[r]={Id:t.calcId(),Value:t.calcValue()};return e}(E));g.warnings.push(w),om(g.dataView,w.limits)}(function(t,e){var r=t.messages();if(r)for(;r.next();)Ko[r.code()]&&r.severity()===Zy(0)&&(e.warnings||(e.warnings=[]),e.warnings.push(r.dsrMessage()))})(E,g),g.dataView&&!_.isEmpty(a)&&(Gy(g.dataView,a),g.disallowPersisting=!0)}else y="dsr1-read",performance&&performance.mark&&performance.mark(y+"-start"),s.mode="V1Old",g=function(t,e,r,n,i,a,o){if(u.assertValue(t,"targets"),u.assertAnyValue(e,"descriptor"),u.assertValue(r,"dsr"),u.assertAnyValue(a,"clientSideFilters"),!function(t){return t&&1===_.size(t.DataShapes)}(r))return null;var s=r.DataShapes[0];if(s["odata.error"]){var c=new Tk(s["odata.error"]);return i&&(c.requestId=i),{error:c}}var d=new Wk(t,e,o,new jk(e,s)),p=function(t){if(u.assertValue(t,"context"),null!=t.scriptVisualBinding)return new Gk(t);for(var e=0,r=0,n=t.selects,i=0,a=n.length;i<a;i++){var o=n[i];o&&(null!=o.Depth&&(e=Math.max(e,o.Depth+1)),null!=o.SecondaryDepth&&(r=Math.max(r,o.SecondaryDepth+1)))}return r>=1&&1===e?new Qk(t):new hm(t)}(d).read(e.Expressions,s,n),h={dataView:p};if(s.RestartTokens&&(h.restartToken=s.RestartTokens),s.DataLimitsExceeded&&s.DataLimitsExceeded.length>0){h.warnings||(h.warnings=[]);var v=new Xy(e,s.DataLimitsExceeded,s.Calculations);h.warnings.push(v),om(p,v.limits)}if(s.DataShapeMessages&&s.DataShapeMessages.length>0)for(var g=0,y=s.DataShapeMessages;g<y.length;g++){var m=y[g];Ko[m.Code]&&m.Severity===Zy(0)&&(h.warnings||(h.warnings=[]),h.warnings.push(new em(m)))}return h.dataView&&!_.isEmpty(a)&&(Gy(h.dataView,a),h.disallowPersisting=!0),u.log("DSR.stats",d.stats),h}(t,e,r,s,i,a,o);return g&&(g.timestamp=f,g.fromCache=d,p&&!g.fromCache&&(g.performanceActivities=hk(p.Events,v&&v.getProperty("rootId")))),performance&&(performance.mark&&performance.mark(y+"-end"),performance.measure&&performance.measure(y,y+"-start",y+"-end")),s.total=It()-c,l&&l.logEvent(f_,{jsonparse:s.jsonParse,categorical:s.categorical,table:s.table,tree:s.tree,matrix:s.matrix,single:s.single,script:s.script,total:s.total,mode:s.mode,targetDataView:t,dsrLength:s.dsrLength,id:o}),g}(t,l.descriptor,l.dsr,0,l.requestId,l.clientSideFilters,i,s,n,c,l.timestamp,l.fromCache,l.metrics,r.scopedAggregates,a);if(null!=r&&r.queryContext){var d=l.queryContext;d&&(f.queryContext=d)}return o&&o.resolve(),f}var ym="CapacityLimitExceeded",Jc="ServerError_";var bm=function(){function t(e){this.message=e.message?e.message:"",this.m_serviceError=e}return Object.defineProperty(t.prototype,"code",{get:function(){return this.m_serviceError.errorCode||t.codeName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requestId",{get:function(){return this.httpRequestId},set:function(r){this.httpRequestId=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){var r=this.m_serviceError.exceptionCulprit;if(null!=r)switch(r){case"System":case"PowerBI":return"PowerBI";case"External":return"External";case"User":return"User";default:return u.assertFail("exceptionCulprit: unrecognized value"),"PowerBI"}},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){var r;return r=6===this.m_serviceError.statusCode?function(t,e){return{message:t.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:t.get("ServiceError_CannotLoadVisual"),errorInfoValue:e.message}]}}(e,this.m_serviceError):function(t,e){var o,r="",n="",i="",a="",s=!1;switch(e.errorCode){case"PremiumFilesModelRequiresPremiumCapacity":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("PremiumRequired_TitleText"),i=t.get("ServerError_PremiumFilesModelRequiresPremiumCapacity"),s=!0;break;case"LargeModelMovedAcrossRegions":r=t.get("ServiceError_LargeModelMovedAcrossRegionsTitle"),n=t.get("ServiceError_LargeModelMovedAcrossRegionsTitle"),i=function(t,e,r){if(!e)return"";var n,i=t.get(Jc+e);return i&&(n=i.replace(/\{\s*([^}\s]+)\s*\}/g,function(a,o,s,l){return r[o]})),n}(t,"LargeModelMovedAcrossRegions",e.parameters),a="https://aka.ms/moving-large-datasets",s=!0;break;case"rsAccessDeniedDueToRLSGroup":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelFetchingFailureKey"),i=t.get("DsrError_NoPermissionDueToRLSGroupMessage"),s=!0;break;case"rsCannotRetrieveModel":case"CannotRetrieveModelError":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelFetchingFailureKey"),i=t.get("DsrError_CanNotRetrieveModelMessage"),s=!0;break;case"DMTS_NoGatewayWithAllDatasourcesToBindError":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelFetchingFailureKey"),i=t.get("ServerError_DMTS_NoGatewayWithAllDatasourcesToBindError"),s=!0;break;case"DM_GWPipeline_UnknownError":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelFetchingFailureKey"),i=t.get("ServerError_DM_GWPipeline_Client_GatewayUnreachable"),s=!0;break;case"pbidAccessDenied":r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_AuthenticationErrorKey"),i=t.get("ServiceError_AuthenticationErrorValue"),s=!0;break;case"pbidWindowsAuthNotSupported":r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_AuthenticationErrorKey"),i=t.get("ServiceError_WindowsAuthNotSupportedErrorValue"),s=!0;break;case"pbidWindowsAuthWindowsAuthImpersonationNotSupported":r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_AuthenticationErrorKey"),i=t.get("ServiceError_WindowsAuthImpersonationNotSupportedErrorValue"),s=!0;break;case"PowerBIServiceLiveConnectModelNotFound":r=t.get("UploadPowerBICompanion_AccessDatasetWarning"),s=!0;break;case"InsecureLibraryLoadingPatchMissing":r=t.get("ServiceError_InsecureLibraryLoadingPatchMissingTitle"),n=t.get("ServiceError_InsecureLibraryLoadingPatchMissingTitle"),i=t.get("ServiceError_InsecureLibraryLoadingPatchMissingMessage"),s=!0;break;case"BYOKEncryptedModelRequiresPremiumCapacity":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("PremiumRequired_TitleText"),i=t.get("ServerError_BYOKEncryptedModelRequiresPremiumCapacity_Report"),s=!0;break;case"CustomerKeyNotAccessible":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelCannotLoad"),i=t.get("ServerError_CustomerKeyNotAccessible_Report"),s=!0;break;case"CustomerKeyVaultError":r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelCannotLoad"),i=t.get("ServerError_CustomerKeyVaultError_Report"),s=!0;break;case ym:r=t.get("ServiceError_ModelCannotLoad_CapacityLimitExceeded"),n=t.get("ServiceError_ModelCannotLoad_CapacityLimitExceeded"),i=t.get("ServiceError_CapacityOverloadedMessage"),a="https://aka.ms/AboutFabricCapacity",s=!0,o="Capacity_Limit_Exceeded_LearnMore"}if(!s)switch(e.statusCode){case 2:r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelConvertFailureKey"),i=t.get("ServiceError_ModelConvertFailureValue");break;case 3:r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelCreationFailureKey"),i=t.get("ServiceError_ModelCreationFailureValue");break;case 1:case 9:if(r=t.get("ServiceError_ModelCannotLoad"),n=t.get("ServiceError_ModelCannotLoad"),e.errorDetails){var l=_.find(e.errorDetails,function(f){return"ModelMode"===f.code});if(l)switch(l.detail.value){case"Internal":i=t.get("ServiceError_ModelConnectFailureInternalValue");break;case"ExternalOnPrem":i=t.get("ServiceError_ModelConnectFailureASLiveValue");break;case"ExternalService":i=t.get("ServiceError_ModelConnectFailurePBIServiceValue")}}i||(i=t.get("ServiceError_ModelFetchingFailureValue"));break;case 4:r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_ExecuteSemanticQueryErrorKey"),i=t.get("ServiceError_ExecuteSemanticQueryErrorValue");break;case 5:r=t.get("ServiceError_CannotLoadVisual"),n=t.get("ServiceError_ExecuteSemanticQueryInvalidStreamFormatKey"),i=t.get("ServiceError_ExecuteSemanticQueryInvalidStreamFormatValue");break;default:r=t.get("ServiceError_GeneralError"),n=t.get("ServiceError_GeneralErrorKey"),i=t.get("ServiceError_GeneralErrorValue")}var c={message:r,displayableErrorInfo:[{errorInfoKey:n,errorInfoValue:i}]};return e.errorCode===ym&&(c.helpLinkType=1),o&&(c.helpLinkOverrideText=o),a&&(c.helpLink=a),c}(e,this.m_serviceError),this.m_serviceError.errorDetails&&function(t,e,r){if(!e)return t;for(var n=0,i=e;n<i.length;n++){var a=i[n],o=r.getOptional(Jc+a.code),s=a.detail.value;0===a.detail.type&&(s=r.get(Jc+s)),t.displayableErrorInfo.push({errorInfoKey:o||a.code,errorInfoValue:s})}}(r,this.m_serviceError.errorDetails,e),function(t,e,r,n,i){var a=t.debugErrorInfo=t.debugErrorInfo||[];i&&a.push({errorInfoKey:zl,errorInfoValue:i}),e&&a.push({errorInfoKey:vn,errorInfoValue:e}),r&&a.push({errorInfoKey:Yv,errorInfoValue:r}),n&&a.push({errorInfoKey:"Stack Trace",errorInfoValue:n})}(r,this.code,this.m_serviceError.message||null,this.m_serviceError.stackTrace||null,this.httpRequestId),r.source=this.source,r},t.codeName="ServiceErrorToClientError",t}();function Em(t,e){return new xL(t,e)}var xL=function(){function t(e,r){this.deferMethod=e,this.drainMethod=r,this.asyncQueue=[],this.processing=!1}return t.prototype.defer=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];u.assertValue(e,"callback"),this.deferMethod?this.deferMethod(e):this.deferInternal(e,r,n)},t.prototype.drain=function(){this.drainMethod?this.drainMethod():this.drainQueue()},t.prototype.deferInternal=function(e,r){for(var n=this,i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];!this.processing&&!this.asyncQueue.length&&setTimeout(function(){n.asyncQueue.length>0&&n.drainQueue()},r),this.asyncQueue.push({callback:e,args:i})},t.prototype.drainQueue=function(){this.processing=!0;for(var e=0,r=this.asyncQueue;e<r.length;e++){var n=r[e];n.callback(n.args)}this.asyncQueue.length=0,this.processing=!1},t}();function Cm(t){return t&&_.isObject(t)&&t.then&&_.isFunction(t.then)}function wm(t){return Cm(t)?t.then:null}var AL=function(){function t(r,n){var i=this;if(this[e]="Promise",this.timeout=t.ensurePbiTimeout(),this.autoFlush=t.autoFlushInitialized||!!n,this.state={status:0},r){if(t.useNativePromise)return new Promise(r);r(function(a){return t.resolvePromise(i,a)},function(a){return t.rejectPromise(i,a)})}}var e;return t.prototype.then=function(r,n){if(_.isUndefined(r)&&_.isUndefined(n))return this;var i=new t(null,this.autoFlush);return this.state.pending=this.state.pending||[],this.state.pending.push({result:i,onFulfilled:r,onRejected:n}),this.state.status>0&&this.scheduleProcessQueue(),i},t.prototype.catch=function(r){return this.then(null,r)},t.prototype.finally=function(r){return this.then(function(n){return t.handleCallback(n,t.resolve,r)},function(n){return t.handleCallback(n,t.reject,r)})},t.all=function(r,n){if(t.useNativePromise)return Promise.all(r);var i,a,o=new t(function(p,h){i=p,a=h},n),s=[],l=r.length;if(l>0)for(var c=0,f=function(h){var v=r[h];wm(v)||(v=t.resolve(v,n)),v.then(function(m){s[h]=m}).catch(function(m){a(m)}).finally(function(){++c===l&&i(s)})},d=0;d<l;d++)f(d);else i(s);return o},t.setUseNativePromise=function(r){t.useNativePromise=r},t.resolvePromise=function(r,n){this.useNativePromise&&this.traceError&&(this.traceError=!1,ot.error("resolvePromise should not be called when useNativePromise is true")),!r.state.status&&(n===r?r.rejectInternal("Expected promise to be resolved with value other than itself"):r.resolveInternal(n))},t.rejectPromise=function(r,n){this.useNativePromise&&this.traceError&&(this.traceError=!1,ot.error("rejectPromise should not be called when useNativePromise is true")),!r.state.status&&r.rejectInternal(n)},t.reset=function(){t.usingMicrotask=void 0,t.pbiTimeout=void 0,t.autoFlushInitialized=void 0},t.init=function(r,n,i,a){void 0!==a&&(t.useNativePromise=a)||t.usingMicrotask||(t.autoFlushInitialized=n,i?(t.pbiTimeout=Em(function(o){Zone.current.scheduleMicroTask("DO_NOT_USE_PbiPromise.useMicrotask",o)}),t.usingMicrotask=!0):(u.assertValue(r,"pbiTimeout"),t.pbiTimeout=r||t.pbiTimeout))},t.resolve=function(r,n,i,a){if(t.useNativePromise)return Promise.resolve(r);var o=new t(null,n);return t.resolvePromise(o,r),o.then(null!=i?i:null,a)},t.reject=function(r,n){return t.useNativePromise?Promise.reject(r):new t(function(i,a){return a(r)},n)},t.prototype.defer=function(r){u.assert(function(){return _.isFunction(r)},"callback"),this.autoFlush&&this.state.status>0?r():(u.assertValue(this.timeout,"timeout object should have been allocated!"),this.timeout.defer(r,0))},t.prototype.resolveInternal=function(r){var i,n=this;try{(i=wm(r))?(this.state.status=-1,i.call(r,function(a){n.resolveInternal(a)},function(a){n.rejectInternal(a)})):(this.state.value=r,this.state.status=1,this.scheduleProcessQueue())}catch(a){this.rejectInternal(a)}},t.prototype.rejectInternal=function(r){this.state.value=r,this.state.status=2,this.scheduleProcessQueue()},t.prototype.scheduleProcessQueue=function(){var r=this.state;r.processScheduled||_.isEmpty(r.pending)||(r.processScheduled=!0,this.defer(function(){return t.processQueue(r)}))},t.ensurePbiTimeout=function(){var r=t.pbiTimeout;return r||(r=t.pbiTimeout=Em()),r},t.handleCallback=function(r,n,i){var a=null;try{_.isFunction(i)&&(a=i())}catch(o){return t.reject(o)}return Cm(a)?a.then(function(o){return n(r)},t.reject):n(r)},t.processQueue=function(r){var n=r.pending;r.processScheduled=!1,r.pending=void 0;for(var i=0,a=n;i<a.length;i++){var o=a[i],s=o.result,l=void 0;l=1===r.status?o.onFulfilled:l,l=2===r.status?o.onRejected:l;try{_.isFunction(l)?t.resolvePromise(s,l(r.value)):1===r.status?t.resolvePromise(s,r.value):t.rejectPromise(s,r.value)}catch(c){t.rejectPromise(s,c)}}},e=Symbol.toStringTag,t.useNativePromise=!0,t.traceError=!0,t}(),Yc=function(){function t(e){void 0===e&&(e=!1);var r=this;this.promise=new AL(function(n,i){r.resolver=n,r.rejector=i})}return t.prototype.resolve=function(e){this.resolver(e)},t.prototype.reject=function(e){this.rejector(e)},t}();function $c(t){return null!=t&&void 0!==t.deferred&&void 0!==t.execution}var FL=function(){function t(e,r,n,i,a){this.addVisualIdToQueryDataAsHttpBodyId=a,this.preferredMaxBatchesConfigured=e>0,this.maxBatches=this.preferredMaxBatchesConfigured?e:4,this.queryExecuteCallback=r,this.pending=[],this.timeoutService=n,this.telemetryV2Enabled=i,this.useHttp2QueryDataEnabled=Aa.browserSupportsHttp2()}return t.prototype.enqueue=function(e){var r=this;if(!function(t,e){var r=e.options;if(1===r.executionType){u.assertValue(r.queryId,"queryId");var n=_.findIndex(t,function(i){return i.options.queryId===r.queryId});if(n>-1)return u.assert(function(){return t[n].execution.rejected()},"CancelQuery should correspond to rejected queries."),!0}return!1}(this.pending,e))return this.pending.push(e),this.currentBatchDeferred||(this.currentBatchDeferred=e.options.telemetryV2Enabled?new Yc(!0):$.Deferred(),this.timeoutService.setTimeout(-1,this.telemetryV2Enabled).promise.then(function(){var a=r.createBatches();r.clearPending(),r.queryExecuteCallback(a),r.currentBatchDeferred.resolve(),r.currentBatchDeferred=void 0})),e.options.telemetryV2Enabled?this.currentBatchDeferred.promise:this.currentBatchDeferred.promise()},t.prototype.clearPending=function(){this.pending=[]},t.prototype.setMaxBatches=function(e){this.maxBatches=e,this.preferredMaxBatchesConfigured=e>0},t.prototype.createBatches=function(){var e=[],r=this.sortQueriesByDataSource(),n=this.maxBatches,i=!1;if(!this.preferredMaxBatchesConfigured&&this.useHttp2QueryDataEnabled&&(_.some(r,function(l){return _.some(l.dataSources,function(c){return c.isLimitedParallelQueryModel})})||(n=20,i=!0)),r.length>=n)for(var o=0,s=r.length;o<s;++o)e.push(this.createBatchFromDataSourceGroup(r[o]));else e=this.splitDataSourcesIntoBatches(r,n);return i&&_.forEach(e,function(l){return l.useSynchronous=!0}),e},t.prototype.sortQueriesByDataSource=function(){var r,e=this;r=this.addVisualIdToQueryDataAsHttpBodyId?_.groupBy(this.pending,function(a){return null===(c=null===(l=null===(s=null==(o=a.options)?void 0:o.applicationContext)||void 0===s?void 0:s.Sources)||void 0===l?void 0:l[0])||void 0===c?void 0:c.VisualId;var o,s,l,c}):{"":this.pending};var i=[];return _.forEach(r,function(a){var o=[];_.forEach(a,function(s){if(!function(t){return!!$c(t)&&t.execution.rejected()}(s)){var l=e.findDataSourceGroup(s.options.dataSources,o,s.options.cacheResponseOnServer);l?l.queuedExecutions.push(s):o.push({dataSources:s.options.dataSources,queuedExecutions:[s],cacheResponseOnServer:s.options.cacheResponseOnServer,cacheOptions:s.options.cacheOptions})}}),i.push.apply(i,o)}),i},t.prototype.findDataSourceGroup=function(e,r,n){for(var i=0,a=r.length;i<a;++i){var o=r[i];if(ed(e,o.dataSources)&&o.cacheResponseOnServer===n)return o}return null},t.prototype.createBatchFromDataSourceGroup=function(e){for(var r=[],n=[],i=[],a=e.queuedExecutions,o=[],s=[],l=function(p,h){var v=a[p],g=a[p].options,y=a[p].enqueueActivity;$c(v)?(r.push(g),i.push(v.deferred),y&&o.push(y),a[p].queryActivity&&s.push(a[p].queryActivity)):(u.assert(function(){return 1===g.executionType},"Only CancelQuery executions are not rejectable."),n.push(g))},c=0,f=a.length;c<f;++c)l(c);return{dataSources:e.dataSources,queryOptions:r,cancelQueryOptions:n,promises:i,cacheOptions:e.cacheOptions,cacheResponseOnServer:e.cacheResponseOnServer,enqueueActivities:o,queryActivities:s}},t.prototype.splitDataSourcesIntoBatches=function(e,r){for(var n=[],i=0,a=e.length;i<a;++i)n.push(this.createBatchFromDataSourceGroup(e[i]));return this.splitBatches(n,r)},t.prototype.splitBatches=function(e,r){for(var n=e.slice();n.length<r;){for(var i=void 0,a=0,o=n.length;a<o;++a){var s=n[a];s.queryOptions.length>1&&(!i||i.queryOptions.length<s.queryOptions.length)&&(i=s)}if(!i)return n;n.push(this.splitBatch(i)),i=null}return n},t.prototype.splitBatch=function(e){var r=e.queryOptions.length,n=e.queryOptions.splice(r/2),i=e.promises.splice(r/2),a=e.enqueueActivities.splice(r/2),o=e.queryActivities.splice(r/2),s=e.cancelQueryOptions.length,l=[];return s&&(l=e.cancelQueryOptions.splice(s/2)),{dataSources:e.dataSources,queryOptions:n,promises:i,cacheOptions:e.cacheOptions,cacheResponseOnServer:e.cacheResponseOnServer,cancelQueryOptions:l,enqueueActivities:a,queryActivities:o}},t}(),Vm=function(){function t(e,r){this.requestId=e,this.errorCode=r}return Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ignorable",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getDetails=function(e){return{message:e.get("ServiceError_CannotLoadVisual"),displayableErrorInfo:[{errorInfoKey:e.get("ServiceError_ExecuteSemanticQueryErrorKey"),errorInfoValue:e.get("ServiceError_ExecuteSemanticQueryErrorValue")},{errorInfoKey:e.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:this.code}],debugErrorInfo:[{errorInfoKey:vn,errorInfoValue:this.code}]}},t}(),Mm=function(){function t(){this._head=new $o,this._tail=new $o,this._head.next=this._tail,this._tail.prev=this._head,this._length=0}return t.prototype.insertToHead=function(e){e.next=this._head.next,e.prev=this._head,this._head.next=e,e.next.prev=e,this._length++},t.prototype.head=function(){if(this._length>0)return this._head.next},t.prototype.tail=function(){if(this._length>0)return this._tail.prev},t.prototype.removeFromTail=function(){this._length>0&&this.remove(this._tail.prev)},t.prototype.remove=function(e){this._length<=0||void 0===e.prev||void 0===e.next||(e.prev.next=e.next,e.next.prev=e.prev,this._length--)},t.prototype.length=function(){return this._length},t}(),$o=function(){return function(e){void 0===e&&(e=void 0),this.value=e}}(),kL=function(){function t(e){this.cache={},this.capacity=e,this.linkedList=new Mm}return t.prototype.get=function(e){if(e in this.cache){var r=this.cache[e].value;return null==r?void 0:r.value}},t.prototype.remove=function(e){this.cache[e]&&(this.linkedList.remove(this.cache[e]),delete this.cache[e])},t.prototype.put=function(e,r){var n=this;e in this.cache&&this.remove(e);var i=new xm(e,r),a=new $o(i);if(this.cache[e]=a,this.linkedList.insertToHead(a),this.size()>this.capacity){u.assert(function(){return n.size()===n.capacity+1},"cache has exceeded expected maximum capacity");var o=this.linkedList.tail();delete this.cache[o.value.key],this.linkedList.removeFromTail()}},t.prototype.containsKey=function(e){return e in this.cache},t.prototype.size=function(){return this.keys().length},t.prototype.keys=function(){return Object.keys(this.cache)},t.prototype.isFull=function(){return this.size()===this.capacity},t}(),LL=function(){function t(e){this.cache={},this.capacity=e,this.linkedList=new Mm}return t.prototype.get=function(e){if(e in this.cache){var r=this.cache[e];return this.linkedList.remove(r),this.linkedList.insertToHead(r),r.value.value}},t.prototype.remove=function(e){e in this.cache&&(this.linkedList.remove(this.cache[e]),delete this.cache[e])},t.prototype.put=function(e,r){var n=this;e in this.cache&&this.remove(e);var i=new xm(e,r),a=new $o(i);if(this.cache[e]=a,this.linkedList.insertToHead(a),this.size()>this.capacity){u.assert(function(){return n.size()===n.capacity+1},"cache has exceeded expected maximum capacity");var o=this.linkedList.tail();delete this.cache[o.value.key],this.linkedList.removeFromTail()}},t.prototype.containsKey=function(e){return e in this.cache},t.prototype.size=function(){return this.keys().length},t.prototype.keys=function(){return Object.keys(this.cache)},t.prototype.isFull=function(){return this.size()===this.capacity},t}(),xm=function(){return function(e,r){this.key=e,this.value=r}}(),Dm=function(){function t(e,r,n){this.cache=1===(n||(n=500),r)?new LL(n):new kL(n),this.promiseFactory=e}return t.prototype.getEntryCount=function(){return this.cache.size()},t.prototype.hasCacheEntry=function(e){return u.assertValue(e,"cacheKey"),!!this.getCacheEntry(e)},t.prototype.createCacheEntry=function(e,r,n,i,a){var o=this;u.assertValue(e,"cacheKey");var s=this.getCacheEntry(e);if(e&&!s){var l=this.promiseFactory,c=this.cache,f=l.defer(a),d=function(t){return new Ov(t)}(f),p=l.defer(a),h=zi(p);return this.appendCacheEntryInternal(e,s={promise:h,refCount:0,context:r}),d.then(function(v){s.updateResult&&(v=s.updateResult(v)),v&&n&&(v=n(v)),s.result=i?i(v):v,p.resolve(v)},function(v){return p.reject(v)}).finally(function(){delete s.updateResult}),h.finally(function(){c.containsKey(e)&&(delete c.get(e).promise,h.rejected()&&o.removeCacheEntryInternal(e))}).catch(function(v){return d.reject(v)}),{deferred:f,promise:d}}},t.prototype.clearEntry=function(e,r){var n=this.getCacheEntry(e);if(n){var i=n.promise;return r&&i?i.reject():this.removeCacheEntryInternal(e),!0}return!1},t.prototype.clearAllEntries=function(e){for(var r=0,n=this.cache.keys();r<n.length;r++)this.clearEntry(n[r],e)},t.prototype.bindCacheEntry=function(e,r,n){u.assertValue(e,"cacheKey");var i=this.getCacheEntry(e);if(void 0!==i){var a=this.promiseFactory.defer(n),o=zi(a);if(i.result){var s=r?r(i.result):i.result;return a.resolve(s),o}var l=i.promise;if(!l)return a.reject(void 0),o;i.refCount++;var c=function(d){i.refCount--,0===i.refCount&&l.pending()&&l.reject(d)};return o.then(function(){return c()},function(f){return c(f)}),l.then(function(f){var d=r?r(f):f;a.resolve(d)},function(f){return a.reject(f)}),o}},t.prototype.getEntryContext=function(e){u.assertValue(e,"cacheKey");var r=this.getCacheEntry(e);if(r)return r.context},t.prototype.keys=function(){return this.cache.keys()},t.prototype.isFull=function(){return this.cache.isFull()},t.prototype.rewriteAllEntries=function(e){for(var r=[],n=!!e.rewriteKey,i=!!e.rewriteResult,a=this.cache,o=function(h){if(n){var v=e.rewriteKey(h);v!==h&&r.push({oldKey:h,newKey:v})}if(i){var g=a.get(h);g&&(g.result&&e.rewriteResult?g.result=e.rewriteResult(g.result,h):g.updateResult=function(y){return e.rewriteResult&&e.rewriteResult(y,h)||y})}},s=0,l=a.keys();s<l.length;s++)o(l[s]);for(var f=0,d=r.length;f<d;f++)this.changeCacheKey(r[f].oldKey,r[f].newKey)},t.prototype.putCacheResult=function(e,r,n){u.assertValue(e,"cacheKey");var i=this.getCacheEntry(e);i?i.result?i.result=n?n(r):r:i.updateResult=function(){return r}:u.assertFail("cannot update no-existing cacheEntry for key '".concat(e,"' with result '").concat(r,"'"))},t.prototype.appendCacheEntryInternal=function(e,r){this.cache.containsKey(e)&&this.removeCacheEntryInternal(e),this.cache.put(e,r)},t.prototype.removeCacheEntryInternal=function(e){this.cache.remove(e)},t.prototype.changeCacheKey=function(e,r){if(!r)return this.clearEntry(e,!0);if(this.hasCacheEntry(r)||!this.hasCacheEntry(e))return!1;var n=this.getCacheEntry(e);return this.removeCacheEntryInternal(e),this.appendCacheEntryInternal(r,n),!0},t.prototype.getCacheEntry=function(e){var r;if(u.assertValue(e,"cacheKey"),e&&(r=this.cache.get(e))&&(r.promise||r.result))return r},t}();function Xn(t){return u.assert(function(){return t&&t.Commands&&t.Commands.length>0},"data query should not be empty"),t.Commands.length>1}function Am(t){return u.assert(function(){return t&&t.Commands&&t.Commands.length>0},"data query should not be empty"),Xn(t)?Xc(t):Zc(t.Commands[0].SemanticQueryDataShapeCommand)}function Xc(t){if(u.assert(function(){return!t||Xn(t)},"!dataQuery || isCompositeDataQuery(dataQuery)"),t)return JSON.stringify(t)}function Zc(t){if(t)return JSON.stringify(t)}var _m=yt.generateGuid,Im=function(){function t(e,r,n,i,a){this.featureSwitches=a,u.assertValue(e,"promiseFactory"),u.assertValue(n,"createQuery"),this.createQuery=n,this.createCancelQuery=i,this.promiseFactory=e,this.cacheByModel={},this.telemetryService=r}return t.prototype.ensure=function(e){var n,r=this;u.assertValue(e,"options"),u.assertValue(e.command,"options.command");var i=e.command;u.assert(function(){return i&&i.Commands&&i.Commands.length>0},"data query should not be empty");var a=i.Commands[0].SemanticQueryDataShapeCommand,o=this.ensureCache(e.dataSources),s=Am(i);if(o.hasCacheEntry(s)){if(t.allowResultFromClientCacheOrDefault(e))return this.telemetryService.logEvent(Gv,{cacheHit:!0,isCacheFull:o.isFull(),entryCount:o.getEntryCount()}),o.bindCacheEntry(s,void 0,e.telemetryV2Enabled);o.clearEntry(s)}this.telemetryService.logEvent(Gv,{cacheHit:!1,isCacheFull:o.isFull(),entryCount:o.getEntryCount()});var l=Tm(i,this.featureSwitches,s),c=this.findEquivalentCache(e,o,l);if(c)return c;var d,f=ye({},e);f.queryId=l.queryId,f.executionType=0,null!==(n=this.featureSwitches)&&void 0!==n&&n.queryContext&&(d=function(g){var y=r.findQueryContext(f);if(!y)return g;var m=ye({},g);return m.queryContext=y,m});var p=o.createCacheEntry(s,l,d,t.rewriteCachedResult,e.telemetryV2Enabled);if(p.promise.catch(function(v){(function(t){return null!=t&&void 0!==t.code&&void 0!==t.ignorable&&void 0!==t.requestId&&void 0!==t.getDetails})(v)||r.featureSwitches&&r.featureSwitches.queryCancellation&&r.createCancelQuery({dataSources:f.dataSources,command:f.command,allowResultFromClientCache:f.allowResultFromClientCache,allowClientSideFilters:f.allowClientSideFilters,cacheResponseOnServer:f.cacheResponseOnServer,ignoreViewportForCache:f.ignoreViewportForCache,cacheOptions:f.cacheOptions,queryId:f.queryId,executionType:1},v&&v.queryCancellationSource)}),f.clientCacheOnly)return p.promise.reject(new S_),p.promise;this.createQuery(f,p);var h=o.bindCacheEntry(s,void 0,e.telemetryV2Enabled);return!1===e.cacheResponseOnClient&&o.clearEntry(s),a.Binding&&a.Binding.DataReduction&&(Xo(a.Binding.DataReduction.Primary)||Xo(a.Binding.DataReduction.Secondary))||h.then(function(v){v&&v.dsr&&function(t,e){if(u.assertValue(t,"dsr"),jc(t)){if(!e)return!1;for(var r=rm(t,void 0).dataShapes(),n=function(t){return u.assertAnyValue(t,"dsr"),t.MinorVersion}(t);r.next();)if(n&&n>=1){if(!0!==r.hasAllData())return!1}else if(!r.complete()||r.limitsExceeded()||r.hasRestartTokens())return!1;return!0}return _.every(t.DataShapes,function(i){return i&&i.IsComplete&&_.isEmpty(i.DataLimitsExceeded)&&!i.RestartTokens})}(v.dsr,r.featureSwitches&&r.featureSwitches.dsrV2)&&(l.hasAllData=!0)},function(){}),h},t.prototype.findQueryContext=function(e){var r=e.applicationContext;if(r)return u.assert(function(){return 1===_.size(r.Sources)},"Expected to have 1 ApplicationContextSource"),r.Sources[0].CustomProperties},t.prototype.clear=function(e){var r=this.getCache(e);r&&r.clearAllEntries()},t.prototype.rewrite=function(e,r){var n=this,i=this.getCache(e);if(i){var a={};r.rewriteCacheKey&&r.rewriteDataQueryCacheKey&&(a.rewriteKey=function(o){var s=JSON.parse(o),l=i.getEntryContext(o);if(l.compositeDataQuery){var c=s,f=r.rewriteDataQueryCacheKey(c);if(f&&f!==c){var d=Pm(f,n.featureSwitches);_.assign(l,d)}}else{var p=s,h=r.rewriteCacheKey(p);h&&h!==p&&(d=Fm(h,n.featureSwitches),_.assign(l,d))}return l.key}),r.rewriteCacheResult&&(a.rewriteResult=function(o){var s=o,l=r.rewriteCacheResult({descriptor:s.descriptor,dsr:s.dsr});return l?{descriptor:l.descriptor,dsr:l.dsr}:{descriptor:s.descriptor,dsr:s.dsr}}),i.rewriteAllEntries(a)}},t.prototype.put=function(e,r,n){var i=this.ensureCache(e),a=r,o=Am(a);if(i.hasCacheEntry(o))i.putCacheResult(o,n,t.rewriteCachedResult);else{var s=Tm(a,this.featureSwitches,o);i.createCacheEntry(o,s,void 0,t.rewriteCachedResult).deferred.resolve(n)}},t.allowResultFromClientCacheOrDefault=function(e){return u.assertValue(e,"options"),!1!==e.allowResultFromClientCache},t.prototype.findEquivalentCache=function(e,r,n){if(u.assertValue(e,"options"),u.assertValue(r,"cache"),u.assertValue(n,"entryContext"),t.allowResultFromClientCacheOrDefault(e))if(n.compositeDataQuery){if(e.ignoreViewportForCache)for(var h=0,v=r.keys();h<v.length;h++)if((d=r.getEntryContext(v[h]))&&d.keyWithoutViewport&&d.keyWithoutViewport===n.keyWithoutViewport)return r.bindCacheEntry(d.key,void 0,e.telemetryV2Enabled)}else{var i=e.command;u.assert(function(){return i&&!_.isEmpty(i.Commands)},"data query should not be empty");for(var a=i.Commands[0].SemanticQueryDataShapeCommand.Binding,o=!!(a&&a.DataReduction&&a.DataReduction.Primary&&a.DataReduction.Primary.TopNPerLevel),s=!1,l=0,c=r.keys();l<c.length;l++){var d;if(d=r.getEntryContext(c[l])){if(!o&&d.hasAllData&&d.keyWithoutReduction===n.keyWithoutReduction)return r.bindCacheEntry(d.key,void 0,e.telemetryV2Enabled);if(KL(r,d,e,n,e.telemetryV2Enabled)){s=!0;break}}}s&&ot.information("Reused cache with client side filters")}},t.prototype.getCache=function(e){return this.cacheByModel[this.generateModelKey(e)]},t.prototype.ensureCache=function(e){var r,n=this.generateModelKey(e),i=this.cacheByModel,a=i[n];return void 0===a&&(a=i[n]=null!==(r=this.featureSwitches)&&void 0!==r&&r.lruCacheEvictionPolicy?new Dm(this.promiseFactory,1):new Dm(this.promiseFactory,0)),a},t.prototype.generateModelKey=function(e){if(!_.isEmpty(e))return JSON.stringify(_.map(e,function(r){return{dbName:r.dbName,vsName:r.vsName,schemaName:r.schemaName}}))},t.rewriteCachedResult=function(e){if(!e)return e;var r=ye({},e);return delete r.metrics,r.fromClientCache=!0,r},t}();function Tm(t,e,r){return u.assertValue(t,"dataQuery"),u.assert(function(){return t&&t.Commands&&t.Commands.length>0},"data query should not be empty"),u.assertAnyValue(r,"cacheKey"),Xn(t)?Pm(t,e,r):(u.assert(function(){return 1===t.Commands.length},"Expecting a non-empty, non-composite query to have exactly 1 command."),Fm(t.Commands[0].SemanticQueryDataShapeCommand,e,r))}function Pm(t,e,r){return u.assertValue(t,"dataQuery"),u.assert(function(){return Xn(t)},"data query should be composite"),u.assertAnyValue(r,"cacheKey"),u.assert(function(){return!r||r===Xc(t)},"If cacheKey is specified, it is expected to be the return value of this.generateCacheKeyDataQuery(dataQuery).  The fact that cacheKey is a parameter to this function is just an optimization."),{key:r||Xc(t),keyWithoutReduction:GL(t),keyWithoutViewport:QL(t),keyWithoutFilter:void 0,queryFilters:void 0,compositeDataQuery:!0,queryId:Rm(e)}}function Fm(t,e,r){u.assertAnyValue(t,"dataShapeCommand"),u.assertAnyValue(r,"cacheKey"),u.assert(function(){return!r||r===Zc(t)},"If cacheKey is specified, it is expected to be the return value of this.generateCacheKey(dataShapeCommand).  The fact that cacheKey is a parameter to this function is just an optimization.");var n=function(t){if(u.assertAnyValue(t,"command"),!t)return!1;var e=t.Binding&&t.Binding.DataReduction,r=e&&e.Primary,n=e&&e.Secondary;return!(!Lm(r)||!Lm(n)||Xo(r)||Xo(n))}(t);return{key:r||Zc(t),keyWithoutReduction:qL(t),keyWithoutViewport:void 0,keyWithoutFilter:n?HL(t):void 0,queryFilters:n?WL(t):void 0,compositeDataQuery:!1,queryId:Rm(e)}}function Rm(t){return t&&t.queryCancellation?_m():""}function Nm(t){t&&t.Binding&&"object"==typeof t.Binding&&(t.Binding.DataReduction=void 0,t.Binding.Limits=void 0)}function qL(t){if(t){var e=_.cloneDeep(t);return Nm(e),JSON.stringify(e)}}function HL(t){if(t){var e=_.cloneDeep(t);return function(t){t&&t.Query&&t.Query.Where&&(t.Query.Where=void 0)}(e),JSON.stringify(e)}}function GL(t){if(u.assert(function(){return!t||Xn(t)},"!dataQuery || isCompositeDataQuery(dataQuery)"),t){var e=_.cloneDeep(t);return Nm(e.Commands[0].SemanticQueryDataShapeCommand),JSON.stringify(e)}}function QL(t){if(u.assert(function(){return!t||Xn(t)},"!dataQuery || isCompositeDataQuery(dataQuery)"),t){u.assertValue(t.Commands,"dataQuery.Commands"),u.assert(function(){return 2===t.Commands.length},"dataQuery.Commands must have two commands"),u.assertValue(t.Commands[1].ScriptVisualCommand,"dataQuery.Commands second element must be a ScriptVisualCommand");var e=_.cloneDeep(t);return function(t){t&&(t.ViewportHeightPx=void 0,t.ViewportWidthPx=void 0)}(e.Commands[1].ScriptVisualCommand),JSON.stringify(e)}}function WL(t){u.assertAnyValue(t,"command");var e=t&&t.Query;if(e&&!_.isEmpty(e.Where)){var r=Bm(e),n=r&&r.where();if(!_.isEmpty(n))return n}}function KL(t,e,r,n,i){if(void 0===i&&(i=!1),u.assert(function(){return Im.allowResultFromClientCacheOrDefault(r)},"QueryCache.allowResultFromClientCacheOrDefault(options)"),u.assertValue(t,"cache"),u.assertValue(e,"oldItemContext"),u.assertValue(r,"newQueryOptions"),u.assertValue(n,"newItemContext"),r.allowClientSideFilters){var a=function(t,e){if(u.assertValue(t,"oldItemContext"),u.assertValue(e,"newItemContext"),!e.compositeDataQuery&&e.keyWithoutFilter&&!t.compositeDataQuery&&t.keyWithoutFilter&&t.hasAllData&&t.keyWithoutFilter===e.keyWithoutFilter&&function(t,e){return u.assertAnyValue(t,"filters"),u.assertAnyValue(e,"counterparts"),_.every(t,function(r){return _.some(e,function(n){return function(t,e){if(u.assertValue(t,"restrictiveFilter"),u.assertValue(e,"baseFilter"),!$f(t,e))return!1;var r=t.condition,n=e.condition;if(r instanceof ja&&n instanceof ja){var i=Uc(r),a=Uc(n);if(i&&a&&j(i.otherSide,a.otherSide))return Ma(Xi(i.constantValue),Xi(a.constantValue))}return!1}(n,r)})})}(km(t.queryFilters,e.queryFilters),e.queryFilters)){var a=km(e.queryFilters,t.queryFilters);if(!_.isEmpty(a))return function(t,e){u.assert(function(){return t&&!t.compositeDataQuery},"itemContext && !itemContext.compositeDataQuery"),u.assertNonEmpty(e,"filtersToConvert");var r=JSON.parse(t.key),n=Bm(r&&r.Query);if(n)return u.assert(function(){return _.every(e,function(a){return Xf(n.where(),a)})},"expecting every item in filtersToConvert to be in the where clause of the source SemanticQuery."),function(t,e){u.assertNonEmpty(t,"selects"),u.assertNonEmpty(e,"filters");var r=_.some(e,function(s){return!function(t){return u.assertValue(t,"filter"),!t.target}(s)});if(!r){for(var n=new JN(t),i=0,a=e;i<a.length;i++)a[i].condition.accept(n);return n.getClientSideFiltersIfAllSupported()}}(n.select(),e)}(e,a)}}(e,n);if(!_.isEmpty(a))return t.bindCacheEntry(e.key,function(o){return function(t,e){u.assertValue(t,"data"),u.assertNonEmpty(e,"clientSideFilters");var r=ye({},t);return r.clientSideFilters=e,r}(o,a)},i)}}function km(t,e){return u.assertAnyValue(t,"filters"),u.assertAnyValue(e,"comparants"),_.isEmpty(e)?t:_.filter(t,function(r){return!Xf(e,r)})}function Xo(t){return u.assertAnyValue(t,"algorithm"),t&&t.Window&&null!=t.Window.RestartTokens}function Lm(t){return u.assertAnyValue(t,"algorithm"),!t||!!t.Window}function Bm(t){if(u.assertAnyValue(t,"queryDefinition"),t&&t.From&&t.Select)return Q.deserializeQuery(t)}var e2=function(t){function e(r){var n=this;return u.assertValue(r,"jobId"),(n=t.call(this,e.Code)||this).jobId=r,n}return T(e,t),e.prototype.getDetails=function(r){var n=t.prototype.getDetails.call(this,r);return n.debugErrorInfo=n.debugErrorInfo||[],n.debugErrorInfo.push({errorInfoKey:"Job Id",errorInfoValue:this.jobId}),n},e.Code="DelayedQueryTimeoutError",e}($v),t2=function(){function t(){}return t.prototype.resolveDelayedQuery=function(e,r,n){u.assertFail("Apps that want to support delayed query results need to specify an IExecuteSemanticQueryDelayedResultResolver implementation"),n.reject(new e2(e))},t}(),r2=function(t){function e(r){var n=this;return u.assertValue(r,"requestId"),(n=t.call(this,"ExecuteSemanticQueryUnknownError")||this).httpRequestId=r,n}return T(e,t),Object.defineProperty(e.prototype,"requestId",{get:function(){return this.httpRequestId},enumerable:!1,configurable:!0}),e.prototype.getDetails=function(r){var n=t.prototype.getDetails.call(this,r);return n.debugErrorInfo=n.debugErrorInfo||[],n.debugErrorInfo.push({errorInfoKey:zl,errorInfoValue:this.httpRequestId}),n},e}($v),n2=function(){function t(e,r,n,i,a,o,s,l,c){var f=this;this.communication=r,this.telemetryService=i,this.featureSwitches=s,this.queryContextProvider=l,this.appContextHostDataProvider=c,u.assertValue(e,"host"),u.assertValue(i,"telemetryService"),this.promiseFactory=e.promiseFactory(),this.delayedQueryResultResolver=a||new t2,this.batcher=new FL(null==o?0:o,function(d){for(var p=0,h=d.length;p<h;++p)f.executeBatch(d[p])},n,s&&s.telemetryV2,s&&s.addVisualIdToQueryDataAsHttpBodyId),this.queryCache=function(t,e,r,n,i){return u.assertValue(t,"promiseFactory"),u.assertValue(r,"createQuery"),new Im(t,e,r,function(d,p){f.telemetryService.logEvent(c_,{source:p}),f.enqueueExecution({options:d,enqueueActivity:d.performanceActivity&&d.performanceActivity.isRunning()&&d.performanceActivity.createChildActivity({name:"Query Pending"}),queryActivity:d.performanceActivity})},i)}(this.promiseFactory,this.telemetryService,function(d,p){var h,v={options:d,deferred:p.deferred,execution:p.promise,enqueueActivity:d.performanceActivity&&d.performanceActivity.isRunning()&&d.performanceActivity.createChildActivity({name:"Query Pending"}),queryActivity:d.performanceActivity};f.setAppContextHostData(v),null!==(h=f.featureSwitches)&&void 0!==h&&h.queryContext?f.setQueryContext(v).then(function(){f.enqueueExecution(v)}):f.enqueueExecution(v)},0,s)}return t.prototype.setAppContextHostData=function(e){var r;if(this.appContextHostDataProvider&&e.options.applicationContext&&null!==(r=this.featureSwitches)&&void 0!==r&&r.useEnrichedApplicationContext){var n=e.options.applicationContext,i=this.appContextHostDataProvider.getApplicationContextHostData();n.Sources[0]=ye(ye({},n.Sources[0]),i)}},t.prototype.setQueryContext=function(e){var r;return nt(this,void 0,void 0,function(){var n,i;return it(this,function(o){switch(o.label){case 0:if(null===(r=this.featureSwitches)||void 0===r||!r.queryContext)return[2];if(!this.queryContextProvider||!e.options.applicationContext)return[2];u.assert(function(){return 1===_.size(e.options.applicationContext.Sources)},"Expected to have 1 ApplicationContextSource"),n=e.options.applicationContext.Sources[0],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.queryContextProvider.generateQueryContext()];case 2:return(i=o.sent())?(n.CustomProperties=ye(ye({},n.CustomProperties),i),[3,4]):[2];case 3:return o.sent(),[2];case 4:return[2]}})})},t.prototype.enqueueExecution=function(e){this.isCommunicationStopped?(this.pausedQueries=this.pausedQueries||[],this.pausedQueries.push(e)):this.batcher.enqueue(e)},t.prototype.execute=function(e){if(!_.isEmpty(e.dataSources))return this.queryCache.ensure(e);var r=this.promiseFactory.defer(e.telemetryV2Enabled),n=zi(r);return r.resolve(e.command),n},t.prototype.stopCommunication=function(){this.isCommunicationStopped=!0},t.prototype.resumeCommunication=function(){this.isCommunicationStopped=!1;var e=this.pausedQueries;if(e){for(var r=0,n=e.length;r<n;r++){var i=e[r];i2(i)&&this.batcher.enqueue(i)}this.pausedQueries=void 0}},t.prototype.cache=function(){return this.queryCache},t.prototype.setLocalCacheResult=function(e,r){this.queryCache.put(e.dataSources,e.command,r)},t.prototype.setPreferredMaxConnections=function(e){this.batcher.setMaxBatches(e)},t.prototype.executeBatch=function(e){var r=this;u.assertValue(e,"batch"),u.assert(function(){return e.queryOptions.length===e.promises.length},"Queries & promises sizes must match.");var n=e.promises;this.communication.execute(e).then(function(i){return r.onSuccess(i,n)},function(i){return r.onError(i,n)})},t.prototype.onSuccess=function(e,r){u.assertValue(e,"result"),u.assertValue(r,"executions"),this.rejectExecutionsForMissingJobs(e,r);for(var n=e.jobIds,i={},a=0,o=r.length;a<o;++a)i[n[a]]=r[a];var s=e.results;for(a=0,o=s.length;a<o;++a){var l=s[a],c=l.result,d=i[f=l.jobId];delete i[f];var p=c.data,h=c.error;if(p)d.resolve({descriptor:p.descriptor,dsr:p.dsr,metrics:p.metrics,requestId:e.requestId,timestamp:p.timestamp,fromCache:p.fromCache});else if(h){var g=new bm(h);g.requestId=e.requestId,d.reject(g)}else c.asyncResult&&this.delayedQueryResultResolver.resolveDelayedQuery(l.jobId,e.requestId,d,e)}if(!_.isEmpty(Object.keys(i)))for(var f in h=new Vm(e.requestId,"MissingJobResult"),i)i[f].reject(h)},t.prototype.rejectExecutionsForMissingJobs=function(e,r){var n=e.jobIds.length,i=r.length;if(i>n)for(var a=new Vm(e.requestId,"MissingJobId"),o=n;o<i;o++)r[o].reject(a)},t.prototype.onError=function(e,r){var n;if(u.assertValue(r,"executions"),e&&e.requestError&&(n=new bm(e.requestError)),n)n.requestId=e.requestId;else{var i=e.error,a=void 0,o=void 0,s=void 0;if(i){a=i.message,o=i.code;var l=i["pbi.error"]&&i["pbi.error"].exceptionCulprit;null!=l&&(s=function(t){switch(t){case 2:return"External";case 1:return"User";default:return"PowerBI"}}(l))}n=e&&null!=e.httpStatusCode&&e.requestId?new m_(e.httpStatusCode,e.requestId,o,a,s):new r2(e.requestId)}for(var c=0,f=r.length;c<f;c++)r[c].reject(n)},t}();function i2(t){return!!$c(t)&&t.execution.pending()}var o2=function(){function t(e,r,n,i,a,o,s,l,c){u.assertValue(e,"host"),this.proxy=new n2(e,r,a,n,o,s,i,l,c),this.featureSwitches=i,this.telemetryService=n}return t.prototype.execute=function(e){return this.proxy.execute(e)},t.prototype.transform=function(e,r,n,i){return void 0===e?{dataView:{metadata:{columns:[]},error:{code:"UndefinedData"}}}:Yk(r,e,this.featureSwitches,this.telemetryService,n,i)},t.prototype.stopCommunication=function(){this.proxy.stopCommunication()},t.prototype.resumeCommunication=function(){this.proxy.resumeCommunication()},Object.defineProperty(t.prototype,"cache",{get:function(){return this.proxy.cache()},enumerable:!1,configurable:!0}),t.prototype.setLocalCacheResult=function(e,r){this.proxy.setLocalCacheResult(e,r)},t.prototype.setPreferredMaxConnections=function(e){this.proxy.setPreferredMaxConnections(e)},t}(),s2={get:function(e){return e},getOptional:function(e){return e},format:function(e){return e}};function l2(t,e){if(t){var r={properties:{}};for(var n in t.displayName&&(r.displayName=Ir(t.displayName,e)),t.description&&(r.description=Ir(t.description,e)),t.properties)r.properties[n]=f2(t.properties[n],e);return r}}function f2(t,e){var r={type:p2(t.type,e)};return t.rule&&(r.rule=t.rule),t.displayName&&(r.displayName=Ir(t.displayName,e)),t.description&&(r.description=Ir(t.description,e)),t.placeHolderText&&(r.placeHolderText=Ir(t.placeHolderText,e)),r}function p2(t,e){var r=L.fromDescriptor(t);return r&&r.enum?{enumeration:Um(r.enum,e)}:null!=r&&r.flagsEnum?{flagsEnumeration:Um(r.flagsEnum,e)}:t}function Um(t,e){return _.map(t.members(),function(r){return function(t,e){return{displayName:Ir(t.displayName,e),value:t.value}}(r,e)})}var ef="message",zm="message",qm="onMessageProxyAsyncComplete";function Hm(t,e){return new b2(t,e)}var b2=function(){function t(e,r){var n=this;this.promiseFactory=e,this._queue=[],this._allowSameWindow=!1,this.handlers={message:[],error:[]},this.isFlushing=!1,r&&(this._contentWindow=r),this.deferredCache={},this.windowMessageHandler=function(i){return n.onMessageReceived(i.originalEvent)},$(window).on(zm,this.windowMessageHandler)}return Object.defineProperty(t.prototype,"allowSameWindow",{get:function(){return this._allowSameWindow},set:function(r){this._allowSameWindow=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contentWindow",{get:function(){return this._contentWindow},set:function(r){u.assertValue(r,"value"),this._contentWindow=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queue",{get:function(){return jQuery.extend([],this._queue)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(e){this.contentWindow?this.sendMessage(e):this.queueMessage(e)},t.prototype.postMessageAsync=function(e){var r=this,n=this.promiseFactory.defer(),i=this.createRandomString();return this.deferredCache[i]=n,e.id=i,this.postMessage(e),n.promise.finally(function(){delete r.deferredCache[i]}),n.promise},t.prototype.queueMessage=function(e,r){void 0===r&&(r=this._queue.length);var n=this.prepareMessage(e);this._queue.splice(r,0,n)},t.prototype.on=function(e,r){u.assertValue(e,"type"),u.assertValue(r,"handler"),this.handlers[e]&&(this.handlers[e].indexOf(r)>-1||this.handlers[e].push(r))},t.prototype.off=function(e,r){if(u.assertValue(e,"type"),this.handlers[e]){if(!r)return void(this.handlers[e].length=0);var n=this.handlers[e].indexOf(r);n>-1&&this.handlers[e].splice(n,1)}},t.prototype.flushQueue=function(){this.isFlushing||!this.contentWindow||(this.isFlushing=!0,this.contentWindow.postMessage&&this.contentWindow.postMessage(this._queue,"*"),this._queue.length=0,this.isFlushing=!1)},t.prototype.sendMessage=function(e){var r=this.prepareMessage(e);this.contentWindow?this.contentWindow.postMessage&&this.contentWindow.postMessage(r,"*"):u.assertFail("contentWindow not set")},t.prototype.prepareMessage=function(e){var r;try{r=JSON.stringify(e)}catch(n){throw r=null,yt.ensureError(n)}return r},t.prototype.onMessageReceived=function(e){if(this.allowSameWindow||e.source!==window){var r;try{r="string"==typeof e.data?JSON.parse(e.data):e.data}catch(c){r=null}if(r)for(var i=0,a=jQuery.isArray(r)?r:[r];i<a.length;i++){var o=a[i],s=void 0,l=void 0;try{"string"==typeof o?(s=JSON.parse(o),l=o.length):(s=o,l=e.data.length)}catch(c){s=null}if(!s)return;this.dispatchMessage(e,s,l)}}},t.prototype.dispatchMessage=function(e,r,n){var i={message:r,source:e.source,origin:e.origin,packedSize:n};if(r.id&&(r.eventName===qm||r.result||r.error)){var a=this.deferredCache[r.id];return a?r.error?a.reject(r.error):a.resolve(r.result):void 0}for(var s=0,l=r.error?this.handlers.error:this.handlers.message;s<l.length;s++)this.invokeHandler(l[s],i)},t.prototype.invokeHandler=function(e,r){var i,a,n=this;r.message.id&&(a={id:r.message.id,eventName:qm,arguments:[]});try{i=e.call(null,r),a&&this.promiseFactory.when(i).then(function(o){a.result=o,n.postMessage(a)}).catch(function(o){a.error=o,n.postMessage(a)})}catch(o){a&&(a.error={message:o.message},this.postMessage(a))}},t.prototype.createRandomString=function(){return(Math.random()+1).toString(36).substring(7)},t.prototype.destroy=function(){this.handlers.message.length=0,this.handlers.error.length=0,$(window).off(zm,this.windowMessageHandler),this.windowMessageHandler=null},t}();function E2(){var t=Ni(),r={messageProxy:Hm(t,window.parent),promiseFactory:t,resourceProvider:{get:function(i){return i},getOptional:function(i){return i},format:function(i){return i}}};return new C2(r)}var C2=function(){function t(e){var r=this;u.assertValue(e.messageProxy,"messageProxy"),u.assertValue(e.promiseFactory,"promiseFactory"),this.messageProxy=e.messageProxy,this.promiseFactory=e.promiseFactory,this.resourceProvider=e.resourceProvider,this.messageProxy.on(ef,function(n){return r.onMessageReceived(n)}),this.hostOrigin=new URL(window.location.href).origin}return t.prototype.onMessageReceived=function(e){if(e.source===parent&&e.origin===this.hostOrigin&&"loadVisualPluginWithContent"===e.message.eventName)return this.loadVisualPluginWithContent.apply(this,e.message.arguments)},t.prototype.loadVisualPluginWithContent=function(e){var r=this.promiseFactory.defer(),n=e.pluginName,i=e.mappedPluginContent,a=i[Tt.CustomVisualJavascript].content,o=i[Tt.CustomVisualsCss].content;try{Eo(n,a),Co(n,o);var s=Wn[n];s.iconUrl=function(t){var r=$("#css-"+t)[0],n=_.find(document.styleSheets,function(o){return o.ownerNode===r});if(n&&n.cssRules)for(var i=0;i<n.cssRules.length;i++){var a=n.cssRules[i];if(a.selectorText&&a.selectorText===".visual-icon."+t)return a.style.backgroundImage}return""}(n),s.content={js:a,css:o,iconBase64:s.iconUrl},So(s),s.capabilities.objects=function(t,e){u.assertValue(t,"objectDescriptors");var r={};for(var n in t)r[n]=l2(t[n],e||s2);return r}(s.capabilities.objects,this.resourceProvider),r.resolve(s)}catch(l){r.reject(l)}return r.promise},t}();function Gm(){if(!Qm){window.powerbi||(window.powerbi={}),window.powerbi.visualSandbox||(window.powerbi.visualSandbox={});var t=E2;window.powerbi.visualSandbox.createResourceLoaderHost=function(){return t()},Qm=!0}}var Qm=!1;function Zo(t,e){u.assertValue(t,"fill"),t.solid&&t.solid.color?e.visitExpr(t.solid.color):u.assertFail("Unsupported FillDefinition")}function I2(t,e,r,n){var i=Wm(t,e,r,n);return i&&i.expressions}function T2(t,e,r,n){return u.assertValue(t,"propDefn"),Wm(t,e,r,n)}function Wm(t,e,r,n){var a,o,i=new II;return Ro(t)?((a=new tf(e,r,n,t.context)).propertyVisitor=o,(o=new Na(a,i)).visitExpr(t.value)):oc(t)?(a=new tf(e,r,n),o=new Na(a,i),a.propertyVisitor=o,o.visitExpr(t)):(a=new tf(e,r,n),o=new Na(a,i),a.propertyVisitor=o,function(t,e){Gl(t)?e.visitFillDefinition(t):Ql(t)?e.visitFillRuleDefinition(t):Wl(t)?e.visitParagraphs(t):jl(t)?e.visitDataBarsDefinition(t):Mo(t)?e.visitIconDefinition(t):qi(t)&&e.visitErrorRangeDefinition(t)}(t,a)),{expressions:a.exprs,references:i.references}}Gm();var tf=function(t){function e(r,n,i,a){var o=t.call(this)||this;return o.selector=r,o.querySelects=n,o.context=a,o.exprs=[],o.inputExpr=o.resolveSelectRef(i),o}return T(e,t),e.prototype.resolveSelectRef=function(r){return r&&Jt(r)?this.getSelectByRef(r):r},e.prototype.add=function(r){this.context&&(r.context=this.context),null!=this.relatedProjectionQueryName&&(r.targetsQueryName=[this.relatedProjectionQueryName]),this.exprs.push(r)},e.prototype.visitMeasureRef=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitArithmetic=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitAggr=function(r){if(Jt(r.arg)){var i={expr:this.getSelectByRef(r.arg),selector:this.selector,aggregates:this.getAggregates(r.func)};this.add(i)}else this.add({expr:r,selector:this.selector})},e.prototype.checkIfOrdinal=function(r){},e.prototype.getAggregates=function(r){switch(r){case 4:return{max:!0};case 3:return{min:!0};case 6:return{median:!0};case 1:return{average:!0};default:u.assertFail("Unsupported Projection Aggregate")}},e.prototype.visitPercentile=function(r){if(Jt(r.arg)){var i={expr:this.getSelectByRef(r.arg),selector:this.selector,aggregates:{percentiles:[{k:r.k,exclusive:r.exclusive}]}};this.add(i)}else this.add({expr:r,selector:this.selector})},e.prototype.visitColumnRef=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitContains=function(r){this.checkIfOrdinal(r),t.prototype.visitContains.call(this,r)},e.prototype.visitStartsWith=function(r){this.checkIfOrdinal(r),t.prototype.visitStartsWith.call(this,r)},e.prototype.visitCompare=function(r){this.checkIfOrdinal(r),t.prototype.visitCompare.call(this,r)},e.prototype.visitHierarchyLevel=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitNativeMeasure=function(r){this.add({expr:r,selector:this.selector})},e.prototype.visitSelectRef=function(r){var n=this.getSelectByRef(r);n&&this.add({expr:n,selector:this.selector})},e.prototype.getSelectByRef=function(r){var n=this.querySelects.withName(r.expressionName);return n&&n.expr},e.prototype.visitScopedEval=function(r){var n=r.decomposeGlobalAggregateOfScopedExpr();if(n){var i={expr:this.resolveSelectRef(n.source),selector:this.selector,aggregates:this.getAggregates(n.func)};this.add(i)}else r.hasGlobalScope()?this.add(i={expr:r.expression,selector:null}):(i={expr:r,selector:{data:[Fu()]}},this.add(i))},e.prototype.visitFillRule=function(r){r.input.accept(this),this.inputExpr=this.resolveSelectRef(r.input),this.visitFillRuleDefinition(r.rule)},e.prototype.visitFillDefinition=function(r){Zo(r,this.propertyVisitor)},e.prototype.visitFillRuleDefinition=function(r){u.assertValue(r,"fillRule"),u.assertAnyValue(this.inputExpr,"inputExpr can end up being undefined if it was a non-matching SelectRef");var n=r.linearGradient2||r.linearGradient3;u.assertValue(n,"fillRule needs either linearGradient2 or linearGradient3"),u.assertValue(n.min,"gradient.min"),u.assertValue(n.max,"gradient.max");var i={};n.min.value||(i.min=!0),n.max.value||(i.max=!0),(i.min||i.max)&&(this.exprs.push({expr:this.inputExpr,selector:this.selector,aggregates:i}),yd(r,this.propertyVisitor))},e.prototype.visitDataBarsDefinition=function(r){u.assertValue(this.inputExpr,"Databars without an input Expr"),u.assertValue(r,"dataBars");var n={};r.minValue||(n.min=!0),r.maxValue||(n.max=!0),(n.min||n.max)&&(this.exprs.push({expr:this.inputExpr,selector:this.selector,aggregates:n}),function(t,e){u.assertValue(t,"dataBars"),t.minValue&&e.visitExpr(t.minValue),t.maxValue&&e.visitExpr(t.maxValue),t.totalMatchingOption&&e.visitExpr(t.totalMatchingOption),Zo(t.positiveColor,e),Zo(t.negativeColor,e),Zo(t.axisColor,e),e.visitExpr(t.reverseDirection),e.visitExpr(t.hideText)}(r,this.propertyVisitor))},e.prototype.visitIconDefinition=function(r){!function(t,e){u.assertValue(t,"fillRule"),t.layout&&e.visitExpr(t.layout),t.verticalAlignment&&e.visitExpr(t.verticalAlignment),t.value&&e.visitExpr(t.value)}(r,this.propertyVisitor)},e.prototype.visitParagraphs=function(r){!function(t,e){u.assertValue(t,"paragraphs");for(var r=0,n=t;r<n.length;r++)FI(n[r],e)}(r,this.propertyVisitor)},e.prototype.visitErrorRangeDefinition=function(r){var n=this;u.assert(function(){return null!=n.selector.metadata},"Error range should have a target"),this.relatedProjectionQueryName=this.selector.metadata,function(t,e){t.explicit?function(t,e){e.visitExpr(t.isRelative),t.lowerBound&&e.visitExpr(t.lowerBound),t.upperBound&&e.visitExpr(t.upperBound)}(t.explicit,e):t.symmetricalExplicit?e.visitExpr(t.symmetricalExplicit.delta):t.standardDeviation?function(t,e){t.visitExpr(e.value),t.visitExpr(e.multiplier)}(e,t.standardDeviation):t.percentage?function(t,e){e.visitExpr(t.lowerBoundDelta),e.visitExpr(t.upperBoundDelta)}(t.percentage,e):t.percentile?function(t,e){e.visitExpr(t.lowerBound),e.visitExpr(t.upperBound)}(t.percentile,e):u.assertFail("Unsupported ErrorRangeDefinition")}(r,this.propertyVisitor),this.relatedProjectionQueryName=void 0},e}($t);function be(t){var e=we(t,R2.instance);return u.assertValue(e,"Failed to convert FieldExprPattern into SQExpr"),e}var F2=function(){function t(){}return t.prototype.visitIn=function(e){return nn(_.map(e.args,function(r){return be(r)}),_.map(e.values,function(r){return _.map(r,function(n){return on(n.value,n.type)})}))},t.prototype.visitBetween=function(e){if(e&&e.lower&&e.upper){var r=bt(e.lower.unit,er(e.lower.value)),n=bt(e.upper.unit,er(e.upper.value));return wr(be(e.arg),r,n)}},t.prototype.visitRelativeDateRange=function(e){return qa({field:be(e.arg),options:e.options})},t.prototype.visitComposite=function(e){return null},t.prototype.visitTopN=function(e){return null},t.prototype.visitComplex=function(e){u.assertFail("cannot recreate complex patterns as SQExprs")},t.prototype.visitAdvanced=function(e){},t.prototype.visitCompare=function(e){},t.prototype.visitHierarchical=function(e){},t.instance=new t,t}();function jm(t){return Xt(rf(t),t.aggregate)}function rf(t){return Re(cr(t),t.name)}function Km(t){return Xt(Ja(t.name,cr(t),sS(t.groupedColumns)),t.aggregate)}function Jm(t){return Ja(t.name,cr(t),sS(t.groupedColumns))}function cr(t){return je(t.schema,t.entity,t.entityVar)}function Ym(t){return Xt(cr(t),t.aggregate)}function $m(t){return Mi(Ya(cr(t.source),t.variationName,t.source.name),t.hierarchy.name)}function Xm(t){return $a(Mi(Ya(cr(t.source),t.variationName,t.source.name),t.level.name),t.level.level)}function Zm(t){return t.subqueryRef?Re(rn(t.subqueryRef),t.name):t.subquery?Re(rn(t.subquery),t.name):void 0}function eS(t){return Xt(Re(rn(t.subqueryRef),t.name),t.aggregate)}function tS(t){return Re(Eu(t.transformTable.name),t.name)}function rS(t){return Xt(nf(t),t.aggregate)}function nf(t){return $a(af(t),t.level)}function af(t){return Mi(cr(t),t.name)}function nS(t){return Vi(be(t.left),be(t.right),t.operator)}function iS(t){return on(t.value,t.type)}function aS(t){return Du(be(t.measure),_.map(t.grouping,function(e){return be(e)}))}function oS(t){return new Ld(t.name,t.language,t.expression)}function sS(t){return _.map(t,function(e){return be(e)})}var R2=function(){function t(){}return t.prototype.visitColumn=function(e){return rf(e)},t.prototype.visitColumnAggr=function(e){return jm(e)},t.prototype.visitGroupingColumn=function(e){return Jm(e)},t.prototype.visitGroupingColumnAggr=function(e){return Km(e)},t.prototype.visitColumnHierarchyVariation=function(e){return $m(e)},t.prototype.visitColumnHierarchyLevelVariation=function(e){return Xm(e)},t.prototype.visitColumnSubquery=function(e){return Zm(e)},t.prototype.visitColumnAggrSubquery=function(e){return eS(e)},t.prototype.visitColumnTransformRef=function(e){return tS(e)},t.prototype.visitEntity=function(e){return cr(e)},t.prototype.visitEntityAggr=function(e){return Ym(e)},t.prototype.visitHierarchy=function(e){return af(e)},t.prototype.visitHierarchyLevel=function(e){return nf(e)},t.prototype.visitHierarchyLevelAggr=function(e){return rS(e)},t.prototype.visitMeasure=function(e){return mu(this.visitEntity(e),e.name)},t.prototype.visitPercentile=function(e){return Su(be(e.arg),e.k,e.exclusive)},t.prototype.visitPercentOfGrandTotal=function(e){var r=be(e.baseExpr);return Vi(r,Ka(r,[]),3)},t.prototype.visitPercentOfRoleTotal=function(e){var r=be(e.baseExpr);return Vi(r,Ka(r,_.map(e.roles,function(n){return wu(n)})),3)},t.prototype.visitSelectRef=function(e){return wi(e.expressionName)},t.prototype.visitTransformOutputRoleRef=function(e){return Cu(e.expressionName)},t.prototype.visitFilteredEval=function(e){return bu(be(e.baseExpr),_.map(e.filters,function(r){return function(t){var e={condition:g0(t,F2.instance)};return _.isEmpty(t.target)||(e.target=_.map(t.target,function(r){return be(r)})),e}(r)}))},t.prototype.visitArithmetic=function(e){return nS(e)},t.prototype.visitConstant=function(e){return iS(e)},t.prototype.visitSparklineData=function(e){return aS(e)},t.prototype.visitNativeVisualCalc=function(e){return oS(e)},t.instance=new t,t}();function L2(t){return B2.rewrite(t)}var B2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.prototype.visitDefault=function(r){var n=me(r);return n&&!n.percentOfGrandTotal&&(r=be({percentOfGrandTotal:{baseExpr:n}})),r},e.instance=new e,e}(Zr),es=function(t){function e(r){var n=this;return u.assertValue(r,"func"),(n=t.call(this)||this).func=r,n}return T(e,t),e.prototype.visitAggr=function(r){return r.func===this.func?r:new en(r.arg,this.func)},e.prototype.visitColumnRef=function(r){return new en(r,this.func)},e.prototype.visitGroupRef=function(r){return new en(r,this.func)},e.prototype.visitHierarchyLevel=function(r){return new en(r,this.func)},e.rewrite=function(r,n){u.assertValue(r,"expr"),u.assertValue(n,"func");var i=new e(n);return r.accept(i)},e}(Zr);function U2(t,e){return O2.rewrite(t,e)}var O2=function(){function t(e,r){this.sqExpr=e,this.aggregate=r}return t.rewrite=function(e,r){return we(me(e),new t(e,r))},t.prototype.visitPercentOfGrandTotal=function(e){return e.baseExpr=me(es.rewrite(be(e.baseExpr),this.aggregate)),be({percentOfGrandTotal:e})},t.prototype.visitPercentOfRoleTotal=function(e){return e.baseExpr=me(es.rewrite(be(e.baseExpr),this.aggregate)),be({percentOfRoleTotal:e})},t.prototype.visitFilteredEval=function(e){return e.baseExpr=me(es.rewrite(be(e.baseExpr),this.aggregate)),be({filteredEval:e})},t.prototype.visitColumn=function(e){return this.defaultRewrite()},t.prototype.visitColumnAggr=function(e){return this.defaultRewrite()},t.prototype.visitGroupingColumn=function(e){return this.defaultRewrite()},t.prototype.visitGroupingColumnAggr=function(e){return this.defaultRewrite()},t.prototype.visitColumnHierarchyVariation=function(e){return this.defaultRewrite()},t.prototype.visitColumnHierarchyLevelVariation=function(e){return this.defaultRewrite()},t.prototype.visitColumnSubquery=function(e){return this.defaultRewrite()},t.prototype.visitColumnAggrSubquery=function(e){return this.defaultRewrite()},t.prototype.visitColumnTransformRef=function(e){return this.defaultRewrite()},t.prototype.visitSelectRef=function(e){return this.defaultRewrite()},t.prototype.visitEntity=function(e){return this.defaultRewrite()},t.prototype.visitEntityAggr=function(e){return this.defaultRewrite()},t.prototype.visitHierarchy=function(e){return this.defaultRewrite()},t.prototype.visitHierarchyLevel=function(e){return this.defaultRewrite()},t.prototype.visitHierarchyLevelAggr=function(e){return this.defaultRewrite()},t.prototype.visitMeasure=function(e){return this.defaultRewrite()},t.prototype.visitPercentile=function(e){return this.defaultRewrite()},t.prototype.visitTransformOutputRoleRef=function(e){return this.defaultRewrite()},t.prototype.visitArithmetic=function(e){return this.defaultRewrite()},t.prototype.visitConstant=function(e){return this.defaultRewrite()},t.prototype.visitSparklineData=function(e){return this.defaultRewrite()},t.prototype.visitNativeVisualCalc=function(e){return this.defaultRewrite()},t.prototype.defaultRewrite=function(){return es.rewrite(this.sqExpr,this.aggregate)},t}();function z2(t){return q2.rewrite(t)}var q2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.prototype.visitDefault=function(r){var n=me(r);return n&&n.percentOfRoleTotal&&(r=be(n.percentOfRoleTotal.baseExpr)),r},e.instance=new e,e}(Zr);function H2(t){return G2.rewrite(t)}var G2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.prototype.visitDefault=function(r){var n=me(r);return n&&n.percentOfGrandTotal&&(r=be(n.percentOfGrandTotal.baseExpr)),r},e.instance=new e,e}(Zr);function Q2(t,e){return j2.rewrite(t,e)}var W2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.visitAggr=function(r){return r.arg},e.rewrite=function(r){return u.assertValue(r,"expr"),r.accept(e.instance)},e.instance=new e,e}(Zr),j2=function(){function t(e){this.sqExpr=e}return t.rewrite=function(e,r){return we(me(e,r),new t(e))},t.prototype.visitPercentOfGrandTotal=function(e){return t.rewrite(be(e.baseExpr))},t.prototype.visitPercentOfRoleTotal=function(e){return t.rewrite(be(e.baseExpr))},t.prototype.visitFilteredEval=function(e){return t.rewrite(be(e.baseExpr))},t.prototype.visitColumn=function(e){return this.defaultRewrite()},t.prototype.visitColumnAggr=function(e){return this.defaultRewrite()},t.prototype.visitGroupingColumn=function(e){return this.defaultRewrite()},t.prototype.visitGroupingColumnAggr=function(e){return this.defaultRewrite()},t.prototype.visitColumnHierarchyVariation=function(e){return this.defaultRewrite()},t.prototype.visitColumnHierarchyLevelVariation=function(e){return this.defaultRewrite()},t.prototype.visitColumnSubquery=function(e){return this.defaultRewrite()},t.prototype.visitColumnAggrSubquery=function(e){return this.defaultRewrite()},t.prototype.visitColumnTransformRef=function(e){return this.defaultRewrite()},t.prototype.visitSelectRef=function(e){return this.defaultRewrite()},t.prototype.visitEntity=function(e){return this.defaultRewrite()},t.prototype.visitEntityAggr=function(e){return this.defaultRewrite()},t.prototype.visitHierarchy=function(e){return this.defaultRewrite()},t.prototype.visitHierarchyLevel=function(e){return this.defaultRewrite()},t.prototype.visitHierarchyLevelAggr=function(e){return this.defaultRewrite()},t.prototype.visitMeasure=function(e){return this.defaultRewrite()},t.prototype.visitPercentile=function(e){return this.defaultRewrite()},t.prototype.visitTransformOutputRoleRef=function(e){return this.defaultRewrite()},t.prototype.visitArithmetic=function(e){return this.defaultRewrite()},t.prototype.visitConstant=function(e){return this.defaultRewrite()},t.prototype.visitSparklineData=function(e){return this.defaultRewrite()},t.prototype.visitNativeVisualCalc=function(e){return this.defaultRewrite()},t.prototype.defaultRewrite=function(){return W2.rewrite(this.sqExpr)},t}();function K2(t,e){return J2.rewrite(t,e)}var J2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.rewrite=function(r,n){return u.assertValue(r,"expr"),r.accept(e.instance,n)},e.prototype.visitDefault=function(r,n){var i=me(r);return i&&!i.percentOfRoleTotal&&(r=be({percentOfRoleTotal:{baseExpr:i,roles:n}})),r},e.instance=new e,e}(Zr);function ts(){return window.powerbi||(window.powerbi={}),window.powerbi}var X2=function(t){return t[t.merge=0]="merge",t[t.remove=1]="remove",t}({});var uS=new Set(["powerbi.bab","powerbi.common.cultureInfo","powerbi.common.formattingLocale","powerbi.data.DataViewScopeIdentity","powerbi.ExtendedType","powerbi.extensibility.data","powerbi.extensibility.utils.axisType","powerbi.extensibility.utils.CartesianHelper","powerbi.extensibility.utils.chart.dataLabel","powerbi.extensibility.utils.chart.legend","powerbi.extensibility.utils.chart","powerbi.extensibility.utils.color","powerbi.extensibility.utils.ColumnUtil","powerbi.extensibility.utils.dataview.converterHelper","powerbi.extensibility.utils.dataview.DataRoleHelper","powerbi.extensibility.utils.dataview.DataViewObject","powerbi.extensibility.utils.dataview.DataViewObjects","powerbi.extensibility.utils.dataview.validationHelper","powerbi.extensibility.utils.dataview","powerbi.extensibility.utils.filter","powerbi.extensibility.utils.formatting.DateTimeUnit","powerbi.extensibility.utils.formatting.dateUtils","powerbi.extensibility.utils.formatting.DisplayUnitSystemType","powerbi.extensibility.utils.formatting.font","powerbi.extensibility.utils.formatting.numberFormat","powerbi.extensibility.utils.formatting.stringExtensions","powerbi.extensibility.utils.formatting.textMeasurementService","powerbi.extensibility.utils.formatting.TextProperties","powerbi.extensibility.utils.formatting.textUtil","powerbi.extensibility.utils.formatting.valueFormatter","powerbi.extensibility.utils.formatting.wordBreaker","powerbi.extensibility.utils.formatting","powerbi.extensibility.utils.interactivity.interactivityUtils","powerbi.extensibility.utils.interactivity","powerbi.extensibility.utils.MessageBox","powerbi.extensibility.utils.objects","powerbi.extensibility.utils.parser","powerbi.extensibility.utils.selection","powerbi.extensibility.utils.svg.CssConstants","powerbi.extensibility.utils.svg.shapes","powerbi.extensibility.utils.svg.touch","powerbi.extensibility.utils.svg","powerbi.extensibility.utils.telemetry","powerbi.extensibility.utils.test.dataViewBuilder","powerbi.extensibility.utils.test.helpers","powerbi.extensibility.utils.test.mocks","powerbi.extensibility.utils.test","powerbi.extensibility.utils.tooltip","powerbi.extensibility.utils.type.ArrayExtensions","powerbi.extensibility.utils.type.EnumExtensions","powerbi.extensibility.utils.type.ExtendedType","powerbi.extensibility.utils.type.JsonComparer","powerbi.extensibility.utils.type.LogicExtensions","powerbi.extensibility.utils.type.PixelConverter","powerbi.extensibility.utils.type.PrimitiveType","powerbi.extensibility.utils.type.Prototype","powerbi.extensibility.utils.type.RegExpExtensions","powerbi.extensibility.utils.type.StringExtensions","powerbi.extensibility.utils.type.TextSizeDefaults","powerbi.extensibility.utils.type.ValueUtil","powerbi.extensibility.utils.type","powerbi.extensibility.utils.yAxisPosition","powerbi.extensibility.utils","powerbi.extensibility.visual.Color","powerbi.extensibility.visual.FormatUtils","powerbi.extensibility.visual.LinkColorType","powerbi.extensibility.visual.LinkType","powerbi.extensibility.visual.Month","powerbi.extensibility.visual.PositionType","powerbi.extensibility.visual","powerbi.extensibility.visualApiVersions","powerbi.extensibility.VisualPlugin","powerbi.extensibility","powerbi.FilterAction","powerbi.formattingService._currentCulture","powerbi.formattingService._currentCultureSelector","powerbi.PrivilegeStatus","powerbi.reportServerHost","powerbi.SelectionIdBuilder","powerbi.session.userInfo","powerbi.session","powerbi.SortDirection","powerbi.VisualEventType","powerbi.VisualObjectInstance","powerbi.VisualObjectInstanceEnumerationObject","powerbi.visuals.DataEntrySlicers.Slicers.Page","powerbi.visuals.DataEntrySlicers.Slicers.URL","powerbi.visuals.DataEntrySlicers.Slicers","powerbi.visuals.DataEntrySlicers","powerbi.visuals.dataLabelUtils","powerbi.visuals.DateUtil","powerbi.visuals.DonutChart","powerbi.visuals.DonutChartWebBehavior","powerbi.visuals.filter","powerbi.visuals.plugins.debugVisual","powerbi.visuals.plugins","powerbi.visuals.SelectionIdBuilder","powerbi.visuals.valueFormatter","powerbi.VisualUpdateType.36"]);function lS(t,e){var r={get:function(i,a){var o=i[a],s="".concat(t,".").concat(a.toString());return void 0===o?uS.has(s)||(function(t){var r=JSON.stringify({eventName:"onGlobalUndefinedGet",arguments:[t]});window.parent.postMessage(r,"*")}(s),uS.add(s)):o&&"object"==typeof o&&e>0&&(o=new Proxy(o,lS(s,e-1))),o},set:function(i,a,o){return i[a]=o,!0}};return r}function nB(){window.powerbi=function(t,e){return new Proxy(t,lS("powerbi",3))}(ba())}function cS(t,e){if(t.matrix||u.assert(function(){return function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;var n=e.columns.length;if(t.columns.length!==n)return!1;for(var i=0;i<n;i++)if(!Lu(t.columns[i],e.columns[i]))return!1;return!0}(t.metadata,e.metadata)},"Cannot merge data views with different metadata columns"),e.metadata.segment?t.metadata.segment=e.metadata.segment:delete t.metadata.segment,t.table&&e.table&&function(t,e){if(u.assertValue(t,"source"),u.assertValue(e,"segment"),!_.isEmpty(e.rows)){var r=e.lastMergeIndex+1;En(t.rows,e.rows,r),u.assert(function(){return!t.identity==!e.identity},"The existence of identity in the new segment is different than the source"),e.identity&&En(t.identity,e.identity,r)}}(t.table,e.table),t.categorical&&e.categorical&&function(t,e){if(u.assertValue(t,"source"),u.assertValue(e,"segment"),u.assert(function(){return _.size(t.categories)===_.size(e.categories)},"pre-condition: source categories and segment categories should have the same length"),u.assert(function(){return _.every(t.categories,function(c){return t.categories[0].identity===c.identity})},"pre-condition: the identity property of all category columns are expected to be the same array object"),!_.isEmpty(t.categories)&&!_.isEmpty(e.categories)){for(var r=e.lastMergeIndex+1,n=e.categories.length,i=function(f){var d=e.categories[f],p=t.categories[f];u.assert(function(){return Lu(p.source,d.source)},"Source and segment category have different sources."),u.assert(function(){return void 0!==p.values||void 0===p.identity},"Source category is missing values but has identities."),d.values&&En(p.values,d.values,r)},a=0;a<n;a++)i(a);e.categories[0].identity&&En(t.categories[0].identity,e.categories[0].identity,r)}if(t.values&&e.values){var o=e.values.length;u.assert(function(){return t.values.length===o},"Source and segment values have different lengths.");for(var s=function(f){var d=e.values[f],p=t.values[f];u.assert(function(){return Lu(p.source,d.source)},"Source and segment value have different sources."),!p.values&&d.values&&(p.values=[]);var h=e.lastMergeIndex+1;d.values&&En(p.values,d.values,h),d.highlights&&En(p.highlights,d.highlights,h)},l=0;l<o;l++)s(l)}}(t.categorical,e.categorical),t.tree&&e.tree&&of(t.tree.root,e.tree.root,!0),t.matrix&&e.matrix){u.assertValue(t.matrix.rows,"source.matrix.rows"),u.assertValue(t.matrix.rows.levels,"source.matrix.rows.levels"),u.assertValue(e.matrix.rows,"segment.matrix.rows"),u.assertValue(e.matrix.rows.levels,"segment.matrix.rows.levels"),u.assertValue(t.metadata,"source.metadata"),u.assertValue(t.metadata.columns,"source.metadata.columns"),u.assertValue(e.metadata,"segment.metadata"),u.assertValue(e.metadata.columns,"segment.metadata.columns");var r=t.matrix.rows.levels.length,n=e.matrix.rows.levels.length;if(r>n)_.remove(t.metadata.columns,function(c){return null!=c.index&&!_.some(e.metadata.columns,function(f){return f.index===c.index})}),t.metadata.columns.length=e.metadata.columns.length,function(t,e){var r=e.levels.length;t.levels.length=r,u.assert(function(){return _.isEqual(t.levels,e.levels)},"Segments have different levels");var n=[];sf(t.root.children,r-1,n);for(var i=0,a=n;i<a.length;i++)uB(a[i])}(t.matrix.rows,e.matrix.rows);else if(r<n){for(var a=0,o=0,s=_.filter(e.metadata.columns,function(c){return null!=c.index&&!_.some(t.metadata.columns,function(f){return f.index===c.index})});o<s.length;o++){for(var l=s[o];a<t.metadata.columns.length&&(null==t.metadata.columns[a].index||t.metadata.columns[a].index<l.index);)a++;t.metadata.columns.splice(a,0,l)}!function(t,e){for(var r=e.levels.length,n=t.levels.length,i=n;i<r;i++)t.levels.push(e.levels[i]);u.assert(function(){return _.isEqual(t.levels,e.levels)},"Segments have different levels");var a=[];sf(t.root.children,n-1,a);for(var o=0,s=a;o<s.length;o++)cB(s[o],n);(function(t,e){for(var r=t.root,n=0;n<e;n++)if(_.isEmpty(r.children)||(u.assertValue(r=r.children[0],"Segment has fewer levels than expected"),!r.isMerge||r.isSubtotal))return!1;return!0})(e,n)&&delete _.last(a).children}(t.matrix.rows,e.matrix.rows)}of(t.matrix.rows.root,e.matrix.rows.root,r!==n)}}function En(t,e,r){if(r>=e.length)return e;var n=[];return void 0!==r&&(n=e.splice(0,r)),Array.prototype.push.apply(t,e),n}function of(t,e,r){if(u.assertValue(t,"sourceRoot"),u.assertValue(e,"segmentRoot"),e.children&&0!==e.children.length){if(r&&(!t.children||0===t.children.length))return void(t.children=e.children);u.assert(function(){return t.children&&t.children.length>=0},"Source tree has different structure than segment.");var n=function(t){if(0===t.length)return 0;for(var e=0;e<t.length&&t[e].isMerge;e++);return e}(e.children),i=t.children[t.children.length-1],a=En(t.children,e.children,n);a.length>0&&of(i,a[a.length-1],r)}}function uB(t){if(!_.isEmpty(t.children)){var e=_.find(t.children,function(r){return r.isSubtotal});e&&(t.values=e.values),delete t.children,delete t.childIdentityFields}}function cB(t,e){t.isSubtotal||(u.assert(function(){return t.level===e-1},"Leaf was found on a non-last level"),u.assert(function(){return 0===_.size(t.children)},"Node has children"),t.children=[{isSubtotal:!0,level:e,values:t.values}],delete t.values)}function sf(t,e,r){u.assertValue(t,"nodes");for(var n=0,i=t;n<i.length;n++){var a=i[n];a.isSubtotal||(a.level===e?r.push(a):!_.isEmpty(a.children)&&void 0!==a.level&&a.level<e&&sf(a.children,e,r))}}var uf="children",pB=function(){function t(){this.serializeDataViewFromScrathTimes=0,this.matrixIdentityToValueMapper=new Map,this.initializeFields()}return t.prototype.serializeDataViewForCv=function(e,r,n,i,a,o,s){var l=this;if(void 0===o&&(o=!1),void 0===s&&(s=!1),n||(this.initializeFields(),this.serializeDataViewFromScrathTimes=(this.serializeDataViewFromScrathTimes+1)%11617),e){e=this.filterDataViewsType(e,r),this.isExpandCollapseSupported=!!e.matrix&&!!r.expandCollapse,this.isExpandCollapseSupported&&(n&&(u.assert(function(){return!_.isEmpty(a)},"lastNodeIndex should be defined and not empty when we load more data"),this.lastNodeIndex=a),e.matrix.rows.levels.forEach(function(p,h){p.sources&&p.sources[0]&&p.sources[0].queryName&&(l.rowsLevel.length>h?l.rowsLevel[h]=p.sources[0].queryName:l.rowsLevel.push(p.sources[0].queryName))}));var c=this.getValueSource(e),f=this.getValueGroups(e);this.shouldShareIdentityIndexStrategy=o&&!!e.matrix,s&&(s=!!e.matrix&&function(t){var e=Ml(t.objects,nD),r=null==e?void 0:e.type;return!(!r||!r.filter||r.filter.selfFilter)}(r));var d=JSON.stringify(e,function(p,h){return l.replacer(p,h,i,s)});return u.assert(function(){return _.isEmpty(l.stackNodeIndex)},"stackNodeIndex should be empty"),{valueSource:c,valueGroups:f,stringifiedDataView:d}}},t.prototype.serializeDataViewMetadata=function(e){var r=this;return e.metadata?JSON.stringify(e.metadata,function(n,i){return r.replacer(n,i)}):null},t.prototype.deserializeDataView=function(e,r,n,i,a){var s,o=this;return void 0===n&&(n=!1),void 0===i&&(i=[]),void 0===a&&(a=!1),this.isExpandCollapseSupported=n,this.lastNodeIndex=i,s=r||this.isExpandCollapseSupported&&a?JSON.parse(e.stringifiedDataView,function(l,c){return o.deserializeDataViewHelper(l,c,a)}):JSON.parse(e.stringifiedDataView),this.reconstructValuesGroups(s,e),this.reconstructValuesSource(s,e),s},t.prototype.convertOpaqueIdentitiesToScopeIds=function(e){var r=[];if(e&&e.length>0)for(var n=0,i=e;n<i.length;n++){var a=i[n],o=this.replaceOpaqueIndexWithScopeIds(a);o&&(o.opaqueIdentity={identityIndex:a},r.push(o))}return r},t.prototype.getDataViewScopeIdentityByCustomVisualOpaqueIdentity=function(e){return this.replaceOpaqueIndexWithScopeIds(e.identityIndex)},t.prototype.convertCVSelectionIdToPowerbiSelctionId=function(e){var r=this,n=JSON.parse(JSON.stringify(e),function(i,a){return r.replaceOpaqueIdentitiesWithDataViewScopeIdentities(i,a)});return uo.createWithSelectorForColumnAndMeasures(n.dataMap,n.measures)},t.prototype.restoreIdentitiesIndexesFromSelectionId=function(e,r){var n=this,i={serializedDataMap:{},measures:e.metadata};return _.map(e.dataMap,function(o,s){u.assert(function(){return o.length<=1},"dataMap can only have one selector per column"),i.serializedDataMap[s]=[{identityIndex:n.ensureIdentityIsMapped(o[0])}]}),i.serializedDataMap=r&&!e.dataMap?null:i.serializedDataMap,i},t.prototype.getNodeIndexOfSelectionId=function(e){var r,n=[];if(e&&e.dataMap){if(null!==(r=e.nodeIndexes)&&void 0!==r&&r.length)return e.nodeIndexes;for(var i in e.dataMap){var a=_.first(e.dataMap[i]).identityIndex;null!=this.identityNodeIndexArray[a]&&n.push(this.identityNodeIndexArray[a])}}return n},t.prototype.sortSelectionIdAccordingToRows=function(e){var r=this;if(!e||!e.dataMap)return!1;var n=Object.keys(e.dataMap),i=Object.keys(e.dataMap).sort(function(s,l){return r.rowsLevel.indexOf(s)-r.rowsLevel.indexOf(l)}),a=!_.isEmpty(i)&&!_.isEmpty(this.rowsLevel)&&i.length<=this.rowsLevel.length&&i.every(function(s,l){return s===r.rowsLevel[l]});if(a){var o=e.nodeIndexes;null!=o&&o.length&&o.length===n.length&&(e.nodeIndexes=Object.entries(o).sort(function(s,l){var f=l[0];return r.rowsLevel.indexOf(n[Number(s[0])])-r.rowsLevel.indexOf(n[Number(f)])}).map(function(s){return s[1]})),e.dataMap=i.reduce(function(s,l){return s[l]=e.dataMap[l],s},{})}return a},t.prototype.deserializeVisualObjectInstance=function(e){var r=this;return JSON.parse(JSON.stringify(e,function(n,i){return r.replaceOpaqueIdentities(i)}))},t.prototype.deserializeOpaqueIdentity=function(e){var r=this;null!=e&&e.data&&(e.data=e.data.map(function(n){return r.replaceOpaqueIdentities(n)}))},t.prototype.flushIdentitiesArray=function(){!this.identitiesArray||0===this.identitiesArray.length||this.identitiesArray.forEach(function(e){e.opaqueIdentity=void 0,e.serializeDataViewFromScrathTimes=void 0})},t.prototype.getCustomVisualOpaqueIdentityByDataViewScopeIdentity=function(e){return{identityIndex:this.ensureIdentityIsMapped(e)}},t.prototype.getDataViewValueByCustomVisualOpaqueIdentity=function(e){var r=e.identityIndex;if(r>=0)return this.matrixIdentityToValueMapper.get(r)},t.prototype.getValueGroups=function(e){var r=this;if(e&&e.categorical&&e.categorical.values&&e.categorical.values.grouped){var n=e.categorical.values.grouped();return JSON.stringify(n,function(i,a){return r.replacer(i,a)})}return null},t.prototype.getValueSource=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.source?e.categorical.values.source:null},t.prototype.deserializeDataViewHelper=function(e,r,n){var i,a,o;if(r&&(n&&this.isExpandCollapseSupported&&!isNaN(parseInt(e,10))&&null!=(null===(i=r.identity)||void 0===i?void 0:i.identityIndex)&&(r.nodeIndex=null!==(a=r.nodeIndex)&&void 0!==a?a:parseInt(e,10)),e===uf&&r instanceof Array)){if(n&&this.isExpandCollapseSupported&&!_.isEmpty(r)&&_.first(r).isMerge&&!_.isEmpty(this.lastNodeIndex))for(var s in r){var l=r[s];l.identity&&(l.nodeIndex=null!==(o=l.nodeIndex)&&void 0!==o?o:Number(s),l.nodeIndex+=this.lastNodeIndex[l.level])}for(var c=0;c<r.length;c++)if(r[c]&&(r[c].isDate&&(r[c].value=new Date(r[c].value)),r[c].values))for(var f in r[c].values)r[c].values[f].isDate&&(r[c].values[f].value=new Date(r[c].values[f].value))}return r},t.prototype.replacer=function(e,r,n,i){var o,s,a=this;if(void 0===i&&(i=!1),r){if(i&&r.levelValues&&this.isDataViewScopeIdentity(r.identity)&&this.valuesStack.push(null===(s=null===(o=r.levelValues)||void 0===o?void 0:o[0])||void 0===s?void 0:s.value),!this.shouldShareIdentityIndexStrategy&&this.isExpandCollapseSupported&&!isNaN(parseInt(e,10))&&r.identity&&this.isDataViewScopeIdentity(r.identity)&&(this.stackNodeIndex.push(parseInt(e,10)+this.getNodeIndexOffset(r)),r.needOffset&&delete r.needOffset),this.isDataViewScopeIdentity(r)){if(r.serializeDataViewFromScrathTimes===this.serializeDataViewFromScrathTimes&&r.opaqueIdentity&&null!=r.opaqueIdentity.identityIndex){if(this.stackNodeIndex.length){var l=this.stackNodeIndex.pop();null==this.identityNodeIndexArray[r.opaqueIdentity.identityIndex]&&(this.identityNodeIndexArray[r.opaqueIdentity.identityIndex]=l)}return{identityIndex:r.opaqueIdentity.identityIndex}}u.assert(function(){return _.isEmpty(a.lastNodeIndex)||!_.isEmpty(a.lastNodeIndex)&&null==r.opaqueIdentity},"The new segment's values should not have opaqueIdentity"),r.serializeDataViewFromScrathTimes=this.serializeDataViewFromScrathTimes;var c=-1;return this.shouldShareIdentityIndexStrategy&&(c=this.getIndexOfIdentity(r))>-1?(r.opaqueIdentity={identityIndex:c},this.valuesStack.pop()):(r.opaqueIdentity={identityIndex:this.identitiesArray.length},this.shouldShareIdentityIndexStrategy&&(this.identitiesIndexesMapper[r.key]=this.identitiesArray.length),this.valuesStack.length&&this.matrixIdentityToValueMapper.set(this.identitiesArray.length,this.valuesStack.pop()),this.identitiesArray.push(r)),this.stackNodeIndex.length&&(this.identityNodeIndexArray[r.opaqueIdentity.identityIndex]=this.stackNodeIndex.pop()),r.opaqueIdentity}if(r instanceof Array){var f=[];if(!this.shouldShareIdentityIndexStrategy&&this.isExpandCollapseSupported&&e===uf&&r.length&&r[0].isMerge)for(var d=0,p=r;d<p.length;d++){var h=p[d];h.identity&&(h.needOffset=!0)}if(n&&e===uf)for(var v=0;v<r.length;v++)if(r[v]&&(r[v].value&&r[v].value instanceof Date&&(r[v].isDate=!0),r[v].values))for(var g in r[v].values)r[v].values[g].value&&r[v].values[g].value instanceof Date&&(r[v].values[g].isDate=!0);return f.push.apply(f,r||[]),f}if("object"==typeof r&&!this.dontNeedToClone(r)){var y={};for(var m in r)y[m]=r[m];return y}}return r},t.prototype.replaceOpaqueIdentities=function(e){if(e){var r=e.identityIndex;if(void 0!==r&&r>=0&&r<this.identitiesArray.length)return Ic(this.identitiesArray[e.identityIndex])}return e},t.prototype.getNodeIndexOffset=function(e){var r=this;return this.isExpandCollapseSupported&&!_.isEmpty(this.lastNodeIndex)&&e.needOffset?(u.assert(function(){return e.level<r.lastNodeIndex.length},"node's level is too high"),this.lastNodeIndex[e.level]):0},t.prototype.getIndexOfIdentity=function(e){if(this.shouldShareIdentityIndexStrategy){var r=this.identitiesIndexesMapper[e.key];return null!=r?r:-1}return _.findIndex(this.identitiesArray,function(n){return Ii(n,e)})},t.prototype.ensureIdentityIsMapped=function(e){var r=this.getIndexOfIdentity(e);return-1===r&&(r=this.identitiesArray.length,this.shouldShareIdentityIndexStrategy&&(this.identitiesIndexesMapper[e.key]=r),this.identitiesArray.push(e)),r},t.prototype.replaceOpaqueIdentitiesWithDataViewScopeIdentities=function(e,r){return r&&void 0!==r.identityIndex?this.identitiesArray[r.identityIndex]:r},t.prototype.filterDataViewsType=function(e,r){return r.dataViewMappings&&(r.dataViewMappings[0].categorical||(e.categorical=null),r.dataViewMappings[0].matrix||(e.matrix=null),r.dataViewMappings[0].table||(e.table=null),r.dataViewMappings[0].tree||(e.tree=null),r.dataViewMappings[0].single||(e.single=null)),e},t.prototype.dontNeedToClone=function(e){return e._proto_===Object.prototype||e instanceof Date},t.prototype.isDataViewScopeIdentity=function(e){return!!(e&&e.expr&&e.key&&e.kind)},t.prototype.reconstructValuesSource=function(e,r){r&&r.valueSource&&(e.categorical.values.source=r.valueSource)},t.prototype.reconstructValuesGroups=function(e,r){e&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&(e.categorical.values.grouped=function(){return JSON.parse(r.valueGroups)})},t.prototype.replaceOpaqueIndexWithScopeIds=function(e){return e>=0&&e<this.identitiesArray.length?this.identitiesArray[e]:null},t.prototype.initializeFields=function(){this.identitiesArray=[],this.identityNodeIndexArray={},this.stackNodeIndex=[],this.rowsLevel=[],this.lastNodeIndex=[],this.identitiesIndexesMapper={},this.shouldShareIdentityIndexStrategy=!1,this.matrixIdentityToValueMapper.clear(),this.valuesStack=[]},t}(),rs_AzureKey="xfefTl4ZST_fZb9l-IT5EpZqJGKpqQOsHTXeyoi3zeQ",Qt_MaxBingRequest=6,Qt_MaxCacheSize=3e3,Qt_MaxCacheSizeOverflow=100,Qt_MaxPersistedSpace=24e5,Qt_MaxAge=43200,Qt_BingKey="AoW85FdF-eTJavFmWhZjaQ970kwG1FuainbyVSlP5HglkbhVVIFOyNwlaQxAIj-S",he={Address:"Address",City:"City",Continent:"Continent",CountryRegion:"Country",County:"County",Longitude:"Longitude",Latitude:"Latitude",Place:"Place",PostalCode:"PostalCode",StateOrProvince:"StateOrProvince"},MB=".".concat("mapLassoButton"),dS=(".".concat("NavBar_Container"),".".concat("plot-area"),"NavBar_zoomIn"),pS="NavBar_zoomOut";function Zn(t,e,r){void 0===r&&(r=!1);var n=is(t),i=n.baseUrl;if(r&&_.assign(e,n.queryParameters),_.isEmpty(e))return i;var a=[];for(var o in e){var s=e[o];if(null==s)a.push(encodeURIComponent(o));else if("string"==typeof s)a.push(encodeURIComponent(o)+"="+encodeURIComponent(s));else for(var l=0,c=s;l<c.length;l++){var f=c[l];a.push(encodeURIComponent(o)+"="+encodeURIComponent(f))}}return i+"?"+a.join("&")}function is(t){var e=function(t){var e=document.createElement("a");return e.href=t,e.search}(t);return{baseUrl:e?t.slice(0,t.indexOf("?")):t,queryParameters:bS(e)}}function bS(t){if(!t)return{};_.startsWith(t,"?")&&(t=t.substring(1));for(var r={},n=0,i=t.split("&");n<i.length;n++){var o=i[n].split("="),s=decodeURIComponent(o[0]),l=decodeURIComponent(o[1]),c=r[s];null==c?r[s]=l:"string"==typeof c?r[s]=[c,l]:c.push(l)}return r}".".concat(dS,", .").concat(pS),"".concat(MB,", .").concat(dS,", #").concat(pS);var Rt,fr,Ze={Continent:"Continent",Sovereign:"Sovereign",CountryRegion:"CountryRegion",AdminDivision1:"AdminDivision1",AdminDivision2:"AdminDivision2",PopulatedPlace:"PopulatedPlace",Postcode:"Postcode",Postcode1:"Postcode1",Neighborhood:"Neighborhood",Address:"Address"},na="2023-06-01",ES="https://platform.bing.com/geo/spatial/v1/public/Geodata",CS="https://dev.virtualearth.net/REST/v1/Locations",wS="https://atlas.microsoft.com/geocode",VS="https://atlas.microsoft.com/search/polygon",eU={adminDistrict:"AdminDistrict",locality:"Locality",postalCode:"PostalCode",addressLine:"AddressLine",countryRegion:"CountryRegion"},tU={AdminDistrict:"adminDistrict",Locality:"locality",PostalCode:"postalCode",AddressLine:"addressLine",CountryRegion:"countryRegion"};function as(t){return Rt||((Rt={})[he.Continent.toLowerCase()]=Ze.Continent,Rt[he.CountryRegion.toLowerCase()]=Ze.Sovereign,Rt[he.StateOrProvince.toLowerCase()]=Ze.AdminDivision1,Rt[he.County.toLowerCase()]=Ze.AdminDivision2,Rt[he.City.toLowerCase()]=Ze.PopulatedPlace,Rt[he.PostalCode.toLowerCase()]=Ze.Postcode,Rt[he.Address.toLowerCase()]=Ze.Address),t&&Rt[t.toLowerCase()]||""}function os(t){return fr||((fr={})[he.CountryRegion.toLowerCase()]=Ze.CountryRegion,fr[he.StateOrProvince.toLowerCase()]=Ze.AdminDivision1,fr[he.County.toLowerCase()]=Ze.AdminDivision2,fr[he.City.toLowerCase()]=Ze.PopulatedPlace,fr[he.PostalCode.toLowerCase()]=Ze.Postcode1),t&&fr[t.toLowerCase()]||""}function ia(){var e=function(t){switch(t.toLowerCase()){case"fr":return"fr-FR";case"de":return"de-DE";case"da":return"da-DK";case"es":return"es-ES";case"it":return"it-IT";case"nl":return"nl-BE";case"af":case"am":case"ar-sa":case"as":case"az-atn":case"be":case"bg":case"bn-bd":case"bn-in":case"bs":case"ca":case"ca-es-valencia":case"cs":case"cy":case"de-de":case"el":case"en-gb":case"en-us":case"es-es":case"es-us":case"es-mx":case"et":case"eu":case"fa":case"fi":case"fil-latn":case"fr-fr":case"fr-ca":case"ga":case"gd-latn":case"gl":case"gu":case"ha-latn":case"he":case"hi":case"hr":case"hu":case"hy":case"id":case"ig-latn":case"is":case"it-it":case"ja":case"ka":case"kk":case"km":case"kn":case"ko":case"kok":case"ku-arab":case"ky-cyrl":case"lb":case"lt":case"lv":case"mi-latn":case"mk":case"ml":case"mn-cyrl":case"mr":case"ms":case"mt":case"nb":case"ne":case"nl-be":case"nn":case"nso":case"or":case"pa":case"pa-arab":case"pl":case"prs-arab":case"pt-br":case"pt-pt":case"qut-latn":case"quz":case"ro":case"ru":case"rw":case"sd-arab":case"si":case"sk":case"sl":case"sq":case"sr-cryl-ba":case"sr-cryl-rs":case"sr-latn-rs":case"sv":case"sw":case"ta":case"te":case"tg-cyrl":case"th":case"ti":case"tk-latn":case"tn":case"tr":case"tt-cyrl":case"ug-arab":case"uk":case"ur":case"uz-latn":case"vi":case"wo":case"xh":case"yo-latn":case"zh-hans":case"zh-hant":case"zh-cn":case"zu":return t;default:return null}}(Aa.getLanguage());return e}function MS(t){return!xS(t,"UpHierarchy")}function xS(t,e){return _.some(t,function(r){return r===e})}function ss(t){ot.information("georequest",void 0,t)}function us(t,e){ot.error("geocoding IndexedDB ".concat(t," failure"),!0,void 0,e)}var ei,ls=function(t){return t.Init="init",t.Get="get",t.Set="set",t.Clear="clear",t}({}),aU=((ei={})[CS]="G",ei[ES]="S",ei[wS]="AG",ei[VS]="AS",ei),DS={Sovereign:"countryRegion",CountryRegion:"countryRegion",AdminDivision1:"adminDistrict",AdminDivision2:"adminDistrict",PopulatedPlace:"locality",Postcode:"postalCode",Postcode1:"postalCode",Neighborhood:"locality",Address:"addressLine"},AS={Sovereign:"countryRegion",CountryRegion:"countryRegion",AdminDivision1:"adminDistrict",AdminDivision2:"adminDistrict2",PopulatedPlace:"locality",Postcode:"postalCode",Postcode1:"postalCode",Neighborhood:"locality",Address:"addressLine"},_S={Continent:"continent",CountryRegion:"countryRegion",AdminDivision1:"adminDistrict",AdminDivision2:"adminDistrict2",AdminDivision3:"adminDistrict3",PopulatedPlace:"locality",Postcode1:"postalCode",Postcode2:"postalCode2",Postcode3:"postalCode3",Postcode4:"postalCode4",Neighborhood:"neighborhood"},aa=function(){function t(e,r,n,i){this.location=e,r&&(n&&i&&(r=this.removeRegion(r)),this.key=((r=aU[r]||r)+";"+_.map(this.location.components,function(a){return(a.query||"")+"/"+(a.category||"")}).join("&")).toLowerCase(),e.culture&&(this.key+="&c=".concat(e.culture)))}return t.prototype.removeRegion=function(e){return u.assert(function(){return!!e&&e.indexOf("atlas.microsoft.com")>0},"should be a valid azure maps url, but received ".concat(e)),e.slice(0,8)+e.slice(e.indexOf("atlas.microsoft.com"))},t.prototype.getKey=function(){return this.key},t.prototype.getAjaxConfig=function(){return{type:"GET",dataType:"jsonp",jsonp:"jsonp"}},t}(),oa=function(t){function e(r,n,i){var a=t.call(this,n,r)||this;return a.credentials=i,a}return T(e,t),e.prototype.getCulture=function(){return this.location.culture},e.prototype.getBingEntity=function(){return as(_.last(this.location.components).category)},e.prototype.validate=function(){return null!=this.getEntity()},e.prototype.getEntity=function(){var r=this.getGeocodingParameters();if(_.some(r,function(d){return!d.key})){var n=_.chain(r).map(function(d){return d.value}).filter(function(d){return d}).reverse().value().join(", ");return n?{Query:n}:void 0}for(var i={Address:{}},a=i.Address,o=0,s=r;o<s.length;o++){var l=s[o],c=l.value;if(!c||!(c=c.trim()))return;var f=l.key;"adminDistrict"===f&&a.AdminDistrict?a.AdminDistrict=l.value+", "+a.AdminDistrict:a[eU[f]]=l.value}return i},e.prototype.getUrl=function(r){var n={key:this.credentials||Qt_BingKey},i=this.getEntity();if(i){var a=i.Address;if(a)for(var o in a)n[tU[o]]=a[o];else n.q=i.Query;var s=this.location.culture||ia();return s&&(n.c=s),n.maxRes="10",Zn(r,n,!0)}},e.prototype.getGeocodingParameters=function(){var r=this.location.components;return r.length>=2&&r[0].category===he.Continent&&r[1].category===he.CountryRegion&&(r=_.tail(r)),_.map(r,function(i){var a=as(i.category),o="";a in DS&&(o=DS[a]);var s=i.query;return a===Ze.Sovereign&&s&&(s=e.Iso3166Substitutions[s]||s),{key:o,value:s}})},e.prototype.isGeneralQuery=function(){return _.some(this.getGeocodingParameters(),function(r){return!r.key})},e.prototype.getResult=function(r){var n=this,i=this.isGeneralQuery(),a=IS(r,function(l){return n.locationQuality(l,i)});if(a){var o=a.point.coordinates;return{coordinates:{latitude:o&&o[0],longitude:o&&o[1],entityType:a.entityType}}}return{error:new Error("Geocode result is empty.")}},e.prototype.shouldDoFullGeocoding=function(r){var n=r&&r.resourceSets&&r.resourceSets[0]&&r.resourceSets[0].resources&&r.resourceSets[0].resources[0];if(!n||function(t){return!xS(t,"Ambiguous")}(n.matchCodes))return!1;var i=this.getBingEntity().toLowerCase(),a=n.entityType&&n.entityType.toLowerCase();return"admindivision1"===i&&"admindivision2"===a||"admindivision2"===i&&"admindivision1"===a},e.prototype.extractSingleResult=function(r,n){return r&&r.resourceSets&&r.resourceSets.length>n?{resourceSets:[r.resourceSets[n]]}:void 0},e.prototype.locationQuality=function(r,n){if(!n&&r.matchCodes&&!MS(r.matchCodes))return-1;var i=0;if(1===this.location.components.length&&this.location.components[0].category===he.CountryRegion){var a=r.address&&r.address.countryRegionIso2;if(a){var o=this.location.components[0].query.toLowerCase();2===o.length&&o===a.toLowerCase()&&(i+=2)}}return r.entityType&&r.entityType.toLowerCase()===this.getBingEntity().toLowerCase()&&(i+=1),i},e.Iso3166Substitutions={BI:"Burundi",BQ:"Bonaire",SJ:"Svalbard",BES:"Bonaire",NGA:"Nigeria",NAM:"Namibia",SJM:"Svalbard",MAF:"MF",SA:"Saudi Arabia"},e}(aa),cs=function(t){function e(r,n,i,a,o,s,l){void 0===l&&(l="subscriptionKey");var c=t.call(this,n,r,i,a)||this;return c.apiVersion=o,c.credentials=s,c.credentialType=l,u.assert(function(){return"subscriptionKey"===l||!!s},"credentials must be provided when using Azure Maps SAS Token"),c}return T(e,t),e.prototype.getCulture=function(){return this.location.culture},e.prototype.validate=function(){return null!=this.getEntity()},e.prototype.getEntity=function(){var r=this.getGeocodingParameters();if(_.some(r,function(f){return!f.key})){var n=_.chain(r).map(function(f){return f.value}).filter(function(f){return f}).reverse().value().join(", ");return n?{query:n}:void 0}for(var i={},a=0,o=r;a<o.length;a++){var s=o[a],l=s.value;if(!l||!(l=l.trim()))return;i[s.key]=s.value}return i},e.prototype.getUrl=function(r){var n={},i=this.getEntity();if(!_.isEmpty(i)){for(var a in i)n[a]=i[a];return n.top="10",n["api-version"]=this.apiVersion,Zn(r,n,!0)}},e.prototype.getGeocodingParameters=function(){var r=this.location.components;return r.length>=2&&r[0].category===he.Continent&&r[1].category===he.CountryRegion&&(r=_.tail(r)),_.map(r,function(i){var a=as(i.category),o="";a in AS&&(o=AS[a]);var s=i.query;return a===Ze.Sovereign&&s&&(s=e.Iso3166Substitutions[s]||s),{key:o,value:s}})},e.prototype.isGeneralQuery=function(){return _.some(this.getGeocodingParameters(),function(r){return!r.key})},e.prototype.getResult=function(r){var a,n=this,i=r&&!_.isEmpty(r.features)&&r.features;if(Array.isArray(i)){var o=_.chain(i).map(function(f){return{feature:f,value:n.locationQuality(f,n.isGeneralQuery())}}).filter(function(f){return f.value>=0}).maxBy(function(f){return f.value}).value();a=o&&o.feature}if(a){var s=a.geometry,l=a.properties;return{coordinates:{latitude:s&&s.coordinates[1],longitude:s&&s.coordinates[0],entityType:l&&l.type}}}return{error:new Error("Geocode result is empty.")}},e.prototype.extractSingleResult=function(r,n){return r&&r.batchItems&&r.batchItems.length>n?r.batchItems[n]:void 0},e.prototype.getBingEntity=function(){return as(_.last(this.location.components).category)},e.prototype.locationQuality=function(r,n){var i;if(!n&&r.properties&&r.properties.matchCodes&&!MS(r.properties.matchCodes))return-1;var a=0;if("High"===(null===(i=r.properties)||void 0===i?void 0:i.confidence)&&(a+=3),1===this.location.components.length&&this.location.components[0].category===he.CountryRegion){var o=r.properties&&r.properties.address&&r.properties.address.countryRegion&&r.properties.address.countryRegion.ISO;if(o){var s=this.location.components[0].query.toLowerCase();2===s.length&&s===o.toLowerCase()&&(a+=2)}}return r.properties&&r.properties.type&&r.properties.type.toLowerCase()===this.getBingEntity().toLowerCase()&&(a+=1),a},e.prototype.getHeaders=function(){var r;r="sasToken"===this.credentialType?{Authorization:"jwt-sas ".concat(this.credentials)}:{"subscription-key":this.credentials||rs_AzureKey};var n=this.getCulture()||ia();return n&&(r["Accept-Language"]=n),r},e.prototype.getAjaxConfig=function(){return{type:"GET",dataType:"json"}},e.Iso3166Substitutions={BI:"Burundi",BQ:"Bonaire",SJ:"Svalbard",BES:"Bonaire",NGA:"Nigeria",NAM:"Namibia",SJM:"Svalbard",MAF:"MF"},e}(aa);function IS(t,e){var r=t&&!_.isEmpty(t.resourceSets)&&t.resourceSets[0].resources;if(Array.isArray(r)){var n=_.chain(r).map(function(i){return{location:i,value:e(i)}}).filter(function(i){return i.value>=0}).maxBy(function(i){return i.value}).value();return n&&n.location}}var ke,De,la,TS=function(t){function e(r,n,i,a,o){var s=t.call(this,{components:[{query:[n,i].join(),category:"Point"}]})||this;return s.credentials=o,s.latitude=n,s.longitude=i,s.entities=a,s}return T(e,t),e.prototype.validate=function(){return!0},e.prototype.getUrl=function(r){var n=this;u.assert(function(){return n.entities.every(function(s){return!!_.findKey(Ze,function(l){return l===s})})},"All entities should match one of the allowed BingEntities");var i=is(r),a=_.endsWith(i.baseUrl,"/")?i.baseUrl:i.baseUrl+"/";a+=[this.latitude,this.longitude].join();var o={key:this.credentials||Qt_BingKey,include:"ciso2"};return _.isEmpty(this.entities)||(o.includeEntityTypes=this.entities.join()),Zn(a,o,!0)},e.prototype.getResult=function(r){var n=this,i=IS(r,function(c){return-1===n.entities.indexOf(c.entityType)?0:1});if(i){var a=i.point.coordinates,o=i.address||{};return{coordinates:{latitude:a[0],longitude:a[1],addressLine:o.addressLine,locality:o.locality,neighborhood:o.neighborhood,adminDistrict:o.adminDistrict,adminDistrict2:o.adminDistrict2,formattedAddress:o.formattedAddress,postalCode:o.postalCode,countryRegionIso2:o.countryRegionIso2,countryRegion:o.countryRegion,landmark:o.landmark,name:i.name}}}return{coordinates:null}},e}(aa),sa=function(t){function e(r,n,i,a,o,s,l,c){void 0===s&&(s=3);var f=t.call(this,{components:[{query:[n,i,o,s].join(",")+(l!==os(a)?","+l:""),category:a}]},r)||this;return f.credentials=c,f.latitude=n,f.longitude=i,f.levelOfDetail=o,f.maxGeoData=s,f.entityType=l,f}return T(e,t),e.prototype.getBingEntity=function(){return os(_.last(this.location.components).category)},e.prototype.validate=function(){return!(!this.entityType&&!this.getBingEntity())},e.prototype.getUrl=function(r){var n=this.entityType||this.getBingEntity();if(!n)return null;var i=is(r),a=i.baseUrl,o=i.queryParameters;o||(o={});var s=o.c||o.culture,l=s||"",c=s&&function(t){switch(t=t.toUpperCase()){case"ZH-HANS":case"ZH-HANT":return"CN"}var e=t.split("-",2);return e.length>1?e[1]:""}(s)||"";return o.key=this.credentials||Qt_BingKey,o.$format="json",o.SpatialFilter="GetBoundary("+[this.latitude,this.longitude,this.levelOfDetail,"'"+n+"'",1,0,"'"+l+"'","'"+c+"'"].join(", ")+")",delete o.c,delete o.culture,Zn(a,o,!0)},e.prototype.getResult=function(r){var n=r;if(n&&n.d&&Array.isArray(n.d.results)&&n.d.results.length>0){var a=n.d.results[0].Primitives;if(a&&a.length>0){var o={latitude:this.latitude,longitude:this.longitude,locations:[]};a.sort(function(p,h){return p.Shape.length<h.Shape.length?1:p.Shape.length>h.Shape.length?-1:0});for(var s=Math.min(a.length,this.maxGeoData),l=0;l<s;l++)for(var f=a[l].Shape.split(","),d=1;d<f.length;d++)o.locations.push({nativeBing:f[d]});return{coordinates:o}}}return{error:new Error("Geocode result is empty.")}},e}(aa),fs=function(t){function e(r,n,i,a,o,s,l,c,f,d,p,h){void 0===f&&(f=3),void 0===h&&(h="subscriptionKey");var v=t.call(this,{components:[{query:[s,l,c,f].join(",")+(d!==os(n)?","+d:""),category:n}]},r,i,a)||this;return v.apiVersion=o,v.latitude=s,v.longitude=l,v.levelOfDetail=c,v.maxGeoData=f,v.entityType=d,v.credentials=p,v.credentialType=h,u.assert(function(){return"subscriptionKey"===h||!!p},"credentials must be provided when using Azure Maps SAS Token"),v}return T(e,t),e.prototype.getBingEntity=function(){return os(_.last(this.location.components).category)},e.prototype.getResolution=function(){switch(this.levelOfDetail){case 3:return"huge";case 2:return"large";case 1:return"medium";default:return"small"}},e.prototype.validate=function(){return!(!this.entityType&&!this.getBingEntity())},e.prototype.getUrl=function(r){var n,i,a=null!==(n=this.entityType)&&void 0!==n?n:this.getBingEntity();return""!==a&&a in _S&&(i=_S[a]),i?Zn(r,{coordinates:"".concat(this.longitude,",").concat(this.latitude),view:"".concat("Auto"),resultType:i,resolution:"".concat(this.getResolution()),"api-version":this.apiVersion},!0):null},e.prototype.getResult=function(r){var n=r;if(n&&n.geometry&&Array.isArray(n.geometry.geometries)&&n.geometry.geometries.length>0){var i=n.geometry.geometries,a=function(s,l){return s+l.length};return i.sort(function(o,s){var l=o.coordinates.reduce(a,0);return s.coordinates.reduce(a,0)-l}),this.maxGeoData<i.length&&(i=i.slice(0,this.maxGeoData)),{coordinates:{latitude:this.latitude,longitude:this.longitude,geoJsonPolygons:i}}}return{error:new Error("Azure Maps Geo-boundary result is empty.")}},e.prototype.getHeaders=function(){var r;(r="sasToken"===this.credentialType?{Authorization:"jwt-sas ".concat(this.credentials)}:{"subscription-key":this.credentials||rs_AzureKey}).Accept="application/json";var n=ia();return n&&(r["Accept-Language"]=n),r},e.prototype.getAjaxConfig=function(){return{type:"GET",dataType:"json"}},e}(aa),oU=function(){function t(){}return t.prototype.isLocalStorageSupported=function(){try{var e="validateLocalStorageKey",r="validateLocalStorageValue";return localStorage.setItem(e,r),localStorage.getItem(e)===r&&(localStorage.removeItem(e),null===localStorage.getItem(e))}catch(n){return!1}},t.prototype.getData=function(e){try{if(localStorage){var r=localStorage[e];if(r)return JSON.parse(r)}}catch(n){}},t.prototype.setData=function(e,r){try{if(localStorage)return void(void 0===r?localStorage.removeItem(e):localStorage[e]=JSON.stringify(r))}catch(n){}},t.prototype.setJSONData=function(e,r){try{localStorage&&(void 0===r?localStorage.removeItem(e):localStorage[e]=r)}catch(n){}},t.prototype.forEach=function(e){try{if(!localStorage)return;for(var r=localStorage.length;r-- >0;)e(localStorage.key(r))}catch(n){}},t}(),sU=function(){function t(e){this.cache={},this.clearCacheInterval=null!=e?e:t.defaultClearCacheInterval,this.clearCache()}return t.prototype.getData=function(e){return this.cache[e]},t.prototype.setData=function(e,r,n){var i=this;this.cache[e]=r,null==this.clearCacheTimerId&&(this.clearCacheTimerId=setTimeout(function(){return i.clearCache()},this.clearCacheInterval))},t.prototype.clearCache=function(){this.cache={},this.clearCacheTimerId=void 0},t.defaultClearCacheInterval=864e5,t}(),uU=new oU,lU=(new sU,/^V:[12]-|^g:.* s:|(address|city|continent|country|county|postalcode|stateorprovince)$/);function FS(t,e){return"`"+t+"-"+e}function ca(t,e){return"``"+t+"-"+e}!function(t){ke=uU,De=t,la={}}();var hU=function(){function t(e,r,n){this.cacheName=e,this.maxSpace=r,this.maxAge=n,this.disabled=!1}return t.prototype.getData=function(e){if(!this.disabled){var r=FS(this.cacheName,e),n=ke.getData(r),i=n&&n.id;if(null!=i){var a=ca(this.cacheName,i),o=De.caches[this.cacheName];if(ps(o.added)-n.added<=this.maxAge)return ke.getData(a);o.size-=n.size,Rr(),ke.setData(a,void 0),ke.setData(r,void 0)}}},t.prototype.setData=function(e,r,n){if(!this.disabled){if(!(De=cf()))return void(this.disabled=!0);var i=FS(this.cacheName,e),a=ke.getData(i);void 0===r?this.removeEntry(i,a):this.setEntry(i,a,r,n)}},t.prototype.removeEntry=function(e,r){if(r){var n=r.size;null!=n&&(De.caches[this.cacheName].size-=n,Rr());var i=r.id;null!=i&&ke.setData(ca(this.cacheName,i),void 0)}ke.setData(e,void 0)},t.prototype.setEntry=function(e,r,n,i){var a=De.caches[this.cacheName];if(!a)return this.disabled=!0,void Nr("error","Did't find cache metadata for ".concat(this.cacheName," in directory ").concat(JSON.stringify(De)));var o=ps(a.added),s=r&&r.id;s?(r.added=o,a.size-=r.size):r={id:s=a.nextId++,added:o,size:0};var l=ca(this.cacheName,s),c=JSON.stringify(n);r.size=c.length+e.length+l.length,r.size+=JSON.stringify(r).length,r.size+=1,a.size+=r.size,a.size>this.maxSpace&&(i&&i(),ff(this.cacheName),a.added=Date.now(),a.nextId=2,r.added=ps(a.added),r.id=1,l=ca(this.cacheName,r.id),r.size=c.length+e.length+l.length,r.size+=JSON.stringify(r).length,r.size+=1,a.size=r.size),Rr(),ke.setData(e,r),ke.setJSONData(l,c)},t}();function ps(t){return Math.floor((Date.now()-t)/6e4)}function NS(){if(De=cf()){if("2"===De.version)return;Nr("information","Clearing old verion ".concat(De.version," localStorage entries")),df(function(t){return t.length>0&&"`"===t[0]})}else Nr("information","Clearing obsolete localStorage entries"),df(function(t){return lU.test(t)});De={version:"2",caches:{}},Rr(),kS()}function Rr(){ke.setData("``",De)}function cf(){return ke.getData("``")}function kS(){try{var t=cf();_.isEqual(t,De)||Nr("warning","Cache directory different after save: saved=".concat(JSON.stringify(De)," reloaded=").concat(JSON.stringify(t)))}catch(e){Nr("error","Error checking cache directory after save: ".concat(e&&e.stack?e.stack:JSON.stringify(e)))}}function ff(t){var e=function(t){return new RegExp("^`"+t+"-")}(t),r=function(t){return new RegExp("^``"+t+"-")}(t);df(function(n){return e.test(n)||r.test(n)})}function df(t){var e=[];ke.forEach(function(a){t(a)&&e.push(a)});for(var r=0,n=e;r<n.length;r++)ke.setData(n[r],void 0);return e.length}function Nr(t,e){var r=window.jsCommon;!r||!r.Trace||ot[t]("localStorageCache: "+e)}var hs,mU=function(){function t(e,r,n){this.maxMemoryCacheSize=e,this.maxMemoryCacheSizeOverflow=r,this.localStorageCache=n,this.geocodeCache={},this.geocodeCacheCount=0,this.localStorageCache=n}return t.prototype.clear=function(e,r){return nt(this,void 0,void 0,function(){return it(this,function(n){switch(n.label){case 0:return e&&r.isSupported()?[4,r.clear()]:[3,2];case 1:n.sent(),n.label=2;case 2:return function(t){ff(t),NS();var e=De.caches.G;e&&(la.G?De.caches.G={version:e.version,size:0,nextId:1,added:Date.now()}:delete De.caches.G,Rr())}("G"),this.geocodeCache={},this.geocodeCacheCount=0,[2]}})})},t.prototype.getCoordinates=function(e,r,n,i){return nt(this,void 0,void 0,function(){var a,o,s;return it(this,function(c){switch(c.label){case 0:return a=e.getKey(),(o=this.geocodeCache[a])?(++o.hitCount,[2,o.coordinate]):(s=void 0,n&&i.isSupported()?[4,i.get(a)]:[3,2]);case 1:s=c.sent(),c.label=2;case 2:return!s&&(!n||!i.isSupported()||this.isBingQuery(e))&&(s=this.localStorageCache.getData(a)),s?(r&&r.logFirstQueryHit(e),this.registerInMemory(a,s,r,n,i),[2,s]):(void 0===o&&(r&&r.logFirstQueryMiss(e),this.markPendingInMemory(a)),[2])}})})},t.prototype.getCoordinatesMemoryOnly=function(e,r){var n=e.getKey(),i=this.geocodeCache[n];if(i)return++i.hitCount,i.coordinate},t.prototype.registerCoordinates=function(e,r,n,i,a){return nt(this,void 0,void 0,function(){var o;return it(this,function(s){switch(s.label){case 0:return this.registerInMemory(e,r,n,i,a),o=t.getCoordinateToCache(r),i&&a.isSupported()?[4,a.set(e,o,function(){return n.logGeocodeCacheLimitExceeded(!0)})]:[3,2];case 1:return s.sent(),[3,3];case 2:this.localStorageCache.setData(e,o,function(){return n.logGeocodeCacheLimitExceeded(!1)}),s.label=3;case 3:return[2]}})})},t.prototype.markPendingInMemory=function(e){this.geocodeCache[e]=null},t.prototype.registerInMemory=function(e,r,n,i,a){var o=this.geocodeCache,s=this.maxMemoryCacheSize,l=s+this.maxMemoryCacheSizeOverflow;if(this.geocodeCacheCount>=l){n&&n.disableFirstQueryLogging();var c=Object.keys(o),f=c.length;if(c.sort(function(h,v){var g=o[h],y=o[v];return(y?y.hitCount:0)-(g?g.hitCount:0)}),f<2*l)for(var d=s-1;d<f;d++)o[c[d]]=void 0;else{var p={};for(d=s-1;d-- >0;)p[c[d]]=o[c[d]];o=this.geocodeCache=p}this.geocodeCacheCount=s}i&&a.isSupported()&&null==r&&(r={latitude:void 0,longitude:void 0}),o[e]={coordinate:r,hitCount:1},++this.geocodeCacheCount},t.prototype.isBingQuery=function(e){return e instanceof oa||e instanceof TS||e instanceof sa},t.getCoordinateToCache=function(e){var r=null==e?void 0:e.locations;if(!r||!t.hasRuntimeBoundaryData(r))return e;var n={latitude:e.latitude,longitude:e.longitude,locations:_.map(r,function(i){return{nativeBing:i.nativeBing}})};return e.entityType&&(n.entityType=e.entityType),n},t.hasRuntimeBoundaryData=function(e){for(var r=0,n=e;r<n.length;r++){var i=n[r];for(var a in i)if("nativeBing"!==a)return!0}return!1},t}();function vs(){return hs||(hs=function(t,e,r,n,i){return new mU(t,e,function(t,e,r,n){NS();var i=la.G;if(!i){Nr("information","ensuring localStorageCache ".concat(t));var a=De.caches.G;a&&a.version!==e&&(Nr("information","Clearing old version cache ".concat(t)),ff(t),delete De.caches.G,Rr(),a=void 0),i=new hU(t,r,n),la.G=i,a||(Nr("information","Adding initial cache metadata for ".concat(t)),De.caches.G={version:e,size:0,nextId:1,added:Date.now()},Rr(),kS())}return i}("G",i,r,n))}(Qt_MaxCacheSize,Qt_MaxCacheSizeOverflow,Qt_MaxPersistedSpace,Qt_MaxAge,"4")),hs}function BS(t,e,r,n){return t.getKey()?vs().getCoordinates(t,e,r,n):Promise.resolve(void 0)}function pf(t,e){if(t.getKey())return vs().getCoordinatesMemoryOnly(t,e)}function gs(t,e,r,n,i){return t?vs().registerCoordinates(t,e,r,n,i):Promise.resolve(void 0)}var US=function(){function t(){}return t.setMapsAjaxCall=function(e){t.MapsAjaxCall=e},t.MapsAjaxCall=$.ajax,t}();function fa(t,e,r){t&&(e instanceof oa?t.logGeocodeImmediate(e,r):e instanceof sa?t.logGeocodeBoundaryImmediate(e,r):e instanceof cs?t.logAzureMapsGeocodeImmediate(e):e instanceof fs&&t.logAzureMapsGeocodeBoundaryImmediate(e))}function ys(t,e,r,n,i){t&&(e instanceof oa?(t.logGeocodeResult(e,r,n,i),t.logBatchTelemetry(e)):e instanceof sa?t.logGeocodeBoundaryResult(e,r,n,i):e instanceof cs?(t.logAzureMapsGeocodeResult(e,r,n,i),t.logBatchTelemetry(e)):e instanceof fs&&t.logAzureMapsGeocodeBoundaryResult(e,r,n,i))}var bU=function(){function t(e,r){this.useBatchGeocoding=e,this.bypassGeocodingCache=r}return t.prototype.geocodeBaseUrl=function(e){switch(e){case 4:case 6:return this.azureMapsGeocodingUrl();case 5:return this.azureMapsBoundaryUrl();case 1:return this.bingSpatialDataUrl();default:return this.bingGeocodingUrl()}},t.prototype.geocodeQueueType=function(e){return 1===e?this.useBatchGeocoding()?6:4:this.useBatchGeocoding()?3:0},t.prototype.geocode=function(e,r,n,i,a,o){u.assert(function(){return 1===r||"sasToken"!==(null==a?void 0:a.credentialType)},"SASToken credential type is only supported for Azure Maps");var s=Ni().defer(),l=this.geocodeQueueType(r),c=1===r?new cs(this.azureMapsGeocodingUrl(),e,!0,o,na,a&&a.credentials,a&&a.credentialType):new oa(this.bingGeocodingUrl(),e,a&&a.credentials);return this.geocodeCore(l,c,n,i,a).pipe(function(f){return s.resolve(f)},function(f){return s.reject(f)}),s.promise},t.prototype.geocodeBoundary=function(e,r,n,i,a,o){u.assert(function(){return 1===r||"sasToken"!==(null==a?void 0:a.credentialType)},"SASToken credential type is only supported for Azure Maps");var s=e.latitude,l=e.longitude,c=e.category,f=void 0===c?"":c,d=e.levelOfDetail,p=void 0===d?2:d,h=e.maxGeoData,v=void 0===h?3:h,g=e.entityType,y=1===r?5:1,m=1===r?new fs(this.azureMapsBoundaryUrl(),f,!0,o,na,s,l,p,v,g,a&&a.credentials,a&&a.credentialType):new sa(this.bingSpatialDataUrl(),s,l,f,p,v,g,a&&a.credentials);return this.geocodeCore(y,m,n,i,a)},t.prototype.geocodePoint=function(e,r,n,i,a,o){return this.geocodeCore(2,new TS(this.bingGeocodingUrl(),e,r,a,o&&o.credentials),n,i,o)},t.prototype.tryGeocodeImmediate=function(e,r,n,i,a){return nt(this,void 0,void 0,function(){var o,s,l;return it(this,function(c){switch(c.label){case 0:return this.bypassGeocodingCache()?[2]:(o=1===r?new cs(this.azureMapsGeocodingUrl(),e,!0,a,na):new oa(this.bingGeocodingUrl(),e),s=this.bingGeocodingLogger(),[4,BS(o,s,n,i)]);case 1:return l=c.sent(),fa(s,o,l),[2,l]}})})},t.prototype.tryGeocodeBoundaryImmediate=function(e,r,n,i,a){return nt(this,void 0,void 0,function(){var o,s,l,c,f,d,p,h,v,g;return it(this,function(y){switch(y.label){case 0:return this.bypassGeocodingCache()?[2]:(o=e.latitude,s=e.longitude,l=e.category,c=e.levelOfDetail,d=void 0===(f=e.maxGeoData)?3:f,p=e.entityType,h=1===r?new fs(this.azureMapsBoundaryUrl(),l,!0,a,na,o,s,c,d,p):new sa(this.bingSpatialDataUrl(),o,s,l,c,d,p),v=this.bingGeocodingLogger(),[4,BS(h,v,n,i)]);case 1:return g=y.sent(),fa(v,h,g),[2,g]}})})},t.prototype.geocodeCore=function(e,r,n,i,a){var o=$.Deferred();if(r.validate()){var s=this.bingGeocodingLogger(),l=a&&null!=a.bypassCache?a.bypassCache:this.bypassGeocodingCache(),c=!l&&pf(r,s);if(c)fa(s,r,c),o.resolve(c);else{var f=a&&a.timeout,d=3===e||6===e,p=function(t,e,r,n,i,a,o,s){var l=t.toString()+e+(r||"");(3===t||6===t)&&o&&(l+=o);var f=da[l];if(!f){var d=is(e),p=d.queryParameters;switch("/"===(e=d.baseUrl)[e.length-1]&&(e=e.substring(0,e.length-1)),t){case 6:f=new OS("".concat(e,":").concat("batch"),r,{batchGeocodeCulture:o,batchSize:100,batchRequest:function(v){return JSON.stringify({batchItems:_.map(v,function(g){return g.getEntity()})})},batchHeaders:function(v,g){var y={"Accept-Language":g||ia()};return"sasToken"===a?y.Authorization="jwt-sas ".concat(v):y["subscription-key"]=v||rs_AzureKey,y},batchQueryParameters:function(v,g){return ye(ye({},p),{"api-version":na})},tryIndexedDB:n,indexedDBService:i,instanceId:s,queueName:l,geocodeRetryOptions:{maxRetryAttempts:3,initialRetryIntervalInMs:1e3,retryOnStatusCodes:[429]}});break;case 3:f=new OS("".concat(e,"/").concat("multigeocode"),r,{batchGeocodeCulture:o,batchSize:30,batchRequest:function(v){return JSON.stringify({GeocodeEntities:_.map(v,function(g){return g.getEntity()})})},batchHeaders:function(v,g){return{}},batchQueryParameters:function(v,g){return ye(ye({},p),{culture:g||ia(),output:"json",key:v})},tryIndexedDB:n,indexedDBService:i,instanceId:s,queueName:l});break;case 4:case 5:f=new zS(e,r,{tryIndexedDB:n,indexedDBService:i,instanceId:s,queueName:l,geocodeRetryOptions:{maxRetryAttempts:3,initialRetryIntervalInMs:1e3,retryOnStatusCodes:[429]}});break;default:f=new zS(e,r,{tryIndexedDB:n,indexedDBService:i,instanceId:s,queueName:l})}da[l]=f}return f}(e,this.geocodeBaseUrl(e),a&&a.credentials,n,i,a&&a.credentialType,d&&r.getCulture?r.getCulture():void 0,a&&a.instanceId),h={timeout:f,geocoder:this,query:r,deferred:o,logger:this.bingGeocodingLogger(),bypassCache:l};p.enqueue(h),s&&s.collectBatchQueue(p),f&&a.timeout.finally(function(){h.deferred.state()===Gn[Gn.pending]&&h.deferred.reject()})}}else o.reject();return o},t}(),EU=function(t){function e(r,n,i){void 0===r&&(r=function(){return!1}),void 0===n&&(n=function(){return!1});var a=t.call(this,r,n)||this;return a.logger=i,a}return T(e,t),e.prototype.bingSpatialDataUrl=function(){return ES},e.prototype.bingGeocodingUrl=function(){return CS},e.prototype.bingGeocodingLogger=function(){return this.logger},e.prototype.azureMapsGeocodingUrl=function(){return wS},e.prototype.azureMapsBoundaryUrl=function(){return VS},e}(bU),OS=function(){function t(e,r,n){this.baseUrl=e,this.credentials=r,this.entries=[],this.activeEntries=[],this.activeBatches=0,this.maxEntries=0,this.processedBatchQueries=new Set,this.inDequeue=!1,this.culture=n.batchGeocodeCulture,this.batchSize=n.batchSize,this.batchRequest=n.batchRequest,this.batchHeaders=n.batchHeaders,this.batchQueryParameters=n.batchQueryParameters,this.geocodeRetryOptions=n.geocodeRetryOptions,this.tryIndexedDB=n.tryIndexedDB,this.indexedDBService=n.indexedDBService,this.instanceId=n.instanceId,this.queueName=n.queueName}return t.prototype.getInstanceId=function(){return this.instanceId},t.prototype.getQueueName=function(){return this.queueName},t.prototype.getGeocodeBatchSize=function(){return this.batchSize},t.prototype.getEntryCount=function(){return this.maxEntries},t.prototype.getProcessedBatches=function(){return this.processedBatchQueries?Array.from(this.processedBatchQueries).map(function(e){return e.split(",").length}):[]},t.prototype.setGeocodeBatchSize=function(e){u.assert(function(){return e>0&&_.isInteger(e)},"Invalid geocode batch size"),this.batchSize=e},t.prototype.reset=function(){var e=this.dequeueTimeout;e&&(this.dequeueTimeout=void 0,clearTimeout(e));for(var r=0,n=this.entries.concat(this.activeEntries);r<n.length;r++)this.cancel(n[r]);this.entries=[],this.activeEntries=[]},t.prototype.enqueue=function(e){var r=this,n={item:e};this.entries.push(n);var i=this.entries.length+this.activeEntries.length;i>this.maxEntries&&(this.maxEntries=i),e.deferred.always(function(){r.cancel(n)}),this.inDequeue||this.entries.length<this.batchSize||this.activeBatches>=Qt_MaxBingRequest?this.scheduleDequeue():(this.dequeueTimeout&&(clearTimeout(this.dequeueTimeout),this.dequeueTimeout=void 0),this.dequeue())},t.prototype.addProcessedBatch=function(e){var r=e.map(function(n){return n.item.query.getKey()}).sort().toString();this.processedBatchQueries.add(r)},t.prototype.dequeue=function(){if(!this.inDequeue&&!this.dequeueTimeout)try{for(this.inDequeue=!0;0!==this.entries.length&&this.activeBatches<Qt_MaxBingRequest;){for(var e=[];0!==this.entries.length&&e.length<this.batchSize;){var r=this.entries.shift();if(!r.isCompleted){var n=!r.item.bypassCache&&pf(r.item.query,r.item.logger);n?(fa(r.item.logger,r.item.query,n),this.complete(r,{coordinates:n},!0)):e.push(r)}}e.length&&(this.geocodeRetryOptions?this.makeRequest(e,0,this.geocodeRetryOptions.initialRetryIntervalInMs):this.makeRequest(e),this.addProcessedBatch(e))}}finally{this.inDequeue=!1}},t.prototype.scheduleDequeue=function(){var e=this;!this.dequeueTimeout&&0!==this.entries.length&&(this.dequeueTimeout=setTimeout(function(){e.dequeueTimeout=void 0,e.dequeue()}))},t.prototype.cancel=function(e){var r=e.batch;if(r){var n=r.request;n&&--r.uncancelledCount<=0&&(r.request=null,n.abort())}this.complete(e,{error:new Error("cancelled")})},t.prototype.complete=function(e,r,n){var a,i=this,o=!1;if(!e.isCompleted&&(e.isCompleted=!0,e.item.deferred.state()===Gn[Gn.pending])){var s=this.tryIndexedDB&&this.indexedDBService.isSupported(),l=!e.item.bypassCache&&!n;!r||r.error?s&&l&&"Geocode result is empty."===(null===(a=null==r?void 0:r.error)||void 0===a?void 0:a.message)?(o=!0,gs(e.item.query.getKey(),void 0,e.item.logger,this.tryIndexedDB,this.indexedDBService).then(function(){e.item.deferred.reject(r&&r.error||new Error("cancelled")),i.scheduleDequeue()},function(c){us(ls.Set,{error:JSON.stringify(c)}),e.item.deferred.reject(r&&r.error||new Error("cancelled")),i.scheduleDequeue()})):e.item.deferred.reject(r&&r.error||new Error("cancelled")):l&&r.coordinates?(o=!0,gs(e.item.query.getKey(),r.coordinates,e.item.logger,this.tryIndexedDB,this.indexedDBService).then(function(){e.item.deferred.resolve(r.coordinates),i.scheduleDequeue()},function(c){s&&us(ls.Set,{error:JSON.stringify(c)}),e.item.deferred.resolve(r.coordinates),i.scheduleDequeue()})):e.item.deferred.resolve(r.coordinates)}o||this.scheduleDequeue()},t.prototype.makeRequest=function(e,r,n){var i=this;if(!_.isEmpty(e)){var a={type:"POST",dataType:"json",contentType:"application/json",data:this.batchRequest(e.map(function(g){return g.item.query}))},o=this.batchHeaders&&this.batchHeaders(this.credentials,this.culture);_.isEmpty(o)||(a.headers=o);for(var s=this.batchQueryParameters(this.credentials,this.culture),l=Zn(this.baseUrl,s),c={uncancelledCount:e.length,request:US.MapsAjaxCall(l,a)},f=0,d=e;f<d.length;f++){var p=d[f];p.batch=c,this.activeEntries.push(p)}++this.activeBatches;var h=c.request;h.always(function(){--i.activeBatches;for(var g=0,y=e;g<y.length;g++)_.pull(i.activeEntries,y[g])});var v=_.head(e).item.bypassCache;h.pipe(function(g){v&&ss({url:l,request:a.data,response:JSON.stringify(g)});for(var y=function(b){var E=e[b];E.batch=null;var w,C=E.item,M=C.query.extractSingleResult&&C.query.extractSingleResult(g,b);if(C.geocoder&&C.query.shouldDoFullGeocoding&&C.query.shouldDoFullGeocoding(M))C.geocoder.geocodeCore(0,C.query,i.tryIndexedDB,i.indexedDBService,{bypassCache:!0,timeout:C.timeout}).then(function(V){w={coordinates:V}},function(V){w={error:V}}).done(function(){i.complete(E,w)});else{if(M)try{w=C.query.getResult(M)}catch(V){w={error:V}}else w={error:new Error("no data")};ys(C.logger,C.query,M,w,!0),i.complete(E,w)}},m=0;m<e.length;++m)y(m)},function(g){if(v&&ss({url:l,request:a.data,error:JSON.stringify(g)}),i.shouldRetry(g?g.status:void 0,r)){var m=Math.random()*n+n;n*=2,setTimeout(function(){r++,i.makeRequest(e,r,n)},m)}else for(var S=0,b=e;S<b.length;S++){var E=b[S];E.batch=null;var C={error:new Error(g&&g.statusText||"cancelled")};ys(E.item.logger,E.item.query,void 0,C,!0),i.complete(E,C)}})}},t.prototype.shouldRetry=function(e,r){if(!this.geocodeRetryOptions)return!1;var n=this.geocodeRetryOptions,a=n.maxRetryAttempts;return n.retryOnStatusCodes.includes(e)&&r<a},t}(),zS=function(){function t(e,r,n){this.baseUrl=e,this.credentials=r,this.entries=[],this.activeEntries=[],this.inDequeue=!1,this.geocodeRetryOptions=n.geocodeRetryOptions,this.tryIndexedDB=n.tryIndexedDB,this.indexedDBService=n.indexedDBService,this.instanceId=n.instanceId,this.queueName=n.queueName}return t.prototype.getInstanceId=function(){return this.instanceId},t.prototype.getQueueName=function(){return this.queueName},t.prototype.reset=function(){var e=this.dequeueTimeout;e&&(this.dequeueTimeout=void 0,clearTimeout(e));for(var r=0,n=this.entries.concat(this.activeEntries);r<n.length;r++)this.cancel(n[r]);this.entries=[],this.activeEntries=[]},t.prototype.enqueue=function(e){var r=this,n={item:e};this.entries.push(n),e.deferred.always(function(){r.cancel(n)}),this.dequeue()},t.prototype.dequeue=function(){if(!this.inDequeue&&!this.dequeueTimeout)try{for(this.inDequeue=!0;0!==this.entries.length&&this.activeEntries.length<Qt_MaxBingRequest;){var e=this.entries.shift();e.isCompleted||(this.geocodeRetryOptions?this.makeRequest(e,0,this.geocodeRetryOptions.initialRetryIntervalInMs):this.makeRequest(e))}}finally{this.inDequeue=!1}},t.prototype.scheduleDequeue=function(){var e=this;!this.dequeueTimeout&&0!==this.entries.length&&(this.dequeueTimeout=setTimeout(function(){e.dequeueTimeout=void 0,e.dequeue()}))},t.prototype.cancel=function(e){if(!e.jsonp){var r=e.request;r&&(e.request=null,r.abort())}this.complete(e,{error:new Error("cancelled")})},t.prototype.complete=function(e,r,n){var a,i=this,o=!1;if(!e.isCompleted&&(e.isCompleted=!0,e.item.deferred.state()===Gn[Gn.pending])){var s=this.tryIndexedDB&&this.indexedDBService.isSupported(),l=!e.item.bypassCache&&!n;!r||r.error?s&&l&&"Geocode result is empty."===(null===(a=null==r?void 0:r.error)||void 0===a?void 0:a.message)?(o=!0,gs(e.item.query.getKey(),void 0,e.item.logger,this.tryIndexedDB,this.indexedDBService).then(function(){e.item.deferred.reject(r&&r.error||new Error("cancelled")),i.scheduleDequeue()},function(c){us(ls.Set,{error:JSON.stringify(c)}),e.item.deferred.reject(r&&r.error||new Error("cancelled")),i.scheduleDequeue()})):e.item.deferred.reject(r&&r.error||new Error("cancelled")):l&&r.coordinates?(o=!0,gs(e.item.query.getKey(),r.coordinates,e.item.logger,this.tryIndexedDB,this.indexedDBService).then(function(){e.item.deferred.resolve(r.coordinates),i.scheduleDequeue()},function(c){s&&us(ls.Set,{error:JSON.stringify(c)}),e.item.deferred.resolve(r.coordinates),i.scheduleDequeue()})):e.item.deferred.resolve(r.coordinates)}o||this.scheduleDequeue()},t.prototype.makeRequest=function(e,r,n){var i=this,a=!e.item.bypassCache&&pf(e.item.query,e.item.logger);if(a)return fa(e.item.logger,e.item.query,a),void this.complete(e,{coordinates:a},!0);var o=e.item.query.getAjaxConfig();o.jsonp&&(e.jsonp=!0);var s=e.item.query.getHeaders&&e.item.query.getHeaders();_.isEmpty(s)||(o.headers=s);var l=e.item.query.getUrl(this.baseUrl);l?(this.activeEntries.push(e),e.request=US.MapsAjaxCall(l,o),e.request.always(function(){_.pull(i.activeEntries,e)}),e.request.pipe(function(c){var f;e.item.bypassCache&&ss({url:l,response:JSON.stringify(c)}),e.request=null;try{f=e.item.query.getResult(c)}catch(d){f={error:d}}ys(e.item.logger,e.item.query,c,f,!1),i.complete(e,f)},function(c){if(e.item.bypassCache&&ss({url:l,error:JSON.stringify(c)}),i.shouldRetry(c?c.status:void 0,r)){var d=Math.random()*n+n;n*=2,setTimeout(function(){r++,i.makeRequest(e,r,n)},d)}else{e.request=null;var p={error:new Error(c&&c.statusText||"cancelled")};ys(e.item.logger,e.item.query,void 0,p,!1),i.complete(e,p)}})):this.complete(e,{error:new Error("Unsupported query.")})},t.prototype.shouldRetry=function(e,r){if(!this.geocodeRetryOptions)return!1;var n=this.geocodeRetryOptions,a=n.maxRetryAttempts;return n.retryOnStatusCodes.includes(e)&&r<a},t}(),da={};function Nt(t){return{class:t,selector:"."+t}}Nt("tooltip-container"),Nt("tooltip-content"),Nt("arrow"),Nt("hide-arrow"),Nt("small-touch-screen"),Nt("large-touch-screen"),Nt("truncate-tooltip-height"),Nt("new-mobile-tooltip"),Nt("heightened-header"),Nt("themeableElement"),Nt("tooltip-light");var ms=function(){function t(){}return t.highlightedValueDisplayNameResorceKey="Tooltip_HighlightedValueDisplayName",t}();function ti(t){return u.assertValue(t,"instances"),0===t.length?[]:_.map(t,AU)}function DU(t,e){return u.assertValue(t,"containers"),_.map(t,function(r){return{displayName:Ir(r.displayName,e)}})}function AU(t){return{objectName:t.objectName,displayName:t.displayName,properties:IU(t.properties),selector:$n(t.selector),altConstantValueSelector:$n(t.altConstantValueSelector),validValues:t.validValues,containerIdx:t.containerIdx,propertyInstanceKind:t.propertyInstanceKind}}function IU(t){var e={};for(var r in t)e[r]=PU(t[r]);return e}function PU(t){return t instanceof Qe?Q.serializeFilter(t):void 0===t?null:t}var LU=function(){function t(e,r,n){this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.acquireAADToken=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"acquireAADToken",arguments:[e.id]}),e.deferred.promise},t.prototype.getAcquireAADTokenStatus=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getAcquireAADTokenStatus",arguments:[e.id]}),e.deferred.promise},t}(),UU=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.getResourceUrl=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getResourceUrl",arguments:[e.id]}),e.deferred.promise},t.prototype.getAADAuthenticationToken=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getAADAuthenticationToken",arguments:[e.id]}),e.deferred.promise},t.prototype.getAADToken=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getAADToken",arguments:[e.id]}),e.deferred.promise},t.prototype.getWACToken=function(e,r){var n=this.sandboxPromiseHandler.CreatePromise2(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getWACToken",arguments:[{resourceEtag:r,resourceSiteUrl:e,promiseId:n.id}]}),n.deferred.promise},t.prototype.getSignedInAccessToken=function(){return this.promiseFactory.reject()},t.prototype.getClusterInfo=function(){return this.promiseFactory.reject()},t}(),zU=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.downloadFile=function(e,r,n,i){throw new Error("Not implemented")},t.prototype.getExportStatus=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"exportVisualsContentStatus",arguments:[e.id]}),e.deferred.promise},t.prototype.exportVisualsContent=function(e,r,n,i){var a=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return e&&r&&n&&i?this.messageProxy.postMessage({eventName:"exportVisualsContent",arguments:[e,r,n,i,a.id]}):a.deferred.reject(),a.deferred.promise},t}(),HU=function(){function t(e,r){this.messageProxy=e,this.instanceId=r,u.assertValue(e,"messageProxy")}return t.prototype.renderingStarted=function(e){this.messageProxy.postMessage({eventName:"renderingStarted",arguments:[this.instanceId,e.updateId]})},t.prototype.renderingFinished=function(e){this.messageProxy.postMessage({eventName:"renderingFinished",arguments:[this.instanceId,e.updateId]})},t.prototype.renderingFailed=function(e,r){this.messageProxy.postMessage({eventName:"renderingFailed",arguments:[this.instanceId,e.updateId,r]})},t}(),QU=function(){function t(e,r,n){this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n,u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory")}return t.prototype.getAvailableServicePlans=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getAvailableServicePlans",arguments:[e.id]}),e.deferred.promise},t.prototype.notifyLicenseRequired=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"notifyLicenseRequired",arguments:[e,r.id]}),r.deferred.promise},t.prototype.notifyFeatureBlocked=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"notifyFeatureBlocked",arguments:[e,r.id]}),r.deferred.promise},t.prototype.clearLicenseNotification=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"clearLicenseNotification",arguments:[e.id]}),e.deferred.promise},t}(),jU=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.getStorageStatus=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getStorageStatus",arguments:[e.id]}),e.deferred.promise},t.prototype.getStorageData=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getStorageData",arguments:[e,r.id]}),r.deferred.promise},t.prototype.setStorageData=function(e,r){var n=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"setStorageData",arguments:[e,r,n.id]}),n.deferred.promise},t.prototype.removeStorageData=function(e){this.messageProxy.postMessage({eventName:"removeStorageData",arguments:[e]})},t}(),JU=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.getStorageStatus=function(){var e=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getStorageV2Status",arguments:[e.id]}),e.deferred.promise},t.prototype.getStorageData=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getStorageV2Data",arguments:[e,r.id]}),r.deferred.promise},t.prototype.setStorageData=function(e,r){var n=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"setStorageV2Data",arguments:[e,r,n.id]}),n.deferred.promise},t.prototype.removeStorageData=function(e){this.messageProxy.postMessage({eventName:"removeStorageV2Data",arguments:[e]})},t}(),$U=function(){function t(e,r){this.messageProxy=e,u.assertValue(e,"messageProxy"),this.instanceId=r}return t.prototype.trace=function(e,r){this.messageProxy.postMessageAsync({eventName:"logVisualEvent",arguments:[BV(e),{instanceId:this.instanceId,payload:r}]})},t.prototype.logStandardizedFeatureEvent=function(){},t}(),ZU=function(){function t(e){u.assertValue(e,"messageProxy"),this.messageProxy=e,this.rootElement=window.document.body}return t.prototype.serializeIdentities=function(e){return e&&e[0]instanceof oe?e:e&&_(e).map(function(n){return Wo(n)}).compact().value()},t.prototype.show=function(e){var r=e&&{coordinates:e.coordinates,dataItems:e.dataItems,identities:this.serializeIdentities(e.identities),isTouchEvent:e.isTouchEvent};this.messageProxy.postMessage({eventName:"showTooltip",arguments:[r]})},t.prototype.move=function(e){var r=e&&{coordinates:e.coordinates,dataItems:e.dataItems,identities:this.serializeIdentities(e.identities),isTouchEvent:e.isTouchEvent};this.messageProxy.postMessage({eventName:"moveTooltip",arguments:[r]})},t.prototype.hide=function(e){this.messageProxy.postMessage({eventName:"hideTooltip",arguments:[e]})},t.prototype.visible=function(){return!1},t.prototype.isTouchOptimized=function(){return!1},t.prototype.container=function(){return this.rootElement},t.prototype.enabled=function(){return!0},t}(),tO=function(){function t(e,r,n){u.assertValue(e,"messageProxy"),u.assertValue(r,"promiseFactory"),this.messageProxy=e,this.promiseFactory=r,this.sandboxPromiseHandler=n}return t.prototype.getWebAccessStatus=function(e){var r=this.sandboxPromiseHandler.CreatePromise(this.promiseFactory.defer());return this.messageProxy.postMessage({eventName:"getWebAccessStatus",arguments:[e,r.id]}),r.deferred.promise},t}(),nO=function(){function t(e){u.assertValue(e,"messageProxy"),this.messageProxy=e}return t.prototype.subSelect=function(e){e&&this.messageProxy.postMessage({eventName:"subSelect",arguments:[e]})},t.prototype.updateRegionOutlines=function(e){e&&this.messageProxy.postMessage({eventName:"updateRegionOutlines",arguments:[e]})},t}(),iO={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},rt={NullValue:"(Blank)",BooleanTrue:"True",BooleanFalse:"False",NaNValue:"NaN",InfinityValue:"+Infinity",NegativeInfinityValue:"-Infinity",Restatement_Comma:"{0}, {1}",Restatement_CompoundAnd:"{0} and {1}",DisplayUnitSystem_EAuto_Title:"Auto",DisplayUnitSystem_E0_Title:"None",DisplayUnitSystem_E3_LabelFormat:"{0}K",DisplayUnitSystem_E3_Title:"Thousands",DisplayUnitSystem_E6_LabelFormat:"{0}M",DisplayUnitSystem_E6_Title:"Millions",DisplayUnitSystem_E9_LabelFormat:"{0}bn",DisplayUnitSystem_E9_Title:"Billions",DisplayUnitSystem_E12_LabelFormat:"{0}T",DisplayUnitSystem_E12_Title:"Trillions",Percentage:"#,0.##%",Percentage1:"#,0.#%",TableTotalLabel:"Total",Tooltip_HighlightedValueDisplayName:"Highlighted",Decrease:"Decrease",Increase:"Increase",Waterfall_TotalLabel:"Total",GeotaggingString_Continent:"continent",GeotaggingString_Continents:"continents",GeotaggingString_Country:"country",GeotaggingString_Countries:"countries",GeotaggingString_State:"state",GeotaggingString_States:"states",GeotaggingString_City:"city",GeotaggingString_Cities:"cities",GeotaggingString_Town:"town",GeotaggingString_Towns:"towns",GeotaggingString_Province:"province",GeotaggingString_Provinces:"provinces",GeotaggingString_County:"county",GeotaggingString_Counties:"counties",GeotaggingString_Village:"village",GeotaggingString_Villages:"villages",GeotaggingString_Post:"post",GeotaggingString_Zip:"zip",GeotaggingString_Code:"code",GeotaggingString_Place:"place",GeotaggingString_Places:"places",GeotaggingString_Address:"address",GeotaggingString_Addresses:"addresses",GeotaggingString_Street:"street",GeotaggingString_Streets:"streets",GeotaggingString_Longitude:"longitude",GeotaggingString_Longitude_Short:"lon",GeotaggingString_Longitude_Short2:"long",GeotaggingString_Latitude:"latitude",GeotaggingString_Latitude_Short:"lat",GeotaggingString_PostalCode:"postal code",GeotaggingString_PostalCodes:"postal codes",GeotaggingString_ZipCode:"zip code",GeotaggingString_ZipCodes:"zip codes",GeotaggingString_Territory:"territory",GeotaggingString_Territories:"territories"},qS=function(){function t(e,r){this.messageProxy=e,this.sandboxPromiseHandler=r,this.loadMoreDataEnabled=!0,u.assertValue(e,"messageProxy"),this.visualHostTooltipService=function(t){return new ZU(t)}(e),this.queryDictionary=t.parseUrlParameters(),this.authService=function(t,e,r){return new UU(t,e,r)}(e,this.promiseFactory(),r),this.storageService=function(t,e,r){return new jU(t,e,r)}(e,this.promiseFactory(),r),this.hostWebAccessService=function(t,e,r){return new tO(t,e,r)}(e,this.promiseFactory(),r),this.contentDownloadService=function(t,e,r){return new zU(t,e,r)}(e,this.promiseFactory(),r),this.licensesManagerService=function(t,e,r){return new QU(t,e,r)}(e,this.promiseFactory(),r),this.acquireTokenService=function(t,e,r){return new LU(t,e,r)}(e,this.promiseFactory(),r),this.storageV2Service=function(t,e,r){return new JU(t,e,r)}(e,this.promiseFactory(),r),this.hostSubSelectionService=function(t){return new nO(t)}(e),this.dialogPromiseFactory=this.promiseFactory()}return t.prototype.initInstanceId=function(e){this._instanceId=e,this.telemetryService=function(t,e){return new $U(t,e)}(this.messageProxy,e),this.eventsService=function(t,e){return new HU(t,e)}(this.messageProxy,e)},t.initialize=function(){ms&&(ms.localizationOptions=t.createTooltipLocaleOptions())},t.createLocaleOptions=function(){return{null:rt.NullValue,true:rt.BooleanTrue,false:rt.BooleanFalse,NaN:rt.NaNValue,infinity:rt.InfinityValue,negativeInfinity:rt.NegativeInfinityValue,beautify:function(r){return t.beautify(r)},describe:function(r){return t.describeUnit(r)},restatementComma:rt.Restatement_Comma,restatementCompoundAnd:rt.Restatement_CompoundAnd,restatementCompoundOr:rt.Restatement_CompoundOr}},t.createTooltipLocaleOptions=function(){return{highlightedValueDisplayName:rt.Tooltip_HighlightedValueDisplayName}},t.prototype.getLocalizedString=function(e){return rt[e]},t.prototype.onSelecting=function(e){e.action=0},t.prototype.onSelect=function(e){var r;if(function(t){var r=null!=t.data||null!=t.selectors,n=_.some(t.visualObjects,function(i){return i.selectorsByColumn&&i.selectorsByColumn.metadata&&!_.isArray(i.selectorsByColumn.metadata)});return r||n}(e)){var n=e;r={data:Ty(n.data),data2:Wo(n.data2),selectors:Ty(n.selectors)}}else r={type:e.type,visualObjects:cN(e.visualObjects)};this.messageProxy.postMessage({eventName:"onSelect",arguments:[r]})},t.prototype.customVisualOnContextMenu=function(e){this.messageProxy.postMessage({eventName:"onCustomVisualContextMenu",arguments:[e]})},t.prototype.customVisualOnExpandCollapse=function(e){this.messageProxy.postMessage({eventName:"onCustomVisualExpandCollapse",arguments:[e]})},t.prototype.switchFocusModeState=function(e){this.messageProxy.postMessage({eventName:"onSwitchFocusModeState",arguments:[e]})},t.prototype.displayWarningIcon=function(e,r){null!=e&&null!=r&&this.messageProxy.postMessage({eventName:"onDisplayWarningIcon",arguments:[e,r]})},t.prototype.persistProperties=function(e){var r,n=e;r=this.apiVersion&&(sn(this.apiVersion,"2.0.0")||rh(this.apiVersion,"2.0.0"))?e:n.merge||n.remove||n.replace?{merge:n.merge?ti(n.merge):null,replace:n.replace?ti(n.replace):null,remove:n.remove?ti(n.remove):null}:ti(e),this.messageProxy.postMessage({eventName:"persistProperties",arguments:[r]})},t.prototype.sendSelectionIdsToHost=function(e){this.messageProxy.postMessage({eventName:"transformCvSelectionIdsAndSelect",arguments:[e]})},t.prototype.loadMoreData=function(){this.fetchMoreData(!0)},t.prototype.loadWindow=function(e){},t.prototype.fetchMoreData=function(e){return!!this.loadMoreDataEnabled&&(!1!==e&&(e=!0),this.messageProxy.postMessage({eventName:"loadMoreData",arguments:[e]}),!0)},t.prototype.launchUrl=function(e){this.messageProxy.postMessage({eventName:"launchUrl",arguments:[e]})},t.prototype.setCanDrill=function(e){this.messageProxy.postMessage({eventName:"setCanDrill",arguments:[e]})},t.prototype.drill=function(e){this.messageProxy.postMessage({eventName:"drill",arguments:[e]})},t.prototype.openModalDialog=function(e,r,n){var i=this.sandboxPromiseHandler.CreatePromise(this.dialogPromiseFactory.defer());return this.messageProxy.postMessage({eventName:"openModalDialog",arguments:[e,r,n,i.id]}),i.deferred.promise},t.prototype.tooltips=function(){return this.visualHostTooltipService},t.prototype.telemetry=function(){return this.telemetryService},t.prototype.authenticationService=function(){return this.authService},t.prototype.localStorageService=function(){return this.storageService},t.prototype.localStorageV2Service=function(){return this.storageV2Service},t.prototype.eventService=function(){return this.eventsService},t.prototype.licenseManagerService=function(){return this.licensesManagerService},t.prototype.acquireAADTokenService=function(){return this.acquireTokenService},t.prototype.visualTimeSynchronization=function(){return this.visualTimeSynchronizationService},t.prototype.networkAvailability=function(){return this.networkAvailabilityService},t.prototype.webAccessService=function(){return this.hostWebAccessService},t.prototype.visualHostSubSelectionService=function(){return this.hostSubSelectionService},t.prototype.getSectionsMetadata$=function(){},t.prototype.getBookmarksMetadata$=function(){},t.prototype.downloadService=function(){return this.contentDownloadService},t.prototype.artifactService=function(){},t.prototype.getQueryStringValue=function(e){return this.queryDictionary&&this.queryDictionary[e]},t.prototype.locale=function(){var e=this.queryDictionary&&this.queryDictionary.locale;return u.assert(function(){return!!e},"custom visual locale parameter is not valid"),e||navigator.language},t.prototype.loader=function(){var e=this;return{require:function(){return e.promiseFactory().reject()}}},t.prototype.applyJsonFilter=function(e,r,n,i){var a=[e,r,n];return i&&a.push(i),this.messageProxy.postMessage({eventName:"applyJsonFilter",arguments:a}),!0},t.prototype.applyIdentityFilter=function(e,r,n,i){var a=[e,r,n];return i&&a.push(i),this.messageProxy.postMessage({eventName:"applyIdentityFilter",arguments:a}),!0},t.prototype.getJSONFilter=function(e,r){return this.promiseFactory().reject()},t.parseUrlParameters=function(e){void 0===e&&(e=window.location.search);var r={},n=e;if(n&&"?"===n.substr(0,1))for(var a=0,o=n.substr(1).split("&");a<o.length;a++){var s=o[a],l=s&&s.split("=");l&&2===l.length&&(r[decodeURIComponent(l[0])]=decodeURIComponent(l[1]))}return r},t.prototype.destroy=function(){this.messageProxy.destroy(),this.messageProxy=null},t.prototype.refreshHostData=function(){this.messageProxy.postMessage({eventName:"refreshHostData",arguments:null})},t.prototype.createSelectionIdBuilder=function(){return new oe},t.prototype.createTooltipService=function(){return lt({hostServices:this})},t.prototype.createSelectionManager=function(e){return new ze({hostServices:this,apiVersion:e})},t.prototype.applyCustomSort=function(e){this.messageProxy.postMessage({eventName:"applyCustomSort",arguments:[e]})},t.prototype.alertScreenReader=function(e){},t.prototype.alertWithDebounce=function(e,r){},t.prototype.requestFocus=function(){},t.prototype.setShouldDeferData=function(){},t.prototype.onDragStart=function(){},t.prototype.onContextMenu=function(){},t.prototype.onSwitchFocusModeState=function(){},t.prototype.onDisplayWarningIcon=function(){},t.prototype.onClearCustomizedWarningIcon=function(){},t.prototype.getVisualLinkProperties=function(){},t.prototype.canSelect=function(){return!1},t.prototype.canExpandCollapse=function(e){return!1},t.prototype.setNodeExpansionState=function(e){},t.prototype.setLevelExpansionState=function(e){},t.prototype.onCustomSort=function(e){},t.prototype.getViewMode=function(){return 0},t.prototype.getEditMode=function(){return 0},t.prototype.setWarnings=function(e){},t.prototype.getWarnings$=function(){},t.prototype.setToolbar=function(e){},t.prototype.shouldRetainSelection=function(){return!1},t.prototype.geocoder=function(){return new EU},t.prototype.geolocation=function(){u.assertFail("Not being used anywhere")},t.prototype.promiseFactory=function(){return Ni()},t.prototype.ignoreDefaultFilter=function(){return!1},t.prototype.getIdentityDisplayNames=function(e){},t.prototype.setIdentityDisplayNames=function(e){},t.prototype.setFilterExpressionMetadata=function(){},t.prototype.getFilterExpressionMetadata=function(){},t.prototype.getUIComponentFactory=function(){},t.prototype.onHyperlinkClick=function(e,r){},t.prototype.isVisualEnabled=function(){return this.promiseFactory().resolve(!0)},t.prototype.dataMultiSelectMode=function(){return 0},t.prototype.dropdown=function(){},t.prototype.setAriaMetadata=function(e){},t.prototype.onNotifyLicense=function(e){},t.prototype.onClearLicenseNotification=function(){},t.prototype.onNotifyFeatureBlocked=function(e){},t.prototype.getSubSelectionService=function(){},t.prototype.getAzureMapToken=function(){},t.prototype.azureMapsEndpoint=function(){},t.prototype.geocoderIndexedDB=function(){},t.prototype.triggerUpdate=function(){},t.prototype.isScreenshotWorkload=function(){return!1},t.prototype.dateTimeFormatService=function(){},t.prototype.visualExportService=function(){},Object.defineProperty(t.prototype,"instanceId",{get:function(){return this._instanceId},enumerable:!1,configurable:!0}),t.beautify=function(e){var r=iO[e];return r&&rt[r]||e},t.describeUnit=function(e){var r=-1===e?"Auto":e.toString(),n=rt["DisplayUnitSystem_E"+r+"_Title"],i=e<=0?"{0}":rt["DisplayUnitSystem_E"+r+"_LabelFormat"];if(n||i)return{title:n,format:i}},t.prototype.enableLoadMoreData=function(e){this.loadMoreDataEnabled=e},t}();function sO(t){var e={selector:$n(t.selector),altStaticSelector:$n(t.altStaticSelector),objects:t.objects};return void 0!==t.allowOverrideSubtotalMatching&&(e.allowOverrideSubtotalMatching=t.allowOverrideSubtotalMatching),e}var lO=function(t){return t.Click="click",t.MouseUp="mouseup",t.MSPointerUp="MSPointerUp",t.PointerUp="pointerup",t.Dblclick="dblclick",t}({}),cO=function(t){return t.Tap="tap",t.TouchCancel="touchcancel",t.Touchend="touchend",t}({}),fO=function(t){return t.KeyDown="keydown",t}({}),dO=function(t){return t.KeyDown="keydown",t}({}),HS=Object.values(lO),GS=Object.values(cO),hf=Object.values(fO),vf=HS.concat(GS),gf=Object.values(dO),yf=["type","bubbles","which","buttons","button","ctrlKey","altKey","metaKey","shiftKey","x","y","clientX","clientY","pageX","pageY","movementX","movementY","layerX","layerY","changedTouches","keyCode","code","key","cancelable","composed"],pO={Escape:[]},hO={Escape:[],y:["ctrlKey"],z:["ctrlKey"]},QS=function(){function t(e){this.id=++t.counter,this.deferred=e}return t.getLastId=function(){return t.counter},t.counter=0,t}(),WS=function(){function t(e){this.id=++t.counter,this.deferred=e}return t.getLastId=function(){return t.counter},t.counter=0,t}(),jS=function(){function t(){this.promises={},this.promises2={}}return t.prototype.CreatePromise=function(e){var r=new QS(e);return this.promises[r.id]=r,r},t.prototype.ResolvePromise=function(e,r){var n=this.promises[e];n&&(n.deferred.resolve(r),this.promises[e]=null)},t.prototype.RejectPromise=function(e,r){var n=this.promises[e];n&&(n.deferred.reject(r),this.promises[e]=null)},t.prototype.CreatePromise2=function(e){var r=new WS(e);return this.promises2[r.id]=r,r},t.prototype.ResolvePromise2=function(e,r){var n=this.promises2[e];n&&(n.deferred.resolve(r),this.promises2[e]=null)},t.prototype.RejectPromise2=function(e,r){var n=this.promises2[e];n&&(n.deferred.reject(r),this.promises2[e]=null)},t}();function ri(){return window.powerbi.visuals.plugins}function KS(t){var r=JSON.stringify({eventName:"onSecurityPolicyViolation",arguments:[t.blockedURI,t.violatedDirective,t.originalPolicy]});window.parent.postMessage(r,"*")}function JS(t,e){void 0===e&&(e=!1);var r=Ni(),n=Hm(r);qS.initialize(),go.getQueryStringValue("pbiglobals")&&function(){var t=ba();t.FilterAction=X2,t.VisualDataRoleKind=at,t.VisualDataChangeOperationKind=dr,t.VisualUpdateType=_t,t.VisualPermissions=ab,t.formattingService=Ge;var e=function(){var t=ts();return t.data||(t.data={}),t.data}();je&&(e.SQExprBuilder={},e.SQExprBuilder.entity=je,e.SQExprBuilder.subqueryRef=rn,e.SQExprBuilder.namedQueryRef=lp,e.SQExprBuilder.columnRef=Re,e.SQExprBuilder.measureRef=mu,e.SQExprBuilder.nativeMeasure=cp,e.SQExprBuilder.nativeColumn=fp,e.SQExprBuilder.aggregate=Xt,e.SQExprBuilder.selectRef=wi,e.SQExprBuilder.percentile=Su,e.SQExprBuilder.rangePercent=dp,e.SQExprBuilder.arithmetic=Vi,e.SQExprBuilder.floor=pp,e.SQExprBuilder.scopedEval=Ka,e.SQExprBuilder.filteredEval=bu,e.SQExprBuilder.withRef=hp,e.SQExprBuilder.groupRef=Ja,e.SQExprBuilder.hierarchy=Mi,e.SQExprBuilder.propertyVariationSource=Ya,e.SQExprBuilder.hierarchyLevel=$a,e.SQExprBuilder.transformTableRef=Eu,e.SQExprBuilder.transformOutputRoleRef=Cu,e.SQExprBuilder.roleRef=wu,e.SQExprBuilder.summaryValueRef=vp,e.SQExprBuilder.allRolesRef=gp,e.SQExprBuilder.and=st,e.SQExprBuilder.between=wr,e.SQExprBuilder.inValues=nn,e.SQExprBuilder.inTable=Vu,e.SQExprBuilder.or=xi,e.SQExprBuilder.compare=Rn,e.SQExprBuilder.conditional=Mu,e.SQExprBuilder.contains=yp,e.SQExprBuilder.exists=mp,e.SQExprBuilder.equal=Nn,e.SQExprBuilder.not=Xa,e.SQExprBuilder.startsWith=Sp,e.SQExprBuilder.nullConstant=Lt,e.SQExprBuilder.emptyString=$0,e.SQExprBuilder.now=xu,e.SQExprBuilder.defaultValue=Za,e.SQExprBuilder.anyValue=Di,e.SQExprBuilder.boolean=Zt,e.SQExprBuilder.dateAdd=St,e.SQExprBuilder.dateTime=er,e.SQExprBuilder.dateSpan=bt,e.SQExprBuilder.decimal=eo,e.SQExprBuilder.double=an,e.SQExprBuilder.integer=kn,e.SQExprBuilder.text=Ce,e.SQExprBuilder.typedConstant=on,e.SQExprBuilder.fromRawValue=Ai,e.SQExprBuilder.sparklineData=Du,e.SQExprBuilder.setAggregate=U2,e.SQExprBuilder.removeAggregate=Q2,e.SQExprBuilder.setPercentOfGrandTotal=L2,e.SQExprBuilder.removePercentOfGrandTotal=H2,e.SQExprBuilder.setPercentOfRoleTotal=K2,e.SQExprBuilder.removePercentOfRoleTotal=z2,e.SQExprBuilder.removeEntityVariables=X0,e.SQExprBuilder.setVisualCalcExpression=Z0,e.SQExprBuilder.fillRule=bp,e.SQExprBuilder.themeDataColor=Au,e.SQExprBuilder.resourcePackageItem=Ep,e.SQExprBuilder.discretize=Cp,e.SQExprBuilder.member=wp,e.SQExprBuilder.color=ew,e.SQExprBuilder.nativeVisualCalc=_u,e.SQExprBuilder.fieldExpr=be,e.SQExprBuilder.fromColumnAggr=jm,e.SQExprBuilder.fromColumn=rf,e.SQExprBuilder.fromGroupingColumnAggr=Km,e.SQExprBuilder.fromGroupingColumn=Jm,e.SQExprBuilder.fromEntity=cr,e.SQExprBuilder.fromEntityAggr=Ym,e.SQExprBuilder.fromColumnHierarchyVariation=$m,e.SQExprBuilder.fromColumnHierarchyLevelVariation=Xm,e.SQExprBuilder.fromColumnSubquery=Zm,e.SQExprBuilder.fromColumnAggrSubquery=eS,e.SQExprBuilder.fromColumnTransformRef=tS,e.SQExprBuilder.fromHierarchyLevelAggr=rS,e.SQExprBuilder.fromHierarchyLevel=nf,e.SQExprBuilder.fromHierarchy=af,e.SQExprBuilder.fromArithmetic=nS,e.SQExprBuilder.fromConstant=iS,e.SQExprBuilder.fromSparklineData=aS,e.SQExprBuilder.fromNativeVisualCalc=oS),e.Selector={},e.Selector.AllEncompasingKey="{}",e.Selector.isScopeIdentity=Bt,e.Selector.isScopeWildcard=Mr,e.Selector.isScopeTotal=tr,e.Selector.isRoleWildcard=rr,e.Selector.isWildcard=xr,e.Selector.isWildcardSelector=Bn,e.Selector.toScopeIdentities=Rp,e.Selector.getScopeIdentities=Cw,e.Selector.filterFromSelector=Ru,e.Selector.filterFromSelectorsByColumn=ww,e.Selector.filterExprsFromSelectors=Np,e.Selector.hasIdentities=Vw,e.Selector.equals=Ct,e.Selector.equalsDataArray=kp,e.Selector.equalsSelectorsByColumn=Lp,e.Selector.equalsSelectorsByColumnArray=Mw,e.Selector.equalsData=Nu,e.Selector.getKey=Bp,e.Selector.getDecomposedKeys=ku,e.Selector.containsWildcard=ro,e.Selector.hasRoleWildcard=no,e.Selector.convertSelectorsByColumnToSelector=Dr,e.Selector.getSelectorTargetExpr=nr,e.Selector.normalizeSelector=xw,e.Selector.clone=Dw,e.SQCompareExpr=gu,e.createDataViewScopeIdentity=Et,e.createDisplayNameGetter=QD,e.DataViewObjectDefinitions={},e.DataViewObjectDefinitions.allPropertiesAreEqual=QI,e.DataViewObjectDefinitions.clone=jI,e.DataViewObjectDefinitions.cloneDefinitions=Dg,e.DataViewObjectDefinitions.deleteObjectDefinition=LI,e.DataViewObjectDefinitions.deleteProperties=BI,e.DataViewObjectDefinitions.deleteProperty=nc,e.DataViewObjectDefinitions.encodePropertyValue=ac,e.DataViewObjectDefinitions.ensure=rc,e.DataViewObjectDefinitions.extend=UI,e.DataViewObjectDefinitions.getDataBoundExprs=I2,e.DataViewObjectDefinitions.getDataBoundExprsAndValueRef=T2,e.DataViewObjectDefinitions.getObjectDefinition=Mg,e.DataViewObjectDefinitions.getObjectDefinitions=ji,e.DataViewObjectDefinitions.getPropertyContainer=Vg,e.DataViewObjectDefinitions.getUnequalProperties=WI,e.DataViewObjectDefinitions.getValue=ic,e.DataViewObjectDefinitions.getValueFormatting=GI,e.DataViewObjectDefinitions.isEmpty=KI,e.DataViewObjectDefinitions.isObjectPropertySQExpr=oc,e.DataViewObjectDefinitions.isObjectPropertySQExprWithContext=Ro,e.DataViewObjectDefinitions.isPropertyDefinition=YI,e.DataViewObjectDefinitions.moveProperty=OI,e.DataViewObjectDefinitions.propertiesAreEqual=Fo,e.DataViewObjectDefinitions.reduce=ZI,e.DataViewObjectDefinitions.setValue=Wi,e.DataViewObjectDefinitions.setValueFormatting=HI,e.DataViewObjectDefinitions.updateSelector=kI,e.DataViewObjectDefinitions.visitPropertyDefinitions=$I,e.DataViewObjectDefinitions.visitPropertyExprs=XI;var r=function(){var t=ts();return t.extensibility||(t.extensibility={}),t.extensibility}();r.createColorPalette=Mt,r.createExtendedColorPalette=se,r.getVisualApiVersions=Qn,r.visualApiVersions=Qn();var n=Ea();n.buildValueDetailsForColumnValue=On,n.SelectionId=uo,n.SelectionIdBuilder=tt;var i=function(){var t=Ea();return t.valueFormatter||(t.valueFormatter={}),t.valueFormatter}();i.beautifyTrace=Kp,i.allowFormatBeautificationTraced=zu,i.getLocalizedString=tV,i.getFormatMetadata=sV,i.setLocaleOptions=uV,i.createDefaultFormatter=Jp,i.create=lV,i.format=qu,i.formatVariantMeasureValueWithDataPointObjects=cV,i.createDisplayUnitSystem=Yp,i.getDisplayUnits=fV,i.getFormatString=so,i.getDefaultFormatString=$p,i.getLabelPrecision=hV,i.getFormatStringWithDataPointObjects=Xp,i.formatListAnd=vV,i.formatListOr=gV}(),Ea().plugins={},nB();var a={promiseFactory:r},o=function(t){return new o_(t)}(n),s=function(t){return new t_(t)}(n),l=new jS,c=function(t,e){return u.assertValue(t,"messageProxy"),new qS(t,e)}(n,l),p={$element:t,hostServices:c,hostServicesControl:c,dataProxy:gO(r),promiseFactory:r,messageProxy:n,resourceLoader:$A(a,null),resourceProvider:{get:function(g){return g},getOptional:function(g){return g},format:function(g){return g}},telemetryProxyService:o,certifiedEventsProxyService:s,instanceId:"",sandboxPromiseHandler:l},h=c.getQueryStringValue("cspiframe");return n.contentWindow=h?window.parent.parent:window.parent,new $S(p,e)}function gO(t){var e=new u_,n={promiseFactory:function(){return t}},i=function(t,e){return new ND(t,e)}(function(t,e){return new TD(t,{})}({dsr:{name:"dsr",reader:function(o){return new o2(o,{execute:function(){return t.reject()}},e,{dsrV2:!1},null,void 0,void 0)}}}),n);return function(t,e,r){return new V_(t,e,r)}(t,i,e)}function YS(t,e,r){var a,n=t.content,i=t.hasBeenInjected||ri()&&ri().hasOwnProperty(t.name)&&ri()[t.name].hasBeenInjected;return(!e||!i)&&(Eo(t.name,n.js,r,t.apiVersion),Co(t.name,n.css)),!t.apiVersion||_r(t.apiVersion,{major:3,minor:0,patch:0})?(u.assertValue(ri()[t.name],"Visual does not have a plugin"),a=ri()[t.name]):(u.assertValue(window[t.name],"Visual does not have a plugin"),a=window[t.name].default),t.apiVersion&&(a.iconUrl=t.iconUrl,a.capabilities=t.capabilities,a.localizationResources=t.localizationResources,a.isDeprecated=t.isDeprecated,a.version=t.version),e&&(a.hasBeenInjected=!0,a.approvedForNoIframe=!0,ri()[t.name]=a),a}var $S=function(){function t(e,r){void 0===r&&(r=!1);var n=this;this.isolate=r,this.isVisualInitialized=!1,this.messageQueue=[],this.formatMode=!1,this.relayUIEventListener=function(i){var a=_.pick(i.originalEvent,yf);n.messageProxy.postMessage({eventName:"onRelayUIEvent",arguments:[a]})},this.relayKeyboardEventListener=function(i){var a=_.pick(i.originalEvent,yf);n.isSupportedKeyBoardEvent(i.originalEvent)&&n.messageProxy.postMessage({eventName:"onRelayUIEvent",arguments:[a]})},this.container=e.$element,this.hostServices=e.hostServices,this.hostServicesControl=e.hostServicesControl,this.dataProxy=e.dataProxy,this.promiseFactory=e.promiseFactory,this.messageProxy=e.messageProxy,this.resourceLoader=e.resourceLoader,this.resourceProvider=e.resourceProvider,this.telemetryProxyService=e.telemetryProxyService,this.certifiedEventsProxyService=e.certifiedEventsProxyService,this.sandboxPromiseHandler=e.sandboxPromiseHandler,this.aggregatedDataViewSize=0,this.dataViewSerializer=new pB,this.skipRedundantResize=!1,this.hostOrigin=new URL(window.location.href).origin,this.messageProxy.on(ef,function(i){return n.onMessageReceived(i)})}return Object.defineProperty(t.prototype,"visual",{get:function(){return this._visual},enumerable:!1,configurable:!0}),t.prototype.init=function(e){this.hostServices.initInstanceId(e.instanceId),this.hostServicesControl.initInstanceId(e.instanceId),this.style=function(t){return{colorPalette:RN(t.colorPalette),isHighContrast:t.isHighContrast,icons:t.icons}}(e.style);var r={animation:e.animation,element:this.container,host:this.hostServices,interactivity:e.interactivity,style:this.style,viewport:e.viewport,localizationResources:this.plugin.localizationResources,hostEnv:e.hostEnv,dataMultiSelectMode:e.dataMultiSelectMode};return this.featureSwitches=e.featureSwitches,this.skipRedundantResize=this.featureSwitches&&this.featureSwitches.cvSkipExtraResize,this.attachRelayUIEventListener(),this.attachWindowResizeListener(),this.visual.init(r)},t.prototype.destroy=function(){this.detachRelayUIEventListener(),this.detachWindowResizeListener(),this.detachFormatModeRelayUIEventListener(),this.messageProxy.off(ef),this.messageProxy.destroy(),this.visual&&this.visual.destroy&&this.visual.destroy()},t.prototype.categoriesExists=function(e){return!!(e&&e.dataViews&&e.dataViews.length>0&&e.dataViews[0].categorical&&e.dataViews[0].categorical.categories&&e.dataViews[0].categorical.categories.length>0&&e.dataViews[0].categorical.categories[0]&&e.dataViews[0].categorical.categories[0].values)},t.prototype.getHostCategoriesValues=function(e,r,n){try{if(e){if(n)for(var i=0;i<e.length;i++)e[i]&&(e[i]=new Date(e[i]));r.dataViews[0].categorical.categories[0].values=e}}catch(a){this.sendError(a)}return r},t.prototype.update=function(e){var i,r=this,n=e.message.arguments[0];if(this.formatMode!==!!n.formatMode&&(this.formatMode=n.formatMode,this.handleAttachingEventListeners()),this.plugin&&this.plugin.apiVersion&&!_r(this.plugin.apiVersion,"2.0.0")){this.stringifiedDataView=n.serializedDataView?n.serializedDataView.stringifiedDataView:null;var a=!(!this.plugin.capabilities.expandCollapse||!this.plugin.capabilities.dataViewMappings[0].matrix),o=n.serializedDataView?[this.dataViewSerializer.deserializeDataView(n.serializedDataView,sn(this.plugin.apiVersion,"3.5.9"),a,[],th(this.plugin.apiVersion,"5.3.0"))]:[];this.formatMode&&this.reCreateSelectionIds(n.subSelections);var s=this.lastVisualUpdateOptions={dataViews:o,suppressAnimations:n.suppressAnimations,viewMode:n.viewMode,editMode:n.editMode,viewport:n.viewport,type:n.type,operationKind:dr.Create,resizeMode:n.resizeMode,isInFocus:n.isInFocus,jsonFilters:n.jsonFilters?n.jsonFilters:null,updateId:n.updateId,formatMode:n.formatMode,subSelections:n.subSelections};this.plugin&&this.plugin.apiVersion&&!_r(this.plugin.apiVersion,"3.5.0")?(this.onRestoreCvSelectionIds(n.selections,!sn(this.plugin.apiVersion,"2.4.0")),this.fixUpdateOptionsAndUpdateVisual(s,e,n)):(this.fixUpdateOptionsAndUpdateVisual(s,e,n),this.onRestoreCvSelectionIds(n.selections,!sn(this.plugin.apiVersion,"2.4.0")))}else n.dataTransforms&&(i=qy.deserializeDataViewTransformActions(n.dataTransforms,this.plugin.capabilities||{})),this.transformDataViewSource(n.dataViewSource,i,!0).then(function(l){var c=r.lastVisualUpdateOptions={dataViews:l.dataViews,suppressAnimations:n.suppressAnimations,viewMode:n.viewMode,editMode:n.editMode,viewport:n.viewport,type:n.type,operationKind:dr.Create,resizeMode:n.resizeMode,isInFocus:n.isInFocus,jsonFilters:n.jsonFilters?n.jsonFilters:null,updateId:n.updateId};r.visualHasNullFilter(i)&&r.onRestoreSelection(null),r.fixUpdateOptionsAndUpdateVisual(c,e,n)}).catch(function(l){return r.sendError(l)})},t.prototype.visualHasNullFilter=function(e){var r,n,i,a,o,s,l;if(null!==(o=null===(a=null===(i=null===(n=null===(r=this.plugin)||void 0===r?void 0:r.capabilities)||void 0===n?void 0:n.objects)||void 0===i?void 0:i.general)||void 0===a?void 0:a.properties)&&void 0!==o&&o.filter){var c=null===(s=null==e?void 0:e.objects)||void 0===s?void 0:s.general;if(c&&c.length>0&&null!==(l=c[0])&&void 0!==l&&l.properties&&!c[0].properties.filter)return!0}return!1},t.prototype.updateWithCachedData=function(e){var n,i,a,r=e.message.arguments[0];if(this.plugin&&this.plugin.apiVersion&&!_r(this.plugin.apiVersion,"2.0.0")){if(this.lastVisualUpdateOptions.dataViews&&this.lastVisualUpdateOptions.dataViews[0]&&this.lastVisualUpdateOptions.dataViews[0].metadata){var o=this.lastVisualUpdateOptions.dataViews[0].metadata.segment;this.lastVisualUpdateOptions.dataViews[0].metadata=r.dataViewMetadata?JSON.parse(r.dataViewMetadata):void 0,this.lastVisualUpdateOptions.dataViews[0].metadata.segment=o}i=this.lastVisualUpdateOptions.dataViews,a=!0}else r.dataTransforms&&(n=qy.deserializeDataViewTransformActions(r.dataTransforms,this.plugin.capabilities||{})),this.lastDataViewTransformApplyOptions.transforms=n,i=Sc(this.lastDataViewTransformApplyOptions).dataViews;var s=this.lastVisualUpdateOptions={dataViews:i,suppressAnimations:r.suppressAnimations,viewMode:r.viewMode,editMode:r.editMode,viewport:r.viewport,type:r.type,operationKind:dr.Create,resizeMode:r.resizeMode,isInFocus:r.isInFocus,jsonFilters:r.jsonFilters?r.jsonFilters:null,updateId:r.updateId,formatMode:r.formatMode,subSelections:r.subSelections};this.fixUpdateOptionsAndUpdateVisual(s,e,r,a)},t.prototype.loadResourcePackage=function(e){var r=this;u.assertValue(e,"resourcePackage"),this.resourceLoader.loadVisualPlugin(e).then(function(n){r.plugin=n,r.createAdapter()}).catch(function(){var n=new Error("Unable to load plugin, resource package id: "+e.id);return r.sendError(n)})},t.prototype.createAdapter=function(){var e=this.plugin;if(this.container.addClass("visual-"+e.name),this._visual=function(t,e,r,n,i,a,o){var s=new jh(t,e,r,n,i,o),l=function(t,e){return t&&(t=new bD(t),e&&(t=new uD(t,e))),t}(s,a);return new vD(l,t,r,n,s.isPluginInError,o)}(e,e.create,this.promiseFactory,this.telemetryProxyService,void 0,void 0,this.certifiedEventsProxyService),!e||!this.visual){var r=new Error("Unable to create visual from plugin "+e.name);return this.sendError(r)}this.flushQueue(),this.isVisualInitialized=!0,this.sendSandboxReady()},t.prototype.loadWithoutResourcePackage=function(e){if(this.plugin)this.sendError(new Error("Plugin is already loaded"));else{var n=e.apiVersion?this.isolate&&_r(e.apiVersion,"3.0.0"):this.isolate;this.plugin=YS(e,!1,n),So(this.plugin),this.createAdapter()}},t.prototype.enumerateObjectInstances=function(e){if(this.visual.enumerateObjectInstances){var r=this.visual.enumerateObjectInstances(e);if(r){var n=r,i=this.plugin&&this.plugin.apiVersion&&!_r(this.plugin.apiVersion,"2.0.0");return n&&n.instances?i?{instances:n.instances,containers:n.containers}:{instances:ti(n.instances),containers:n.containers?DU(n.containers,this.resourceProvider):null}:i?r:ti(r)}}},t.prototype.enumerateObjectRepetition=function(){if(this.visual.enumerateObjectRepetition){var e=this.visual.enumerateObjectRepetition();return e?function(t){return u.assertValue(t,"repetitions"),_.isEmpty(t)?[]:_.map(t,sO)}(e):void 0}},t.prototype.getFormattingModel=function(){var e,r;return null===(r=(e=this.visual).getFormattingModel)||void 0===r?void 0:r.call(e)},t.prototype.getSubSelectionStyles=function(e){var r,n;return this.reCreateSelectionIds(e),null===(n=(r=this.visual).getSubSelectionStyles)||void 0===n?void 0:n.call(r,e)},t.prototype.getSubSelectionShortcuts=function(e,r){var n,i;return this.reCreateSelectionIds(e),null===(i=(n=this.visual).getSubSelectionShortcuts)||void 0===i?void 0:i.call(n,e,r)},t.prototype.getSubSelectables=function(e){var r,n;return null===(n=(r=this.visual).getSubSelectables)||void 0===n?void 0:n.call(r,e)},t.prototype.focusVisualIframeWindow=function(){window.focus()},t.prototype.sendUpdateResult=function(){var e=this.container.children("*").length;this.messageProxy.postMessage({eventName:"onUpdateResult",arguments:[e]})},t.prototype.sendSandboxReady=function(){this.messageProxy.postMessage({eventName:"onPluginReady",arguments:[]})},t.prototype.flushQueue=function(){for(;this.messageQueue.length>0;){var e=this.messageQueue.shift();this.executeMessage(e)}},t.prototype.sendError=function(e,r){this.messageProxy.postMessage({eventName:"onError",arguments:[],error:{id:r?r.id:null,eventName:r?r.eventName:null,name:e.name,message:e.message,pluginName:this.plugin.name}})},t.prototype.sendErrorMessage=function(e,r){this.messageProxy.postMessage({eventName:"onError",arguments:[],error:{eventName:e,message:r,pluginName:this.plugin.name}})},t.prototype.onMessageReceived=function(e){if(this.isVisualInitialized||"loadResourcePackage"===e.message.eventName||"loadWithoutResourcePackage"===e.message.eventName)return this.executeMessage(e);this.messageQueue.push(e)},t.prototype.validateSandboxHostMessage=function(e){var n=this[e.message.eventName];return n?"function"!=typeof n?{error:"not a function"}:n.approvedMessage?{ok:!0}:{error:"unapproved type"}:{error:"undefined method"}},t.prototype.validateVisualMessage=function(e){var r=e.message;if(!this.visual)return{error:"unset visual"};var n=this.visual[r.eventName];return n?"function"!=typeof n?{error:"not a function"}:jh.prototype[r.eventName].approvedMessage?{ok:!0}:{error:"unapproved type"}:{error:"undefined method"}},t.prototype.executeMessage=function(e){var n,i,r=e.message,a="SandboxHost.executeMessage rejected message:";if(e.source===window||e.source.parent!==window){if(e.source!==this.messageProxy.contentWindow)return this.sendErrorMessage(r.eventName,"".concat(a," invalid source"));if(e.origin!==this.hostOrigin)return this.sendErrorMessage(r.eventName,"".concat(a," invalid origin"));try{if((n=this.validateSandboxHostMessage(e)).ok)return"update"===r.eventName||"updateWithCachedData"===r.eventName||"handleLoadMoreDataResult"===r.eventName?this[r.eventName].call(this,e):this[r.eventName].apply(this,r.arguments);if((i=this.validateVisualMessage(e)).ok)return this.visual[r.eventName].apply(this.visual,r.arguments)}catch(o){return void this.sendError(o,r)}this.sendErrorMessage(r.eventName,"".concat(a," ").concat(null==n?void 0:n.error,", ").concat(null==i?void 0:i.error))}},t.prototype.reCreateSelectionIds=function(e){e&&e.forEach(function(r){var n=r.customVisualObjects[0].selectionId;r.customVisualObjects[0].selectionId=n&&new oe(n.dataMap,n.measures)})},t.prototype.transformDataViewSource=function(e,r,n){var i=this,a=this.promiseFactory.defer();return(e?this.createDataView(e):this.promiseFactory.resolve({dataView:null})).then(function(s){var l=Sc(i.lastDataViewTransformApplyOptions={prototype:s.dataView,objectDescriptors:i.plugin.capabilities?i.plugin.capabilities.objects:void 0,dataViewMappings:i.plugin.capabilities?i.plugin.capabilities.dataViewMappings:void 0,dataRoles:i.plugin.capabilities?i.plugin.capabilities.dataRoles:void 0,drillCapabilities:i.plugin.capabilities&&i.plugin.capabilities.drilldown,expandCollapseCapabilties:i.plugin.capabilities&&i.plugin.capabilities.expandCollapse,transforms:r,colorAllocatorFactory:ho(),bypassConcatenation:n,visualStyle:i.style,keepAllMetadataColumnsCapability:!!i.plugin.capabilities&&i.plugin.capabilities.keepAllMetadataColumns,featureSwitches:i.featureSwitches}).dataViews;a.resolve({dataViews:l})}).catch(function(s){return i.sendError(s)}),a.promise},t.prototype.createDataView=function(e){var r=this;u.assertValue(e,"dataViewSource");var n=this.promiseFactory.defer();return this.dataProxy.execute({type:e.type,query:{dataSources:null,command:e.data}}).then(function(a){var s=function(t,e){if(!e||0===e.length)return{dataView:t,isValid:!0};if(t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(SF(t,i))return{dataView:t,isValid:!0};if(i.categorical&&t.categorical)return vF(t,i);if(i.tree&&t.tree)return yF(t,i.tree);if(i.single&&t.single)return gF(t,i.single);if(i.table&&t.table)return mF(t,i.table)}if(t.metadata)return{dataView:{metadata:t.metadata},isValid:!0}}return{isValid:!1}}(a&&a.dataReaderResult?a.dataReaderResult.dataView:null,r.plugin.capabilities?r.plugin.capabilities.dataViewMappings:null);n.resolve({dataView:s.dataView})}).catch(function(a){return r.sendError(a)}),n.promise},t.prototype.attachWindowResizeListener=function(){$(window).on("resize",this.windowResizeListener.bind(this)),$(window).trigger("resize")},t.prototype.detachWindowResizeListener=function(){$(window).off("resize")},t.prototype.windowResizeListener=function(){if(this.lastVisualUpdateOptions){var e=$(window).height(),r=$(window).width();if(!(this.skipRedundantResize&&this.lastVisualUpdateOptions.viewport&&this.lastVisualUpdateOptions.viewport.width&&this.lastVisualUpdateOptions.viewport.height&&Math.abs(r-this.lastVisualUpdateOptions.viewport.width)<=1&&Math.abs(e-this.lastVisualUpdateOptions.viewport.height)<=1)){var n=ve(this.lastVisualUpdateOptions);n.viewport={width:r,height:e,scale:this.lastVisualUpdateOptions.viewport.scale},n.type=_t.Resize,n.resizeMode=1,this.visual.update(n)}}},t.prototype.attachRelayUIEventListener=function(){$(window).on(hf.join(" "),this.relayKeyboardEventListener),this.container.on(vf.join(" "),this.relayUIEventListener)},t.prototype.detachRelayUIEventListener=function(){$(window).off(hf.join(" "),this.relayKeyboardEventListener),this.container.off(vf.join(" "),this.relayUIEventListener)},t.prototype.attachFormatModeRelayUIEventListener=function(){$(window).on(gf.join(" "),this.relayKeyboardEventListener)},t.prototype.detachFormatModeRelayUIEventListener=function(){$(window).off(gf.join(" "),this.relayKeyboardEventListener)},t.prototype.handleAttachingEventListeners=function(){this.formatMode?(this.detachRelayUIEventListener(),this.attachFormatModeRelayUIEventListener()):(this.detachFormatModeRelayUIEventListener(),this.attachRelayUIEventListener())},t.prototype.isSupportedKeyBoardEvent=function(e){var r=this.formatMode?hO:pO;return e.key in r&&_.every(r[e.key],function(i){return i in e&&e[i]})},t.prototype.handleLoadMoreDataResult=function(e){return nt(this,void 0,void 0,function(){var r,n,i,a,o,s,l,f=this;return it(this,function(d){switch(d.label){case 0:return r=e.message.arguments[1],this.plugin&&this.plugin.apiVersion&&!_r(this.plugin.apiVersion,"2.0.0")?(i=e.message.arguments[2],(n=e.message.arguments[0])&&this.stringifiedDataView!==n.stringifiedDataView?(this.stringifiedDataView=n.stringifiedDataView,a=!(!this.plugin.capabilities.expandCollapse||!this.plugin.capabilities.dataViewMappings[0].matrix),o=[this.dataViewSerializer.deserializeDataView(n,sn(this.plugin.apiVersion,"3.5.9"),a,i,th(this.plugin.apiVersion,"5.3.0"))],this.lastVisualUpdateOptions.type=_t.Data,r?(cS(this.lastVisualUpdateOptions.dataViews[0],o[0]),this.lastVisualUpdateOptions.operationKind=dr.Append,[4,this.aggregateDataViewSizeAndUpdateVisual(e.packedSize)]):[3,2]):[3,4]):[3,5];case 1:return d.sent(),[3,4];case 2:return this.lastVisualUpdateOptions.dataViews[0]=o[0],this.lastVisualUpdateOptions.operationKind=dr.Segment,[4,this.visual.update(this.lastVisualUpdateOptions)];case 3:d.sent(),d.label=4;case 4:return[3,9];case 5:return u.assert(function(){return f.lastDataViewTransformApplyOptions&&!!f.lastDataViewTransformApplyOptions.prototype},"Expected to have previous segment already"),(l=(s=e.message.arguments[0])?s.dataReaderResult.dataView:null)?(this.lastVisualUpdateOptions.type=_t.Data,r?(cS(this.lastDataViewTransformApplyOptions.prototype,l),this.lastVisualUpdateOptions.dataViews=Sc(this.lastDataViewTransformApplyOptions).dataViews,this.lastVisualUpdateOptions.operationKind=dr.Append,[4,this.aggregateDataViewSizeAndUpdateVisual(e.packedSize)]):[3,7]):[3,9];case 6:return d.sent(),[3,9];case 7:return this.lastVisualUpdateOptions.dataViews[0]=l,this.lastVisualUpdateOptions.operationKind=dr.Segment,[4,this.visual.update(this.lastVisualUpdateOptions)];case 8:d.sent(),d.label=9;case 9:return this.messageProxy.postMessage({eventName:"stopProgressBar",arguments:[]}),[2]}})})},t.prototype.aggregateDataViewSizeAndUpdateVisual=function(e){return nt(this,void 0,void 0,function(){return it(this,function(r){switch(r.label){case 0:return this.aggregatedDataViewSize+=e,this.hostServicesControl.enableLoadMoreData(!(this.aggregatedDataViewSize>=104857600)),[4,this.visual.update(this.lastVisualUpdateOptions)];case 1:return r.sent(),[2]}})})},t.prototype.handleGetResourceUrlResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId,e.payload):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.payload)},t.prototype.handleGetAADAuthenticationTokenResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId,e.payload):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e)},t.prototype.handleGetAADTokenResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId,e.payload):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.payload)},t.prototype.handleGetWACTokenResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise2(e.promiseId,e.payload?e.payload:""):this.sandboxPromiseHandler.ResolvePromise2(e.promiseId,e.wacToken)},t.prototype.handleGetStorageStatus=function(e){this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.status)},t.prototype.handleGetStorageData=function(e){e.data?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},t.prototype.handleSetStorageData=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.freeSpace)},t.prototype.handleGetStorageV2Data=function(e){e.isError||!e.data?this.sandboxPromiseHandler.RejectPromise(e.promiseId):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data)},t.prototype.handleSetStorageV2Data=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.resultInfo)},t.prototype.handleExportVisualsContentStatus=function(e){void 0!==e.status?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.status):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},t.prototype.handleExportVisualsContent=function(e){void 0!==e.data?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},t.prototype.handleGetWebAccessStatus=function(e){void 0!==e.status?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.status):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},t.prototype.handleModalDialogResult=function(e){e.isError?this.sandboxPromiseHandler.RejectPromise(e.promiseId,e.data):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data)},t.prototype.handleAcquireAADTokenResult=function(e){this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.data)},t.prototype.handleGetAcquireAADTokenStatus=function(e){this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.status)},t.prototype.handleLicenseResult=function(e){e.licenseInfoResult?this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.licenseInfoResult):this.sandboxPromiseHandler.RejectPromise(e.promiseId)},t.prototype.handleLicenseNotificationResult=function(e){null==e.licenseNotificationResult?this.sandboxPromiseHandler.RejectPromise(e.promiseId):this.sandboxPromiseHandler.ResolvePromise(e.promiseId,e.licenseNotificationResult)},t.prototype.onRestoreSelection=function(e){var r=this.hostServices.selectionManager;if(r)if(e&&e.selection){var n=e.selection.map(function(i){return uo.fromSelectorsByColumn(function(t){if(u.assertAnyValue(t,"input"),t){var e={};if(t.dataMap)for(var r in e.dataMap={},t.dataMap)e.dataMap[r]=_.chain(t.dataMap[r]).map(function(n){return Ry(n)}).filter(function(n){return null!=n}).value();return t.metadata&&(e.metadata=t.metadata),t.id&&(e.id=t.id),e}}(i))});r.setSelectionIds(n),r.invokeOnSelectCallback(n)}else r.setSelectionIds([]),r.invokeOnSelectCallback([])},t.prototype.onRestoreCvSelectionIds=function(e,r){void 0===r&&(r=!0);var n=this.hostServices.selectionManager;if(n){var i=[];e?(i=_.map(e,function(a){return new oe(a.serializedDataMap,a.measures)}),n.setSelectionIds(i)):n.setSelectionIds([]),r&&n.invokeOnSelectCallback(i)}},t.prototype.fixUpdateOptionsAndUpdateVisual=function(e,r,n,i){void 0===i&&(i=!1),i||(e=this.categoriesExists(e)?this.getHostCategoriesValues(n.categoriesValues,e,n.isCategoryDate):e,this.hostServicesControl.enableLoadMoreData(!0),this.aggregatedDataViewSize=r.packedSize),this.visual.update(e),this.sendUpdateResult()},W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",Object)],t.prototype,"init",null),W([K(),x("design:type",Function),x("design:paramtypes",[]),x("design:returntype",void 0)],t.prototype,"destroy",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"update",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"updateWithCachedData",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"loadWithoutResourcePackage",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",Object)],t.prototype,"enumerateObjectInstances",null),W([K(),x("design:type",Function),x("design:paramtypes",[]),x("design:returntype",Array)],t.prototype,"enumerateObjectRepetition",null),W([K(),x("design:type",Function),x("design:paramtypes",[]),x("design:returntype",Object)],t.prototype,"getFormattingModel",null),W([K(),x("design:type",Function),x("design:paramtypes",[Array]),x("design:returntype",Object)],t.prototype,"getSubSelectionStyles",null),W([K(),x("design:type",Function),x("design:paramtypes",[Array,String]),x("design:returntype",Array)],t.prototype,"getSubSelectionShortcuts",null),W([K(),x("design:type",Function),x("design:paramtypes",[Number]),x("design:returntype",Array)],t.prototype,"getSubSelectables",null),W([K(),x("design:type",Function),x("design:paramtypes",[]),x("design:returntype",void 0)],t.prototype,"focusVisualIframeWindow",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",Promise)],t.prototype,"handleLoadMoreDataResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetResourceUrlResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetAADAuthenticationTokenResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetAADTokenResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetWACTokenResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetStorageStatus",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetStorageData",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleSetStorageData",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetStorageV2Data",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleSetStorageV2Data",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleExportVisualsContentStatus",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleExportVisualsContent",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetWebAccessStatus",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleModalDialogResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleAcquireAADTokenResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleGetAcquireAADTokenStatus",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleLicenseResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"handleLicenseNotificationResult",null),W([K(),x("design:type",Function),x("design:paramtypes",[Object]),x("design:returntype",void 0)],t.prototype,"onRestoreSelection",null),W([K(),x("design:type",Function),x("design:paramtypes",[Array,Object]),x("design:returntype",void 0)],t.prototype,"onRestoreCvSelectionIds",null),t}();function XS(){if(!ZS){window.powerbi||(window.powerbi={}),window.powerbi.visualSandbox||(window.powerbi.visualSandbox={});var t=JS;window.powerbi.visualSandbox.createSandboxHost=function(e,r){return void 0===r&&(r=!1),t(e,r)},ZS=!0}}var ZS=!1;function eb(){if(!tb){window.powerbi||(window.powerbi={}),window.powerbi.visualSandbox||(window.powerbi.visualSandbox={});var t=KS;window.powerbi.visualSandbox.onSecurityPolicyViolation=function(e){return t(e)},tb=!0}}XS();var tb=!1;eb(),Gm(),window.customVisualsHost=Ss}();