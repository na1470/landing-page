window.VisualisationWidgetBookmark=window.VisualisationWidgetBookmark||{},function(n){n.saveBookmark=function(u,f){var s=f[u],e;if(s&&(e=s.visualisationsOptions,e)&&!e.isDesignMode){var o=$("#"+e.saveBookmarkButtonId),c=$(o).attr("sf-data-bookmark-viewId"),l=$(o).attr("sf-data-bookmark-tabId"),a=$(o).attr("sf-data-bookmark-recaptcha"),v=$("#"+a),h=$(v).attr("sf-data-recaptcha-id");t(o,!0);onRecaptchaExecutedCallback=function(f){n.captureBookmark(u).then(function(n){if(n!=null){var t=new FormData;return t.append("visualisationWidgetId",e.widgetId),t.append("bookmarkName",n.name),t.append("bookmarkDisplayName",n.displayName),t.append("bookmarkState",n.state),t.append("currentPageUrl",e.currentPageUrl),t.append("tabId",l),t.append("viewId",c),t.append("g-recaptcha-response",f),i(t)}}).then(function(n){var i,u,f,s;if(n!=null){i=$("#"+e.bookmarkContainerId);u=$("#"+e.bookmarkContainerId+" > :input");u.val(n);i.removeAttr("hidden");f=$("#"+e.copyBookmarkButtonId);f.on("click",{bookmarkContainerId:e.bookmarkContainerId},r);s=$("#"+e.bookmarkModalId);s.show()}t(o,!1)},function(){t(o,!1)})};e.recaptchaEnabled?(grecaptcha.reset(h),grecaptcha.execute(h)):onRecaptchaExecutedCallback("")}};n.captureBookmark=function(n){var t=$.Deferred(),i=$("#"+n)[0],r=powerbi.get(i);return r.bookmarksManager.capture().then(function(n){t.resolve(n)}).catch(function(n){t.reject(n)}),t.promise()};n.hideModal=function(n){$("#"+n).hide()};var i=function(n){var i=$.Deferred(),r=window.sf_appPath||"/",u=r+"visualisations/savebookmark",t=new XMLHttpRequest;return t.open("POST",u),t.onload=function(){if(t.status===200){var n=JSON.parse(t.response);n.bookmarkUrl?i.resolve(n.bookmarkUrl):i.reject()}else i.reject()},t.onError=function(n){i.reject(n)},t.send(n),i.promise()},r=function(n){var t=$("#"+n.data.bookmarkContainerId+" > :input");t.prop("disabled",!1);t.select();document.execCommand("copy");t.prop("disabled",!0)},t=function(n,t){t?(n.attr("disabled","disabled"),n.children("i").addClass("power-bi-button-loader-hidden"),n.children(".power-bi-button-loader").removeClass("power-bi-button-loader-hidden")):(n.removeAttr("disabled"),n.children("i").removeClass("power-bi-button-loader-hidden"),n.children(".power-bi-button-loader").addClass("power-bi-button-loader-hidden"))}}(VisualisationWidgetBookmark);